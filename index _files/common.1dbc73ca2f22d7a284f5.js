(window.webpackJsonp=window.webpackJsonp||[]).push([["common"],{"+YbT":function(e,t){var n={obj:null,highlight:!1,start:function(e){e.touches&&1==e.touches.length&&(n.clear(),n.end(e),n.obj=this||null,n.obj&&(n.highlight=!0,addClass("hover",n.obj),addClass("_thover",n.obj)))},cancel:function(e){n.obj&&(n.highlight=!1,n.end(e))},end:function(){n.obj&&(removeClass("hover",n.obj),n.highlight&&(n.clear(),addClass("active",n.obj)),n.obj=null,n.highlight=!1)},clear:function(){removeClass("active",geByClass1("active","vk_wrap")),removeClass("active",$(".Popup .active._thover"))}};window.thover=n},"+ggo":function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return s}));var i=n("tGJf");function a(){var e=i.b.getItem("market_stat_data");return e&&JSON.parse(e)||{}}function o(){return a().screen||window.cur.module}function r(){return a().ownerId||0}function s(){return a().city}},"/88W":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"d",(function(){return l})),n.d(t,"g",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return _})),n.d(t,"f",(function(){return c})),n.d(t,"e",(function(){return s}));var i=n("UxAg"),a=(n("G0UO"),n("OcsD")),o=n("Xrg9"),r={ACCOUNT_HINT_MVK_VIDEO_FILTERS:"mvk:video_filters",ACCOUNT_HINT_TEXTLIVE_HIDE:"feed:textlive_hide",ACCOUNT_HINT_COMMUNITY_TEXTLIVES_COUNTER:"community:textlives_counter",ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP:"narratives:add_tooltip",ACCOUNT_HINT_FEED_POST_POPUP_REACTIONS:"feed:post_popup_reactions",ACCOUNT_HINT_FEED_POST_POPUP_SELECT_INACTIVE:"feed:post_popup_select_inactive",ACCOUNT_HINT_FEED_POST_PREVIEW_REACTIONS:"feed:post_preview_reactions",ACCOUNT_HINT_FEED_POST_REACTION:"feed:post_reaction",ACCOUNT_HINT_MVK_STORIES_ARCHIVE_PRIVACY_HINT:"mvk:stories_archive:privacy_hint",ACCOUNT_HINT_MVK_STORIES_ARCHIVE_ACTIONS_HINT:"mvk:stories_archive:actions_hint"};function s(e){window.store.helpHints.all=e}function c(){window.store.helpHints.shown=o.a.get("shown_tooltips")||{}}function l(e){return e?Object(i.a)('.Tooltip[tooltip-id="'+e+'"]'):null}function u(e){if(!e)return!1;if(!p(e))return!1;var t,n,i=(t=e,null===(n=window.store.helpHints.all[t])||void 0===n?void 0:n.hash),a=_(e),r=o.a.get("shown_tooltips")||{};r[e]=!0,o.a.set("shown_tooltips",r),window.store.helpHints.shown[e]=!0,window.store.helpHints.all[e].active=!1,a&&window.ajax.post("/",{act:"help_hints_hide",hint_id:e,hash:i})}function d(e){return!!e&&(Object(a.Vb)(e),!0)}function _(e){return d(l(e))}function p(e){return!(!e||window.store.helpHints.locked[e])&&(c(),Object(a.vb)(window.store.helpHints.all[e])?!window.store.helpHints.shown[e]:!window.store.helpHints.shown[e]&&window.store.helpHints.all[e].active)}c(),Object(a.b)(window,"click touchend touchcancel",(function(e){var t=e.target&&e.target.classList.contains("Tooltip")?e.target:e.target.closest(".Tooltip");if(t&&(e.preventDefault(),e.stopPropagation(),t.classList.contains("Tooltip_onboarding"))){var n=t.getAttribute("tooltip-id");u(n),_(n)}}),{capture:!0}),Object(a.b)(window,"touchstart mousedown click",(function(){var e=Object(i.b)(".Tooltip_closeOnOverlayClick[tooltip-id]");null==e||e.forEach(d)}),{passive:!0,capture:!0})},"/Id8":function(e,t,n){"use strict";n.r(t),n.d(t,"Msg__restoreInner",(function(){return U})),n.d(t,"Msg__reply",(function(){return q})),n.d(t,"Msg__authorName",(function(){return J})),n.d(t,"Msg__replyAttach",(function(){return Q})),n.d(t,"Msg__replyLink",(function(){return K})),n.d(t,"Msg__textPreview",(function(){return z})),n.d(t,"Msg__attachPreview",(function(){return Y})),n.d(t,"Msg_makeReplyLink",(function(){return F})),n.d(t,"Msg_makePinnedReplyLink",(function(){return V})),n.d(t,"Msg_detailed",(function(){return D}));var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("9y81"),s=n("KMpi"),c=n("u33z"),l=n("B+U2"),u=n("BoyB"),d=n("A6le"),_=n("SNk7"),p=n("+sJP"),h=n("EDm3"),f=n("vy0q");function m(){var e=Object(i.a)(["\n    ","\n  "]);return m=function(){return e},e}function v(){var e=Object(i.a)(['\n    <div class="msg__keyboard">\n      ',"\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.a)(['\n    <a class="','"\n      href="','"\n      ',"\n      ",'\n      style="width: ',"px; height: ",'px;"\n    >\n      <img class="msg__stickerImg sticker_img" height="','" src="','">\n    </a>\n  ']);return g=function(){return e},e}function b(){var e=Object(i.a)(['\n      <div class="','"\n        ',"\n        ",'\n        style="width: ',"px; height: ",'px;"\n      >\n        <img class="msg__stickerImg sticker_img" height="','" src="','">\n      </div>\n    ']);return b=function(){return e},e}function A(){var e=Object(i.a)(['\n    <div class="msg__stickerWrap">\n      ',"\n    </div>\n  "]);return A=function(){return e},e}function w(){var e=Object(i.a)(['\n    <a href="','" class="msg__replyLink" ',">\n      ","\n    </a>\n  "]);return w=function(){return e},e}function y(){var e=Object(i.a)(['\n    <div class="msg__replyAttach">',"</div>\n  "]);return y=function(){return e},e}function O(){var e=Object(i.a)(['\n    <div class="msg__bodyPreview">\n      ',"\n      ","\n    </div>\n  "]);return O=function(){return e},e}function k(){var e=Object(i.a)(['\n    <div class="msg__reply">\n      ','\n      <div class="msg__replyInner">\n        <div class="msg__replyHead">\n          <div class="msg__replyHeadRow">\n            <div class="msg__replyName">','</div>\n            <div class="msg__replyDate">','</div>\n          </div>\n        </div>\n        <div class="msg__replyBody">\n          ',"\n        </div>\n      </div>\n    </div>\n  "]);return k=function(){return e},e}function j(){var e=Object(i.a)(['\n    <div class="msg__info msg__restoreText msg__restoreText_remove">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ",'\n      </span>\n    </div>\n    <div class="msg__info msg__restoreText msg__restoreText_spam">\n      ','\n      <span class="msg__restoreText msg__infoLink" ',">\n        ","\n      </span>\n    </div>\n  "]);return j=function(){return e},e}function S(){var e=Object(i.a)(['\n    <span class="msg__edited">\n      <span class="msg__editedMiddot">&middot;</span><span class="msg__editedText">',"</span>\n    </span>\n  "]);return S=function(){return e},e}function C(){var e=Object(i.a)(['\n    <div class="msg__admin">\n      (<a class="msg__adminLink" href="','">',"</a>)\n    </div>\n  "]);return C=function(){return e},e}function E(){var e=Object(i.a)(['\n    <div class="msg__actions">\n      ',"\n    </div>\n  "]);return E=function(){return e},e}function T(){var e=Object(i.a)(['\n    <div class="msg_item','">\n      <div class="mi_header">\n        ','\n        <a class="msg__author" href="','">','</a>\n        <div class="msg__date">',"</div>\n        ","\n      </div>\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return T=function(){return e},e}function I(){var e=Object(i.a)(['\n    <div class="msg__detailed">\n      <div class="msg__detailedHead">\n        ','\n        <div class="msg__detailedInfo">\n          <div class="msg__detailedRow">\n            <a class="msg__detailedAuthor" href="','">','</a>\n            <span class="msg__detailedPeer">','</span>\n          </div>\n          <div class="msg__detailedRow">\n            <div class="msg__date">','</div>\n          </div>\n        </div>\n      </div>\n      <div class="msg__content">\n        <div class="msg__text">\n          ',"\n        </div>\n        ","\n      </div>\n      ","\n    </div>\n  "]);return I=function(){return e},e}function M(){var e=Object(i.a)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="msg__giftMedia">',"</div>\n      ","\n    </div>\n  "]);return M=function(){return e},e}function P(){var e=Object(i.a)(['\n    <div class="msg_item _msg single_msg_item msg__text">\n      <div class="mi_cont">\n        <div class="mi_body">\n          ',"\n          ","\n          ","\n          ","\n        </div>\n      </div>\n    </div>\n  "]);return P=function(){return e},e}function x(){var e=Object(i.a)(["\n    ",'\n    <div class="msg__content">\n      <div class="msg__head">\n        <a class="msg__author" href="','">',"</a>\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n      </div>\n      ",'\n      <div class="msg__text">\n        ',"\n      </div>\n      ",'\n    </div>\n    <div class="msg__restore">\n      ',"\n    </div>\n  "]);return x=function(){return e},e}function L(){var e=Object(i.a)(['\n    <div class="','" ',">\n      ","\n      ","\n    </div>\n  "]);return L=function(){return e},e}function R(){var e=Object(i.a)(['\n      <div class="','" ',">\n        ","\n      </div>\n    "]);return R=function(){return e},e}var B=function(e){var t=e.id,n=e.removed,i=e.isExpired,l=i||e.service,u=function(e){var t=window.lang,n=e.isDefaultCasperTimerShown;if(e.service)return e.text;var i,l=o.a.html(Object(s.a)({mix:"msg__avatar",url:e.authorUrl,src:e.authorPhoto,size:40,mode:Object(p.q)({id:e.authorId,name:e.authorName}),backgroundTheme:e.authorId,text:e.authorName,textLength:Object(p.r)(e.authorId)})),u=Object(r.b)({mix:"msg__check",icon:"check"}),_=o.a.html({class:"msg__star"}),f=!!e.attaches.gift,m=store.mail.msgs[e.id];m&&m.authorId===m.peerId&&(i=store.mail.peers[m.peerId]);var v=e.admin?(T=e.admin,a.a.html(C(),T.url,T.name)):"",g=e.removed?U(e.id):"",b=e.edited?H():"",A=e.pending||e.failed?"":'<div class="msg__date">'+e.date+"</div>",w=e.pending?o.a.html({inner:[Object(h.q)()],class:"msg__pending",tag:"div"}):"",y=e.failed?'<div class="msg__error">'+t.mobile_mail_send_error+"</div>":"",O=e.channel?function(e){var t=Object(c.default)({class:"msg__actionForward",onClick:a.a.onClick("Msg._onActionClick","event","forward",e)});return a.a.html(E(),t)}(e.id):"",k=f&&i?'<div class="msg__giftHead">'+langSex(i.sex,t.mobile_mail_sent_gift)+"</div>":"",j=Object(p.U)(),S=null;var T;e.ttl&&(S=Math.round(e.ts+e.ttl-j));var I,P=S?o.a.render(Object(d.default)({durationInSeconds:S,isDefaultCasperTimerShown:n})):"";I=f?function(e){var t=e.text,n=e.attachesHTML;t&&(t='<div class="msg__giftText">'+t+"</div>");return a.a.html(M(),n,t)}(e):N(e);var L=e.keyboard?X(e):"";return a.a.html(x(),l,e.authorUrl,e.authorName,k,A,w,y,b,v,P,u,_,O,I,L,g)}(e),f=!l&&!(!e.attaches||!e.attaches.gift),m=!(!e.attaches||!e.attaches.group_call_in_progress),v=a.a.class("msg",{id:t,service:l,unread:e.unread&&!e.failed,important:e.important,removed:!!n,spam:"spam"===n,pending:e.pending,failed:e.failed,gift:f,call:m,hasTemplate:!!e.template}),g="";l||m||(g=e.pending||e.failed?a.a.onClick("Msg._onPendingClick","event","this",t,e.sendId||"",!!e.failed):a.a.onClick("Msg._onClick","event","this",t));if(i){var b=o.a.render(Object(_.default)());return a.a.html(R(),v,g,b)}var A=e.template?$(e):"";return a.a.html(L(),v,g,u,A)};function N(e){var t,n,i=window.lang,r=Object(p.N)(e.text),c=0;e.attachesHTML?t=e.attachesHTML:e.attaches.sticker&&e.sticker?(n=function(e,t,n,i,o,r,s){void 0===i&&(i=""),void 0===o&&(o=!0),void 0===r&&(r=""),void 0===s&&(s="");var c=Date.now(),l=Math.random(),u=""+c+l,d="msg__sticker",_="";s&&(d+=" sticker_animation",_='\n      data-animation-path="'+s+'"\n      data-uniq-id="'+u+'"\n      data-sticker-id="'+e+'"\n      data-loop-count="3"\n      ontouchstart="StickersAnimation.touchStartSticker(this);"\n      ontouchend="StickersAnimation.touchEndSticker(this);"\n    ');var h=a.a.onClick("Msg._onStickerClick","event","this",o,i);return Object(p.H)()?a.a.html(b(),d,_,h,t,t,t,n):a.a.html(g(),d,r,h,_,t,t,t,n)}(e.sticker.id,e.sticker.height,e.sticker.url),t=a.a.html(A(),n)):ee(e)&&Object.keys(e.attaches).length&&(c+=1,t=G(Y(e),!e.failed&&1===c));var l,u=e.forwards;u.length&&(ee(e)&&Z(u)?(c+=1,l=G(langNumeric(u.length,i.mobile_mail_N_forwards),!e.failed&&1===c)):l=(l=u.map((function(t){return function e(t,n,i){var r=window.lang,c=store.mail,l=c.forwards[t]||c.msgs[t];if(!l)return"";var u,d=c.members[l.authorId],_=l.peerId,h=(c.peers[_],J(d,_,c.cur.userId)),f=l.edited,m=d.avatar,v=d.url,g=h,b=l.date,A=Object(p.N)(l.text),w=l.attachesHTML,y=l.forwards,O=l.reply,k=o.a.html(Object(s.a)({mix:"mi_author_photo",src:m,size:36,mode:Object(p.q)({id:l.authorId,name:g}),backgroundTheme:l.authorId,text:g,textLength:Object(p.r)(l.authorId)})),j=f?H():"";if(i>0){for(var S=[],C=y.length,E=0;E<C;E++){var I=e(y[E],n,i-1);S.push(I)}u=S.join("")}else if(y.length){var M=langNumeric(y.length,r.mobile_mail_N_forwards);u='<a href="/mail?act=msg&id='+n+'" class="msg__fwdsLink">'+M+"</a>"}w&&(w='<div class="mi_medias">'+(w=w.replace(/%top_msg_id%/g,n))+"</div>");u&&(u='<div class="mi_forwarded">'+u+"</div>");A&&(A='<div class="mi_text">'+A+"</div>");var P=O?W(O,n,{}):"",x=l.attaches.gift?" msg__forwardGift":"";return a.a.html(T(),x,k,v,g,b,j,P,A,w,u)}(t,e.id,e.maxDepth-1)}))).join(""));var d,_=e.reply;_&&(ee(e)&&(Z([_])||!function(e){var t=store.mail;return Object(p.E)(e)?!!t.replies[e]:!!t.pendingReplies[e]}(_))?(c+=1,d=G(i.mobile_mail_in_reply_to,!e.failed&&1===c)):d=W(_,e.id,{isPinned:e.isPinned,chatId:e.chatId}));return t&&(t='<div class="mi_medias">'+t+"</div>"),l&&(l='<div class="mi_forwarded">'+l+"</div>"),r&&(r='<div class="mi_text">'+r+"</div>"),a.a.html(P(),d,r,t,l)}function D(e){var t=N(e),n=e.keyboard?X(e):"",i=e.template?$(e):"",r=o.a.html(Object(s.a)({mix:"msg__avatar",url:e.authorUrl,src:e.authorPhoto,size:40,mode:Object(p.q)({id:e.authorId,name:e.authorName}),backgroundTheme:e.authorId,text:e.authorName,textLength:Object(p.r)(e.authorId)})),c=function(e){var t=window.lang,n=store.mail,i=n.msgs[e.id],a=n.peers[i.peerId],o="";if(Object(p.B)(i.peerId)){var r='<a href="'+Object(p.X)("/mail?act=show&peer="+i.peerId)+'">'+a.title+"</a>";o=t.mobile_mail_message_to_chat.replace("{chat}",r)}return o}(e);return a.a.html(I(),r,e.authorUrl,e.authorName,c,e.date,t,n,i)}function H(){var e=window.lang;return a.a.html(S(),e.mobile_mail_edited_short)}function U(e){var t=window.lang,n=a.a.onClick("Msg._onRestoreClick","event",e);return a.a.html(j(),t.mobile_msg_mail_message_deleted,n,t.mobile_restore,t.mobile_msg_mail_message_marked_as_spam,n,t.mobile_restore)}function V(e,t){var n="/mail?act=msg";return n=Object(p.h)(n,"&id=pinned&chat="+e),t&&(n=Object(p.h)(n,"&reply_id="+t+"&reply=true")),Object(p.X)(n)}function F(e,t,n){var i="/mail?act=msg";return t?(i=Object(p.h)(i,"&id="+t+"&reply=true"),n&&(i=Object(p.h)(i,"&reply_id="+n))):i=Object(p.h)(i,"&id="+e),Object(p.X)(i)}function W(e,t,n){var i=store.mail.forwards[e]||store.mail.msgs[e],a=store.mail.replies[e]||store.mail.pendingReplies[e];return K(q(i,J(store.mail.members[i.authorId],i.peerId,store.mail.cur.userId),a.preview_url),a.msg_id,t,e,n)}function q(e,t,n){var i="";i=e.isExpired?'<span class="msg__replyDisappeared">'+Object(p.t)("mobile_casper_chat_message_disappeared")+"</span>":e.body?z(e.body):Q(e);var o="";return(e.attaches.photo||e.attaches.video||e.attaches.doc)&&(o=n?'<div class="msg__replyPreview"\n        style="background-image: url('+n+')"></div>':e.attaches.doc?'<div class="msg__replyPreview msg__replyPreview_icon">\n        <div class="msg__replyPreviewDoc"></div>\n      </div>':'<div class="msg__replyPreview msg__replyPreview_empty"></div>'),a.a.html(k(),o,t,e.date,i)}function z(e){return e=e.replace(/<br>/g,"\n"),e=Object(p.L)(e,"@$3"),e=Object(p.M)(e,"$3"),e=Object(p.l)(e)}function Y(e){var t,n=window.lang,i=Object.keys(e.attaches),a=i.length;if(a>1){for(var o=0,r=i.length,s=0;s<r;s++)o+=0|e.attaches[i[s]];t=langNumeric(o,n.mobile_mail_attachments)}else if(1===a){var c=i[0],l=e.attaches[c];if(1===l)switch(c){case"poll":t=n.mobile_mail_added_poll;break;case"article":t=n.global_article;break;case"artist":t=n.mobile_mail_added_artist;break;case"curator":t=n.mobile_mail_added_curator;break;case"photo":t=n.mobile_mail_added_photo;break;case"video":t=n.mobile_mail_added_video;break;case"audio":t=n.mobile_mail_added_audio;break;case"audio_playlist":t=n.mobile_mail_added_audio_playlist;break;case"money_transfer":t=n.mobile_mail_added_money_transfer;break;case"podcast":t=n.mobile_mail_added_podcast;break;case"money_request":t=n.mobile_mail_added_money_request;break;case"vkpay":t=n.mobile_mail_added_vkpay;break;case"story":t=n.mobile_mail_added_story;break;case"narrative":t=n.mobile_mail_added_narrative;break;case"graffiti":t=n.mobile_mail_added_graffiti;break;case"audiomsg":t=n.mobile_mail_added_audiomsg;break;case"doc":t=n.mobile_mail_added_doc;break;case"geo":case"map":t=n.mobile_mail_added_geo;break;case"wall":t=n.mobile_mail_added_wall;break;case"wall_reply":t=n.mobile_mail_added_wall_reply;break;case"gift":t=n.mobile_mail_added_gift;break;case"link":t=n.mobile_mail_added_link;break;case"sticker":t=n.mobile_mail_added_sticker;break;case"market":t=n.mobile_mail_added_market_item;break;case"call":case"group_call_in_progress":t=n.mobile_mail_added_call;break;case"donut_link":t=n.mobile_mail_added_donut_link}else if(l>1)switch(c){case"photo":t=langNumeric(l,n.mobile_mail_added_photos);break;case"video":t=langNumeric(l,n.mobile_mail_added_videos);break;case"audio":t=langNumeric(l,n.mobile_mail_added_audios);break;case"doc":t=langNumeric(l,n.mobile_mail_added_docs)}}var u=e.forwards&&e.forwards.length||e.hasReply;return!t&&u&&(t=e.hasReply?langNumeric(1,n.mobile_mail_messages):langNumeric(e.forwards.length,n.mobile_mail_N_forwards)),t||""}function G(e,t){var n;return t&&(n='<div class="msg__loading">'+(n=Object(u.a)({large:!0}))+"</div>"),a.a.html(O(),e,n)}function Q(e){var t=Y(e);return a.a.html(y(),t)}function K(e,t,n,i,o){var r="";r=o.isPinned&&o.chatId?V(o.chatId,i):F(t,n,i);var s=a.a.onClick("Msg._onReplyClick","event",t,n,i);return a.a.html(w(),r,s,e)}function X(e){var t=te(e.id),n=o.a.render(Object(l.b)({msgId:e.id,pressed:t,keyboard:e.keyboard}));return a.a.html(v(),n)}function $(e){switch(e.template.type){case"carousel":return function(e){for(var t=[],n=0;n<e.template.elements.length;n++){var i=e.template.elements[n];t[n]=Object(p.m)(i,{pressed:te(e.id,"carousel"+n)})}var r=o.a.render(Object(f.a)({msgId:e.id,authorId:e.authorId,elements:e.template.elements,pressed:t}));return a.a.html(m(),r)}(e)}return""}function J(e,t,n){return t>2e9?e.name:t>-2e9&&t<0?e.id===n?e.firstName:e.name:e.firstName}function Z(e){for(var t=store.mail.msgs,n=store.mail.members,i=store.mail.forwards,a=e.length,o=0;o<a;o++){var r=e[o];if(Object(p.E)(r)){var s=i[r];if(!s)return!0;if(!s.authorId||!n[s.authorId])return!0}else{var c=t[r];if(!c)return!0;if(!c.authorId||!n[c.authorId])return!0}}return!1}function ee(e){return e.pending||e.failed||e.waiting}function te(e,t){void 0===t&&(t="");var n=window.store,i="";return t&&(i=t+"|"),n.mail&&n.mail.cur&&n.mail.cur.pressedButtons?n.mail.cur.pressedButtons.msgs[i+e]:{}}var ne=n("UxAg"),ie=n("+cqQ"),ae=n("Gzds"),oe=n("OcsD"),re=need("Voting");Object.assign(B,{class:"msg",onClick:Object(ie.a)(),onPendingClick:Object(ie.a)(),onRestoreClick:Object(ie.a)(),onReplyClick:Object(ie.a)(),onForward:Object(ie.a)(),onLoadAgain:Object(ie.a)(),getElem:function(e){return Object(ne.a)(".msg_id_"+e)},remove:function(e,t){void 0===t&&(t=!1);t?Object(ne.b)(".msg_id_"+e).forEach((function(e){return e.remove()})):_e(e,!1)},spam:function(e){_e(e,!0)},restore:function(e){Object(ne.b)(".msg_id_"+e).forEach((function(e){e.classList.remove("msg_removed"),e.classList.remove("msg_spam")}))},unselectAll:function(){Object(ne.b)(".msg_selected").forEach((function(e){return e.classList.remove("msg_selected")}))},getReplyDataFromHTML:function(e){var t=e&&B.getElem(e),n="";if(t){var i=Object(ne.a)(".thumbs_map .thumb_map_img_as_div",t);return(n=i&&i.style.backgroundImage)&&(n=n.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,"")),{msg_id:e,parent_id:null,preview_url:n}}return null},toggleImportant:function(e,t){[].concat(e).forEach((function(e){var n=Object(ne.a)(".msg_id_"+e);n&&n.classList.toggle("msg_important",t)}))},markAsRead:function(e){Object(ne.b)(".msg_id_"+e).forEach((function(e){return e.classList.remove("msg_unread")}))},getId:function(e){var t=a.a.parseClass(ce,e.className);return Number(t.id)},getTextHtml:function(e){return e.$(le).innerHTML}}),B._onClick=pe,B._onPendingClick=he,B._onTouchStart=me,B._onRestoreClick=de,B._onActionClick=ve,B._onReplyClick=be,B._onStickerClick=Ae,B.onStickerTouchStart=we;var se,ce="msg",le=".msg__text",ue=!1;function de(e,t){e.stopPropagation(),t=parseInt(t,10),B.onRestoreClick(t)}function _e(e,t){void 0===t&&(t=!1);var n=U(e);Object(ne.b)(".msg_id_"+e).forEach((function(e){e.$(".msg__restore").innerHTML=n,e.classList.remove("msg_selected"),e.classList.add("msg_removed"),e.classList.toggle("msg_spam",t)}))}function pe(e,t,n){fe(e.target,t,(function(){t.classList.toggle("msg_selected"),B.onClick(n)}))}function he(e,t,n,i,a){fe(e.target,t,(function(){B.onPendingClick(n,i,a)}))}function fe(e,t,n){for(var i,a,o=t.classList.contains("msg_pending")||t.classList.contains("msg_failed");e!==t;)if(o&&-1!==e.className.indexOf("msg__sticker"))e=e.parentElement;else{if("A"===e.tagName||"BUTTON"===e.tagName||e.getAttribute("onclick")||e.classList.contains("im_msg_audiomsg")||e.classList.contains("articleSnippet__block")||e.classList.contains("MailButton")||e.closest("."+re.cls))return;e=e.parentElement}ue?ue=!1:ge()||t.classList.contains("msg_removed")||t.classList.contains("msg_spam")||store.mail.cur.editing||(null==(i=window.Speech)||null==(a=i.recorder)?void 0:a.isRecording)||Object(ne.a)(".VoiceRecordControls")||n()}function me(){ge()&&(ue=!0)}function ve(e,t,n){switch(t){case"forward":B.onForward(n)}}function ge(){return window.getSelection().toString().length>0}function be(e,t,n,i){e.preventDefault(),B.onReplyClick(t,n,i)}function Ae(e,t,n,i){n&&(e.preventDefault(),i&&ae.a.stickersClick(t,i))}function we(e,t){if(clearTimeout(se),!!t.getAttribute("data-animation-path")){var n=e.touches[0].clientX,i=e.touches[0].clientY;Object(oe.b)(t,"contextmenu",ye),Object(oe.b)(t,"touchmove",a,{passive:!0}),Object(oe.b)(t,"touchend",o,{passive:!0}),Object(oe.b)(t,"touchcancel",o,{passive:!0}),se=setTimeout((function(){!function(e){StickersAnimation.loadAndPlaySticker(e)}(t),o()}),500)}function a(e){(Math.abs(e.touches[0].clientX-n)>=10||Math.abs(e.touches[0].clientY-i)>=10)&&o()}function o(){clearTimeout(se),Object(oe.Zb)(t,"contextmenu",ye),Object(oe.Zb)(t,"touchmove",a,{passive:!0}),Object(oe.Zb)(t,"touchend",o,{passive:!0}),Object(oe.Zb)(t,"touchcancel",o,{passive:!0})}}function ye(e){event.preventDefault(),event.stopPropagation()}t.default=B;window.Msg=B},"03kU":function(e,t,n){"use strict";var i=n("OmnB"),a=n.n(i),o=n("jE6c"),r=100,s=101,c=102,l=103,u=105,d=106,_=107,p=108,h=109,f=110,m=112,v=113,g=[s,l,c,d,_,p,h,f],b="click_on_video",A="click_on_audio",w="click_on_photo",y="external_link_click",O="click_on_carousel_next",k="click_on_carousel_prev",j="click_on_mentions",S="night_mod_on",C="night_mod_off",E="close";function T(e,t,n){var i=[];if(Object(o.b)(e,(function(e,t){n&&!["w","z","y","x","m","s"].includes(e)||i.push(t)})),!i.length)return[!1];i.sort((function(e,t){return e[1]-t[1]})),t*=window.devicePixelRatio>=2?2:1;var a=i[i.length-1];return Object(o.b)(i,(function(e,n){if(n[1]>=t)return a=n,!1})),a}var I={};function M(e,t){if(Object(o.o)(t)&&!Object(o.k)(t)){var n="https://vk-callback.go.mail.ru/longread_pxl?action="+e;Object(o.b)(t,(function(e,t){n+="&"+e+"="+t})),(new Image).src=n}}function P(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t||location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function x(e){if(/^https?:\/\/([\w-]+\.)*(instagram\.com|instagr\.am)$/.test(e.origin)){var t=function(e){for(var t,n=document.getElementsByTagName("iframe"),i=n.length-1;i>=0;i--){var a=n[i];if(a.contentWindow===e.source){t=a;break}}return t}(e);if(t){try{e=JSON.parse(e.data)}catch(e){}"object"==typeof e&&"string"==typeof e.type&&"object"==typeof e.details&&setTimeout((function(){if("MEASURE"===e.type){var n=e.details.height;t.setAttribute("height",n)}}),100)}}}function L(e,t){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes"));(domData(n,"media-links")||"").split(",");if(!(i.length<=1||domData(e,"carousel-inited"))){if(domData(e,"carousel-inited",1),t.mobile)return function(e,t,n){void 0===n&&(n={});var i,a,r,s=geByClass1("article_photo_carousel__controls",t),c=geByClass1("article_photo_carousel__counter",t),l=domData(c,"counter-lang")||getLang("global_article_carousel_counter"),u=getSize(geByClass1("article_figure_content",t)),d=geByClass1("article_photo_carousel_inner",t),_=n.onClick,p=0,h=0,f=!1,m=0,v=0,g=!1,b=!1;s.addEventListener("touchstart",(function(e){a=e.touches[0].pageX,i=e.touches[0].pageY,addClass(d,"--no_trans"),f=!0,clearTimeout(r)}));var A,w=!1;s.addEventListener("touchmove",(function(t){if(b||!(Math.abs(t.touches[0].pageY-i)>5||g)){if(h=t.touches[0].pageX-a,!(Math.abs(h)<10)||w){b||window.addEventListener("touchmove",A=function(e){return cancelEvent(e)},{passive:!1}),b=!0,w=!0;var n=Math.min(e.length-1,Math.max(0,p+(h<0?1:-1))),o=0===n&&0===p,r=n===e.length-1&&p===e.length-1;m=n;var s=-p*u[0];s+=o||r?.2*h:h,d.style.transform="translateX("+s+"px)"}}else g=!0})),s.addEventListener("touchend",(function(){w=!1,g=!1,b=!1,v=p,removeClass(d,"--no_trans"),A&&window.removeEventListener("touchmove",A),Math.abs(h)<50||(p=m),j(0,!1,m,!0)})),window.addEventListener("resize",y),window.cur&&window.cur.destroy&&window.cur.destroy.push((function(){window.removeEventListener("resize",y)}));function y(){u=getSize(geByClass1("article_figure_content",t)),j(0,!1,p,!1,!1)}function j(n,i,a,s,h){if(void 0===s&&(s=!1),void 0===h&&(h=!0),!i||!f){if(f=!0,i)return d.style.transform="translateX(-50px)",void(r=setTimeout((function(){d.style.transform="translateX(0px)"}),700));clearTimeout(r),p=void 0===p?Math.min(e.length-1,Math.max(0,p+n)):a,s&&Object(o.m)(_)&&v!==p&&_(v<p?O:k),domData(t,"photo-carousel-index",p),R(p,t),c.innerHTML=l.replace("{counter}",p+1).replace("{total}",e.length),h||addClass(d,"--no_trans"),d.style.transform="translateX(-"+p*u[0]+"px)",h||(d.offsetWidth,removeClass(d,"--no_trans"))}}return function(e,t,n,i,a){void 0===i&&(i=!1),void 0===a&&(a=!0),t||(m=n),v=p,j(e,t,n,i,a)}}(i,e,t);var a=function(e,t,n,i){var a,o=0,r=geByClass1("article_photo_carousel__controls",t),s=geByClass1("article_photo_carousel__counter",t),c=domData(s,"counter-lang")||getLang("global_article_carousel_counter"),l=getSize(geByClass1("article_figure_content",t)),u=geByClass1("article_photo_carousel_inner",t),d=geByClass1("article_photo_carousel__left",t),_=geByClass1("article_photo_carousel__right",t),p=n.onClick,h=!1;function f(n,i){if(!i||!h){if(h=!0,i)return u.style.transform="translateX(-50px)",void(a=setTimeout((function(){u.style.transform="translateX(0px)"}),700));clearTimeout(a),o=Math.min(e.length-1,Math.max(0,o+n)),u.style.transform="translateX(-"+o*l[0]+"px)",s.innerHTML=c.replace("{counter}",o+1).replace("{total}",e.length),toggle(d,o>0),toggle(_,o<e.length-1),domData(t,"photo-carousel-index",o),R(o,t)}}return _.addEventListener("click",(function(e){return f(1),p&&p(O),cancelEvent(e)})),d.addEventListener("click",(function(e){return f(-1),p&&p(k),cancelEvent(e)})),t.addEventListener("mousemove",(function(){r.style.opacity=1})),t.addEventListener("mouseleave",(function(){r.style.opacity=0})),f}(i,e,t);return window.data(e,"changePhotoFunction",a),a}}function R(e,t){var n=geByTag1("figcaption",t),i=[];n&&((i=domData(n,"captions"))&&(i=JSON.parse(i)),n.innerHTML=i[e]||"")}var B,N,D=n("lkNA"),H={};window._articleCarouselGlobalId=window._articleCarouselGlobalId||1;var U,V=function(){function e(e,t,n){var i=this;this._handleClick=function(e){if(e.target.href)try{var t=new URL(e.target.href);window.location.pathname===t.pathname&&t.search.match(/\?|&anchor=/)&&(e.preventDefault(),i.scrollToAnchor(null,t.search),window.history.replaceState({},document.title,""+t.pathname+t.search))}catch(e){console.error(e)}},this._article=e,this._options=t,this._readTO=null,this._scrollStatEvent=!1,this._openTime=0,this._els={view:ge("article_view_"+e.raw_id)},window.cur&&cur.destroy&&cur.destroy.push((function(){i.deinit()})),n&&this.ready()}var t=e.prototype;return t.getEl=function(){return this._els.view},t.getArticle=function(){return this._article},t.getScrollNode=function(){return this._options.getScrollNode?this._options.getScrollNode():document},t._getScrollTop=function(){return this._options.getScrollTop?this._options.getScrollTop():window.scrollNode?window.scrollNode.scrollTop:window.document.documentElement.scrollTop},t.getTimeSpent=function(){return Math.round((Date.now()-this._openTime)/1e3)},t.changeCarouselPosition=function(e,t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);var a=H[e];Object(o.m)(a)&&a(0,!1,t,n,i)},t.deinit=function(){this._scrollEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollEvent),this._scrollEvent=!1),this._scrollStatEvent&&(this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),this._scrollStatEvent=!1),document.removeEventListener("click",this._handleClick),clearTimeout(this._readTO)},t._onViewScroll=function(){var e=this,t=scrollGetY(),n=window.innerHeight;Object(o.b)(geByTag("figure",this._els.view),(function(i,a){var r=Object(o.g)(domData(a,"done"));if(!r){var s=getH(a),c=getXY(a)[1],l=Object(o.g)(domData(a,"type")),u=101==l?-200:100,d=c<=t+n-u&&t+u<=c+s;(r=e._onObjectView(d,l,a))&&domData(a,"done",1)}})),Object(o.b)(geByTag("figure",this._els.view),(function(i,a){var r,s=getH(a),c=getXY(a)[1],l=Object(o.g)(domData(a,"type")),u=c,d=c+s,_=t,p=t+n;if(u>p||_>d)r=!1;else{var h=Math.max(u,_);r=(Math.min(d,p)-h)/s>.7}e._onObjectPartialView(r,l,a)}))},t._initObjects=function(){var e=this;this._initedObjects=this._initedObjects||{},Object(o.b)(geByClass("_article_unmute_button",this._els.view),(function(t,n){e._initedObjects[t]||(e._initedObjects[t]=!0,n.addEventListener("click",(function(){var e=n.parentNode,t=geByTag1("video",e);t.muted=!t.muted,toggleClass(e,"article_object_unmuted",!t.muted)})))})),Object(o.b)(geByTag("figure",this._els.view),(function(t,n){if(!e._initedObjects[t])switch(e._initedObjects[t]=!0,parseInt(domData(n,"type"))){case s:var i=L(n,{mobile:e._options.mobile,moderDeletePhoto:e._options.moderDeletePhoto,onClick:function(t){e.sendStats({type:t})}});if(e._initPhoto(n),i){var a=window._articleCarouselGlobalId++;n.setAttribute("data-carousel-id",a),H[a]=i}break;case u:case r:geByClass1("article_figure_content",n).addEventListener("click",(function(){e.sendStats({type:A})}),!0);break;case m:case v:break;case l:case c:if(e._options.mobile){var o=geByTag1("video",n);o&&(o.addEventListener("play",(function(){e.sendStats({type:b})})),o.addEventListener("pause",(function(){e.sendStats({type:b})})))}else{geByClass1("article_figure_content",n).addEventListener("click",(function(){e.sendStats({type:b})}),!0)}}})),this._els.view&&this._els.view.addEventListener("click",(function(t){var n=t.target;if(matchesSelector(n,'a[href^="/away"]')){var i=decodeURIComponent(unescape(n.href)).split("vk.com/away.php?to=")[1];i&&e.sendStats({type:y,domain:encodeURIComponent(e._getUrlDomain(i))})}}))},t._initPhoto=function(e){var t=this;geByClass1("article_figure_content",e).addEventListener("click",(function(){var n=domQuery1("[data-sizes]",e),i=JSON.parse(domData(n,"sizes")),a=Object(o.g)(domData(e,"photo-carousel-index"));t._options.onImageOpen&&t._options.onImageOpen.call(t,i,e,a),t.sendStats({type:w})}))},t._initStats=function(){if(this._statsInited)this._scrollStatEvent&&this._scrollStatEvent();else{this._statsInited=!0,this._openTime=Date.now();var e,t=-1,n=[];this._scrollStatEvent&&this.getScrollNode().removeEventListener("scroll",this._scrollStatEvent),clearTimeout(this._readTO);var i=this;this.getScrollNode().addEventListener("scroll",this._scrollStatEvent=function(){var o=i.getCurrentScrollRatio();if(!(o<0)){var r=1;o>=.95?r=4:o>.66?r=3:o>.33&&(r=2),function(o){if(i._isReady&&(i._article.has_more&&(o=Math.min(o,1)),!(t>=o))){for(var r=t+1;r<=o;r++)n.push(r);if(t=o,clearTimeout(e),e=setTimeout(a,300),3==o&&i._article.ttr){var s=i._article.ttr-i.getTimeSpent();s>0&&(i._readTO=setTimeout((function(){if(!document.hidden){var e=i.getCurrentScrollRatio();if(!(e<0||e>1.3)){var o=4==t;n=[t=4],a(o)}}}),1e3*s))}}}(r),4!=r||i._article.has_more||(i.getScrollNode().removeEventListener("scroll",i._scrollStatEvent),i._scrollStatEvent=!1)}},{passive:!0}),this._scrollStatEvent&&this._scrollStatEvent()}function a(e){if(n.length){var t=i._article,a=i._options,r="";if(t.ref)r=t.ref;else if(window.cur){if("feed"===(r=window.cur.module)&&cur.articlePrevLoc&&!a.mobile)"search"===nav.fromStr(cur.articlePrevLoc).section&&(r="feed_search")}var s={act:"stats",scroll:n.join(","),spent:i.getTimeSpent(),hash:t.access_hash,article_owner_id:t.owner_id,article_id:t.id,is_web_view:a.isWebView?1:0,post_id:a.sourcePostId,is_widget:a.isWidget,is_delayed_scroll_4:Object(o.g)(e),track_code:a.trackCode,ref:r};ajax.post(a.mobile?"article.php":"al_articles.php",s),t.mailru_stats_data&&n.forEach((function(e){M("scroll_"+e,t.mailru_stats_data)})),n=[]}}},t._initGoogleAnalytics=function(){var e=this._options.googleAnalyticsId;if(e)if(window.dataLayer=window.dataLayer||[],window.gtag)window.gtag("config",e,{page_location:window.location.href});else{var t=document.createElement("script");t.setAttribute("src","https://www.googletagmanager.com/gtag/js?id="+e),t.setAttribute("async","true"),document.head.appendChild(t),window.gtag=function(){window.dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",e)}},t._onObjectPartialView=function(e,t,n){var i=domQuery1("[data-sizes]",n),a=Boolean(Number(domData(i,"should-disable-carousel-animation")));if(t==s&&!a&&JSON.parse(domData(i,"sizes")).length>1){var o=n.getAttribute("data-carousel-id");e?N!=o&&(clearTimeout(B),B=setTimeout((function(){var e=H[o];e&&e(1,!0)}),400),N=o):o==N&&(N=-1,clearTimeout(B))}},t._onObjectView=function(e,t,n){var i=!1;switch(t){case s:if(e){var a=geByTag1("img",n),r=getW(a)||this._options.width,c=domQuery1("[data-sizes]",n),u=JSON.parse(domData(c,"sizes")),m=geByTag("img",n);u.forEach((function(e,t){var n=T(u[t],r,!0)[0];!function(e,t){if(!0===I[e])return t&&t(),!0;if(Array.isArray(I[e]))return I[e].push(t),!1;I[e]=[t];var n=new Image;n.onload=function(){var t=I[e];I[e]=!0,Object(o.b)(t,(function(e,t){t&&t()}))},n.src=e}(n,(function(){var e=m[t];removeClass(e,"article_object_photo__image_blur"),e.src=n}))})),i=!0}break;case l:if(!this._options.mobile){var v=geByTag1("video",n);if(v)if(e){if(v.hasAttribute("autoplay")){var g=v.play();g&&g.catch((function(){}))}}else v.pause();else i=!0}break;case d:case _:case p:case h:case f:this.initEmbed(t,n),i=!0}return i},t.initEmbed=function(e,t){var n=this;switch(e){case d:var i=domQuery1("[data-tweet-id]",t),a=domData(i,"tweet-id");Object(D.a)("https://platform.twitter.com/widgets.js",{onLoad:function(){window.twttr.widgets.createTweet(a,i,{align:"center",lang:window.vk&&0==window.vk.lang?"ru":"en",dnt:!0})}});break;case _:var o=window.vk&&0==window.vk.lang?"ru_RU":"en_US";Object(D.a)("https://connect.facebook.net/"+o+"/all.js#xfbml=1&amp;version=v2.8",{onLoad:function(){window.FB.XFBML.parse()}});break;case p:Object(D.a)("https://www.instagram.com/embed.js",{onLoad:function(){window.instgrm.Embeds.process(),addEvent(window,"message",x)}});break;case h:var r=domQuery1("[data-raw-id]",t),s=domData(r,"raw-id"),c=domData(r,"index"),l=s.split(";"),u=l[0],m=l[1];Object(D.a)("/js/api/openapi.js",{onLoad:function(){ajax.post("dev.php",{act:"a_get_post_hash",post:u+"_"+m},{onDone:function(e){e&&window.VK&&window.VK.Widgets&&window.VK.Widgets.Post("vk_post_"+s+"_"+c,u,m,e,{from:n._options.isWebView?"article_webview":""})}})}});break;case f:Object(D.a)("https://telegram.org/js/telegram-widget.js?5",{})}},t.getCurrentScrollRatio=function(){var e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1];return(this._getScrollTop()+window.innerHeight-t)/e},t.getScreenVisibilityRatio=function(){var e=getH(this._els.view),t=getXY(this._els.view)[1]-getXY(this.getScrollNode().firstElementChild)[1],n=this._getScrollTop(),i=window.innerHeight,a=t,o=t+e,r=n,s=n+i;if(r>o||a>s)return 0;var c=Math.max(a,r);return(Math.min(o,s)-c)/i},t.update=function(){this._initObjects(),this._initStats(),this._options.onScroll&&this._options.onScroll.call(this,this.getCurrentScrollRatio())},t.ready=function(){var e=this;(this._isReady=!0,this._initObjects(),this._initStats(),this._initGoogleAnalytics(),setTimeout((function(){var t=P("anchor");if(t){e._options.isWebView||e.scrollToAnchor(t);var n=e.getScrollNode();n===document&&(n=document.scrollingElement||window.scrollNode||document.body),n.click&&n.click(),n.focus()}}),0),!this._options.mobile&&window.AudioPlaylist)&&(this._article.audios_list&&this._article.audios_list.length>0&&new AudioPlaylist(AudioPlaylist.TYPE_TEMP,this._article.owner_id,"article_"+this._article.id).mergeWith({list:this._article.audios_list}));this.getScrollNode().addEventListener("scroll",this._scrollEvent=function(){e._onViewScroll(),e._options.onScroll&&e._options.onScroll.call(e,e.getCurrentScrollRatio())}),document.addEventListener("click",this._handleClick),setTimeout((function(){e._scrollEvent()}),this._options.objectsInitDelay||0)},t.scrollToAnchor=function(e,t){e=e||P("anchor",t);var n=this._options,i=this.getScrollNode();i===document&&(i=document.scrollingElement||window.scrollNode||document.body);e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var a=n.isWebView?0:25,o=t.parentNode.offsetTop-a;window.setTimeout((function(){i.scrollTo?i.scrollTo(0,o):i.scrollTop=o}),10)}}()},t.sendStats=function(e){var t=this._article,n=this._options,i={act:"stats",spent:this.getTimeSpent(),article_id:t.id,article_owner_id:t.owner_id,hash:t.access_hash,is_web_view:n.isWebView?1:0};Object.assign(i,e),ajax.post(n.mobile?"article.php":"al_articles.php",i)},t._getUrlDomain=function(e){var t=document.createElement("a");return t.href=e,t.hostname},e}(),F=[],W=!1,q=function(){function e(){}return e.init=function(e,t,n,i){if(void 0===n&&(n=0),void 0===i&&(i={}),W=i.mobile||i.isWebView,t&&e.ads&&!isEmpty(e.ads)&&!(e.has_more||isArray(e.ads)&&0==e.ads.length)){var a=ce("ins");addClass(a,"mrg-tag"),addClass(a,"article_adsblock"),i.mobile&&addClass(a,"article_adsblock_mobile"),setStyle(a,{display:"block","text-decoration":"none"});var o="";if(isObject(i.deviceInfo))for(var r in i.deviceInfo)i.deviceInfo.hasOwnProperty(r)&&(o+="&"+r+"="+i.deviceInfo[r]);for(var s in e.ads.data["ad-query"]=e.ads.data["ad-query"].replace("%device_info%",o),e.ads.data["ad-query"]+="&place="+n,e.ads.data)e.ads.data.hasOwnProperty(s)&&domData(a,s,""+e.ads.data[s]);t.appendChild(a),window.MRGtag||(window.MRGtag=[]);var c=i.isWebView?{iframeMode:!0}:{},l=e.ads.eventsHash;if(z(e,i,"requested",l),c.onNoAds=function(){z(e,i,"no_ads",l)},c.onAdsLoaded=function(){z(e,i,"ads_loaded",l)},c.onAdsClosed=function(){z(e,i,"ads_closed",l)},c.onAdsSuccess=function(){z(e,i,"ads_success",l)},c.onAdsClicked=function(){z(e,i,"ads_clicked",l)},c.onScriptError=function(){z(e,i,"script_error",l)},window.MRGtagOnAdsImpression=function(){z(e,i,"ads_impression",l)},window.MRGtag.push(c),!window.mailRuSdsScriptLoaded){var u=document.createElement("script");u.setAttribute("src",e.ads.script),u.setAttribute("async","true"),document.head.appendChild(u),window.mailRuSdsScriptLoaded=!0}}},e.wasShown=function(){return!1},e}();function z(e,t,n,i){F.push(n+"/"+e.owner_id+"_"+e.id+"/"+i),clearTimeout(U),U=setTimeout((function(){var e=W?"article.php":"al_articles.php";ajax.post(e,{act:"ads_event",events:F.join(","),is_web_view:intval(t.isWebView)}),F=[]}),200)}var Y,G,Q,K,X,$,J=n("aJgW"),Z=n("6I9u");window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var ee,te,ne,ie=!1,ae=[],oe=[],re=1,se=2,le={},ue={};function de(e,t){e=e.split("_");for(var n=0;n<t.length;n++){var i=t[n].split("_");if(i[0]==e[0]&&i[1]==e[1])return n}return-1}function _e(){return document}function pe(){return(document.scrollingElement||window.scrollNode||document.body).scrollTop}function he(e){return domQuery('.articleView__social_buttons[data-article-id="'+e+'"] .articleView__footer_btn_bookmark')}function fe(e){if($!=e.raw_id)if($=e.raw_id,G.isWebView)!function(e){a.a.send("articleUpdate",{article:ke(e),isSubscribedToOwner:e.is_subscribed_to_owner})}(e);else{var t=geByClass1("articleView__owner"),n=geByTag1("img",t);t&&n&&(n.src=e.owner_photo);var i=geByTag1("a",t);t&&i&&(i.href=e.owner_href);var r=geByClass1("articleView__ownerName"),s=geByTag1("a",r);r&&s&&(s.href=e.owner_href,s.innerHTML=e.owner_name);var c=geByClass1("articleView__footer"),l=geByClass1("articleView__footer_views");l&&(l.innerHTML=e.views_formatted);var u=geByClass1("articleView__social_buttons",c);c&&u&&!e.is_blog&&u.setAttribute("data-article-id",e.raw_id);var d=[domQuery1('.articleView__content_misc_block[data-article-id="'+e.raw_id+'"] .articleView__footer_btn_share'),c&&domQuery1(".articleView__footer_btn_share",c)];Object(o.b)(d,(function(t,n){n&&!e.is_blog&&(n.href="/like?act=publish&object=article"+e.raw_id+"&list="+e.access_hash)}));var _=he(e.raw_id),p=JSON.stringify(e.mailru_stats_data);Object(o.b)(_,(function(t,n){n&&(n.setAttribute("onclick","Article.fave(this, '"+e.url+"', '"+e.fave_hash+"', "+p+", '"+e.raw_id+"')"),toggleClass(n,"_active",e.is_faved))}));var h=geByClass1("Unfold__item_name_noted");h&&(h.href="/feed?section=search&q=url:https://vk.com"+e.url);var f=geByClass1("Unfold__item_name_report");f&&(f.href=Object(Z.a)({ownerId:e.owner_id,articleId:e.id,accessHash:e.access_hash,refrom:"feed"}))}}function me(e,t){void 0===t&&(t=!1),e.has_more||(ae=ae.concat(e.audios_list));var n=new V(e,{notFull:!!G.preloadMoreHash,isWebView:G.isWebView,mobile:!0,width:G.width,getScrollTop:pe,getScrollNode:_e,trackCode:G.trackCode,onScroll:function(t){if(!e.has_more){var n=oe[oe.length-1],i=gpeByClass("articleView__content",n.getEl());t>.6&&e.next_article_url&&(oe.length<20&&(be(e.next_article_url),addClass(i,"articleView_waitNextArticle")),function(){var e=oe[oe.length-1];if(e){var t=gpeByClass("articleView__content",e.getEl()),n=geByClass1("articleView__social_buttons",t);n&&show(n)}}()),t>.99&&e.next_article_url&&oe.length<20&&be(e.next_article_url,(function(e,t){if(e){for(var n=0;n<oe.length;n++)if(oe[n].getArticle().raw_id==t.raw_id)return;ne||(ne=setTimeout((function(){var n=domCreate(e);X.appendChild(n),removeClass(i,"articleView_waitNextArticle"),addClass(n,"articleView_nextPrepared"),requestAnimationFrame((function(){removeClass(n,"articleView_nextPrepared")})),me(t),ne=null}),400))}})),this.getScreenVisibilityRatio()>.5&&fe(e)}},onImageOpen:function(e,t,i){if(G.isWebView){for(var o=[],r=0;r<e.length;r++){var s=e[r],c=[];for(var l in s)s.hasOwnProperty(l)&&c.push({type:l,src:s[l][0],width:s[l][1],height:s[l][2]});o.push(c)}ee=t,te=n,a.a.send("articlePhotoView",{photos:o,index:i})}}});if(t||n.ready(),oe.push(n),ve(e),Object(o.b)(geByTag("video"),(function(e,t){domData(t,"auto-pause-inited")||(domData(t,"auto-pause-inited",1),t.addEventListener("play",(function(){Object(o.b)(geByTag("video"),(function(e,n){n!=t&&n.pause()}))})))})),G.isWebView){Object(o.b)(geByTag("figure",n._els.view),(function(e,t){var i=Object(o.g)(domData(t,"type"));n._onObjectView(!1,i,t)&&domData(t,"done",1)}));var i=document.getElementsByClassName("articleView__educationCloseButton")[0];i&&i.addEventListener("click",(function(e){var t=e.target,n=Object(o.g)(domData(t,"article-id")),i=Object(o.g)(domData(t,"course-id")),r=Object(o.g)(domData(t,"step-id")),s=t.href;a.a.send("articleClose",{fallback_url:s,payload:{status:"read",data:{author_id:n,course_id:i,step_id:r}}}),e.preventDefault()}))}}function ve(e){var t=gpeByClass("articleView__content",ge("article_view_"+e.raw_id)),n=geByClass1("articleView__ads_block",t);q.init(e,n,oe.length,G)}function be(e,t){var n=ue[e];n!==se?Object(o.i)(n)?t&&t(n[0],n[1]):(le[e]=le[e]||[],t&&le[e].push(t),n!=re&&(ue[e]=re,ajax.post("article.php",{act:"view",url:e,scroll_load:1,wall_owner_id:G.wallOwnerId,audio_bridge:Object(o.g)(G.audioBridge),can_infinite_scroll:Object(o.g)(G.canInfiniteScroll),web_view:G.isWebView,context:G.context,ref:"scroll",v:G.clientVersion},{onDone:function(t,n){for(var i=le[e],a=0;a<i.length;a++)i[a](t,n);ue[e]=[t,n]}}))):t&&t()}function Ae(e,t){var n=he(e);Object(o.b)(n,(function(e,n){toggleClass(n,"_active",t)}))}function we(){var e=P("anchor");e&&function(){var t=document.getElementById(e);if(t){"scrollRestoration"in history&&(history.scrollRestoration="manual");var n=G.isWebView?0:25,i=t.parentNode.offsetTop-n;window.setTimeout((function(){var e;e=i,(document.scrollingElement||window.scrollNode||document.body).scrollTop=e}),0)}}()}function ye(e){if(void 0===e&&(e={}),ie)we();else{G.deviceInfo=e.deviceInfo;var t=oe[0],n=t.getArticle();t.ready(),n.has_more?ajax.post("article.php",{act:"load_more",rev:n.rev,hash:n.has_more_hash,article_owner_id:n.owner_id,article_id:n.id,audio_bridge:Object(o.g)(G.audioBridge),no_lazy_images:Object(o.g)(G.noLazyImages),can_infinite_scroll:Object(o.g)(G.canInfiniteScroll),wall_owner_id:G.wallOwnerId,context:G.context,client_version:G.clientVersion},{onFail:function(){G.failTries>0&&(G.failTries--,setTimeout((function(){ye(e)}),2e3))},onDone:function(e,i){ie=!0,n.audios_list=i.audios_list,n.next_article_url=i.next_article_url,n.has_more=!1,n.audios_list&&n.audios_list.length&&(ae=ae.concat(n.audios_list));var a=domCreate(e),o=geByClass1("article_view",a),r=geByClass1("article_view");"figure"!==r.lastElementChild.tagName.toLowerCase()&&r.lastChild.remove();for(var s=r.children.length,c=o.children;s<c.length;)r.appendChild(c[s]);var l=geByClass1("article_preload_spinner");l&&l.parentNode.removeChild(l);var u=geByClass1("articleView__content_misc_block",a);r.parentNode.appendChild(u),function(){for(var e=geByClass1("article").children,t=0;t<e.length;t++){var n=t>0&&e[t-1],i=e[t],a=t+1<e.length&&e[t+1],o=n?n.tagName+"_"+domData(n,"type"):"",r=i?i.tagName+"_"+domData(i,"type"):"",s=a?a.tagName+"_"+domData(a,"type"):"",c=!1,l=!1,u=!1;o&&r==o||(c=!0),s&&r==s||(l=!0),(g.includes(+s.type)||s.sep)&&(u=!0),toggleClass(i,"article_decoration_first",c),toggleClass(i,"article_decoration_last",l),toggleClass(i,"article_decoration_before",u)}}(),ve(n),we(),t.update()}}):ajax.post("article.php",{act:"next_url",access_hash:n.access_hash,article_owner_id:n.owner_id,article_id:n.id,wall_owner_id:G.wallOwnerId,context:G.context},{onDone:function(e){e&&(n.next_article_url=e,t.update())}});var i=t.getEl();e.paddingTop&&setStyle(i,"marginTop",Object(o.g)(e.paddingTop)),e.paddingBottom&&setStyle(i,"marginBottom",Object(o.g)(e.paddingBottom)),e.noDarkModeTransition&&addClass(i,"article_dark_no_transition")}}function Oe(e){var t=null;return Object(o.b)(oe,(function(n,i){var a=i.getArticle();if(a.raw_id==e)return t=a,!1})),t}function ke(e){var t="https://"+G.devHost+"vk.com"+e.url,n={id:e.id,owner_id:e.owner_id,owner_name:e.owner_name,state:"available",can_report:e.can_report,title:e.title,subtitle:"",views:e.views,shares:e.shares,is_favorite:e.is_faved,url:t,view_url:t,access_key:e.access_hash,published_date:e.published_date,no_footer:e.no_footer};return e.owner_photo&&0!=e.owner_photo.indexOf("/images/")&&(n.owner_photo=e.owner_photo),n}function je(e,t){void 0===t&&(t="");var n=oe[oe.length-1];if(t)for(var i=0;i<oe.length;i++)if(oe[i]._article.raw_id===t){n=oe[i];break}n.sendStats({type:e})}window.ArticleView=V,window.Article={init:function(e,t){if((G=t).mobile=!0,G.failTries=50,window.cur&&(window.cur.lang=window.cur.lang||{},extend(window.cur.lang,t.lang||{})),X=geByClass1("articleView__content_list"),!G.isWebView){var n,i=pe(),r=geByClass1("articleView__header"),s=geByClass1("articleView__footer"),c=geByClass1("articleView__layout");_e().addEventListener("scroll",n=function(){var e=c.clientHeight,t=Math.max(0,pe()),n=t-i>0,a=t+window.innerHeight+20>e;toggleClass(r,"articleView__header--narrow",n),s&&toggleClass(s,"articleView__footer--hidden",!a&&n),i=t},{passive:!0});var l=geByClass1("articleView__close"),u=geByClass1("articleView__close_mini");l.addEventListener("click",je.bind(window,E)),u.addEventListener("click",je.bind(window,E)),window.cur&&cur.destroy.push((function(){document.removeEventListener("scroll",n),removeClass(document.body,"article_body_with_transition")})),G.isStandalone&&(window.al=!1);var d=Object(o.g)(c.classList.contains("article_dark")),_=document.querySelector(".basis");_&&J.d.applyScheme(_,d?J.c.Dark:J.c.Light)}if(G.preloadMoreHash||show(geByClass1("article_layer_prev_next")),G.isWebView){var p=geByClass1("article");addClass(p,"article_webview")}G.isWebView&&G.audioBridge&&(window.audioplayer={playPause:function(e,t){var n=gpeByClass("audio_item",e.target);if(Q&&Q!=n&&(removeClass(Q,"ai_playing"),Q=!1),K&&(removeClass(K,"article_object_audioplaylist_playing"),K=!1),hasClass(n,"ai_playing"))a.a.send("audioPause",{}),removeClass(n,"ai_playing");else{var i=de(t,ae),o=ae;-1==i&&(o.unshift(t),i=0),a.a.send("audioPlay",{audioIds:o,pos:i}),addClass(n,"ai_playing"),Q=n}return cancelEvent(e),!1}}),G.isWebView?(a.a.send("articleReady"),window.addEventListener("VKWebAppEvent",(function(e){var t=e.detail||{};switch(t.type){case"articleOwnerSubscribed":var n=t.ownerId,i=t.isSubscribed;Object(o.b)(oe,(function(e,t){var a=t.getArticle();if(a.owner_id==n)return a.is_subscribed_to_owner=i,!1}));break;case"articleBookmarked":var a=t.articleOwnerId+"_"+t.articleId,r=Oe(a);r&&(r.is_faved=t.isBookmarked);var s=he(a);Object(o.b)(s,(function(e,n){toggleClass(n,"_active",!!t.isBookmarked)}));break;case"articleWebViewShow":ye(t);break;case"articleWebViewClose":je(E);break;case"didShareArticle":var c=t.articleRawId,l=t.shareType;if(!l)break;je(l,c);break;case"articleMentionClick":var u=t.articleRawId;je(j,u);break;case"articlePhotoCarouselPositionChanged":default:var d=t.index;if(void 0===d)return;te&&ee&&te.changeCarouselPosition(domData(ee,"carousel-id"),d,!0,!1)}})),me(e,!0)):me(e,!1)},fave:function(e,t,n,i,r){var s=!hasClass(e,"_active");ajax.post("article.php",{act:"fave",url:t,add:Object(o.g)(s),hash:n}),oe.forEach((function(e){var n=e.getArticle();n.url==t&&(n.is_faved=s)})),M(s?"fave":"unfave",i),Ae(r,s),G.isWebView?function(e){var t=Oe(e);t&&(JSON.stringify({article:ke(t)}),a.a.send("articleBookmarked",{article:ke(t)}))}(r):Share&&Share.setBookmarkState(r,s)},toggleButton:Ae,share:function(e,t,n){return function(e){var t=Oe(e),n=G.clientVersion;if(t)if(n){var i={type:"article",data:ke(t)};a.a.send("share",i)}else{var o={article:ke(t)};a.a.send("articleShare",o)}}(t),!1},subscribe:function(e,t,n){ajax.post("article.php",{act:"subscribe",owner_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"articleView__subscribed",t),e.innerHTML=n}})},toggleDarkMode:function(e){Y||(Y=setTimeout((function(){var t=geByClass1("articleView__layout");toggleClass(t,"article_dark",e),toggleClass(document.body,"article_dark",e);var n=Object(o.g)(hasClass(t,"article_dark"));Y=!1,void 0!==e||G.isWebView||ajax.post("article.php",{act:"set_dark_mode",dark:n});var i=geByClass1("articleMenu");i&&Unfold.setTitle(i,"dark_mode",n?getLang("mobile_articles_menu_dark_disable"):getLang("mobile_articles_menu_dark")),je(n?S:C);var a=document.querySelector(".basis");a&&!G.isWebView&&J.d.applyScheme(a,n?J.c.Dark:J.c.Light)}),e?0:10))},onWebViewShow:ye,sendStats:je,audioPlayPlaylist:function(e,t,n){var i=gpeByClass("article_object_audioplaylist_webview",e);if(Q&&(removeClass(Q,"ai_playing"),Q=!1),K){var o=K;if(removeClass(o,"article_object_audioplaylist_playing"),K=!1,o==i)return a.a.send("audioPause",{}),cancelEvent(n)}var r=de(t,ae),s=ae;return-1==r&&(s.unshift(t),r=0),a.a.send("audioPlay",{audioIds:s,pos:r}),addClass(i,"article_object_audioplaylist_playing"),K=i,cancelEvent(n)},onAudioStateChanged:function(e,t){Q&&(removeClass(Q,"ai_playing"),Q=!1),K&&(removeClass(K,"article_object_audioplaylist_playing"),K=!1),e=(e=e.split("_"))[0]+"_"+e[1];var n=ge("audio"+e);n&&toggleClass(n,"ai_playing","play"==t);for(var i=geByClass("_article_object_audioplaylist_webview"),a=0;a<i.length;a++){if((domData(i[a],"ids")||"").split(",").indexOf(e)>=0&&"play"==t){addClass(i[a],"article_object_audioplaylist_playing"),K=i[a];break}}}}},"0ZFE":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("Y6JH"),a=n("OcsD"),o=n("Fbxv");function r(e,t){t=t||"al_loading";var n=Object(a.O)(t)||Object(a.M)(t);if(n){var r;if(!n&&!Object(a.gb)("BottomMenu__preloader",n))if("al_loading"!==t||!(null==(r=window)?void 0:r.getComputedStyle(n).getPropertyValue("--content_area_height"))){var s=document.getElementById("m").offsetHeight||0,c=document.getElementById("mfoot")&&document.getElementById("mfoot").offsetHeight||0;e=Object(a.S)()-s+c-16}n.style.height=e+"px",n.innerHTML=Wd.html(Object(i.a)(Object(o.a)())),Object(a.a)(t,n)}}window.alLoadingFix=r},"0hva":function(e,t,n){"use strict";n.d(t,"b",(function(){return f}));var i=n("vOib"),a=n("1VZq"),o=n("z1UI"),r=n("O5lf"),s=n("z9sQ");var c,l,u,d,_=function(e){void 0===e&&(e={});var t=window.lang,n=e.title||"",c=e.description||"",l=e.pretag,u=e.buttons||{},d=(e.photos||[]).map((function(e){return Object(a.a)({photo:e})})),_=null;if(e.is_loading)_=Wd.wrap(Object(r.a)({mix:"al_loading",type:"pageLoader"}));else{if(!d.length)return Object(o.a)({separator:!0,more_text:e.add_url&&e.is_owner?t.mobile_photos_placeholder_album_action:null,more_type:"primary",more_url:e.add_url,text:t.mobile_photos_placeholder_album_text});_={inner:[d],class:"AlbumPage__photos photos_page",tag:"div"}}var p=s.a.class("AlbumPage",{withoutDescription:!c});return{inner:[Object(i.a)({inner:[{inner:[{inner:[n],class:"AlbumPage__title",tag:"h2"},c&&{inner:[c],class:"AlbumPage__description",tag:"span"}],class:"AlbumPage__info",tag:"div"},u.prev,_,u.more,l]})],class:p,tag:"div"}},p=n("OcsD"),h=n("UxAg");function f(){Object(h.a)(".AlbumPage")&&(c=!1,l=!1,u=!1,d=!1,Object(p.Kb)(m),Object(p.Kb)(!0))}function m(){if(c||(c=Object(h.a)(".AlbumPage__title"),l=Object(p.U)(c)),u||(u=Object(h.a)(".header__title",Object(h.a)("#mhead"))),!u)return Object(p.Kb)("__clear",m);d||(d=Object(h.a)(".header__text",u));var e=Math.min(40,Math.max(0,Object(p.db)(c)-l-Object(p.gc)()));p.jc.transform(d,1,[0,e]),u.classList.toggle("header__title--initial-position",0===e)}var v=n("Cbap");v.a.getRouter().addRoute(/\/(?:album|tag)(-?\d+(?:_\d+)?)/,f),v.a.getRouter().addRoute(/\/(?:attachments\?act=choose_photo).*(?:album|tag)=(-?\d+(?:_\d+)?)/,f);t.a=_},"1KAK":function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("/Id8"),r=n("+sJP");function s(){var e=Object(i.a)(['\n    <div class="msg__newMsgsDivider">\n      <span class="msg__newMsgDividerText">',"</span>\n    </div>\n  "]);return s=function(){return e},e}function c(){var e=Object(i.a)(["\n    ","\n    ","\n  "]);return c=function(){return e},e}var l=function(e){var t=e.msgId,n=e.withDivider?function(){var e=window.lang;return a.a.html(s(),e.mobile_mail_new_msgs)}():"",i=store.mail,l=Object(r.E)(t)?i.forwards[t]:i.msgs[t];if(!l)return null;var u,d=l.authorId,_=i.members[d],p=l.peerId,h=i.peers[p];if(!e.detailed){var f=store.mail.presend,m=(f=f&&f.msgs)&&f["edit"+t];m&&(l=m)}h&&(h.isIncomingMR||h.isRejectedMR)&&(n="");if(l.isService)u=Object(o.default)({id:t,text:l.service,service:!0,unread:l.isUnread});else{var v=Object(o.Msg__authorName)(_,p,i.cur.userId),g={id:t,text:l.text,important:l.isImportant,unread:l.isUnread,authorId:d,authorPhoto:_.avatar,authorName:v,authorUrl:_.url,date:l.date,removed:i.cur.msgRemoved[t],admin:l.adminName?{name:l.adminName,url:l.adminUrl}:null,edited:l.edited,channel:h.isChannel&&h.ownerId!==i.cur.viewerId,attaches:l.attaches,attachesHTML:l.attachesHTML,attachesLoading:l.attachesLoading,forwards:l.forwards,reply:l.reply,pending:l.pending,waiting:l.waiting,failed:l.failed,sendId:l.sendId,sticker:l.sticker,keyboard:l.keyboard,maxDepth:e.detailed?i.cur.maxDetailedMsgDepth:i.cur.maxMsgDepth,ttl:l.ttl,ts:l.ts,isExpired:l.isExpired,template:l.template,isDefaultCasperTimerShown:!h.isCasper,isPinned:e.isPinned,chatId:e.chatId};u=e.detailed?Object(o.Msg_detailed)(g):Object(o.default)(g)}return a.a.html(c(),n,u)};t.default=l;window.uMsg=l},"1UEa":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s}));var i,a,o=n("DM2o"),r=n("W9Tc");function s(e,t,n,i){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=a.other);var s={event_type:e,narrative_id:n,narrative_owner_id:t,nav_screen:i};Object(o.a)("narrative_product_analytic",s),Object(r.b)("narratives_web_analytic_debug")&&console.log("-- narrative analytic",s)}!function(e){e.clickToAddToNarrative="click_to_add_to_narrative",e.addStoryToNarrative="add_story_to_narrative",e.openNarrativeList="open_narrative_list",e.close="close",e.changeSort="change_sort",e.publishNarrative="publish_narrative",e.createNarrative="create_narrative",e.deleteNarrative="delete_narrative",e.clickToEditNarrative="click_to_edit_narrative",e.editNarrative="edit_narrative",e.addToBookmarks="add_to_bookmarks",e.shareNarrative="share_narrative",e.seeMore="see_more",e.addToNarrativeFromActionSheet="add_to_narrative_from_action_sheet"}(i||(i={})),function(e){e.storyArchive="story_archive",e.storyViewer="story_viewer",e.profile="profile",e.feedBlock="narratives_feed_block",e.club="club",e.other="other"}(a||(a={}))},"1VZq":function(e,t,n){"use strict";var i=n("z9sQ"),a=n("EDm3");var o=function(e){var t,n=e.photo,o=n.restriction;if(o&&"block"===o.type)t={inner:[{inner:[Object(a.Ib)()],class:"PhotosPhotoItem__restriction PhotosPhotoItem__restriction--doNotDisturb",tag:"div"}],class:"_image PhotosPhotoItem__photo",tag:"div"};else{var r=["_image",i.a.class("PhotosPhotoItem__photo",{blur:o&&"blur"===o.type})];t={inner:[o&&o.type?{inner:[Object(a.Mb)()],class:"PhotosPhotoItem__restriction PhotosPhotoItem__restriction--hide",tag:"div"}:null],style:"background-image: url("+n.src+")",attrs:n.attrs,class:r,tag:"div"}}return{inner:[t],href:n.href,class:"PhotosPhotoItem "+n.class,onclick:n.onclick,tag:"a"}};t.a=o},"29dZ":function(e,t,n){"use strict";var i=n("UvyM"),a=n("TYsd"),o=n("BoyB"),r="Btn_loading",s="Btn_theme_secondary",c="Btn__loader",l="Btn__loader--white",u={loader:"."+c},d=function(e,t,n){if(void 0===n&&(n=""),e){var i=e.classList.contains(r);if(t){if(i)return;var a=e.classList.contains(s),d=e.classList.contains(l),_=!n&&a?"white":n,p=Object(o.a)({mix:c,white:"white"===_||d,large:!0,spinner:"white"!==_});e.classList.add(r),e.insertAdjacentHTML("afterbegin",p)}else{if(!i)return;var h=e.querySelector(u.loader);e.classList.remove(r),h&&h.remove()}}},_=function(e,t){void 0===t&&(t=!0),e instanceof HTMLAnchorElement||(e.disabled=t)},p=function(e,t,n){e.preventDefault(),a.a.handle(n,{$btn:t})},h={className:"Btn",setDisabled:_,setLoading:d};h._onClick=p,Object.assign(i.a,h),i.a.setLoading=d,i.a.setDisabled=_,window.Btn=i.a;t.a=i.a},"2IoG":function(e,t,n){"use strict";var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.a)(["\n    <",' class="','" '," ",">\n      ","\n    </",">\n  "]);return o=function(){return e},e}t.a=function(e){void 0===e&&(e={});var t,n,i=a.a.list(e.inner);e.url?(t="a",n=a.a.attr("href",e.url)):(t=e.tag||"div",n="");return a.a.html(o(),t,e.mix,n,e.attrs,i,t)}},"3pHe":function(e,t,n){"use strict";n.r(t),n.d(t,"Messenger",(function(){return Te}));var i={};n.r(i),n.d(i,"onConfirmReject",(function(){return ct})),n.d(i,"open",(function(){return lt})),n.d(i,"close",(function(){return ut})),n.d(i,"isMarkedAsSpam",(function(){return _t}));var a={};n.r(a),n.d(a,"showCaptcha",(function(){return ft})),n.d(a,"renderBody",(function(){return mt}));var o=n("MUpH"),r=n("bZ/P"),s=n("z9sQ"),c=n("TYsd"),l=n("Mc5h"),u=(n("9y81"),n("O5lf")),d=n("AgBx"),_=n("QBkA"),p=n("rKp0"),h=n("u33z"),f=n("PUg3"),m=n("CkGd"),v=n("drfJ"),g=n("+cqQ"),b=n("DkIl");var A,w=n("k9Tg");function y(e){return!!e.settings.show_only_not_muted_messages}function O(){var e=window.store.mail.cur;return e?y(e)?e.unreadCounters.countNotMuted:e.unreadCounters.count:0}function k(e,t){void 0===t&&(t=!1),function(e,t){var n=window.store.mail.cur;n&&((void 0!==t?t:y(n))&&(n.unreadCounters.countNotMuted=e),n.unreadCounters.count=e)}(Math.max(0,O()+e),!t)}function j(){store.mail&&store.mail.cur&&(store.mail.cur.peerId&&S())}function S(){var e=store.mail.cur;(e?e.peerId:null)?A=setTimeout((function(){T(),S()}),3e4):C()}function C(){A&&clearTimeout(A)}function E(){$$(".mailHat").forEach((function(e){return e.outerHTML=Object(v.default)()}))}function T(){var e=window.lang,t=store.mail,n=t.cur,i=t.peers,a=n?n.peerId:null;if(a){var o=i[a];if(o.lastActionTime&&!o.isOnline){var r=n.timeShift,s=function(e,t){var n=window.lang,i="";e+=t;var a=parseInt(Date.now()/1e3)-e;if(a>7776e3)return"";if(a<60)i=n.mobile_profile_status_just_now;else if(a<3600){var o=intval(a/60);i=langWordNumeric(o,n.mobile_profile_status_word_mins_ago,n.mobile_profile_status_mins_ago)}else if(a<14400){var r=intval(a/3600);i=langWordNumeric(r,n.mobile_profile_status_word_hours_ago,n.mobile_profile_status_hours_ago)}else i=function(e){var t=1e3*e,n=new Date(t),i=new Date,a=window.lang;return n.getFullYear()!=i.getFullYear()&&n.getTime()<i.getTime()-1728e5||Math.abs(n.getTime()-i.getTime())>157248e5?langDate(t,a.mobile_mail_date,0,a.months_sm_of,!1):langDate(t,a.mobile_mail_short_date_time,0,a.months_sm_of,!1)}(e);return i}(o.lastActionTime,r);o.offlineText=s?langSex(o.sex,e.mobile_mail_last_activity_tip).replace("{time}",s):""}else o.canSeeOnline||(o.offlineText=function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(o.onlineStatus,o.sex));E()}}Object.assign(v.default,{onUnreadClick:Object(g.a)(),onBackClick:Object(g.a)(),onBackToDialogClick:Object(g.a)(),onCancelEditing:Object(g.a)(),setModifiers:b.MailHat_convo.setModifiers,redrawCounter:function(){var e=O();if(!nav.getQuery("community")){var t=geBySel1(".mmi_mail .mm_counter2");t&&(e>0?(t.innerText=e,attr(t,"style","display: inline")):hide(t))}navigator.setAppBadge&&navigator.setAppBadge(Math.max(0,Math.min(9999,e||0)));Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e)},redrawOnline:T,redrawActions:function(){var e=store.mail.cur.peerId,t=Object(w.c)(Object(v.uMailHat_getPeerActions)(e));$$(".mailHat__actions").forEach((function(e){return e.outerHTML=t}))},redraw:E,startStatusUpdate:S,cancelStatusUpdate:C}),b.MailHat_main.onUnreadClick(v.default.onUnreadClick),b.MailHat_main.onBurgerClick(menu.open),b.MailHat_main.onCancelForwardTap(v.default.onBackToDialogClick),b.MailHat_convo.onBackTap(v.default.onBackClick),b.MailHat_convo.onCancelEditingTap(v.default.onCancelEditing),uVK.onReady(j);var I=v.default;window.uMailHat=v.default;var M=n("29dZ"),P=function(e){var t=window.lang;return c.a.html({class:"MessageRequestBox",inner:[{class:"MessageRequestBox__info",inner:t.mobile_mail_mrs_confirm_info},{class:"MessageRequestBox__buttons",inner:[Object(M.a)({theme:"negative",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_reject,attrs:q.onClick("MessageRequestBox.reject","event","this",e)}),Object(M.a)({theme:"secondary",size:"normal",type:"button",inner:t.mobile_mail_mrs_button_accept,attrs:q.onClick("MessageRequestBox.accept","event","this",e)})]}]})};Object.assign(P,{accept:function(e,t,n){M.a.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_accept",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&M.a.setLoading(t,!1)}),(function(){M.a.setLoading(t,!1)}))},reject:function(e,t,n){M.a.setLoading(t,!0),ajaxRequest("/mail",{act:"mrs_reject",peer_id:n,hash:store.mail.hash.mrs},(function(e){e.error&&M.a.setLoading(t,!1)}),(function(){M.a.setLoading(t,!1)}))}});var x=P;var L=x;window.MessageRequestBox=x;var R=n("+sJP"),B=n("Y6JH"),N=n("k0dR"),D=function(e){var t=e.tagsData,n=[];e.tags&&t.peerTags&&(n=e.tags.filter((function(e){return t.peerTags.indexOf(e.id)>-1})));var i=H({fromAd:t.fromAd,peerTags:n,urls:e.data.urls}),a=V(e.data),o=(c=e.data,l=c.likesCount||c.repliesCount,{inner:[{inner:[Object(R.t)("mobile_mail_peer_profile_activity_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[l?[c.likesCount?{inner:[c.likesCount],class:"PeerProfile__blockItem",tag:"span"}:"",c.repliesCount?{inner:[c.repliesCount],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[Object(R.t)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}),r=function(e){return{inner:[{inner:[Object(R.t)("mobile_mail_peer_profile_note_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.note?{inner:[e.note],tag:"span"}:"",{inner:[Object(R.t)(e.note?"mobile_mail_peer_profile_edit_note_link":"mobile_mail_peer_profile_add_note_link")],href:e.urls.editNote,class:e.note?"PeerProfile__editNoteLink":"PeerProfile__blockLink",tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}(e.data),s=F(e.data);var c,l;return[i,a,o,r,s]};function H(e){for(var t=e.fromAd?1:0,n=3-t,i=[],a=e.fromAd?{inner:[Object(B.a)({icon:Object(N.a)()}),{inner:[Object(R.t)("mobile_mail_ad_tag_no_access_text")],tag:"span"}],class:"PeerProfile__adTag",tag:"div"}:"",o=e.peerTags,r=0,s=0;s<o.length;s++)e.fromMessenger&&s>=n?r++:i.push(o[s]);var c=window.lang,l=i.length+t;return{inner:[{inner:[Object(R.t)("mobile_mail_peer_profile_tags_label")],class:"PeerProfile__blockLabel",tag:"div"},l>0?{inner:[a,U(i),r>0?{inner:["+"+langNumeric(r,c.mobile_mail_peer_profile_extra_tags)],href:e.urls.showPeerProfile,class:"PeerProfile__extraTag",tag:"a"}:"",e.fromMessenger?"":{inner:[Object(R.t)("mobile_mail_peer_profile_edit_tags_link")],href:e.urls.toggleTags,class:"PeerProfile__editTag",tag:"a"}],class:"PeerProfile__blockContent PeerProfile__tagsList",tag:"div"}:{inner:[{inner:[Object(R.t)("mobile_mail_peer_profile_add_tags_link")],href:e.urls.toggleTags,tag:"a"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function U(e){return[e.map((function(e){return{inner:[e.name],class:"PeerProfile__peerTag",style:"background-color: "+e.color,tag:"div"}}))]}function V(e){var t=e.city||e.age;return{inner:[{inner:[Object(R.t)("mobile_mail_peer_profile_info_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[t?[e.city?{inner:[e.city],class:"PeerProfile__blockItem",tag:"span"}:"",e.age?{inner:[e.age],class:"PeerProfile__blockItem",tag:"span"}:""]:{inner:[Object(R.t)("mobile_mail_peer_profile_info_empty")],tag:"span"}],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}function F(e){return{inner:[{inner:[Object(R.t)("mobile_mail_peer_profile_join_date_label")],class:"PeerProfile__blockLabel",tag:"div"},{inner:[e.joinDate?e.joinDate:Object(R.t)("mobile_mail_peer_profile_join_date_empty_text")],class:"PeerProfile__blockContent",tag:"div"}],class:"PeerProfile__block",tag:"div"}}n("wCFN");var W=n("UxAg"),z=n("OcsD"),Y=n("p5n7"),G=n("EDm3");function Q(e){var t=e.index+"_";return{inner:[Object(Y.a)({name:"tags["+t+"id]",type:"hidden",value:e.id}),Object(Y.a)({name:"tags["+t+"state]",type:"hidden",value:e.state||"",class:"PeerProfileManageTags__stateLabel"}),Object(Y.a)({name:"tags["+t+"color]",type:"hidden",value:e.color,class:"PeerProfileManageTags__colorLabel"}),Object(Y.a)({name:"tags["+t+"name]",class:"PeerProfileManageTags__label",placeholder:Object(R.t)("mobile_mail_peer_profile_manage_tags_placeholder"),value:e.name,maxlength:20,on_change:["PeerProfile.onTagNameChange","this"]}),{class:"PeerProfileManageTags__color",style:"background-color: "+e.color,tag:"span"},{inner:[Object(G.z)()],class:"PeerProfileManageTags__remove",onClick:["PeerProfile.onRemoveTagClick","this"],tag:"div"}],class:"PeerProfileManageTags__field",tag:"div"}}Object.assign(D,{onMessengerBlockClick:function(e,t){if(Object(z.eb)("PeerProfile__adTag",e.target))return;nav.go(t)},toggleTag:function(e,t,n,i){ajaxRequest("/mail",{act:"toggle_peer_profile_tag",tag_id:e,action:i.checked?"bind":"unbind",peer_id:t,hash:n})},onAddTagClick:function(e){var t=e.$btn,n=t.parentElement,i=Object(W.b)(J,n),a=Object(W.b)("."+ie(),n);if(i.length-a.length>=20)return;var o=c.a.elem(Q({id:"",name:"",color:ee(n),state:"new",index:i.length}));n.insertBefore(o,t),ne()},onRemoveTagClick:function(e){var t=e.parentElement,n=Object(W.a)(".PeerProfileManageTags__stateLabel",t),i=Object(W.a)(".TextInput__native",n);"new"===i.value?t.remove():(Object(z.a)(ie(),t),i.value="deleted",te());ne()},onTagNameChange:function(e){var t=e.closest(".PeerProfileManageTags__field"),n=Object(W.a)(".PeerProfileManageTags__stateLabel",t),i=Object(W.a)(".TextInput__native",n);"new"!==i.value&&(i.value="changed");te()}});var K=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],X="PeerProfileManageTags__field",J="."+X,Z="PeerProfileManageTags__addLink";function ee(e){var t=Object(W.b)(J,e),n=Array.from(t).reduce((function(e,t){var n=Object(W.a)(".PeerProfileManageTags__stateLabel",t);if("deleted"!==Object(W.a)(".TextInput__native",n).value){var i=Object(W.a)(".PeerProfileManageTags__colorLabel",t);e[Object(W.a)(".TextInput__native",i).value]=!0}return e}),{});return K.find((function(e){return!n[e]}))}function te(){var e=Object(W.a)(".HeaderBtn"),t=s.a.class("HeaderBtn",{hidden:!0}).replace("HeaderBtn ","");Object(z.Yb)(t,e)}function ne(){var e=Object(W.a)(".PeerProfileManageTags__addLink"),t=e.parentElement,n=Object(W.b)(J,t),i=Object(W.b)("."+ie(),t),a=n.length-i.length,o=s.a.class(Z,{hidden:!0}).replace(Z+" ","");Object(z.vc)(o,e,a>=20)}function ie(){return s.a.class(X,{removed:!0}).replace(X+" ","")}window.PeerProfile=D;var ae=n("gZry"),oe=n("LBnd"),re=n("KMpi");function se(e){void 0===e&&(e={});var t=e.class||"",n=Object(R.q)({id:e.id,name:e.name});return{inner:[Object(re.a)({size:e.size,src:e.src,mode:n,backgroundTheme:e.id,text:e.name,textLength:Object(R.r)(e.id)}),ce(e.online)],class:t+" MailAvatar",tag:"div"}}function ce(e){return"mobile"===e?{inner:[{inner:[Object(B.a)({icon:Object(ae.a)()})],class:"mlvi_default",tag:"div"},{inner:[Object(B.a)({icon:Object(oe.a)()})],class:"mlvi_muted",tag:"div"}],class:"MailAvatar__online MailAvatar__online--mobile lvi mlvi",tag:"div"}:{class:"MailAvatar__online "+("desktop"===e?"MailAvatar__online--desktop":""),tag:"div"}}var le=n("Ligf"),ue=n("oZ+0"),de=n("3H/X"),_e=n("VTzP");function pe(e){void 0===e&&(e={});var t=0,n=e.items.map((function(n){return i=n,a=t++,o=e.trackCode,r=Object(R.O)("mail",{act:"show",peer:i.peer_id,mvk_entrypoint:"list_all_suggestions"}),s=1===i.online&&(i.online_info.is_mobile?"mobile":"desktop"),c="MailRecommendContacts.onItemClick('"+r+"', "+a+", '"+o+"')",{inner:[se({class:"MailRecommendContacts__itemAvatar",size:64,src:i.photo,online:s,id:i.id,name:i.name}),{inner:[i.name],class:"MailRecommendContacts__itemName",tag:"span"}],class:"MailRecommendContacts__item",href:r,onClick:c,"data-peer-id":i.peer_id,tag:"a"};var i,a,o,r,s,c})),i={search:{title:Object(R.t)("mobile_mail_recommend_block_action_find_friends"),icon:Object(le.a)(),url:Object(R.O)("search"),isNewPage:!1},invite:{title:Object(R.t)("mobile_mail_recommend_block_action_invite"),icon:Object(ue.a)(),url:he(e.importServices,-2),isNewPage:!1},ok:{title:Object(R.t)("mobile_mail_recommend_block_action_import_ok"),icon:Object(de.a)(),url:he(e.importServices,5),isNewPage:!0},google:{title:Object(R.t)("mobile_mail_recommend_block_action_import_gmail"),icon:Object(_e.a)(),url:he(e.importServices,6),isNewPage:!0}};return{inner:[n,["search","invite","ok","google"].map((function(e){return function(e){return{inner:[{inner:[Object(B.a)({icon:e.icon})],class:"MailRecommendContacts__itemIcon",tag:"div"},{inner:[e.title],class:"MailRecommendContacts__itemName",tag:"span"}],class:"MailRecommendContacts__item",href:e.url,target:e.isNewPage?"_blank":"_self",tag:"a"}}(i[e])}))],class:(e.class||"")+" MailRecommendContacts",tag:"div"}}function he(e,t){var n=e[t];return n?n.url:""}var fe=n("r0fY"),me=n("FbVm"),ve=new(function(){function e(){this.productionStatCollector=new me.e,this.clickStatCollector=new me.b(this.productionStatCollector)}return e.prototype.logEvent=function(e){var t,n=((t={type:fe.b.TYPE_VKM_CONVERSATION_SUGGESTION_ITEM,position:e.position})[fe.b.TYPE_VKM_CONVERSATION_SUGGESTION_ITEM]=e,t),i={type:fe.c.VKM_CONVERSATION_SUGGESTION_OPEN};return this.clickStatCollector.logEvent(n,i)},e}());function be(e){var t=store.mail.cur.recommendContacts,n=$('.MailRecommendContacts__item[data-peer-id="'+e+'"]');if(n){var i,a,o,r=t.item_data[e],s=n.querySelector(".MailAvatar__online");if(r&&s)i=s,a=r.online_info,o=!!a&&(a.is_mobile?"mobile":"desktop"),i.outerHTML=Wd.html(ce(o))}}function Ae(){var e=Object(o.a)(['\n    <a href="/mail?act=mrs" class="messenger__mrsHintBox _touched">\n      ',"\n    </a>\n  "]);return Ae=function(){return e},e}function we(){var e=Object(o.a)(["\n    ",'\n    <div class="messenger__banner_content">\n      <div class="messenger__banner_text" ',">\n        ",'\n      </div>\n      <div class="messenger__banner_buttons">\n        ',"\n      </div>\n    </div>\n    ","\n  "]);return we=function(){return e},e}function ye(){var e=Object(o.a)(['\n      <div class="messenger__banner_icon">\n        <img class="messenger__banner_icon_img" src="','">\n      </div>\n    ']);return ye=function(){return e},e}function Oe(){var e=Object(o.a)(['\n    <div class="messenger__spinner">\n      ',"\n    </div>\n  "]);return Oe=function(){return e},e}function ke(){var e=Object(o.a)(['\n    <div class="messenger__header">\n      ',"\n    </div>\n    ","\n  "]);return ke=function(){return e},e}function je(){var e=Object(o.a)(['\n    <div class="messenger__convoListNotice">\n      ',"\n    </div>\n  "]);return je=function(){return e},e}function Se(){var e=Object(o.a)(['\n    <div class="messenger__header">\n      ','\n    </div>\n    <div class="messenger__content">\n      <div class="','">','</div>\n      <div class="messenger__pinned">','</div>\n      <div class="messenger__peerProfile">',"</div>\n      ",'\n      <div class="','">\n        <div class="messenger__mrbox">','</div>\n        <div class="messenger__write">','</div>\n        <div class="messenger__acts">',"</div>\n      </div>\n    </div>\n  "]);return Se=function(){return e},e}function Ce(){var e=Object(o.a)(['\n    <div class="','">\n      <div class="messenger__layer messenger__layer_main">\n        <div class="messenger__header">','</div>\n        <div class="messenger__content">\n          ','\n        </div>\n      </div>\n      <div class="messenger__layer messenger__layer_convo">\n        ','\n      </div>\n      <div class="messenger__layer messenger__layer_page">','</div>\n      <div class="messenger__dialog"></div>\n    </div>\n  ']);return Ce=function(){return e},e}Object.assign(pe,{onItemClick:function(e,t,n){ve.logEvent({event_name:fe.p.OPEN,track_code:n,position:Number(t)}),nav.go(e)}}),window.MailRecommendContacts=pe;var Ee=function(e){void 0===e&&(e={});var t=store.mail.cur,n=t.query,i=Object(p.default)({scrap:"folder"}),a=Object(p.default)({scrap:"search"}),o=e.page,r="all"!==t.folder||t.query||t.forwardFromId?0:t.countMR;return Te({mix:Re(),mailHat:I(),convo:Ie(),page:o,mrs:r,query:n,createChatUrl:"/mail?act=new_chat",scrapFolder:i,scrapSearch:a})};function Te(e){var t=window.lang.mobile_mail_search_only_messages,n=Object(_.default)({query:e.query,createUrl:e.createChatUrl}),i=e.mrs?Ne(e.mrs):"",a=r.a.onClick("Messenger._onSearchMsgsClick"),o=Ue(),s=Object(d.a)({mix:"messenger__body",attrs:r.a.onScroll("Messenger._onMainScroll","this"),inner:[Object(l.a)({mix:"messenger__filter",inner:n}),Object(l.a)({mix:r.a.class("messenger__recommendContacts",{hidden:!o}),inner:o}),Object(l.a)({mix:r.a.class("messenger__mrsHint",{hidden:!e.mrs}),inner:i}),Object(l.a)({mix:"messenger__searchMsgs",attrs:a,inner:t}),Object(l.a)({mix:"messenger__loadable",inner:[Object(l.a)({mix:"messenger__folderList",inner:e.scrapFolder}),Object(l.a)({mix:"messenger__searchList",inner:e.scrapSearch}),Me()]})]});return r.a.html(Ce(),e.mix,e.mailHat,s,e.convo,e.page)}function Ie(){var e=store.mail,t=e.cur,n=e.peers[t.peerId],i=I(),a=Pe(),o=xe(),s=Object(f.default)(),c=n&&n.canPin,u=Object(m.default)({canPin:c,isChannel:n.isChannel,isEdu:Object(R.D)()}),_=n.isCasper,h=Object(p.default)({scrap:"peer",isCasper:_}),v=n.isIncomingMR&&!t.isImportantMREnabled?L(t.peerId):"",g=n.isRejectedMR?function(){var e=window.lang;return r.a.html(je(),e.mobile_mail_mrs_rejected_info)}():"",b=t.peerId>0&&t.peerId<2e9,A=e.flags.isPeerProfileEnabled&&b?De({tags:e.peerProfileTags,tagsData:n.peerProfileTagsData,data:n.peerProfileData}):"",w=Object(d.a)({mix:"messenger__body",attrs:r.a.onScroll("Messenger._onConvoScroll","this"),inner:[Object(l.a)({mix:"messenger__spacer"}),Object(l.a)({mix:"messenger__convoList",inner:[h,g]}),Me()]}),y="messenger__banner";o&&(y+=" messenger__bannerVisible");var O=r.a.class("messenger__footer",{actionsOpen:Be(),isIncomingMR:n.isIncomingMR&&!t.isImportantMREnabled});return r.a.html(Se(),i,y,o,a,A,w,O,v,s,u)}function Me(){var e=Object(u.a)({mix:""});return r.a.html(Oe(),e)}function Pe(){var e=store.mail,t=e.cur.peerId;return t&&e.peers[t].pinnedMsg}function xe(){var e=store.mail,t=e.cur.peerId,n=t&&e.peers[t],i=n&&n.banner;if(Object(R.H)()||!i)return"";var a="";i.icon&&(a=r.a.html(ye(),i.icon));for(var o=i.buttons,s=o.length,c=[],l=0;l<s;l++)c.push(Le(o[l],l));c=r.a.list(c);var u=Object(h.default)({class:"messenger__banner_close",onClick:r.a.onClick("uMessenger.onBannerButtonClick","event")}),d=r.a.onClick("uMessenger.onBannerTextClick","event");return r.a.html(we(),a,d,i.text,c,u)}function Le(e,t){var n={};"secondary"===e.layout?n.secondary=!0:"tertiary"===e.layout?n.tertiary=!0:n.primary=!0;var i,a=r.a.class("messenger__banner_button",n),o=e.type;return"gifts_link"===e.type&&(o="link",i="_self"),Object(h.default)({class:a,text:e.text,type:"link"===o?"link":"button",link:"link"===o?{href:e.link,target:i}:null,onClick:r.a.onClick("uMessenger.onBannerButtonClick","event",t)})}function Re(){var e,t,n=store.mail.cur;t=n.page?"view_page":n.peerId?"view_dialog":n.query&&"msgs"===n.tab?"view_searchMsgs":n.query?"view_searchPeers":"folder_"+n.folder;var i=n.peerId?store.mail.peers[n.peerId]:null,a=Object(R.I)();return r.a.class("e","messenger",{isIncomingMR:!!i&&i.isIncomingMR,isRejectedMR:!!i&&i.isRejectedMR},"uMessenger",((e={})[t]=!0,e.community=!!n.groupId,e.sak_vkpay=a,e))}function Be(){var e=store.mail.cur.msgSelected;return Object.keys(e).length>0}function Ne(e){var t=window.lang,n=langNumeric(e,t.mobile_mail_mrs_request_count);return r.a.html(Ae(),n)}function De(e){var t=e.tags,n=e.tagsData,i=e.data;if(!i)return"";var a=[];t&&n.peerTags&&(a=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var o,r=a.length;return o=n.fromAd||r?H({fromAd:n.fromAd,peerTags:a,fromMessenger:!0,urls:e.data.urls}):i.city||i.age?V(i):F(i),c.a.html({class:"PeerProfile__wrapper",inner:[{class:s.a.class("PeerProfile",{messenger:!0}),inner:o},{class:"PeerProfile__link",inner:Object(G.E)()}],onClick:["PeerProfile.onMessengerBlockClick","event",i.urls.showPeerProfile]})}function He(){var e=store.mail.cur,t=!(e.folder&&"all"!==e.folder||e.query||e.forwardFromId);return e.isRecommendationListEnabled&&t&&!e.communityParam}function Ue(){var e=store.mail.cur;if(!He())return"";var t=e.recommendContacts.items.map((function(t){return e.recommendContacts.item_data[t]})),n=e.recommendContacts.item_data.track_code;return c.a.html(pe({items:t,importServices:e.importContactsServices,trackCode:n}))}var Ve=n("jk6M"),Fe=n("Qz23"),We=n("rudk");function qe(){Object(Fe.a)(Te.getConvoBody()),removeEvent(Te.getConvoBody(),"touchstart",ze,{passive:!0})}function ze(e){var t=e.target.closest(".msg__sticker");t&&Msg.onStickerTouchStart(e,t),(t||e.target.closest(".msg"))&&Msg._onTouchStart()}function Ye(e,t){$$(".messenger__layer_"+e).forEach((function(e){e.classList.toggle("messenger__layer_loading",t)}))}function Ge(e){return $(".messenger__layer_"+e+" .messenger__body")}function Qe(e){Te.onMainScroll(e)}function Ke(e){Te.onConvoScroll(e),e._isScrolling=!0,function(e){void 0===e&&(e=null);return!window._preventedCheckTop&&(e&&function(e){return e.scrollHeight&&e.scrollTop<=2.5*window.innerHeight}(e))}(e)&&Te.onConvoAtTop(),function(e){void 0===e&&(e=null);return e&&function(e){return e.scrollHeight&&e.scrollHeight-e.scrollTop-e.offsetHeight<=1.5*window.innerHeight}(e)}(e)&&Te.onConvoAtBottom(),e._scrollingTimer&&clearTimeout(e._scrollingTimer),e._scrollingTimer=setTimeout((function(){e._isScrolling=!1}),100)}function Xe(){var e,t;if(null==(e=window.Speech)||null==(t=e.recorder)?void 0:t.isRecording)setTimeout(Xe,2e3);else{var n,i,a=Te.getConvoBody();if(a)a.prevHeight&&a.prevHeight!==a.offsetHeight&&(n=a,i=a.scrollBottom,n.scrollTop=n.scrollHeight-n.offsetHeight-i),a.prevHeight=a.offsetHeight,a.scrollBottom=function(e){return e.scrollHeight-e.scrollTop-e.offsetHeight}(a),$e&&requestAnimationFrame(Xe)}}Object.assign(Te,{scrollMainBodyToTop:function(){$(".messenger__layer_main .messenger__body").scrollTop=0},onMainScroll:Object(g.a)("scrollElem"),onQueryChange:_.default.onChange,onQueryClear:_.default.onClear,onSearchMsgsClick:Object(g.a)(),setQuery:_.default.setQuery,setQuerySilently:_.default.setQuerySilently,getMainBody:function(e){return Ge("main")},setMainLoading:function(e){return Ye("main",e)},onConvoAtTop:Object(g.a)(),onConvoAtBottom:Object(g.a)(),onConvoScroll:Object(g.a)("scrollElem"),setConvoLoading:function(e){return Ye("convo",e)},getConvoBody:function(){return Ge("convo")},scrollConvoToBottom:function(){var e=Te.getConvoBody();e&&(e.scrollTop=e.scrollHeight)},redrawConvoLayer:function(){var e=Ie();qe(),$$(".messenger__layer_convo").forEach((function(t){t.innerHTML=e}))},cleanConvoBody:qe,setupConvoBody:function(){Object(Fe.e)(Te.getConvoBody(),{topBanner:!1}),addEvent(Te.getConvoBody(),"touchstart",ze,{passive:!0})},getPageLayer:function(){return $(".messenger__layer_page")},renderMessengerPeerProfile:function(e){$(".messenger__peerProfile").innerHTML=De(e)}}),Te._onMainScroll=Qe,Te._onConvoScroll=Ke,Te._onSearchMsgsClick=Te.onSearchMsgsClick;var $e=!1;if(Ee.startPolling=function(){$e=!0,Xe()},Ee.stopPolling=function(){$e=!1},Object.assign(Ee,{redraw:function(){$$(".uMessenger").forEach((function(e){return e.outerHTML=Ee()}))},redrawView:function(){$$(".uMessenger").forEach((function(e){return e.className=Re()}));var e=store.mail,t=e.cur,n=e.peers;t.peerId&&(tt(),et(),m.default.togglePin(n[t.peerId].canPin));AudioMessagePlayer.redrawWaves(),nt(),function(){var e=He(),t=$(".messenger__recommendContacts");e&&(t.innerHTML=Ue());t.classList.toggle("messenger__recommendContacts_hidden",!e)}()},redrawMailActions:function(){var e=Be();$$(".messenger__layer_convo").forEach((function(t){t.$(".messenger__footer").classList.toggle("messenger__footer_actionsOpen",e),m.default.update();var n=store.mail,i=n.cur,a=n.peers;if(!i.peerId||!a[i.peerId].isIncomingMR){var o=t.$(".messenger__write").offsetHeight,r=t.$(".messenger__acts").offsetHeight-o,s=t.$(".messenger__body");requestAnimationFrame((function(){!s._fixed&&r&&(s.style.paddingBottom=r+"px",s._fixed=!0),r<=0&&(s.style.paddingBottom=0,s._fixed=!1)}))}}))},redrawPinnedMsg:et,setPinnedVisibility:function(e){var t=store.mail,n=t.peers,i=t.cur,a=n[i.peerId].hasPinnedMsg;$$(".messenger").forEach((function(t){t.classList.toggle("messenger_pinnedVisible",a&&e),t.classList.toggle("messenger_pinnedHidden",a&&!e)}))},redrawBanner:function(){var e=xe();$$(".messenger__banner").forEach((function(t){t.innerHTML=e,t.classList.toggle("messenger__bannerVisible",!!e)}))},redrawMRsHint:nt,expandPeerBefore:function(){if(!$(".load_before_closed"))return;var e=Te.getConvoBody();if(Ve.a.safari_mobile){var t=function(){var t=$$(".load_before_closed"),n=e.scrollHeight-e.scrollTop-e.offsetHeight;setStyle(e,"overflow","hidden"),t.forEach((function(e){return e.classList.remove("load_before_closed")}));var i=e.scrollHeight-n-e.offsetHeight;setStyle(e,"overflow","auto"),e.scrollTop=i,AudioMessagePlayer.redrawWaves()};e.isScrolling?(Ze&&clearInterval(Ze),Ze=setInterval((function(){e.isScrolling||(clearInterval(Ze),t())}),10)):t()}else if(e.scrollTop<=184){var n=$$(".load_before_closed"),i=e.scrollHeight-e.scrollTop-e.offsetHeight;n.forEach((function(e){return e.classList.remove("load_before_closed")}));var a=e.scrollHeight-i-e.offsetHeight;e.scrollTop=a,AudioMessagePlayer.redrawWaves()}},pinActionToggle:tt,scrollToMsg:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=Msg.getElem(e);if(!i)return!1;var a=Te.getConvoBody();if($(".mailScrap__loading_before"),t)a.scrollTop=i.offsetTop-.18*a.offsetHeight;else{var o=$(".typing_id_curConvo").offsetHeight;a.scrollTop=i.offsetTop-.5*(a.offsetHeight+2)+(i.offsetHeight+o)/2,i.offsetHeight>a.offsetHeight&&(a.scrollTop=i.offsetTop)}return n&&(addClass("msg_highlight",i),setTimeout((function(){removeClass("msg_highlight",i)}),1500)),!0},loadMailPage:Object(g.a)()}),Ve.a.safari_mobile){var Je=null;Te.onConvoScroll((function(e){e.isScrolling=!0,Je&&clearTimeout(Je),Je=setTimeout((function(){return e.isScrolling=!1}),50)}))}var Ze=null;function et(){var e=store.mail,t=e.peers,n=e.cur,i=Pe(),a=t[n.peerId].hasPinnedMsg;$(".messenger__pinned").innerHTML=i,MailHat_convo.setHasPinnedMsg(a)}function tt(){var e=store.mail,t=e.peers,n=e.cur;if(n.peerId){var i=t[n.peerId].majorSortId,a=Object(We.d)(i);$$(".messenger").forEach((function(e){e.classList.toggle("messenger_pinnedDialog",a)}))}}function nt(){var e=store.mail.cur,t=e.countMR,n=t&&"all"===e.folder&&!e.query&&!e.forwardFromId,i=$(".messenger__mrsHint");if(n){var a=t?Ne(t):"";i.innerHTML=a}i.classList.toggle("messenger__mrsHint_hidden",!n)}var it=n("cq4b"),at=n("/Id8"),ot=n("fWqt"),rt=n("iS9e");function st(){var e=Object(o.a)(['\n    <div class="MessageRequestRejectDialog">\n      <div class="MessageRequestRejectDialog__title">','</div>\n      <div class="MessageRequestRejectDialog__text">','</div>\n      <div class="MessageRequestRejectDialog__checkbox">\n        <label class="MessageRequestRejectDialog__checkboxIn">\n          <input type="checkbox" class="','">\n          <span class="MessageRequestRejectDialog__label">',"</span>\n        </label>\n      </div>\n    </div>"]);return st=function(){return e},e}var ct=Object(g.a)();function lt(){rt.default.open({body:dt(),confirmText:lang.mobile_mail_mrs_button_reject,cancelText:lang.mobile_mail_mrs_button_cancel,onConfirm:r.a.onClick("MessageRequestRejectDialog.onConfirmReject"),onClose:r.a.onClick("MessageRequestRejectDialog.close")})}function ut(){rt.default.close()}function dt(){var e=store.mail.members[store.mail.cur.peerId].firstNameGen,t=lang.mobile_mail_mrs_reject_confirmation.replace("{name}",e);return r.a.html(st(),lang.mobile_mail_mrs_reject_request,t,"MessageRequestRejectDialog__checkboxInput",lang.mobile_mail_report_as_spam)}function _t(){var e=$(".MessageRequestRejectDialog__checkboxInput");return!!e&&e.checked}var pt=i;window.MessageRequestRejectDialog=i;var ht=n("qHA9");function ft(e,t){rt.default.open({body:mt(e),title:lang.mobile_captcha_enter_code,confirmText:lang.mobile_captcha_send_btn,cancelText:lang.mobile_cancel,class:"MailCaptcha__dialog",onConfirm:function(n,i){var a,o=Object(W.a)('[name="'+e.key+'"]',i);o=o&&o.value||"",rt.default.close(),Object(ht.m)(e.location,Object.assign({},e.post,(a={},a[e.key]=o,a))).then((function(e){t(Promise.resolve(e))}),(function(e){t(Promise.reject(e))}))},onClose:function(){rt.default.close(),t(null)}})}function mt(e){return c.a.html({inner:[{class:"captcha_img",src:e.img,tag:"img"},{inner:[Object(Y.a)({name:e.key})],class:"MailCaptcha__input",tag:"div"}],class:"MailCaptcha__box",tag:"div"})}var vt=a,gt=n("V4qE"),bt=n("cZev"),At=n("GYWy"),wt=n.n(At),yt=n("eWFs"),Ot=n("wMVj"),kt={onTemplateInput:function(e,t,n,i){var a=$("."+n),o=i-t.value.length;a.textContent=o,a.className=s.a.class(n,{error:o<=0},"_")},onButtonMouseDown:function(e,t){Ve.a.safari_mobile||e.preventDefault()},onButtonClick:function(e,t,n){var i=$(".MailTemplatePage__TextTextarea"),a=i.value,o=i.selectionStart,r=i.selectionEnd;i.value=a.slice(0,o)+n+a.slice(r);var s=o+n.length;i.selectionStart=i.selectionEnd=s},onSave:function(e,t,n,i,a){var o=$(".MailTemplatePage__NameInput .TextInput__native"),r=$(".MailTemplatePage__TextTextarea");M.a.setLoading(t,!0),Object(z.e)("/mail",{act:"save_template",name:o.value,text:r.value,hash:i,id:n},(function(e){if(e){if(e.error){var i=$(".MailTemplatePage__ErrorRow"),o=$(".MailTemplatePage__ErrorText");return M.a.setLoading(t,!1),i.hidden=!1,void(o.textContent=e.message)}if(store.mail.cur&&store.mail.cur.templates){var r=store.mail.cur.templates,s=n?r.findIndex((function(e){return e.id===n})):-1;-1!==s?r.splice(s,1,e.result):r.push(e.result)}Ot.a.go(a)}}),(function(){M.a.setLoading(t,!1)}))},onSubmit:function(e){e.preventDefault()}};window.MailTemplatePage=kt;var jt=n("9b/I"),St=function(e){var t=window.lang,n=Object(b.MailHat)({type:"page",left:c.a.html({class:"mailHat__back",inner:Object(B.a)(Object(jt.a)()),href:"/mail"}),center:Object(b.MailHat__Title)({title:t.mobile_mail_mrs_page_title})}),i=[{class:"MessageRequestsPage__content ScrollView",inner:[{class:"MessageRequestsPage__info",inner:t.mobile_mail_mrs_page_info},c.a.wrap(Object(p.default)({scrap:"mrs"}))]},e.count?{class:"MessageRequestsPage__footer",inner:[Object(M.a)({theme:"negative",size:"large",type:"button",inner:t.mobile_mail_mrs_button_reject_all,attrs:r.a.onClick("MessageRequestsPage.rejectAll","event","this")})]}:null];return{class:"messenger__page MessageRequestsPage",inner:[{class:"messenger__header",inner:c.a.wrap(n)},{class:"messenger__content",inner:[{class:"messenger__body",inner:i}]}]}};Object.assign(St,{rejectAll:function(e,t){M.a.setLoading(t,!0),St.onRejectAll(t)},onRejectAll:befall()});var Ct=St;var Et=Ct;window.MessageRequestsPage=Ct;var Tt,It,Mt=n("V2dH"),Pt=n("iWgD"),xt=n("HGMY"),Lt=n("uEFA"),Rt=n("9M99"),Bt=n("hw56"),Nt=n("H5mD"),Dt=n("aiw/"),Ht=n("W38l"),Ut=n("HdGT"),Vt=n("gF8j"),Ft=Object(g.a)();function Wt(){It=null,Tt&&Tt.stop()}function qt(e,t){Tt&&(Tt.is_idle?It[e]=t:setTimeout(t,0))}function zt(){var e=It;It={},Object.keys(e).forEach((function(t){(0,e[t])()}))}var Yt=null,Gt=null;function Qt(e){if(Gt&&(clearTimeout(Gt),Gt=null),Yt&&(Yt=Object.assign({},Yt,{fails:0})),"online"===e.type&&Yt){var t=Yt;Yt=null,Kt(t)}}function Kt(e){if(!1!==navigator.onLine)return Object(ht.m)("/mail",{act:"message",message_id:e.msgId,forcePinned:e.forcePinned}).then((function(t){e.onResult(t)})).catch((function(t){if(e.onTryError&&e.onTryError(t),!1!==navigator.onLine){var n=Math.min(1+(0|e.fails),6),i=Math.pow(2,Math.max(n-2,0));Yt=Object.assign({},e,{fails:n}),Gt=setTimeout((function(){Gt=null,Kt(Yt)}),1e3*i)}else Yt=Object.assign({},e,{fails:0})}));Yt=Object.assign({},e,{fails:0})}window.addEventListener("online",Qt),window.addEventListener("offline",Qt);var Xt=n("UlUB"),$t=n("ZMWW"),Jt=n("BZzM"),Zt=n("N4ZS"),en=n("r/ag"),tn=n("j80l"),nn=n("vk58"),an=n("j1wj"),on=n("zvhO"),rn=n("i2ua"),sn=n("Gyo5"),cn=n("hC3G"),ln=n("y/eL"),un=new(function(){function e(){this.productStatCollector=new me.e,this.actionStatCollector=new me.a(this.productStatCollector)}return e.prototype.logEvent=function(e,t){var n,i={peer_id:e,action_type:t},a=((n={type:fe.a.TYPE_MESSAGING_ACTION_ITEM})[fe.a.TYPE_MESSAGING_ACTION_ITEM]=i,n);this.actionStatCollector.logEvent(a)},e}()),dn=n("3W//"),_n=!1;uVK.onReady(ei),Te.onQueryChange(ii),Te.onQueryClear(ai),yt.default.onTap(In),I.onUnreadClick(gn),I.onBackClick(ji),I.onBackToDialogClick(Si),I.onCancelEditing(ga),f.default.onAttachedMsgsRemove(Tn),f.default.onToBottomClick(gi),f.default.onMessage(kn),f.default.replyAsChange($a),Ut.d(On),Ut.g(jn),Ut.e(Sn),Ut.b(Ua),at.default.onClick(Xi),at.default.onRestoreClick(Zi),at.default.onReplyClick(ta),at.default.onForward(ia),Voting.onHtmlUpdate(wa),Te.onMainScroll(vi),Te.onConvoScroll(bi),Te.onSearchMsgsClick(ni),Te.onConvoScroll(Ee.expandPeerBefore),Te.onConvoAtTop(hi),Te.onConvoAtBottom(fi),m.default.onCloseClick(Ui),m.default.onRemoveClick(Vi),m.default.onImportantClick(Yi),m.default.onReplyClick(Qi),m.default.onForwardClick(Ki),m.default.onSpamClick(zi),m.default.onPinClick(Di),m.default.onEditClick(Hi),ot.default.onConfirmDelete(Wi),PinnedMsg.onHideClick(sa),Et.onRejectAll(Ea),pt.onConfirmReject(Ta),im.onNewMsg(Cn),im.onEditMsg(En),im.onMultiTyping(Ei),im.onRecordingAudio(Ii),im.onOnlineChange(Mi),im.onMsgReadByMe(Pi),im.onMsgReadByOther(xi),im.onMsgImportantRemove(Pn),im.onMsgImportantAdd(Mn),im.onMsgRemove(xn),im.onMsgListen(Ln),im.onConvoMinorIdChanged(Bn),im.onConvoMajorIdChanged(Rn),im.onPeerKeyboard(Dn),im.onPeerBanner(Gn),im.onPeerConvert(Qn),im.onPeerAdmin(Kn),im.onMsgRequestChange(Xn),im.onCallInProgress($n),im.onDialogImportant(Hn),im.onDialogMarkedUnread(Vn),im.onDialogAdTag(Un),im.onUnreadCount(Fn),im.onIncomingCall(Wn),im.onKeyboardCallback(Yn),im.onResync(qn),im.onIsNewChange(zn),Ft(La),AudioMessagePlayer.events.on("listened",Ra),AudioMessagePlayer.events.on("transcription_toggle",Ha),nav.onPopState(Li),nav.onBeforeGo(Ri),nav.onBeforeGo2(Bi),page.onChange(Ni),uVK.onReady(pa),page.onChange(pa),uVK.onReady(ha),page.onChange(ha),uVK.onReady(fa),page.onChange(fa),page.onChange(yn),page.onChange(Aa),uVK.onReady(yn),uVK.onReady(oa),uVK.onReady(Aa),uVK.onOrientationChange(wn),Ee.loadMailPage(ya),Ee.onShowPinnedMsgClick=ra,Ee.onHidePinnedMsgClick=sa,Ee.onMarkDialogAsUnreadClick=ca,Ee.onPinDialogClick=la,Ee.onUnpinDialogClick=ua,Ee.onBannerButtonClick=da,Ee.onBannerTextClick=_a,Ee.onCall=Qa,Ee.goToMsg=ea,Ee.openSchoolGrade=ka,Ee.createNewChat=ja,Ee.cacheAudioMessageWaves=Ji;var pn=!1,hn=0,fn=[],mn=[],vn=Object(Xt.a)((function(){if(!fn.length)return;var e=store.mail,t=e.members,n=e.cur,i=fn,a=mn;fn=[],mn=[],Object(z.e)("/mail",{act:"get_members",members:i},(function(e){Object.assign(t,e),a.forEach((function(e){e===n.peerId&&Mt.default.redraw(),yt.default.redrawTyping(e)}))}))}),3e3);function gn(){Te.scrollMainBodyToTop()}function bn(){Object(Fe.c)();var e=Te.getMainBody();e&&Object(Fe.e)(e);var t=Object(W.a)(".leftMenu__searchItems");t&&Object(Fe.e)(t,{topBanner:!1,overscrollY:!1})}function An(){Object(Fe.c)({topBanner:!1}),Te.setupConvoBody()}function wn(){Ve.a.safari_mobile&&document.activeElement.blur()}function yn(){var e=nav.getQuery("msg")||nav.getQuery("id")||nav.getQuery("edit_msg_id");e?requestAnimationFrame((function(){Ee.scrollToMsg(e)})):requestAnimationFrame(Te.scrollConvoToBottom)}function On(e){var t=store.mail.cur;Object(Bt.b)(e),t.peerId&&(0===e.sendId.indexOf("edit")?yi(e):(xt.d(e),xt.a(e),Pa()),AudioMessagePlayer.redrawWaves())}function kn(e){store.mail.cur.peerId&&0===e.sendId.indexOf("edit")&&yi(e)}function jn(){Object(Bt.d)();var e=store.mail,t=e.cur,n=e.presend;if(t)if(t.peerId){if(n.failed[t.peerId]){var i=[];n.failed[t.peerId].map((function(e){var t=n.msgs[e];t&&(0===t.sendId.indexOf("edit")?yi(t):i.push(t))})),xt.e(i)}}else Object.keys(n.failed).forEach((function(e){yt.default.redrawLastMsg(e)}))}function Sn(e){var t=store.mail.presend.msgs[e];t&&(Object(Bt.r)(t),Object(Bt.o)(t),0===e.indexOf("edit")?store.mail.cur.peerId&&p.default.peerReplaceItems([t.id]):(store.mail.cur.peerId&&xt.d(t),Pa()))}function Cn(e,t){wi(e,t)}function En(e){wi(e)}function Tn(){var e=store.mail,t=e.cur;e.peers;Object(Bt.w)(t.viewerId,t.peerId,{msgs:void 0},t.editing),t.msgAttached[t.peerId]=[],f.default.uiRedrawAttachments(t.peerId)}function In(e){var t=store.mail,n=(t.cur,t.rolls),i=t.msgs;if(n){var a=Number(qs2obj(e.split("?")[1]).peer);i[last(n.peer[a]||[])];return ti(e)}}function Mn(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls,r=i[e];if(r&&(r.isImportant=!0,o.folder.important=o.folder.important.concat(e).filter(unique).sort(desc),at.default.toggleImportant(e,!0),"important"===n.folder)){var s=a.folder.slice();a.folder=a.folder.concat(e).filter(unique).sort(desc),p.default.redrawFolder(s)}}function Pn(e,t){void 0===t&&(t=!0);var n=store.mail,i=n.cur,a=n.msgs,o=n.scraps,r=n.rolls,s=a[e];if(s&&(s.isImportant=!t,Object(it.c)(r.folder.important,e),at.default.toggleImportant(e,!1),"important"===i.folder)){var c=o.folder.slice();Object(it.c)(o.folder,e),p.default.redrawFolder(c)}}function xn(e,t){void 0===t&&(t=Promise.resolve());var n=store.mail,i=n.cur,a=n.msgs,o=n.scraps,r=n.rolls,s=n.peers,c=a[e];if($t.a.isIntegrated&&$t.a.sendMessage("remove_msg",{msg:c}),c&&!i.msgRemoved[e]){delete a[e],Object(it.c)(r.peer[c.peerId],e),i.peerId===c.peerId&&(Object(it.c)(o.peer,e),at.default.remove(e,!0),i.msgSelected[e]&&(delete i.msgSelected[e],m.default.setCount(Object.keys(i.msgSelected).length),Ee.redrawMailActions()),o.peer.length?p.default.checkDivider():p.default.redrawPeer()),c.isImportant&&i.countImportant--;var l=s[c.peerId];l.groupCall&&l.groupCall.msgId===e&&(l.groupCall=void 0);var u=l.isIncomingMR,d=l.isRejectedMR;c.isUnread&&c.authorId!==i.viewerId&&(l.countUnread=l.countUnread-1,u||d||l.countUnread<=0&&k(-1,l.isMuted),f.default.redrawToBottom(),I.redrawCounter()),r.peer[c.peerId].length?Nn(c.peerId,e):(i.peerId===c.peerId&&I.redrawActions(),t.then((function(){Object(z.e)("/mail",{act:"get_last_msg",peer_id:c.peerId,user_id:i.userId},(function(t,n){n&&(storeMethods.injectMail(t),r.peer[c.peerId].push(n)),Nn(c.peerId,e)}),(function(){Nn(c.peerId,e)}))})))}}function Ln(e){var t=store.mail.msgs,n=t&&t[e];if(n){n.listened=!0,n.attachesHTML=n.attachesHTML.replace(/class="(im_msg_audiomsg(?:\w?\s?)*)"/g,'class="im_msg_audiomsg im_msg_audiomsg_listened"');var i=$$('.audio-msg-track[data-msg="'+e+'"]');i&&i.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")}))}}function Rn(e,t){var n=t.majorSortId,i=store.mail,a=i.peers,o=i.cur,r=i.scraps,s=i.rolls,c=a[e];if(c){c.majorSortId=n,o.peerId===e&&Ee.pinActionToggle();var l=o.folder,u="all"===l||"unread"===l&&c.countUnread;n&&u&&(s.folder[l]=s.folder[l].concat(e).filter(unique).sort(aa),r.folder=r.folder.concat(e).filter(unique).sort(aa),p.default.redrawFolder()),n||Nn(e,void 0)}else n&&Object(z.e)("/mail",{act:"get_dialog",peer_id:e},(function(t){storeMethods.injectMail(t);var i=t.peers[e],a=Object.keys(t.msgs)[0];i.isCasper&&!a||!i||(Object(Bt.a)(e,{msgs:[a]}),Rn(e,{majorSortId:n}))}))}function Bn(e,t){var n=t.minorSortId,i=store.mail,a=i.peers,o=i.scraps,r=i.cur;if(a[e].minorSortId=n,!r.peerId){var s=o.folder.slice();o.folder=o.folder.sort(aa),p.default.redrawFolder(s)}}function Nn(e,t){var n=store.mail,i=n.cur,a=(n.msgs,n.scraps),o=n.rolls,r=n.peers,s=r[e],c=s.isIncomingMR,l=s.isRejectedMR;o.peer[e].length||(c||l?Object(it.c)(o.mrs,e):(Object(it.c)(o.folder.all,e),Object(it.c)(o.folder.unread,e),Object(it.c)(o.folder.unrespond,e)),"mrs"===i.page?Object(it.c)(a.mrs,e):"important"!==i.folder&&Object(it.c)(a.folder,e)),o.peer[e]=o.peer[e].filter(unique).sort(asc),c||l?o.mrs=o.mrs.filter(unique).sort(aa):(0===s.countUnread&&(o.folder.unread=o.folder.unread.filter((function(t){return t!==e}))),o.folder.all=o.folder.all.filter(unique).sort(aa),o.folder.unread=o.folder.unread.filter(unique).sort(aa),i.groupId&&(o.folder.unrespond=o.folder.unrespond.filter(unique).sort(aa))),"mrs"===i.page?(a.mrs=a.mrs.filter(unique).sort(aa),p.default.redrawMRs()):"important"===i.folder?(Object(it.c)(a.folder,t),p.default.redrawFolder()):"all"===i.folder?(a.folder=a.folder.filter(unique).sort(aa),p.default.redrawFolder()):"unread"===i.folder?(0===r[e].countUnread&&Object(it.c)(a.folder,e),a.folder=a.folder.filter(unique).sort(aa),p.default.redrawFolder()):"unrespond"===i.folder&&(a.folder=a.folder.filter(unique).sort(aa),p.default.redrawFolder())}function Dn(e){var t=store.mail,n=t.peers,i=t.cur;if(n[e]){var a=Object(Bt.f)(e);if(!(Date.now()-a.updateTime<=500)){var o=a.updateTime;Object(z.e)("/mail",{act:"get_peers",peer_ids:[e]},(function(t){o===a.updateTime&&(storeMethods.injectMail(t),e==i.peerId&&f.default.renderKeyboardIfNeeded({update:!0}))}))}}}function Hn(e,t){var n=store.mail.peers[e];n&&(n.isImportant=t),yt.default.redrawImportant(e,t)}function Un(e){Object(z.e)("/mail",{act:"get_peers",peer_ids:[e]},(function(t){storeMethods.injectMail(t),yt.default.updateAdTag(e)}))}function Vn(e,t){var n=store.mail,i=n.rolls,a=n.peers,o=n.scraps,r=n.cur,s=a[e];if(s){s.isMarkedUnread=t;var c=function(n){return t?n.concat(e):n.filter((function(t){return t!==e}))};if(i.folder.unread=c(i.folder.unread).filter(unique).sort(aa),"unread"===r.folder){var l=o.folder.slice();o.folder=c(o.folder).filter(unique).sort(aa),p.default.redrawFolder(l)}yt.default.redrawUnread(e)}}function Fn(e){var t,n=e.showOnlyNotMuted?e.countNotMuted:e.count;nav.getQuery("community")||(t=n,setNotify(t),menu.refreshSingleCounter(Lt.b,t)),function(e){var t=window.store.mail.cur;if(t){var n=e.showOnlyNotMuted,i=e.countNotMuted,a=e.count;t.unreadCounters={countNotMuted:i,count:a},t.settings.show_only_not_muted_messages=n}}(e),I.redrawCounter(),Ya(n),navigator.setAppBadge&&navigator.setAppBadge(n)}function Wn(e){$t.a.isIntegrated&&$t.a.sendMessage("incoming_call",e)}function qn(){im.pause(),Zn((function(){im.resume()}))}function zn(e,t){Object(rn.b)(e,t,store.mail)}function Yn(e,t,n,i){void 0===i&&(i={}),function(e,t,n){void 0===n&&(n={});if(store.mail&&store.mail.cur&&"msg"!==store.mail.cur.page&&store.mail.cur.peerId!==e)return;switch(n.type){case"show_snackbar":if(n.text){var i=store.mail.members[t],a=(store.mail.peers[e],!1);e>2e9&&i&&(a=i.avatar),Snackbar.init({position:gt.a,text:Object(Rt.a)(htsc(n.text)),avatar:a,avatar_position:"left"})}break;case"open_app":var o=makeUrl("/app"+n.app_id,{from:nav.cur.slice(1)});nav.hard_go(o+"#"+n.hash);break;case"open_link":var r=Object(Zt.a)(n.link,!0),s=store.mail.members[t],l=Object(tn.c)(n.link),u=l.host||l.hostname||r;u.startsWith("xn--")&&(u=wt.a.toUnicode(u));var d=c.a.elem(Object(en.a)({scrollable:!0,header:{title:lang.mobile_mail_callback_popup_title},content:[c.a.wrap(lang.mobile_mail_callback_popup_text.replace("{name}",s.name).replace("{domain}",u)),{class:"Popup__buttons",inner:Object(nn.a)({inner:[Object(M.a)({inner:[lang.mobile_open],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"regular",url:r,open_in_new_tab:!0}),Object(M.a)({inner:[lang.mobile_cancel],on_click:"Popup.close(this);",use_native_onclick:!0,theme:"secondary"})]})}]}));en.a.open(d,!0)}}(t,n,i),Object(Bt.y)(e)}function Gn(e){Date.now()-hn<=500||Object(z.e)("/mail",{act:"get_peers",peer_ids:[e]},(function(t){var n=store.mail.cur;storeMethods.injectMail(t),e==n.peerId&&Ee.redrawBanner()}))}function Qn(e,t){im.pause(),Object(z.e)("/mail",{act:"get_peers",peer_ids:[t]},(function(n){Object(Bt.s)(e,t),storeMethods.injectMail(n);var i=store.mail.cur;e===i.peerId?(p.default.redrawFolder(),t===i.peerId?ci(t):ti("/mail?act=show&peer="+t,{replace:!0})):i.folder&&p.default.redrawFolder(),im.resume()}))}function Kn(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(a){var r=o[e];r&&(t===a.userId&&(r.isAdmin=n),n&&!Object(it.a)(r.adminIds,t)?r.adminIds.push(t):!n&&Object(it.a)(r.adminIds,t)&&Object(it.c)(r.adminIds,t))}}function Xn(e,t){var n=store.mail,i=n.cur,a=n.rolls,o=n.scraps;i&&("created"!==t&&_n||("created"===t&&_n&&(_n=!1),"created"===t?Jn(e,(function(t,n){Object(Bt.p)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&(a.mrs=a.mrs.concat(e).filter(unique).sort(aa)),i.folder&&(p.default.redrawFolder(),Ee.redrawMRsHint()),i.peerId===e&&ci(e)})):"canceled"===t||"rejected"===t?Jn(e,(function(t,n){Object(Bt.p)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(it.c)(a.mrs,e),i.folder&&(p.default.redrawFolder(),Ee.redrawMRsHint()),i.peerId===e?ci(e):"mrs"===i.page&&(Object(it.c)(o.mrs,e),p.default.redrawMRs())})):"accepted"===t&&Jn(e,(function(t,n){Object(Bt.a)(e),storeMethods.injectMail(t),i.countMR=n,store.mail.mrs&&Object(it.c)(a.mrs,e),i.folder&&(p.default.redrawFolder(),Ee.redrawMRsHint()),i.peerId===e?ci(e):"mrs"===i.page&&(Object(it.c)(o.mrs,e),p.default.redrawMRs())}))))}function $n(e,t){var n=store.mail.peers[e];if(t){var i=n&&n.groupCall,a=i&&i.updateTime||0,o=Date.now()-a<=500;i&&o||Object(z.e)("/mail",{act:"get_peers",peer_ids:[e]},(function(e){storeMethods.injectMail(e)}))}else n&&(n.groupCall=void 0)}function Jn(e,t){im.pause(),Object(z.e)("/mail",{act:"mrs_get_peer",peer_id:e},(function(e,n){t(e,n),im.resume()}))}function Zn(e){var t=store.mail,n=t.cur,i=t.msgs,a=t.scraps,o=t.rolls;o.folder[n.folder]=[],a.folder=[],Te.setMainLoading(!0),Object(z.e)("/mail",{act:"all"===n.folder?null:n.folder,offset:0},(function(t,r){if(store.mail.cur){storeMethods.injectMail(t),"all"!==n.folder&&"unread"!==n.folder||Object.keys(t.msgs).forEach((function(e){e=toInt(e);var n=t.msgs[e].peerId;o.peer[n]=(o.peer[n]||[]).concat(e).filter((function(e){return!!i[e]})).filter(unique).sort(asc)}));var s="important"===n.folder,c=s?desc:aa,l=Object.keys(s?t.msgs:t.peers).map(toInt).sort(c).filter((function(e){return-1===a.folder.indexOf(e)})),u=[].concat(l).filter(unique).sort(c);o.folder[n.folder]=u,a.folder=first(20,u),store.mail.reached.folder[n.folder]=r,p.default.redrawFolder(),I.redrawCounter(),Te.setMainLoading(!1),e&&e()}}))}function ei(){"/mail"!==location.pathname&&0!==location.pathname.indexOf("/write")||Oa()}function ti(e,t){void 0===t&&(t={});var n=oi(e);return e=makeUrl(e),n&&location.pathname+location.search!==e&&nav.go(e,!1,{push_only:!0,replace:!0===t.replace}),n}function ni(){ti("/mail?q="+store.mail.cur.query+"&tab=messages")}function ii(e){var t=ii;if(t.timer&&clearTimeout(t.timer),store.mail.cur){var n=store.mail.cur,i=!n.query;if(e){var a="msgs"===n.tab?"&tab=messages":"",o=makeUrl("/mail?q="+e+a);oi(o),i?ti(o):t.timer=setTimeout((function(){ti(o,{replace:!0})}),300)}else ti("/mail",{replace:!0})}}function ai(){Te.setMainLoading(!1),Te.setConvoLoading(!1),ii.clearTimer(),ti("/mail",{replace:!0})}function oi(e){var t=(e=makeUrl(e)).split("?"),n=t[0],i=qs2obj(t[1]),a=store.mail,o=a.cur,s=a.scraps,l=a.peers;if(o){var u=i.act,_=i.peer,h=i.chat,f=i.email,m=i.m,v=toInt(i.msg)||toInt(i.id)||null,g="messages"===i.tab?"msgs":"peers",A=i.q||"",w=+i.community||0;if(Ri())return Ga(n,i,e),!0;if(!Object(ht.k)(n,i))return clog("[mail nav] Exit Mail"),void Sa();if((o.groupId?-o.groupId:0)===w){Ga(n,i,e),v&&(pn=!0),p.default.clearSystemMessage2();var y=_?toInt(_):h?toInt(h)+2e9:f?-toInt(f)-2e9:null,O="unread"===u||"important"===u||"unrespond"===u||"ad_tag"===u?u:"all",k=function(e){switch(e){case"template":case"mrs":case"msg":return!0}return!1}(u),j=!k&&!!o.page,S=o.query!==A||o.tab!==g;o.page;if(function(){var e=store.mail.cur;if(e.peerId||e.page||e.query)return!1;return!0}()&&Object(Bt.u)(o.folder,Te.getMainBody().scrollTop),j&&(o.page=null),S&&y&&("peers"===o.tab?store.mail.cur.mvk_entrypoint="conversations_search":"msgs"===o.tab&&(store.mail.cur.mvk_entrypoint="message_search")),o.peerId&&!y&&A)clog("[mail nav] Peer back to Search"),o.query=A,o.peerId=null,o.tab=g,li(),Te.setQuery(A),pi();else if(S&&o.peerId===y)o.query=A,o.tab=g,s.search=[],o.tab!==g&&(store.mail.reached.search.msgs={}),Ee.redrawView(),Te.setQuery(A),p.default.redrawSearch(),A?(clog("[mail nav] Search update"),pi()):(clog("[mail nav] Search exit"),function(){var e=store.mail,t=e.cur,n=e.scraps;t.query="",t.tab="peers",n.search=[],Ee.redrawView(),p.default.redrawSearch(),Te.setQuery("")}(),0===s.folder.length&&_i());else if(k)clog("[mail nav] Enter Page: "+u),o.page=u,o.peerId&&(o.peerId=null,li()),o.backUrl=Ca({peerId:y}),Ee.redrawView(),function(e){var t=store.mail.cur,n=Te.getPageLayer();"mrs"===t.page&&store.mail.mrs?(store.mail.scraps.mrs=store.mail.rolls.mrs.concat(),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=c.a.html(Et({count:t.countMR}))):(n.classList.toggle("messenger__layer_loading",!0),n.innerHTML=(i=Object(b.MailHat_page)(),a=Object(d.a)({mix:"messenger__body",inner:[Me()]}),r.a.html(ke(),i,a)),Object(z.e)(e,{},(function(e,t){t&&storeMethods.injectMail(t),n.classList.toggle("messenger__layer_loading",!1),n.innerHTML=e})));var i,a}(e);else{if(o.peerId&&o.peerId===y)return!0;o.peerId!==y||j&&y?y?(clog("[mail nav] Enter Dialog"),o.backUrl=Ca({peerId:y}),ci(y,v),l[y].isIncomingMR&&un.logEvent(y,fe.i.OPEN_MR)):(clog("[mail nav] Exit Dialog"),li(),ri(O),_i()):y&&m?(clog("[mail nav] Peer System Msg"),store.mail.peers[y].systemMessageCode=toInt(m),p.default.updateClass("peer"),p.default.redrawSystemMessage(),Te.scrollConvoToBottom()):(o.folder!==O||j&&O)&&(clog("[mail nav] Enter Folder"),ri(O),_i(),p.default.redrawEmpty("folder"))}return!0}}}function ri(e,t){void 0===t&&(t={restoreScroll:!0});var n=store.mail,i=n.cur,a=n.scraps,o=n.rolls;i.folder=e,si()?Zn():(t.restoreScroll?a.folder=(o.folder[e]||[]).concat():a.folder=first(20,o.folder[e]),p.default.folderSetItems(a.folder),Ee.redrawView(),I.redraw()),Object(ln.a)(location.href,document.referrer),t.restoreScroll?Te.getMainBody().scrollTop=Object(Bt.t)(e):Te.getMainBody().scrollTop=0}function si(){var e=store.mail,t=e.rolls,n=e.cur,i=e.msgs,a=t.folder[n.folder];return!a||("important"===n.folder?a.some((function(e){return!i[e]})):a.some((function(e){return!(t.peer[e]&&t.peer[e].length>0)})))}function ci(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.peers,r=n.scraps,s=n.rolls,c=n.reached;if(Da={},o[e]){var l=s.peer[e]||[];if(t||!(o[e].countUnread>1)||o[e].isIncomingMR||o[e].isRejectedMR){i.peerId=e,r.peer=[],oa(),t?(r.peer=[t],s.peer[e]=[],c.peer.before[e]=!1,c.peer.after[e]=!1):(r.peer=last(20,l),_()),store.mail.reached.peer.after[e]=!0,p.default.updateClass("peer"),Ee.redrawView(),Te.redrawConvoLayer(),pa(),I.startStatusUpdate(),bt.a.checkStickers(),p.default.peerSetItems(r.peer),An(),Ut.h().then((function(){f.default.init()})),t||ui(e);var u=o[e];t&&(p.default.updateClass("peer"),Ee.scrollToMsg(t)),t?hi(t):hi(),Object(Jt.a)(),Object(ln.a)(location.href,document.referrer),requestAnimationFrame((function(){t||(Te.scrollConvoToBottom(),Ut.h().then((function(){Te.scrollConvoToBottom()}))),AudioMessagePlayer.redrawWaves(),requestAnimationFrame((function(){t||Te.scrollConvoToBottom()}))})),Xa(e,store.mail.cur.viewerId),u.banner&&"birthday"===u.banner.name&&statlogsValueEvent("gifts_im_birthday_banner","view",e)}else{Te.setConvoLoading(!0),window._preventedCheckTop=!0,pn=!0,i.peerId=e,r.peer=[],oa(),yt.default.redrawUnread(e),Ee.redrawView(),Te.redrawConvoLayer(),pa(),I.startStatusUpdate(),_(),p.default.peerSetItems([]),An(),Ut.h().then((function(){f.default.init()}));var d={act:"show",peer_id:e,msg:"unread",reply_msg_id:i.msgReply[i.peerId]};Object(z.e)("/mail",d,(function(t,n,i){if(store.mail.cur){var o=t.rolls.peer[e];if(storeMethods.injectMail(t),c.peer.after[e]=n,c.peer.before[e]=i,l=s.peer[e]||[],(Object(it.b)(o,l)||n&&0===l.length)&&(s.peer[e]=l.concat(o).filter(unique).sort(asc)),store.mail.cur.peerId===e){f.default.preventShowToBottom(),r.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",p.default.updateClass("peer"),p.default.peerSetItems(o),AudioMessagePlayer.redrawWaves(),ui(e),Xa(e,store.mail.cur.viewerId);var u=o.find((function(e){return a[e].isUnread}));Ee.scrollToMsg(u,!0,!1),requestAnimationFrame((function(){window._preventedCheckTop=!1,pn=!1,Te.setConvoLoading(!1)}))}}}))}}else Object(z.e)("/mail",{act:"get_peers",peer_ids:[e]},(function(n){storeMethods.injectMail(n),o[e]?ci(e,t):window.location.reload()}));function _(){i.forwardFromId&&(Gi(),i.forwardFromId=null)}}function li(e){void 0===e&&(e={});var t=store.mail,n=t.cur,i=t.scraps;I.cancelStatusUpdate(),ga(),n.peerId=null,n.mvk_entrypoint="",i.peer=[],oa(),n.hasAttachments=!1,e.keepSelected||(n.msgSelected={}),Ee.redrawView(),I.redraw(),f.default.reset(),Te.cleanConvoBody(),bn(),requestAnimationFrame((function(){m.default.setCount(0),Ee.redrawMailActions(),Mt.default.redraw(),requestAnimationFrame((function(){p.default.peerSetItems(i.peer)}))}))}function ui(e){qt("read_dialog"+e,(function(){!function(e){var t=store.mail.peers;if(!t)return;var n=t[e];if(n&&(n.isIncomingMR||n.isRejectedMR))return;!n||n.countUnread>0||n.isMarkedUnread?Object(z.e)("/mail",{act:"read_dialog",peer_id:e,mark_conversation_as_read:n.isMarkedUnread,hash:n.hashRead},(function(){Pi(null,e)})):setTimeout((function(){Pi(null,e)}),500)}(e)}))}function di(e,t){qt("read_dialog"+t,(function(){!function(e,t){var n=store.mail.peers;if(!n)return;Pi(null,t),Object(z.e)("/mail",{act:"read_message",msg_id:e,peer_id:t,hash:n[t].hashRead},(function(){}))}(e,t)}))}function _i(){var e=_i,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.folder,c=a.folder,l=o.folder[s]||[],u="folder_"+s,d=r.folder[s]&&last(c)===last(l);if(Te.setMainLoading(0===c.length&&!d),!t[u]&&!d){var _="important"===s,h=si(),f=_?desc:aa,m=[];if(0===c.length)m=first(20,l);else{var v=l.indexOf(last(c));m=v>=0?l.slice(v+1,v+20+1):[]}if(m.length&&!h){var g=c.concat(m).filter(unique).sort(f);a.folder=g,p.default.folderAddItems(m)}else{t[u]=!0;var b="all"===s?null:s,A=h||c.length<20?0:c.length;Object(z.e)("/mail",{act:b,offset:A},(function(e,n){if(store.mail.cur){storeMethods.injectMail(e),Object.keys(e.peers).forEach((function(e){store.mail.reached.peer.after[e]=!0})),"all"!==s&&"unread"!==s||Object.keys(e.msgs).forEach((function(t){t=toInt(t);var n=e.msgs[t].peerId;o.peer[n]=(o.peer[n]||[]).concat(t).filter(unique).sort(asc)}));var d=Object.keys(_?e.msgs:e.peers).map(toInt).sort(f).filter((function(e){return-1===c.indexOf(e)})),m=l.concat(d).filter(unique).sort(f);o.folder[s]=m,n&&(r.folder[s]=n),t[u]=!1,i.folder===s&&(a.folder=m,p.default.updateClass("folder"),A>0?p.default.folderAddItems(d):p.default.redrawFolder(),Te.setMainLoading(!1),h&&(p.default.folderSetItems(a.folder),Ee.redrawView(),I.redraw()))}}))}}}function pi(){var e=pi,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached,s=i.tab,c=i.query,l="search_msgs_"+s+"_"+c,u=a.search,d=o.search[s][c]||[],_=r.search[s][c]&&last(u)===last(d);if(Te.setMainLoading(0===u.length&&!_),!t[l]&&!_){var h=[];if("peers"===s&&(d.length||(d=function(){var e=store.mail,t=e.cur,n=e.peers,i=(e.rolls,Object.keys(n).map(toInt)),a=QuickSearch.getQueryREs(t.query),o=[];return a.forEach((function(e){i.forEach((function(t){n[t].title.match(e)&&o.push(t)}))})),o.filter(unique).sort(aa)}()),d.length))if(0===u.length)h=first(20,d);else{var f=d.indexOf(u);h=f>=0?d.slice(f+1,f+41):[]}if(h.length&&(a.search=u.concat(h).filter(unique).sort(aa),p.default.redrawSearch(),p.default.updateClass("search"),Te.setMainLoading(!1)),!h.length||"peers"===s){var m="msgs"===s?{act:"search",q:c,offset:a.search.length,messages:1}:{act:"search",q:c};e.timer&&clearTimeout(e.timer),e.timer=setTimeout((function(){t[l]=!0,Object(z.e)("/mail",m,(function(e,n){if(store.mail.cur){t[l]=!1,storeMethods.injectMail(e);var u=Object.keys("peers"===s?e.peers:e.msgs).map(toInt),_="peers"===s?aa:desc,h=d.concat(u).filter(unique).sort(_);o.search[s][c]=h,n&&(r.search[s][c]=n),i.tab===s&&i.query===c&&(Te.setMainLoading(!1),a.search=a.search.concat(u).filter(unique).sort(_),p.default.redrawSearch(),p.default.updateClass("search"))}}))}),300)}}}function hi(e){if(!Object(W.a)(".load_before_closed")){var t=hi,n=t.locked||(t.locked={}),i=store.mail,a=i.cur,o=i.scraps,r=i.rolls,s=i.reached,c=i.flags,l=i.peerProfileTags,u=i.peers;if(a){var d=a.peerId,_=o.peer,h=r.peer[d]||[],m="peer_before_"+d,v=s.peer.before[d]&&_[0]===h[0],g=a.msgReply[d],b=!!u[d].actionUrls;if(Te.setConvoLoading(_.length<1&&!v),!(n[m]||v&&b)){var A=Te.getConvoBody(),w=!Object(it.b)(_,h),y=first(_),O=y?h.indexOf(y):-1,k=0===_.length?last(10,h):O>=0?h.slice(O-20,O):[];if(k.length&&!e){if(A.scrollTop>6e3&&!w)return;if(window._preventedCheckTop)return;var j=o.peer.slice(),S=_.concat(k).filter(unique).sort(asc);o.peer=S,p.default.peerAddItemsBefore(k.filter((function(e){return-1===j.indexOf(e)}))),AudioMessagePlayer.redrawWaves(),p.default.updateClass("peer"),Te.setConvoLoading(!1)}else{if(!d)return;var C={act:"show",peer_id:d,msg:_[0],direction:e?"around":"before",reply_msg_id:g},E=_[0];n[m]=!0,Object(z.e)("/mail",C,(function(t,i,a){if(store.mail.cur){e&&setTimeout((function(){pn=!1}),10);var u=store.mail.peers[d],v=t.peers[d];c.isPeerProfileEnabled&&Object(ht.l)(d)&&(u.peerProfileData=v.peerProfileData,Te.renderMessengerPeerProfile({tags:l,tagsData:v.peerProfileTagsData,data:v.peerProfileData})),n[m]=!1,u.actionUrls=v.actionUrls;var g=Object(rn.a)(d,t);t.peers=[],storeMethods.injectMail(t),Object(rn.b)(d,g,store.mail);var b=Object.keys(t.msgs).map(toInt).filter((function(e){return-1===_.indexOf(e)})),y=_.concat(b).filter(unique).sort(asc);if(a&&(s.peer.before[d]=!0),i&&(s.peer.after[d]=!0),h=r.peer[d]||[],(Object(it.b)(y,h)||a&&0===h.length)&&(r.peer[d]=(r.peer[d]||[]).concat(y).filter(unique).sort(asc)),store.mail.cur.peerId===d){if(f.default.preventShowToBottom(),A.scrollTop>6e3&&!w)return;var O=o.peer.slice();o.peer=y,p.default.updateClass("peer"),E?(p.default.peerAddItemsBefore(b.filter((function(e){return-1===O.indexOf(e)&&e<E})),!0),p.default.peerAddItemsAfter(b.filter((function(e){return-1===O.indexOf(e)&&e>E})),!0)):p.default.peerAddItemsBefore(b,!0),e&&(Ee.scrollToMsg(e),Te.setConvoLoading(!1)),AudioMessagePlayer.redrawWaves(),b.forEach((function(e){CasperTimer.init(e)})),Te.setConvoLoading(!1),null!=t.flags.stickersAutoplay&&StickersSettings.setAutoplay(t.flags.stickersAutoplay),Ee.expandPeerBefore(),setTimeout(Ee.expandPeerBefore,100),e&&Gi(),I.redrawActions(),f.default.redrawReply(),g&&f.default.updateNewConvoStickersHint(!0)}}}))}}}}}function fi(){var e=fi,t=e.locked||(e.locked={}),n=store.mail,i=n.cur,a=n.scraps,o=n.rolls,r=n.reached;if(!pn&&i){var s=i.peerId,c=a.peer,l=o.peer[s]||[],u="peer_after_"+s;if(!(t[u]||r.peer.after[s]&&last(c)===last(l))){var d=Te.getConvoBody(),_=!Object(it.b)(c,l),h=function(){return d.scrollHeight-d.scrollTop-d.offsetHeight},m=last(c),v=m?l.indexOf(m):-1,g=v>=0?l.slice(v+1,v+21):[];if(!g.length||nav.getQuery("msg")||nav.getQuery("id")){if(!s)return;var b={act:"show",peer_id:s,msg:last(c),direction:"after"};t[u]=!0,Object(z.e)("/mail",b,(function(e,n){if(store.mail.cur){t[u]=!1;var i=Object(rn.a)(s,e);e.peers=[],storeMethods.injectMail(e),Object(rn.b)(s,i,store.mail);var d=Object.keys(e.msgs).map(toInt).filter((function(e){return-1===c.indexOf(e)})).sort(asc),m=c.concat(d).filter(unique).sort(asc);if(n&&(r.peer.after[s]=n),l=o.peer[s]||[],(Object(it.b)(m,l)||n&&0===l.length)&&(o.peer[s]=(o.peer[s]||[]).concat(m).filter(unique).sort(asc)),store.mail.cur.peerId===s){if(h()>6e3&&!_)return;n&&p.default.updateClass("peer"),a.peer=m,p.default.updateClass("peer"),p.default.peerAddItemsAfter(d),AudioMessagePlayer.redrawWaves(),i&&f.default.updateNewConvoStickersHint(!0)}}}))}else{if(h()>6e3&&!_)return;var A=c.concat(g).filter(unique).sort(asc);a.peer=A,p.default.peerAddItemsAfter(g),p.default.updateClass("peer"),AudioMessagePlayer.redrawWaves()}}}}ii.clearTimer=function(){var e=ii;e.timer&&(clearTimeout(e.timer),e.timer=null)};var mi=!1;function vi(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.rolls,o=t.reached,r=e.scrollTop,s=e.scrollHeight,c=e.offsetHeight;if(n){var l=n.folder,u=i.folder,d=a.folder[l],_=!(o.folder[l]&&last(u)===last(d))&&c+20>=s;if(!n.query&&r<=20&&i.folder.length&&!_){if(mi){mi=!1;i.folder.slice();i.folder=first(20,a.folder[n.folder]),p.default.folderCutItems(20)}}else(r>20||_)&&(mi=!0,s-r-c<window.innerHeight&&(n.query?pi():l&&_i()))}}function gi(){var e=store.mail,t=e.cur,n=e.scraps,i=e.rolls,a=e.reached,o=n.peer,r=i.peer[t.peerId]||[];if(r.length&&last(o)===last(r)&&a.peer.after[t.peerId])Te.scrollConvoToBottom(),f.default.hideToBottom(),p.default.updateClass("peer");else{var s=t.peerId,c={act:"show",peer_id:s};Object(z.e)("/mail",c,(function(e,t){if(store.mail.cur){var o=e.rolls.peer[s];i.peer[s]=o.slice(),storeMethods.injectMail(e),a.peer.after[s]=!0,store.mail.cur.peerId===s&&(f.default.preventShowToBottom(),n.peer=o.slice(),geByClass1("mailScrap__items_peer").innerHTML="",p.default.peerAddItemsBefore(o),p.default.updateClass("peer"),Te.scrollConvoToBottom(),AudioMessagePlayer.redrawWaves())}}))}}function bi(e){var t=bi;t.timer||(t.timer=setTimeout((function(){t.timer=null,function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.msgs,o=t.peers;if(!n)return;var r=i.peer.find((function(e){return a[e]&&a[e].isUnread&&a[e].authorId!==n.viewerId})),s=e.scrollTop,c=e.scrollHeight-s-e.offsetHeight;if(r){var l=at.default.getElem(r),u=e.scrollHeight-l.offsetTop;c-u<=100&&ui(n.peerId)}e._prevScroll||(e._prevScroll=0),c<300&&Object(W.a)(".mailScrap_reachedAfter")?f.default.hideToBottom():s>e._prevScroll-5||n.peerId&&o[n.peerId].countUnread?f.default.showToBottom():f.default.hideToBottom();e._prevScroll=s}(e)}),50))}function Ai(e){for(var t=0,n=e.attaches.length;t<n;t++){if("sticker"===e.attaches[t].type)return!1}var i=store.mail.cur;return i.userId===e.peerId&&!i.groupId||e.isOut}function wi(e,t){var n,i=e.peerId,a=e.id,o=e.authorId,r=e.attaches,s=e.adminId,c=e.isService,l=e.isStealth,u=e.isOut,d=e.keyboard,_=e.ttl,p=e.ts,h=e.text,f=store.mail,m=f.peers,v=f.members,g=f.cur,b=f.rolls,A=m[i]&&m[i].pinnedMsgId===a,w=Object(ht.e)(e),y=Object(Bt.i)(w,i),O=!(!y&&!e.replaced),k=g.peerId===i&&!b.peer[i].length;if($t.a.isIntegrated&&$t.a.sendMessage("add_msg",{peerId:i,attaches:r,title:m[i]?m[i].title:""}),y)Ht.e(w,"opt_to_lp"),n=function(e){return!!e.length}(r);else{var j=!!m[i],S=c||r.length||A||e.hasTemplate,C=!v[o]||s&&!v[s];n=j?S||C:!l}if(y){var E=function(e){var t=store.mail.cur;if(Object(Bt.r)(e),Ut.i(e.sendId,"silent"),t.peerId&&-1===e.sendId.indexOf("edit"))return xt.c(e)}(y),T=Object.assign({},y,{id:a,failed:!1,pending:!1,waiting:!0,sendId:void 0,canEdit:Ai(e),ts:p,ttl:_,text:Oi(h)});if(storeMethods.injectMsg(T),yi(T,{existingElem:E},t),k&&I.redrawActions(),!n)return void Ht.a(w)}if(!d||!d.inline){if((d||n)&&!u&&!e.edited)Object(Bt.f)(i).updateTime=Date.now();!d||n||u||e.edited||function(e){var t=e.peerId,n=e.authorId,i=e.msgId,a=e.keyboard,o=store.mail.peers[t];Object(Bt.c)(t),o&&(o.keyboard=Object(ht.n)({keyboard:a,authorId:n,msgId:i}))}({peerId:i,authorId:o,msgId:a,keyboard:d})}if(!y&&!n){var M=function(e){var t,n=e.peerId,i=e.id,a=e.authorId,o=e.isOut,r=e.text,s=e.ts,c=e.flags,l=e.adminId,u=e.isService,d=e.ttl,_=e.isExpired,p=store.mail,h=p.cur,f=p.peers,m=p.msgs,v=p.members,g=f[n],b=Object(ht.d)(s,h.timeShift),A=m[i],w="";r&&(w=r.replace(/<br>/g,"\n").replace(ht.a,"@$3").replace(ht.b,"@$1 ($3)"));t=e.replaced?!!A&&A.edited:!!e.edited;var y=r,O=Oi(r,c),k=e.keyboard;k=k&&k.inline?Object(ht.n)({keyboard:k,authorId:a,msgId:i}):null;var j=o?i>g.outReadUpToId:i>g.inReadUpToId,S={id:i,peerId:n,authorId:a,ts:s,date:b,dateShort:b,text:O,textInput:w,body:y,isUnread:j,edited:t,canEdit:Ai(e),isOut:o,isService:u,keyboard:k,attaches:{},forwards:[],hasReply:!!e.hasReply,ttl:d,isExpired:Boolean(_)};l&&(S.adminName=l===h.userId?lang.mobile_mail_you:v[l].name,S.adminUrl=v[l].url);return S}(e);return storeMethods.injectMsg(M),yi(M,{isReplace:O},t),void(k&&I.redrawActions())}im.pause(),Kt({msgId:a,forcePinned:A,onTryError:function(e){var t=e.type;w&&(Ht.b(w,"server_load_attach",t),Ht.a(w))},onResult:function(e){var n=e[0],o=e[1];w&&(Ht.e(w,"attach"),Ht.a(w)),store.mail.cur&&(storeMethods.injectMail(n),o&&function(e,t){var n=t.unpin,i=t.pinned,a=store.mail,o=a.cur,r=a.peers;if(n){r[e].pinnedMsg="",r[e].hasPinnedMsg=!1;var s=ma();delete s[e],va(s),o.peerId===e&&(Ee.redrawPinnedMsg(),pa())}else i&&(r[e].pinnedMsg=i,r[e].hasPinnedMsg=!0,o.peerId===e&&(Ee.redrawPinnedMsg(),pa()))}(i,o),yi(n.msgs[a],{isServerMsg:!0,isReplace:O},t),k&&I.redrawActions(),im.resume())}})}function yi(e,t,n){var i=void 0===t?{}:t,a=i.isServerMsg,o=i.isReplace,r=i.existingElem,s=store.mail,c=s.cur,l=s.peers,u=s.rolls,d=s.scraps,_=s.reached,h=e.peerId,m=e.authorId,v=e.isOut,g=e.id,b=!v,A=l[h]&&0===l[h].countUnread&&b,w=o||!!e.edited,y=l[h],O=y.isIncomingMR,j=y.isRejectedMR,S=Te.getConvoBody(),C=!1;e.isUnread&&(C=c.viewerId===h||c.peerId===h&&b&&S.scrollHeight-S.scrollTop-S.offsetHeight<400&&!!Object(W.a)(".mailScrap_reachedAfter")),C&&b&&!O&&!j&&di(g,h);var E=l[h];if(n&&E&&(E.minorSortId=n),e.groupCall&&E&&E.groupCall&&(E.groupCall.updateTime=Date.now()),!w){var T=last(u.peer[h]||[]);u.peer[h]=(u.peer[h]||[]).concat(g).filter(unique).sort(asc),O||j||(u.folder.all=u.folder.all.concat(h).filter(unique).sort(aa),_.peer.after[h]||(_.peer.after[h]=!0,_.peer.before[h]=!1));var M=l[h];if(b&&(h===c.peerId&&f.default.renderKeyboardIfNeeded({update:!0}),e.isUnread&&(O||j||(u.folder.unread=u.folder.unread.concat(h).filter(unique).sort(aa)),a||(M.countUnread||(M.countUnread=0),M.countUnread+=1)),h===c.peerId&&f.default.redrawToBottom()),!O&&!j)if(A&&(k(1,M.isMuted),I.redrawCounter()),c.groupId&&(b?u.folder.unrespond=u.folder.unrespond.concat(h).filter(unique).sort(aa):Object(it.c)(u.folder.unrespond,h)),"all"===c.folder){var P=d.folder.slice();d.folder=d.folder.concat(h).filter(unique).sort(aa),p.default.redrawFolder(P)}else if("unread"===c.folder&&m!==c.viewerId){var x=d.folder.slice();d.folder=d.folder.concat(h).filter(unique).sort(aa),p.default.redrawFolder(x)}else if("unrespond"===c.folder){var L=d.folder.slice();b?d.folder=d.folder.concat(h).filter(unique).sort(aa):Object(it.c)(d.folder,h),p.default.redrawFolder(L)}if(O&&(u.mrs=u.mrs.concat(h).filter(unique).sort(aa),"mrs"===c.page)){var R=d.mrs.slice();d.mrs=d.mrs.concat(h).filter(unique).sort(aa),p.default.redrawMRs(R)}if(c.peerId!==h||!Object(it.b)(d.peer,u.peer[h])&&0!==d.peer.length||last(d.peer)!==T)r&&r.remove();else{d.peer=d.peer.concat(g).filter(unique).sort(asc);var B=ki((function(){r?p.default.peerAddElemAfter(g,r):p.default.peerAddItemsAfter([g])}));b&&!B&&f.default.showToBottom(),m===c.viewerId&&p.default.removeDivider()}var N=Object(Pt.b)(h);N&&N.users.length&&(Object(Bt.q)(h,m),h===c.peerId&&Mt.default.redraw(),yt.default.redrawTyping(h))}var D=g===Object(yt.uConvo_getLastMsgId)(h);w&&(Object(Bt.c)(h,g),D?ki((function(){return p.default.peerReplaceItems([g])})):p.default.peerReplaceItems([g]),Object.keys(Da).filter((function(e){return!!Da[e]})).forEach((function(e){AudioMessagePlayer.toggleTranscription(null,Object(W.a)(".audio-msg-track__transcriptionButton",at.default.getElem(e)),!0)}))),D&&(yt.default.redrawLastMsg(h),yt.default.redrawUnread(h),StickersAnimation.checkSettingsAndLoad(e.id)),CasperTimer.init(e.id),h===c.peerId&&Ji(),e.attaches&&e.attaches.gift&&bt.a.checkStickers({force:!0,ignore_hash:!0})}function Oi(e,t){return void 0===t&&(t=0),e=Object(ht.q)(e,t),e=Object(ht.r)(e),e=Object(Rt.a)(e)}function ki(e){var t=Te.getConvoBody(),n=t.scrollTop+t.offsetHeight>=t.scrollHeight-2;e();var i=t.scrollHeight-t.scrollTop-t.offsetHeight<400;return n&&Te.scrollConvoToBottom(),i}function ji(){if(store.mail.cur){var e=store.mail.cur.backUrl;if(store.mail.cur.backUrl=null,bn(),e)history.back();else ti(function(){var e=store.mail.cur;return"mrs"===e.page?"/mail":"template"===e.page?"/mail?act=show&peer="+nav.getQuery("from"):(e.tab||e.peerId,"/mail")}(),{replace:!0})}}function Si(){var e=store.mail.cur,t=e.msgSelected,n=e.forwardFromId;e.forwardFromId=null,Object.keys(t).forEach((function(e){delete t[e]})),at.default.unselectAll(),Ee.redrawMailActions(),n&&ci(n)}var Ci={};function Ei(e,t,n){var i=store.mail,a=i.cur,o=i.peers,r=o?o[e]:null;if(r&&!r.isIncomingMR&&!r.isRejectedMR){var s=Object(Bt.e)({type:"text",users:t,count:n},a.viewerId);Object(Bt.x)(e,s);var c=Ci[e];c&&clearTimeout(c),s.count&&s.users.length&&(Ci[e]=setTimeout((function(){Ci[e]=null,Ei(e,[],0)}),7e3),Ma(s.users,e)),e===a.peerId&&Mt.default.redraw(),yt.default.redrawTyping(e)}}var Ti={};function Ii(e,t,n){var i=store.mail,a=i.cur,o=i.peers;if(o?o[e]:null){var r=Object(Bt.e)({type:"audio",users:t,count:n},a.viewerId);Object(Bt.x)(e,r);var s=Ti[e];s&&clearTimeout(s),r.count&&r.users.length&&(Ti[e]=setTimeout((function(){Ti[e]=null,Ii(e,[],0)}),7e3),Ma(r.users,e)),e===a.peerId&&Mt.default.redraw(),yt.default.redrawTyping(e)}}function Mi(e){var t=e.userId,n=e.isOnline,i=e.onlinePlatform,a=e.lastActionTime,o=store.mail,r=o.cur,s=o.peers[t];if(s&&s.canSeeOnline&&(s.isOnline=n,e.isOnline&&(s.onlinePlatform=i),a&&(s.lastActionTime=a),yt.default.redrawOnline(t),r.peerId===t&&I.redrawOnline()),r.recommendContacts&&r.recommendContacts.item_data[t]){var c=r.recommendContacts.item_data[t];c.online=n?1:0,c.online_info.is_online=n,c.online_info.is_mobile="mobile"===i,be(t)}}function Pi(e,t){var n=store.mail,i=n.cur,a=n.peers,o=n.msgs,r=n.scraps,s=n.rolls;if(i){var c=i.peerId===t?r.peer:[],l=s.peer[t]||[],u=a[t];if(l.concat(c).forEach((function(t){var n=o[t];n&&t<=e&&n.authorId!==i.viewerId&&(delete n.isUnread,at.default.markAsRead(t))})),u&&(u.inReadUpToId=e,u.countUnread&&(k(-1,u.isMuted),u.countUnread=0)),Object(it.c)(s.folder.unread,t),"unread"===i.folder){var d=r.folder.slice();Object(it.c)(r.folder,t),p.default.redrawFolder(d)}I.redrawCounter(),f.default.redrawToBottom(),yt.default.redrawUnread(t)}}function xi(e,t){var n=store.mail,i=n.cur,a=n.msgs,o=n.peers,r=n.rolls,s=n.scraps,c=r.peer[t]||[],l=a[e],u=o[t];if(u&&(u.outReadUpToId=e),l)for(var d=c.indexOf(e);d>=0;){var _=a[c[d]];_.authorId===i.viewerId&&_.id<=e&&(delete _.isUnread,at.default.markAsRead(_.id)),d--}else last(c)&&e<=last(c)&&c.forEach((function(t){var n=a[t];n.authorId===i.viewerId&&n.id<=e&&(delete n.isUnread,at.default.markAsRead(n.id))}));i.peerId===t&&s.peer.forEach((function(t){var n=a[t];n.authorId===i.viewerId&&n.id<=e&&(delete n.isUnread,at.default.markAsRead(n.id))})),yt.default.redrawUnread(t)}function Li(){var e;if(Ri())return!0;var t=store.mail.cur;if(t&&(t.backUrl=null),t&&t.forwardFromId)return Si(),!0;Ve.a.safari_mobile&&document.activeElement.blur();var n=qs2obj(location.search.slice(1)).act;if(!Object(W.a)(".uMessenger")&&"/mail"===location.pathname&&"show_medias"!==n)return nav.go(location,null,{no_push:!0,need_restore:!1}),!0;var i=new RegExp(/z=photo/).test(location.search);if(Object(W.a)(".uMessenger")&&!i&&!ge("z_photoview")&&!ge("StoriesView")&&!(null==(e=Object(dn.b)())?void 0:e.mediaViewManager.opened)){var a=oi(location.pathname+location.search);return a&&nav.go(location.pathname+location.search,null,{no_push:!0,push_only:!0}),a}}function Ri(){var e=Ri;if(mediaUpload.isUploading)return e.noAlert||alert(unescapeAttr(lang.mobile_mail_wait_until_uploaded)),e.noAlert=!0,setTimeout((function(){e.noAlert=!1}),10),!0}function Bi(e,t,n,i){void 0===i&&(i={});var a=store.mail.cur;if($t.a.isIntegrated&&!t._sak_embed_force){if(!$t.a.isNewMail)return Ka(t),$t.a.sendMessage("nav",{isNewMail:Object(ht.k)(e,t),path:e,query:t,url:n}),!0;if(!Object(ht.k)(e,t))return Ka(t),$t.a.sendMessage("nav",{isNewMail:!1,path:e,query:t,url:n}),a||setTimeout((function(){location.reload()})),!0}if(!("/mail"===n&&a&&a.groupId||i.replace))return!t.m&&geByClass1("uMessenger")?ti(n):void 0}function Ni(){window.isNewMail&&(store.mail.cur?Object(ht.k)(location.pathname,location.search)?Oa():Sa():ii.clearTimer())}function Di(){var e=store.mail,t=e.cur,n=(e.msgs,e.peers),i=e.hash,a=t.msgSelected,o=toInt(Object.keys(a)[0]),r=n[t.peerId];t.hasAttachments=!1,t.msgSelected={},r.pinnedMsgId=o,r.hasPinnedMsg=!0,at.default.unselectAll(),Ee.redrawMailActions(),Object(z.e)("/mail?act=pin",{hash:i.pin,chat:nav.getQuery("chat")||store.mail.cur.peerId-2e9,msg:o,_ajax:1})}function Hi(){var e,t=store.mail,n=t.cur,i=t.msgs,a=(t.peers,t.hash),o=(t.replies,t.pendingReplies,n.msgSelected),r=toInt(Object.keys(o)[0]),s=n.peerId,c=Object(Bt.h)(n.viewerId,n.peerId),l=i[r],u=function(e){l.hasReply||c&&c.editing&&c.editing.id==r&&c.msgs&&(n.msgAttached[s]=c.msgs),l.hasReply?n.msgReply[s]=l.reply:n.msgReply[s]=null,f.default.redrawReply(),f.default.onAttachedMsgsRemove(),f.default.uiRedrawAttachments(s),f.default.setModifiers({editing:!0}),I.setModifiers({editing:!0}),Ee.redrawMailActions(),Ui(),f.default.setText(e)};if(n.editing==r)return e=c&&c.editing&&c.editing.id==r?c.editing.text||"":l.textInput,void u(e);n.editing=r,ba(),Object(z.e)("/mail?act=edit_message_start",{hash:a.edit,edit_msg_id:r,peerId:s,_ajax:1},(function(e,t){Object(Bt.l)(n.peerId,e),u(t)}))}function Ui(){var e=store.mail.cur.msgSelected;Object.keys(e).forEach((function(t){delete e[t]})),at.default.unselectAll(),m.default.setCount(0),Ee.redrawMailActions()}function Vi(){var e=store.mail,t=(e.msgs,e.cur),n=Object.keys(t.msgSelected).every(Fi);1!==Object.keys(t.msgSelected).length||n?ot.default.open({canDeleteForAll:n}):qi()}function Fi(e){var t=store.mail,n=t.msgs,i=(t.cur,t.peers),a=vk.id,o=n[e],r=nav.getQuery().community,s=i[o.peerId];return!!o&&(o.authorId!==a&&o.authorId!==-r?s.isAdmin&&-1===s.adminIds.indexOf(o.authorId):!(o.peerId===a&&!r)&&(333!==o.peerId&&(!(Date.now()/1e3-o.ts>86400)&&!(s.kicked||s.closed||s.unableToWrite||s.kickedMessage))))}function Wi(){var e=store.mail.cur.editing;e?(!function(e){var t=store.mail,n=t.cur,i=(t.hash,t.msgs,t.peers),a=n.peerId,o=Object(z.e)("/mail",{act:"delete_for_all",peer:a,ids:e+"",hash:i[a].hashRemove},(function(){})).promise;xn(e,o),Ee.redrawMailActions()}(e),ga(!0)):qi(!1,ot.default.isDeleteMessagesForAll()),ot.default.close()}function qi(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var n=store.mail,i=n.cur,a=n.peers,o=i.peerId,r=i.msgRemoved,s=i.msgSelected,c=Object.keys(s),l=window.AudioMessagePlayer.getAttachedTrackPlayer(),u=0;if(l){var d=l.closest(".msg");u=d?at.default.getId(d):0}var _=Object(z.e)("/mail",{act:t?"delete_for_all":e?"spam":"delete",peer:o,ids:c.join(","),hash:a[o].hashRemove},(function(){})).promise;c.forEach((function(n){(n=+n)===u&&window.AudioMessagePlayer.detachPlayer(),delete s[n],t?xn(n,_):(r[n]=!e||"spam",e?at.default.spam(n):at.default.remove(n))})),Ee.redrawMailActions()}function zi(){qi(!0)}function Yi(){var e=store.mail,t=e.cur,n=e.hash,i=e.msgs,a=t.msgSelected,o=Object.keys(a),r=o.some((function(e){return!i[e].isImportant}))?1:0;o.forEach((function(e){delete a[e],i[e].isImportant!=!!r&&(r?t.countImportant++:t.countImportant--),i[e].isImportant=!!r,at.default.toggleImportant([e],!!r)})),Object(z.e)("/mail",{act:"mark_important",ids:o,hash:n.important,val:r},(function(){})),at.default.unselectAll(),Ee.redrawMailActions()}function Gi(){var e=store.mail.cur,t=e.peerId,n=Object.keys(e.msgSelected).map(toInt);e.msgAttached[t]=n,Object(Bt.w)(e.viewerId,e.peerId,{msgs:n,reply:void 0},e.editing),e.msgReply[t]&&!e.editing&&Object(z.e)("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),e.msgReply[t]=null,e.msgSelected={},at.default.unselectAll(),m.default.setCount(0),f.default.redrawReply(),f.default.uiRedrawAttachments(t),Ee.redrawMailActions()}function Qi(){var e=store.mail,t=e.cur,n=e.flags,i=e.pendingReplies,a=t.peerId;if(!Object(ht.h)(a)){if(!n.replies)return Gi();var o=toInt(Object.keys(t.msgSelected)[0]);t.msgReply[a]=o,i[o]=at.default.getReplyDataFromHTML(o),Object(Bt.w)(t.viewerId,t.peerId,{reply:o,msgs:void 0},t.editing),Object(z.e)("/mail",{act:"reply_start",hash:store.mail.hash.reply,peer_id:store.mail.cur.peerId,msg_id:o}),t.msgAttached[a]=[],t.msgSelected={},at.default.unselectAll(),m.default.setCount(0),f.default.redrawReply(),f.default.uiRedrawAttachments(a),Ee.redrawMailActions(),f.default.openKeyboard("text")}}function Ki(){var e=store.mail.cur;if(e){var t=e.msgSelected,n=Object.keys(t);Object(ht.h)(e.peerId)||$i(n)&&(e.forwardFromId=e.peerId,e.query="",e.tab="peers",Te.setQuerySilently(""),li({keepSelected:!0}),ri("all",{restoreScroll:!1}),_i())}}function Xi(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=t.msgs,o=t.flags,r=n.msgRemoved,s=n.msgSelected,c=i[n.peerId];if(f.default.hideStickersPanel(),!r[e]){s[e]?delete s[e]:s[e]=!0;var l=Object.keys(s),u=l.length,d=1===u&&l[0]==i[n.peerId].pinnedMsgId,_=l.reduce((function(e,t){return e&&a[t].isImportant}),!0),p=l.some((function(e){return a[e].ttl}));m.default.setCount(u),m.default.setModifiers({pinned:d,important:_}),m.default.setLabels({pinned:d,important:_}),Object(ht.h)(n.peerId)?m.default.toggleQuickButtons(!1):m.default.toggleQuickButtons(!0),o.replies&&(1!==u||c.isIncomingMR?m.default.setReplyAvailable(!1):m.default.setReplyAvailable(!0));var h=toInt(Object.keys(s)[0]),v=1==u&&a[h];if(m.default.setEditAvailable(v&&v.canEdit&&!c.unableToWrite),m.default.setImportantAvailable(u>0&&n.viewerId>0),m.default.setForwardAvailable($i(l)),c.canPin&&function(e){var t=store.mail.msgs[e];if(!t)return!1;return!t.noPin}(h)){var g=toInt(Object.keys(s)[0]);m.default.togglePin(1===u&&g!==c.pinnedMsgId)}else m.default.togglePin(!1);m.default.setForwardAvailable(!0),p&&(m.default.setImportantAvailable(!1),m.default.togglePin(!1),m.default.setForwardAvailable(!1)),Ee.redrawMailActions()}}}function $i(e){var t=store.mail.msgs;return 0===e.filter((function(e){return t[e]&&t[e].noForward})).length}function Ji(){var e=store.mail.msgs;AudioMessagePlayer.redrawWaves(),Array.from($$(".im_msg_audiomsg")).map((function(e){return e.closest(".msg")})).forEach((function(t){var n,i=at.default.getId(t),a=e[i];if(t.classList.contains("msg_pending")&&(null==(n=a.attaches)?void 0:n.audiomsg)){var o=Object(W.a)(".pi_medias",t);o.isSameNode=function(){return!0},a&&(a.attachesHTML=o.outerHTML)}}))}function Zi(e){var t=store.mail,n=t.cur,i=t.hash,a=t.msgs[e],o="spam"===n.msgRemoved[e]?"nospam":"restore";delete n.msgRemoved[e],at.default.restore(e),Object(z.e)("/mail",{act:o,id:e,hash:i.restore},(function(){})),a.isImportant&&(n.countImportant++,Mn(e)),p.default.redrawFolder()}function ea(e){var t=store&&store.mail&&store.mail.cur;if(t&&e){var n=store.mail.msgs[e],i=!n;if((!n||n.peerId&&n.peerId===t.peerId)&&!t.msgRemoved[e])Ee.scrollToMsg(e)||(i=!0),i&&Object(z.e)("/mail",{act:"get_msgs",msgs:[e]},(function(t){storeMethods.injectMail(t);var n=store.mail,i=n.msgs,a=n.cur;a.peerId&&i[e]&&!i[e].isDeletedForAll&&ci(a.peerId,e)}))}}function ta(e,t,n){var i=store&&store.mail&&store.mail.cur;if(i&&e){var a=store.mail.forwards[n];if(a.peerId&&a.peerId===i.peerId&&!i.msgRemoved[e])Ee.scrollToMsg(e)||Object(z.e)("/mail",{act:"get_msgs",msgs:[e]},(function(i){storeMethods.injectMail(i);var a=store.mail,o=a.msgs,r=a.cur;r.peerId&&(!o[e]||o[e].isDeletedForAll?na(e,t,n):ci(r.peerId,e))}));else na(e,t,n)}else na(e,t,n)}function na(e,t,n){var i=nav.getQuery();t&&"show"===i.act&&(i.msg=t,nav.go(location.pathname+obj2qs(i),!1,{replace:!0,push_only:!0}));var a=Object(ht.j)(t)?Object(at.Msg_makePinnedReplyLink)(i.chat,n):Object(at.Msg_makeReplyLink)(e,t,n);nav.go(a,null,{force:!0})}function ia(e){var t,n=store.mail.cur;n&&$i([e])&&(n.msgSelected=((t={})[e]=!0,t),statlogsValueEvent("messages_channel_forward_click",0),Ki())}function aa(e,t){var n=store.mail,i=n.rolls,a=n.presend,o=n.msgs,r=n.peers,s=i.peer[t]||[0],c=xa(a.pending[e],(function(e){return-1===e.indexOf("edit")})),l=xa(a.pending[t],(function(e){return-1===e.indexOf("edit")})),u=last(s),d=c&&a.msgs[c].ts||0,_=l&&a.msgs[l].ts||0;if(_||(_=u&&o[u].ts||0),d)return _-d;var p=r[e]&&r[e].majorSortId||0,h=r[t]&&r[t].majorSortId||0,f=r[e]&&r[e].minorSortId||0,m=r[t]&&r[t].minorSortId||0;return p!==h?h-p:m-f}function oa(){if(store.mail.cur){var e=!!store.mail.cur.peerId;$$(".vk__page_mail").forEach((function(t){return t.classList.toggle("messenger_noPullToRefresh",e)}))}}function ra(){var e=store.mail.cur.peerId,t=Object(W.a)(".pinnedMsg");if(t){Number(t.dataset.id);var n=ma();delete n[e],va(n),pa()}}function sa(){var e=store.mail.cur.peerId,t=Object(W.a)(".pinnedMsg");if(t){var n=Number(t.dataset.id),i=ma();i[e]=n,va(i),pa()}}function ca(){var e=store.mail.cur.peerId,t=store.mail.hash;Vn(e,!0),Object(z.e)("/mail",{act:"mark_dialog_as_unread",peer_id:e,hash:t.markDialogAsUnread},(function(t){t.error&&Vn(e,!1)})),ji()}function la(){var e=store.mail.cur.peerId,t=store.mail.hash;Object(z.e)("/mail",{act:"pin_convo",peer_id:e,hash:t.pinDialog})}function ua(){var e=store.mail.cur.peerId,t=store.mail.hash;Object(z.e)("/mail",{act:"unpin_convo",peer_id:e,hash:t.unpinDialog})}function da(e,t){var n,i=store.mail,a=i.cur,o=i.peers[a.peerId],r=o.banner;void 0===t||(n=o.banner&&o.banner.buttons[t],"birthday"===r.name&&"gifts_link"===n.type&&statlogsValueEvent("gifts_im_birthday_banner","click",a.peerId),"message_request_banner"!==r.name||"reject_mr"!==n.type)?(Object(z.e)("/mail",{act:"banner_callback",hash:o.hashBanner,peer_id:a.peerId,callback_data:n&&n.callback_data}),hn=Date.now(),o.banner=null,Ee.redrawBanner()):pt.open()}function _a(e){var t=Object(W.a)(".messenger__banner_content");t&&t.classList.toggle("messenger__banner_contentExpanded")}function pa(){var e=store.mail,t=e.cur;e.peers;if(t){var n=t.peerId;if(n){var i=Object(W.a)(".pinnedMsg"),a=ma()[n],o=i?intval(i.dataset.id):null;Ee.setPinnedVisibility(o&&a!==o)}}}function ha(){var e=store.mail.cur;e&&e.peerId&&Ee.pinActionToggle()}function fa(){if(store.mail.cur&&store.mail.cur.peerId){var e=Object(W.a)(".pinnedMsg");if(e)if(!Number(e.dataset.id)){var t=store.mail.cur.peerId,n=ma();delete n[t],va(n)}}}function ma(){return lsGet("messenger.pinHidden")||{}}function va(e){lsSet("messenger.pinHidden",e)}function ga(e){var t=store.mail.cur;if(t&&t.editing){t.editing=!1,ba(),!0!==e&&Object(z.e)("/mail?act=edit_message_cancel",{peerId:t.peerId}),Object(Bt.k)(t.peerId),Object(Bt.w)(t.viewerId,t.peerId,{});var n=Object(Bt.h)(t.viewerId,t.peerId);t.msgAttached[t.peerId]=n.msgs||[],t.msgReply[t.peerId]=n.reply||null,f.default.setText(n&&n.text||""),f.default.setModifiers({editing:!1}),I.setModifiers({editing:!1}),f.default.uiRedrawAttachments(t.peerId),f.default.redrawReply();var i=Te.getConvoBody();i.scrollTop+i.offsetHeight>=i.scrollHeight-2&&Te.scrollConvoToBottom()}}function ba(){var e=nav.getQuery();store.mail.cur.editing?e.edit_msg_id=store.mail.cur.editing||void 0:delete e.edit_msg_id,nav.go(location.pathname+obj2qs(e),!1,{replace:!0,push_only:!0})}function Aa(){if(store.mail.msgs){var e=+nav.getQuery("edit_msg_id");e&&store.mail.msgs[e]&&(store.mail.cur.msgSelected[e]=!0,Hi())}}function wa(e){var t=e.closest("."+at.default.class);if(t){var n=at.default.getId(t);store.mail.msgs[n].textFull=at.default.getTextHtml(t)}}function ya(e){ti(e)}function Oa(){if(store.mail.cur){if(window.isCustomScroll&&Object(Fe.d)(),(store.mail.cur||store.mail.page)&&!store.mail.cur.peerId){bn();var e=Te.getMainBody();e&&vi(e)}store.mail.cur.peerId&&An();var t,n,i=Object(an.a)()-ajax.navStart;if(Object(on.a)(i)&&i>=50)statlogsValueEvent("mvk_mail_loading_time",i,store.mail.cur.folder,null==(t=store.mail.rolls.folder.all)?void 0:t.length);Ut.h().then(Ia).then((function(){Pa(),store.mail.cur.peerId&&(f.default.init(),Pi(null,store.mail.cur.peerId)),nav.getQuery("msg")||nav.getQuery("id")||Te.scrollConvoToBottom()})),im.on(),Tt||((Tt=new Vt.a({id:"mail_user",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:15e3})).on("unidle",zt),Tt.on("unidle",Ft)),It={},Tt.start(),n=qs2obj(location.search.slice(1)),store.mail.cur.mvk_entrypoint=n.mvk_entrypoint||"notifications"===n.from&&"notifications"||"",Ee.startPolling(),addEvent(window,"resize",Jt.a),navigator.setAppBadge&&navigator.setAppBadge(O()),Dt.e(Va),Dt.c(Fa),$t.a.onMessage.on("embed",qa),Ya(O()),Xa(store.mail.cur.peerId,store.mail.cur.viewerId),store.mail.cur.peerId&&store.mail.peers[store.mail.cur.peerId].isIncomingMR&&un.logEvent(store.mail.cur.peerId,fe.i.OPEN_MR)}}function ka(){$t.a.sendMessage("open_school_grade",store.mail.cur.schoolData)}function ja(){$t.a.sendMessage("new_chat")}function Sa(){if($t.a.onMessage.off("embed",qa),store.mail.cur){if(Dt.e(Va),Dt.c(Fa),!document.body.classList.contains("vk__page_mail"))return im.off(),Wt(),void storeMethods.resetMail();Object(Fe.d)(),Te.cleanConvoBody(),im.off(),Wt(),Ee.stopPolling(),I.cancelStatusUpdate(),p.default.resetPrevScraps(),storeMethods.resetMail()}}function Ca(e){var t=e.peerId,n=store.mail.cur,i=null;if("mrs"===n.page)i="/mail?act=mrs";else if("template"===n.page)i="/mail?act=template";else if("msg"===n.page)i="/mail?act=show=peer="+t;else if(n.forwardFromId&&n.forwardFromId!==t)i="/mail?act=show&peer="+n.forwardFromId;else if(n.query){var a="msgs"===n.tab?"&tab=messages":"";i="/mail?q="+n.query+a}else if(n.peerId)i="/mail?act=show&peer="+n.peerId;else if(n.folder&&!n.forwardFromId){var o="";"all"!==n.folder&&(o="?act="+n.folder),i="/mail"+o}return i}function Ea(){var e=store.mail.cur.countMR,t=store.mail.rolls.mrs;store.mail.cur.countMR=0,_n=!0,store.mail.rolls.mrs=[],t.forEach((function(e){Object(Bt.p)(e)})),Object(z.e)("/mail",{act:"mrs_reject",all:!0,hash:store.mail.hash.mrs},(function(n){if(n.error)return store.mail.cur.countMR=e,store.mail.rolls.mrs=t,_n=!1,void Et.cancelRejeectLoading();Ee.redrawView(),ti("/mail")}),(function(){store.mail.cur.countMR=e,store.mail.rolls.mrs=t,_n=!1,Et.cancelRejeectLoading()}))}function Ta(){var e=pt.isMarkedAsSpam();Object(z.e)("/mail",{act:"mrs_reject",peer_id:store.mail.cur.peerId,is_spam:Number(e),hash:store.mail.hash.mrs},(function(e){e.error||(pt.close(),Ee.redrawView(),ti("/mail"))}))}function Ia(){store.mail.cur&&Object(Bt.m)(Ut.a())}function Ma(e,t){var n=store.mail.members;(e=e.filter((function(e){return!n[e]}))).length&&(fn=fn.concat(e),mn.push(t),vn())}function Pa(){var e=store.mail,t=e.rolls,n=e.scraps,i=e.cur;t.folder.all=t.folder.all.filter(unique).sort(aa),"all"===i.folder&&(n.folder=n.folder.filter(unique).sort(aa),p.default.redrawFolder())}function xa(e,t){if(!e||!e.length)return null;for(var n=e.length-1;n>=0;n--)if(t(e[n],n))return e[n];return null}function La(){im.abortWaiting()}function Ra(e){var t=+e.getAttribute("data-msg"),n=e.closest(".im_msg_audiomsg");if(t&&!Object(ht.i)(t)&&store.mail.cur&&!(null==n?void 0:n.classList.contains("im_msg_audiomsg_listened"))){var i=store.mail.msgs[t],a=i&&store.mail.peers[i.peerId];a&&!i.listened&&i.authorId!==store.mail.cur.viewerId&&i.peerId===store.mail.cur.peerId&&Object(ht.m)("/mail",{act:"listen_audiomsg",msg_id:t,hash:a.hashRead})}}var Ba,Na,Da={};function Ha(e,t){var n=Ha,i=store.mail.cur.peerId,a=+t.getAttribute("data-msg"),o=store.mail.msgs[a],r=store.mail.hash.recognize,s=n.locked||(n.locked={});Da[a]=e;var c,l=t.closest(".im_msg_audiomsg");c=l?l.id.replace("audmsg",""):-1,statlogsValueEvent("audio_message_transcript",null,e,i,parseInt(o.conversationMsgId),c);var u=Object(W.a)(".audio-msg-track__transcriptionText",l),d="done"===o.transcript_state&&(null==u?void 0:u.classList.contains("audio-msg-track__transcriptionText--recognized"));e&&d&&Ra(t),e&&"uninitialized"===o.transcript_state&&!s[a]&&(s[a]=!0,Object(ht.m)("/mail",{act:"recognise_audiomessage",msg_id:a,hash:r}))}function Ua(e,t){vt.showCaptcha(e,t)}function Va(){Ba&&clearTimeout(Ba),Ba=setTimeout((function(){return addClass(Object(W.a)(".messenger__layer_convo"),Wa())}),200)}function Fa(){Ba&&clearTimeout(Ba),Ba=setTimeout((function(){return removeClass(Object(W.a)(".messenger__layer_convo"),Wa())}),200)}function Wa(){return Na||(Na="messenger__layer_convo--iosKeyboard",Nt.h&&Nt.g&&Nt.e>=11&&(Na="messenger__layer_convo--iosKeyboardChrome"),Na)}function qa(e,t){var n;("nav"===e&&t.url&&(ti(t.url)||nav.go(t.url)),"send_school_grade"===e&&(store.mail.cur.schoolData=t,I.redraw()),"reload_current_chat"===e)&&ci(store.mail.cur.peerId);"redraw_counter"===e&&function(e){var t=store.mail.cur,n=store.mail.peers[t.peerId];if(!n)return;e&&(store.mail.peers[t.peerId]=Object.assign(n,e));za(t.peerId,n.isMuted),Object(z.e)("/mail",{act:"get_peers",peer_ids:[t.peerId]},(function(e){storeMethods.injectMail(e),Ee.redrawView(),za(t.peerId,n.isMuted)}))}(t),"resync_folder"===e&&Zn((function(){I.redraw()})),"set_message_text"===e&&f.default.setText(t.text),"is_mobile_view"===e&&(n=t.isMobileView,store.mail.cur.isMobileView=n)}function za(e,t){$$(".convo_id_"+e).forEach((function(e){e.$(".Oval").classList.toggle("Oval_type_minor",t)}))}function Ya(e){if($t.a.isIntegrated){var t=Boolean(nav.getQuery("community"));$t.a.sendMessage("message_unread_counter",{isCommunity:t,count:e})}}function Ga(e,t,n){$t.a.isIntegrated&&(Ka(t),$t.a.sendMessage("nav_info",{isNewMail:!0,path:e,query:t,url:n}))}function Qa(){var e=store.mail.cur;if(e){var t=e.peerId,n=Object(ht.g)(t),i=store.mail.peers[t];i&&(i.groupCall?$t.a.sendMessage("call_join",{callData:i.groupCall.data,peerId:t}):$t.a.sendMessage("call",{isGroup:n,peerId:t,peer:i}))}}function Ka(e){e&&(delete e._sak_embed_force,delete e._sak_embed_at,delete e._sak_embed_origin,delete e._sak_embed_name,delete e.forced_color_scheme_mode)}function Xa(e,t){e===cn.d&&sn.a.logEvent({experiment_id:1285,service:"messages",metric_name:"open_vk_service_chat",metric_value:4,unit_id:t,unit_type_id:1})}function $a(e,t){$t.a.isIntegrated&&$t.a.sendMessage("reply_as",{id:e,msg:t})}t.default=Ee;window.uMessenger=Ee,window.Messenger=Te},"4bPz":function(e,t,n){"use strict";n.r(t);var i=n("+cqQ");window.uVK={onReady:Object(i.a)(),onResize:Object(i.a)(),onOrientationChange:Object(i.a)()},onDOMReady((function(){if(window.isNewMail&&document.body){window.uVK.onReady();var e=document.body.getAttribute("onresize"),t=document.body.getAttribute("onorientationchange");document.body.setAttribute("onresize","uVK.onResize(); "+e),document.body.setAttribute("onorientationchange","uVK.onOrientationChange(); "+t)}}))},"4pfz":function(e,t,n){"use strict";function i(e){var t={};return Array.from(e.elements).filter(o).forEach((function(e){if(e.name)switch(e.type){case"submit":break;case"radio":e instanceof HTMLInputElement&&e.checked&&(t[e.name]=e.value);break;case"checkbox":e instanceof HTMLInputElement&&e.checked&&(t[e.name]=a(e.name,e.value,t));break;default:t[e.name]=a(e.name,e.value,t)}})),t}function a(e,t,n){return n[e]?[e,t]:t}function o(e){return!(e instanceof HTMLButtonElement)}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}))},"4qiT":function(e,t){var n={init:function(e){var t=this;this.store?addEvent(window,"scroll touchstart",this._onScrollHandler):(this.store=extend({},e),this.loadCount=20,this.store.offset=this.store.offset?this.store.offset:this.loadCount,this.isLoading=!1,this.elems={wrap:geByClass1("author-page"),nav:geByClass1("author-page-nav",this.wrap),header:geByClass1("author-page-header",this.wrap),content:geByClass1("author-page__inner",this.wrap),spinner:geByClass1("author-page__spinner",this.wrap)},this._onScrollHandler=this._onScrollHandler.bind(this),addEvent(window,"scroll touchstart",this._onScrollHandler),e.isStandalone&&(window.al=!1),window.cur.destroy.push((function(){removeEvent(window,"scroll touchstart",t._onScrollHandler)})))},_getLoadOffset:function(){return this.store.offset},_showLoader:function(){this.isLoading=!0,addClass(this.elems.spinner,"active")},_hideLoader:function(){this.isLoading=!1,removeClass(this.elems.spinner,"active")},_onScrollHandler:function(){var e=this,t=this.elems,n=t.nav,i=t.header,a=t.content,o=this.store.totalCount>this._getLoadOffset();toggleClass(n,"author-page-nav_shown",i.getBoundingClientRect().bottom-n.clientHeight<0),o&&window.scrollTop()+2*window.innerHeight>a.offsetHeight&&this._loadMore(this.store.sortBy,this._getLoadOffset(),(function(t){e.elems.content.innerHTML+=t}))},_loadMore:function(e,t,n){var i=this;void 0===e&&(e=!1),void 0===t&&(t=!1),this.isLoading||(e&&(this.store.sortBy=e),isFunction(n)||(n=function(){}),this._showLoader(),ajax.post("author_page.php",{act:"load_more",author_id:this.store.authorId,sort_by:e||this.store.sortBy,count:this.loadCount,offset:void 0!==t?t:this._getLoadOffset()},{onFail:function(){i._hideLoader()},onDone:function(e){i._hideLoader(),i.store.offset+=20,e&&n(e)}}))},subscribe:function(e,t,n){ajax.post("author_page.php",{act:"subscribe",author_id:t,hash:n},{onDone:function(t,n){toggleClass(e,"Btn_theme_link",t),e.innerHTML=n}})},sortBy:function(e,t){e.preventDefault(),Unfold.setActive(e.target.parentNode),this._closeUnfold(e),t!==this.store.sortBy&&this.updateList(t)},updateList:function(e,t){var n=this;void 0===t&&(t=!1),e=e||this.store.sortBy,addClass(this.elems.content,"loading"),t&&Unfold.setActive(geByClass1("Unfold__item")),this._loadMore(e,0,(function(e){n.elems.content.innerHTML=e,n.store.offset=n.loadCount,removeClass(n.elems.content,"loading")}))},_closeUnfold:function(e){if(e){var t=e.target.closest(".Unfold");t&&removeClass(t,"Unfold_open")}},addToBookmark:function(e,t,n,i,a){e.preventDefault(),this._closeUnfold(e);var o=+domData(t,"is-bookmarked"),r=o?"bookmark_remove":"bookmark_add",s=geByClass1("Unfold__itemText",t);ajax.post("bookmarks.php",{_ajax:1,act:r,item_type:5,item_oid:n,item_id:i,hash:a},{onDone:function(e,n,i){domData(t,"is-bookmarked",o?0:1),o?s&&(s.innerHTML=lang.mobile_bookmarks_actions_add):s&&(s.innerHTML=lang.mobile_bookmarks_actions_remove),i&&Bookmarks.showSuccessSnack(i)}})},pinArticle:function(e,t,n,i,a){var o=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"pin_article",article_owner_id:t,article_id:n,do_pin:i?0:1,hash:a},{onDone:function(){o.updateList("date",!0)}})},hideArticle:function(e,t,n,i){var a=this;e.preventDefault(),this._closeUnfold(e),ajax.post("author_page.php",{act:"hide_article",article_owner_id:t,article_id:n,hash:i},{onDone:function(){a.updateList()}})}};window.AuthorPage=n},"4sM2":function(e,t,n){"use strict";function i(e,t,n){var i=new FormData,a=e.map((function(e){return 31*e}));return i.append("waveform",JSON.stringify(a)),i.append("file",t,"voice_message."+function(e){var t=e.match(/.*\/(\w*).*/);if(!t)return"";switch(t[1]){case"mpeg":return"mp3";case"ogg":case"webm":case"wav":return t[1]}return""}(n)),i}n.d(t,"a",(function(){return i}))},"4vml":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var i=["error"];function a(e,t){var n=e.querySelector(".FormItem__bottom");if(n){var i=n.innerHTML;i&&!n.getAttribute("data-initial")&&n.setAttribute("data-initial",i),n.innerHTML=t,n.classList.toggle("FormItem__bottom--hidden",!t)}}function o(e,t){i.forEach((function(n){n!==t&&e.classList.remove("FormItem--"+n)}));var n=e.querySelector("input")||e.querySelector("textarea");if(n)if(t){e.classList.add("FormItem--"+t);var a=e.getAttribute("data-name");a&&n.setAttribute("aria-describedby",a+"-bottom")}else n.removeAttribute("aria-describedby")}function r(e){return e.closest(".FormItem")}},"5s+S":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("v+Uj"),a=n("xt6h"),o=n("+sJP"),r=n("KMpi");function s(e){return{class:Object(a.a)("ModalMenuUserList__item",e.class),href:e.href,onclick:e.onclick?e.onclick:null,inner:[{class:"ModalMenuUserList__itemAvatar",inner:Object(r.a)({mode:Object(o.q)({id:e.id,name:e.name}),backgroundTheme:e.id,text:e.name,textLength:Object(o.r)(e.id),size:56,src:e.image})},{class:"ModalMenuUserList__itemName",inner:e.name}]}}t.b=function(e){return{class:"ModalMenuUserList",inner:Object(i.a)({inner:e.users})}}},"6I9u":function(e,t,n){"use strict";n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return u}));var i=n("W9Tc"),a=n("cGUQ"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function r(){return Object(i.b)("mvk_vkui_reports")}function s(e,t){return"/vkui/reports/?"+Object(a.a)(o(o({},e),{back_url:t||window.location.href.replace(window.location.origin,"")}))}function c(e){var t=e.type,n=e.rawId,i=e.refrom;if(r()){var a=n.split("_");return s({type:t,owner_id:a[0],item_id:a[1]},i)}return"/reports?act=add&object="+(""+t+n)+"&refrom="+i}function l(e){var t=e.storyOwnerId,n=e.questionId,i=e.refrom;return r()?s({type:"story_question",owner_id:t,item_id:n},i):"/reports?act=add&object="+("story_question"+t+"_"+n)+"&refrom="+i}function u(e){var t=e.ownerId,n=e.articleId,i=e.accessHash,a=e.refrom;return r()?s({type:"article",owner_id:t,item_id:n},a):"/reports?act=add&object=article"+t+"_"+n+"_"+i+"&refrom="+a}},"6Mr/":function(e,t,n){"use strict";var i=n("Ubt6"),a=n("/88W");n.d(t,"e",(function(){return a.g})),n.d(t,"b",(function(){return a.b})),n.d(t,"a",(function(){return a.a})),n.d(t,"d",(function(){return a.d})),t.c=i.a,window.Tooltip={close:a.c,setHelpHintShown:a.g,initShownHelpHints:a.f,initHelpHints:a.e,TooltipHelpHints:a.a}},"6VgB":function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"g",(function(){return u}));var i=n("PU8N"),a=157,o=1075,r=760,s=391,c=45;function l(e){return new Promise((function(t,n){window.ajax.post(Object(i.g)()?"stories.php":"al_stories.php",{act:"create_new_avatar_poll",hash:e},{onDone:t,onError:n,onFail:n})}))}function u(e,t,n){var i=Object.assign({},{pollStickerX:a,pollStickerY:o,pollStickerWidth:r,pollStickerHeight:s,pollStickerOffset:c},n||{}),l=i.pollStickerX,u=i.pollStickerY,d=i.pollStickerWidth,_=i.pollStickerHeight+i.pollStickerOffset;return{type:"poll",poll_id:t,poll_owner_id:e,clickable_area:[{x:l,y:u},{x:l+d,y:u},{x:l+d,y:u+_},{x:l,y:u+_}]}}},"75Qd":function(e,t,n){"use strict";n.r(t);n("XCiN");var i,a,o=n("OcsD"),r=n("0ZFE"),s=n("aJgW"),c=n("CQvH"),l=n("a0wW"),u=n("z9sQ"),d=n("+cqQ"),_=n("TYsd"),p=n("Cbap"),h=n("tgcV"),f=n("T3FL"),m=n("FbVm"),v=n("r0fY");!function(e){e.PAYMENT_FORM="payment_form",e.PAYMENT_FORM_CLICK_OFFER="payment_form_click_offer",e.PAYMENT_FORM_CLICK_PAY="payment_form_click_pay",e.PAYMENT_FORM_CLICK_CLOSE="payment_form_click_close",e.PAYMENT_FORM_CHANGE_CLICK_CHANGE="payment_form_change_click_change",e.CLICK_SHOW_MORE="click_show_more",e.WIDGET_VIEW="widget_view",e.DESCRIPTION_VIEW="description_view"}(i||(i={})),function(e){e.PAYMENT_START="payment_start",e.DATA_ACCESS="data_access",e.RESULT_PAYMENT_SUCCESS_OK="result_payment_success_ok",e.RESULT_PAYMENT_SUCCESS_WAITING="result_payment_success_waiting",e.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT="result_payment_success_waiting_timeout",e.RESULT_RESUB_SUCCESS_WAITING="result_resub_success_waiting",e.RESULT_RESUB_SUCCESS_WAITING_OK="result_resub_success_waiting_ok",e.RESULT_PAYMENT_UNAVAILABLE="result_payment_unavailable",e.RESULT_PAYMENT_CANCEL="result_payment_cancel",e.RESULT_ERROR="result_error",e.CHANGE_START="change_start",e.RESULT_CHANGE_ERROR="result_change_error",e.RESULT_CHANGE_SUCCESS_OK="result_change_success_ok",e.RESULT_CHANGE_SUCCESS_WAITING="result_change_success_waiting",e.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT="result_change_success_waiting_timeout",e.RESULT_CHANGE_UNAVAILABLE="result_change_unavailable",e.UNKNOWN="donut_payment_screen_unknown"}(a||(a={}));var g=function(){return(g=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},b=new(function(){function e(){this.productionStatCollector=new m.e,this.actionStatCollector=new m.a(this.productionStatCollector),this.navStatCollector=new m.d(this.productionStatCollector)}return e.prototype.logEventAction=function(t){return this.actionStatCollector.logEvent(e.createDonutActionStatEvent(t))},e.prototype.logEventActionView=function(e){return this.logEventAction(g(g({},e),{event_type:i.PAYMENT_FORM}))},e.prototype.logEventDescriptionClick=function(t){this.navStatCollector.logEvent(g(g({},e.createNavStatEventBase()),e.createDescriptionClickStatEvent(t)))},e.createDonutActionStatEvent=function(e){var t;return(t={type:v.a.TYPE_DONUT_PAYMENT_ITEM})[v.a.TYPE_DONUT_PAYMENT_ITEM]=e,t},e.createNavStatEventBase=function(){return{screen:"wall",subtype:v.j.GO}},e.createDescriptionClickStatEvent=function(t){var n;return(n={item:e.processClickParamsToEventItem(t),type:v.j.TYPE_DONUT_DESCRIPTION_NAV_ITEM})[v.j.TYPE_DONUT_DESCRIPTION_NAV_ITEM]={},n},e.processClickParamsToEventItem=function(e){return{type:v.c.BROWSER,owner_id:e.ownerId,track_code:e.trackCode}},e}()),A=n("HLtZ");function w(e,t){var n=function(e){try{return JSON.parse(e)}catch(n){var t={environment:"parseJsonError",breadcrumb:{message:"Uncaught json parse error",data:{json:e},category:"custom"}};return Object(A.b)(n,t),{}}}(e),i=n.type,a=n.type_property,o=n.params;a===v.a.TYPE_DONUT_PAYMENT_ITEM?b.logEventAction({event_type:o.event_type,source:o.source,owner_id:o.owner_id}):t&&i===v.k.TYPE_NAVGO&&function(e,t){var n=t.params;if(t.typeProperty===v.j.TYPE_DONUT_DESCRIPTION_NAV_ITEM){var i=n.owner_id,a=n.track_code;if(!n||"number"!=typeof i||"string"!=typeof a)return;b.logEventDescriptionClick({ownerId:i,trackCode:a})}}(0,{typeProperty:a,params:o})}var y=n("ZMWW"),O=n("qHA9");window.SAKIntegration=y.a,window.SAKIntegrationInit=function(e){e.isNewMail=Object(O.k)(location.pathname,location.search),y.a.init(e)};var k,j,S=n("T24x"),C=n("W9Tc");!function(e){e.TYPE_NETWORK_AUDIO_ITEM="type_network_audio_item",e.TYPE_MODULE_NAVIGATION_STATS_ITEM="type_module_navigation_stats_item"}(k||(k={})),function(e){e.FRAGMENT_LOADED="fragment_loaded",e.FRAGMENT_STALLED="fragment_stalled"}(j||(j={}));var E=n("XMCv"),T=n("EEfc"),I=n("TFVZ"),M=function(){return(M=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},P=function(){function e(t,n){this.moduleNavigationStatCollector=t,this.storage=n,this.storage.setItem(e.LS_LOCK_NAME,JSON.stringify(this.getActualNavDurationTimestamps()))}return e.prototype.getActualNavDurationTimestamps=function(){return Object.entries(this.getNavDurationTimestamps()).reduce((function(e,t){var n,i=t[0],a=t[1],o=a+I.a[i];return o&&o>Date.now()?M(M({},e),((n={})[i]=a,n)):e}),{})},e.prototype.getNavDurationTimestamps=function(){var t={};try{t=JSON.parse(this.storage.getItem(e.LS_LOCK_NAME)||"{}")}catch(e){}return t},e.clearPerformanceMeasures=function(e){var t=I.b[e],n=t.PERF_MARK,i=t.PERF_MEASURE;"performance"in window&&(window.performance.clearMeasures(i),window.performance.clearMarks(n))},e.measurementMustBeSkipped=function(e){return T.a.includes(e)||Object(C.c)(1-(T.b[e]||1))},e.prototype.logEvent=function(){var t,n,i,a,o,r,s,c="mvk"===(null===(a=null===(i=window.vk)||void 0===i?void 0:i.statsMeta)||void 0===a?void 0:a.platform)?"mvk":"web2",l=E.a.getConnectionEffectiveType(),u=f.b.getModule();try{var d=I.b[c],_=d.PERF_MARK,p=d.PERF_MEASURE;window.performance.measure(p,_),r=null===(o=window.performance.getEntriesByType("measure").find((function(e){return e.name===p})))||void 0===o?void 0:o.duration}catch(e){}if(e.clearPerformanceMeasures(c),r&&!e.measurementMustBeSkipped(u)){if(Object.keys(I.a).includes(u)){var h=Date.now(),m=this.getNavDurationTimestamps();if(void 0===(s=m[u])&&(s=0),s+I.a[u]>=h)return;this.storage.setItem(e.LS_LOCK_NAME,JSON.stringify(M(M({},m),((t={})[u]=h,t))))}this.moduleNavigationStatCollector.logEvent(((n={network_type:"UNKNOWN",network_effective_type:l,type:k.TYPE_MODULE_NAVIGATION_STATS_ITEM})[k.TYPE_MODULE_NAVIGATION_STATS_ITEM]={module:u,value:Math.round(r).toString()},n))}},e.LS_LOCK_NAME="NAV_DURATION_TIMESTAMPS_"+"mvk".toUpperCase(),e}(),x=n("Bj12"),L=function(){function e(){}return e.prototype.logEvent=function(e){e.type&&e[e.type]?Object(x.b)(e):Object(A.b)(new Error("NetworkStatCollector: invalid event."))},e}(),R=new L,B=function(){function e(e){this.networkStatCollector=e}return e.prototype.logEvent=function(e,t,n){var i,a=((i={network_type:t,network_effective_type:n,type:k.TYPE_NETWORK_AUDIO_ITEM})[k.TYPE_NETWORK_AUDIO_ITEM]=e,i);this.networkStatCollector.logEvent(a)},e}(),N=new P(R,n("tGJf").a);S.a.onChanged((function(){f.b.addStatEvent(f.b.getModule(),m.c.GO),Object(C.b)("measure_module_navigation_stats_mvk")&&N.logEvent()}));var D=n("DM2o"),H=n("BZzM"),U=(n("eGQV"),n("uQjJ"),n("jk6M")),V=(n("wcVR"),n("kr3z")),F=n("wx14"),W=n("Y6JH"),q=n("V4qE"),z=n("UxAg"),Y=n("5Hhy"),G={isUploading:!1,onBeforeRemove:Object(d.a)(),onRemove:Object(d.a)("removeElem"),onStart:Object(d.a)(),onError:Object(d.a)("response"),onComplete:Object(d.a)("response"),_uploadData:{},_uploadQueue:[],_readerQueue:[],_processUploadQueue:!1,_processReaderQueue:!1,_isFakeUploading:!1,fallback:function(e,t){var n=window.post;return e&&n.add_attach(e,t),!1},getLastAttachId:function(){if(!ge("attached_wrap"))return 0;var e,t=0;return each(geByTag("input"),(function(){if(e=this.name.match(/^attach(\d+)_type$/i)){var n=intval(e[1]);t<n&&(t=n)}})),t},refreshAttachIds:function(e){var t=ge("attached_wrap");if(t){var n,i=gpeByClass("mr_x_wrap",e),a=geByTag1("input",i),o=intval((a&&a.name.match(/^attach(\d+)(_type)?$/i)||[])[1]);if(gpeByClass("mr_timer",e)){var r=attr("add_post_btn","data-value");r&&val("add_post_btn",r)}else o&&each(geByTag("input",t),(function(){if(n=this.name.match(/^attach(\d+)(_type)?$/i)){var e=intval(n[1]);e==o?this.disabled=!0:e>o&&(this.name="attach"+(e-1)+(n[2]||""))}}))}},startFakeUploading:function(){G._isFakeUploading=!0,G.onStart()},finishFakeUploading:function(){G._isFakeUploading=!1,G.onComplete()},getAttachesCount:function(e){void 0===e&&(e=!0);var t=0;return window.ThumbsEdit&&window.ThumbsEdit.initialized&&e&&(t=ThumbsEdit.getThumbsCount()),t+=geByClass("mr_x_wrap","attached_wrap").length},refreshUploadState:function(e){isUndefined(e)&&(e=G.getAttachesCount(!0));var t=ge("attached_wrap"),n=geByClass1("mr_timer",t),i=geByClass1("pi_medias",t),a=ge("attach_photo_btn");if(toggle(i,e>0||isVisible(n)),toggleClass("attached_wrap_empty",t,e<=0),a){toggleClass("cp_attachBtnEl_sel",a,e>0);var o=geByClass1("inline_upload",a);if(o||(o=geByClass1("inline_upload",a.parentNode)),o){var r=attr(o,"data-max-attaches")||10;o.disabled=e>=r}}show("attached_options"),show("attached_flush")},checkUploading:function(e){return!G._processUploadQueue&&!G._isFakeUploading||cancelEvent(e)},attachedPhotoTpl:function(e){var t=[{id:"upload_item_"+e,class:"medias_thumb thumb_item mr_x_wrap thumb_upload",inner:[{id:"upload_image_"+e,class:"tu_img"},{id:"item_progress_wrap_"+e,class:"tu_progress_wrap",inner:[{id:"item_progress_"+e,class:"tu_progress"}]},{id:"item_cancel_wrap_"+e,class:"tu_cancel_wrap",onclick:"return mediaUpload.reset(this, event, '"+e+"');",inner:[{id:"item_cancel_"+e,class:"tu_progress"}]}]}];return ceFromString(_.a.html(t))},attachedTpl:function(e){void 0===e&&(e={});var t=e,n=t.id,i=t.type,a=["medias_row","mr_x_wrap","thumb_upload"];i&&a.push("attachment_type_"+i);var o=Object(Y.a)(),r={inner:[{inner:[{inner:[{inner:[Object(W.a)({icon:o})],class:"medias_link_icon",tag:"span"}],class:"medias_link_icon",tag:"span"},{inner:[{inner:[e.label],class:"medias_link_labeled medias_link_title",tag:"span"}],class:"medias_link_texts",tag:"span"}],class:"mr_label medias_link",tag:"span"},{inner:[{class:"tu_progress",id:"item_progress_"+n,tag:"div"}],class:"tu_progress_wrap",id:"item_progress_wrap_"+n,tag:"div"},{inner:[{class:"tu_progress",id:"item_cancel_"+n,tag:"div"}],class:"tu_cancel_wrap",id:"item_cancel_wrap_"+n,onclick:"return mediaUpload.reset(this, event, '"+n+"');",tag:"div"}],id:"upload_item_"+n,class:a,tag:"div"};return ceFromString(_.a.html([r]))},onUploadProgress:function(e){var t=ge("item_progress_"+this.id);window.ThumbsEdit&&ThumbsEdit.initialized?ThumbsEdit.onUploadProgress(this.id,e.loaded/e.total*100):setStyle(t,{width:e.loaded/e.total*100+"%",visibility:"visible"})},onUploadComplete:function(e){var t=this,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)G.onUploadError.call(t,e);else{var a=ThumbsEdit.initialized;t.xhr=ajax.post(t.done_url,{_ajax:1,_query:n,te:intval(a)},{onDone:function(e){var n,i=ge("item_progress_wrap_"+t.id),o=G.getLastAttachId()+1,r=ge("upload_item_"+t.id);if(r&&r.classList.add("thumb_uploaded"),a?(ThumbsEdit.replaceTemp(t.id,e.photo_raw,e.list||"",e.sizes),n=Object(z.a)('[data-media="phototemp_'+t.id+'"]')):n=ge("upload_image_"+t.id),n)if(e.src)var s=ce("img",{id:"upload_image_"+t.id,className:"ph_img",onload:function(){if(a&&(n.src=e.src,n.classList.remove("Thumb__wrap--temp"),n.setAttribute("data-media","photo"+e.photo_raw),n.setAttribute("data-upload",t.id)),replace(s,n),t.iw&&t.ih){if(t.iw>t.ih==s.width>s.height)var i=Math.min(130,Math.floor(75/t.ih*t.iw));else i=Math.min(130,Math.floor(75/t.iw*t.ih));setStyle(s,"width",i)}reflow(s),setStyle(s,"opacity",1)},src:e.src});else{var c=ge("upload_image_"+t.id);setStyle(c,"opacity",1)}var l=t.attach_type||"photo",u=(e.hash,e.photo_raw);t.attach_type&&"photo"!==t.attach_type&&(u=e.owner_id+"_"+e.id),r&&(r.appendChild(ce("input",{type:"hidden",name:"attach"+o,value:u})),r.appendChild(ce("input",{type:"hidden",name:"attach"+o+"_type",value:l}))),setStyle(i,"opacity",0),t.attached=!0,t.delete_url=e.delete_url,G._processUploadQueue||(G.isUploading=!1,G.onComplete(e))}}),addClass("tu_progress_request","item_progress_wrap_"+t.id),t.uploaded=!0,G.uploadQueueNext()}},onUploadError:function(e){clog("upload error.",e.target.responseText),Snackbar.init({text:"blog"===cur.module?lang.mobile_jobs_upload_error:lang.mobile_unknown_error,type:q.d}),this.id&&G.reset(null,null,this.id),G.uploadQueueNext(),G.onError(e.target.responseText)},uploadFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t,n=e.file_attr_name||"photo",i=JSON.parse(e.upload_params);e.xhr=uploadFile(e.upload_url,Object(F.a)(((t={})[n]=e.file,t),i),{onProgress:bind(G.onUploadProgress,e),onComplete:bind(G.onUploadComplete,e),onError:bind(G.onUploadError,e)})})),readFile:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){readFile(e.file,(function(t){var n=ge("upload_image_"+e.id);if(n)var i=ce("img",{id:"upload_image_"+e.id,className:"ph_img",onload:function(){replace(i,n),e.iw=i.width,e.ih=i.height},src:t});G.readerQueueNext()}))})),addFile:function(e){var t,n=ge("attached_wrap"),i=geByClass1("pi_medias",n),a=i?geByClass("medias_thumb",i):[],o=i?geByClass1("medias_row",i):null,r=a[a.length-1],s=e.attach_type||"photo";if(t="photo"===s?G.attachedPhotoTpl(e.id):G.attachedTpl({id:e.id,type:s,label:e.file?e.file.name:""}),n){if(window.ThumbsEdit&&ThumbsEdit.initialized)readFile(e.file,(function(t){var n=ce("img");n.src=t,n.onload=function(){var i=n.width,a=n.height;window.fakeImg=n;var o=getImageOrientation(t);t="/images/blank.gif";var r=!1;o>4&&o<9&&(r=!0);var s=["photo",e.id,{sizes:{temp:[t,r?a:i,r?i:a]}},{remove:e.id}];ThumbsEdit.addTempPreview(s),CreatePost.checkAttaches()}}));else{if(!i){var c=geByClass1("AddedAttach",n);i=ce("div",{className:"pi_medias"}),append(i,c||n)}r?after(t,r):o?before(t,o):append(t,i)}G._processReaderQueue||G.readerQueueNext()}},uploadQueueNext:function(){clog("next upload"),G._processUploadQueue=!0;var e=G.uploadQueueRemove();if(!e)return clog("empty upload"),G._processUploadQueue=!1,void(G.isUploading=!1);G.uploadFile(e)},readerQueueNext:function(){clog("next reader"),G._processReaderQueue=!0;var e=G.readerQueueRemove();if(!e)return clog("empty reader"),void(G._processReaderQueue=!1);G.readFile(e)},queueInsert:function(e){var t=srand();return G.getUploadDataById(t)?G.queueInsert(e):(G._uploadData[t]=extend(e,{id:t}),G._uploadQueue.push(t),G._readerQueue.push(t),G._uploadData[t])},uploadQueueRemove:function(){var e=G._uploadQueue.shift();return!!e&&G.getUploadDataById(e)},readerQueueRemove:function(){var e=G._readerQueue.shift();return!!e&&G.getUploadDataById(e)},getUploadDataById:function(e){return G._uploadData[e]||!1},delUploadDataById:function(e){delete G._uploadData[e]},start:function(e,t){if(!e||!canUploadFile())return G.fallback(e,t);var n=e.files,i=e.form||gpeByTag("form",e),a=submitBtn(i),o=ge("attach_photo_btn"),r=attr(e,"data-upload-url"),s=attr(e,"data-upload-params"),c=domData(e,"file-attr-name"),l=domData(e,"attach-type"),u=attr(e,"data-done-url"),d=attr(e,"data-max-attaches")||10,_=G.getAttachesCount();return r&&u?(each(n,(function(){var e={attach_type:l,file_attr_name:c,upload_url:r,upload_params:s,done_url:u,file:this,uploaded:!1,attached:!1};if(_>=d)return!1;G.queueInsert(e),G.addFile(e),_++})),removeEvent(i,"submit",G.checkUploading),addEvent(i,"submit",G.checkUploading),removeEvent(a,"click",G.checkUploading),addEvent(a,"click",G.checkUploading),removeEvent(o,"click",G.checkUploading),addEvent(o,"click",G.checkUploading),G.refreshUploadState(_),replace(clone(e),e),G._processUploadQueue||G.uploadQueueNext(),window.isNewMail&&G.onStart(),G.isUploading=!0,!1):G.fallback(e,t)},reset:function(e,t,n,i){if(cancelEvent(t),window.isNewMail&&G.onBeforeRemove(e),"/"==n[0]){ajax.post(n,{_ajax:1}),G.refreshAttachIds(e);var a=gpeByClass("mr_x_wrap",e)||gpeByClass("mr_timer",e);i?i():remove(a)}else{var o=n,r=G.getUploadDataById(o);if(!r)return!1;r.attached?r.delete_url&&(ajax.post(r.delete_url,{_ajax:1}),G.refreshAttachIds(e)):(r.xhr&&r.xhr.abort&&r.xhr.abort(),r.loaded||G.uploadQueueNext()),i?i():remove("upload_item_"+o),G.delUploadDataById(o)}return G.refreshUploadState(),window.isNewMail&&G.onRemove(e),Replies.abortTimer("editing"),!1},onUnfoldItemClick:function(e,t){var n=Object(z.a)('[type="file"]',t);e.target!==n&&n.click()}};window.mediaUpload=G;var Q=n("cGUQ"),K=n("IjIm"),X=n("vOql"),J=n("TdLS"),Z={thumbnailCreator:null,newAvatarStoryOptions:{},onUploadedDone:Object(d.a)("resp"),fallback:function(e,t){var n=window.nav,i=e.nextSibling;return!!i&&!n.go(i)},onUploadProgress:function(e){window.photoview.updateUpload({progress:e.loaded/e.total})},onUploadComplete:function(e){var t=window.photoview,n=e.target.responseText,i=!1;try{i=parseJSON(n)}catch(e){i={error:"ERR_CLIENT_BAD_RESPONSE: bad request response"}}if(i.error)Z.onUploadError.call(this,e);else{this.xhr=null,this.photo_res=n,this.photo_size=i.size;var a=this.static_url+i.x_src,o=i.size[0],r=i.size[1],s=Math.min(o,r);if(t.onClose=bind(Z.onClose,this),t.openCrop({src:a,max_scale:s/200,onSelect:bind(Z.onCropSelected,this)}),Z.newAvatarStoryOptions.shouldCreateNewAvatarStory){var c;if(i.photo.sizes2&&i.photo.sizes2.length>0){var l=i.photo.sizes2.findIndex((function(e){return e[3]===i.size[0]&&e[4]===i.size[1]}));i.photo.urls2&&i.photo.urls2[l]&&(c=this.static_url+i.photo.urls2[l])}c=c||a,Z.initNewAvatarStory(vk.id,c)}}},onUploadError:function(e){var t=window.photoview;clog("upload error.",e.target.responseText),t.close()},onClose:function(e){this.xhr&&this.xhr.abort&&this.xhr.abort()},onCropSelected:function(e,t,n){var i=window.photoview,a=this,o=a.photo_res,r=a.photo_size,s=r[0],c=r[1],l=Math.min(s,c),u=Math.round(e*s),d=Math.round(t*c),_=Math.round(n*l);if(a.upload_edit_url)var p=a.upload_edit_url;else p=a.base_url+"upload.php?"+Object(Q.a)({act:"owner_photo_edit",_query:o,_origin:location.protocol+"//"+location.host},!0);a.xhr=ajax.plainpost(p,{_crop:[u,d,_].join(",")},(function(e){Z.onCropSuccess.call(a,e)}),(function(e){Z.onCropCancel.call(a)}),!0),i.updateCrop({saving:!0})},onCropSuccess:function(e){var t=window.photoview,n=this;new Promise((function(e){Z.newAvatarStoryOptions.shouldCreateNewAvatarStory?Z.saveNewAvatarStory().then((function(){return e(!0)})).catch((function(){return e(!1)})):e()})).then((function(i){n.xhr=ajax.post("/photos.php?act=done_photo",{_ajax:1,_query:e,_from:n.from,is_snackbar_disabled:Boolean(i)},{onDone:function(e){Z.onUploadedDone(e),t.close()},onFail:function(){Z.onCropCancel.call(n)}})}))},onCropCancel:function(){window.photoview.updateCrop({saving:!1})},prepareInput:function(e){e.files&&e.files.length&&(e.value="")},start:function(e,t){var n=window.photoview;if(!e||!canUploadFile())return Z.fallback(e,t);var i=e.files[0]||!1,a=attr(e,"data-upload-url"),o=attr(e,"data-base-url"),r=attr(e,"data-static-url"),s=attr(e,"data-from"),c=JSON.parse(attr(e,"data-new-avatar-story-data"))||{};if(!i)return!1;if(!a)return Z.fallback(e,t);var l={upload_url:a,base_url:o,static_url:r,file:i,from:s};return Z.newAvatarStoryOptions=Object(F.a)({},c),l.xhr=uploadFile(a,{photo:i},{onProgress:bind(Z.onUploadProgress,l),onComplete:bind(Z.onUploadComplete,l),onError:bind(Z.onUploadError,l)}),readFile(i,(function(e){n.updateUpload({thumb:e})})),replace(clone(e),e),n.onClose=bind(Z.onClose,l),n.openUpload({src:null}),!1},initNewAvatarStory:function(e,t){Z.getNewAvatarStoryUploadResult=J.a.initNewAvatarStory(Z.newAvatarStoryOptions,e,t)},saveNewAvatarStory:function(){return Z.getNewAvatarStoryUploadResult.then((function(e){var t=e.response;t.upload_result&&J.a.saveNewAvatarStory(Z.newAvatarStoryOptions,t.upload_result)}))},getCropFromTag:function(e,t,n){if(!e)return!1;if(3==e.length)var i=+e[0],a=+e[1],o=+e[2];else{i=+e[0]*t/1e4,a=+e[1]*n/1e4,o=+e[2]*t/1e4;var r=+e[3]*n/1e4;if(o>r&&(i+=(o-r)/2,o=r),o<200){var s=(200-o)/2;i-=s,a-=s,o=200}o=Math.min(Math.max(o,200),Math.min(t,n)),i=Math.min(Math.max(i,0),t-o),a=Math.min(Math.max(a,0),n-o)}return[i/t,a/n,o/Math.min(t,n)]},crop:function(e){if(!e||!e.size&&!e.url)return!1;var t=window.photoview,n={upload_edit_url:e.upload_url};if(e.size){n.photo_size=e.size;var i=Math.min(e.size[0],e.size[1]);t.onClose=bind(Z.onClose,n),t.openCrop({src:e.thumb,max_scale:i/200,rect:Z.getCropFromTag(e.rect,e.size[0],e.size[1]),onSelect:bind(Z.onCropSelected,n)})}else{var a=ce("img",{src:e.url,onload:function(){n.photo_size=[a.width,a.height];var i=Math.min(a.width,a.height);t.updateCrop({src:e.thumb,max_scale:i/200,rect:Z.getCropFromTag(e.rect,a.width,a.height),onSelect:bind(Z.onCropSelected,n)})}});t.onClose=bind(Z.onClose,n),t.openCrop({src:!0})}return!0},generateNewAvatarStory:K.a,drawPollSticker:X.a};window.ownerPhotoUpload=Z;n("+YbT");var ee=n("dmnf"),te=n("2W9W");var ne=n("wTbK"),ie=n("t7Ww"),ae=n("+sJP"),oe=n("w1cP");var le,ue=function(){return[Object(ie.d)({onClose:["DarkSchemeModal.closeAndSendStat","click_close_button","this"]}),Object(ie.e)({inner:[{inner:[Object(W.a)({icon:Object(oe.a)()})],class:"DarkSchemeModal__icon",tag:"div"}]}),Object(ie.f)({inner:[_.a.wrap(Object(ae.t)("mobile_dark_scheme_modal_title"))]}),Object(ie.a)({inner:[{inner:[_.a.wrap(Object(ae.t)("mobile_dark_scheme_modal_description"))],class:"DarkSchemeModal__description",tag:"div"},{inner:[_.a.wrap(Object(ae.t)("mobile_dark_scheme_modal_description_additional"))],class:"DarkSchemeModal__descriptionAdditional",tag:"div"}]}),Object(ie.b)({inner:[Object(ae.t)("mobile_dark_scheme_modal_button")],url:"/settings?act=appearance",theme:"regular",size:"large",isBtn:!0,onclick:["DarkSchemeModal.goToAppearance","this","event"]})]};function de(e){ne.f.close(e)}function _e(e){if(!le){var t={event:e,_ajax:1};V.a.post("/promo?act=dark_scheme_guide_close",t),le=!0}}var pe={open:function(){var e=_.a.elem(Object(ne.f)({class:"DarkSchemeModal",on_overlay_click:["DarkSchemeModal.closeAndSendStat","click_overlay"],body:ue()}));s.d.applyScheme(e,s.c.Dark),le=!1,ne.f.open(e,!0,"",{onClose:function(){_e("close")}}),Object(D.a)("mvk_dark_scheme_guide","shown")},close:de,closeAndSendStat:function(e,t){_e(e),de(t)},goToAppearance:function(e,t){return _e("click_button"),de(e),nav.go(e,t)}};window.DarkSchemeModal=pe;var he,fe=n("wMVj"),me=n("BoyB"),ve=n("YU/R"),be=n("Fkq0"),Ae=n("h8oe"),we=n("RJa5"),ye=n("IetZ"),Oe=n("XNGt"),ke=function(){return(ke=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},je=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},Se=function(){function e(e,t){var n=this;this.blockId=t;this.observed_items=[],this.observer=new IntersectionObserver((function(e){return n.onView(e)}),{root:null,rootMargin:"0px",threshold:.5}),this.productCollector=new m.e,this.viewCollector=new m.f(this.productCollector),this.clickCollector=new m.b(this.productCollector),this.elements=e,this.addHandlers()}return e.prototype.destroy=function(){var e=this;this.observer.disconnect(),this.observed_items.forEach((function(t,n){return e.sendViewStat(n)})),this.elements.forEach((function(t){return t.removeEventListener("mousedown",e.clickHandler)}))},e.prototype.addHandlers=function(){var e=this;this.clickHandler=this.onClick.bind(this),this.elements.forEach((function(t){return t.addEventListener("mousedown",e.clickHandler)})),this.elements.forEach((function(t){return e.observer.observe(t)}))},e.prototype.onClick=function(e){if(e.currentTarget&&e.currentTarget instanceof HTMLElement&&e.currentTarget.parentElement&&e.currentTarget.dataset.id){var t=parseInt(e.currentTarget.dataset.id),n={type:v.b.TYPE_CATALOG_BANNER_ITEM,position:je([],e.currentTarget.parentElement.children).indexOf(e.currentTarget)+1},i={type:v.c.CATALOG_BANNER,id:t,track_code:this.blockId};this.clickCollector.logEvent(n,i)}},e.prototype.sendViewStat=function(e){if(void 0!==this.observed_items[e]){var t=ke(ke({},this.observed_items[e]),{end_view:this.productCollector.getCurrentTime()}),n={type:v.c.CATALOG_BANNER,id:e,track_code:this.blockId};this.viewCollector.logEvent(t,n),delete this.observed_items[e]}},e.prototype.onView=function(e){var t=this;e.forEach((function(e){var n=e.target;if(n instanceof HTMLElement&&n.parentElement&&n.dataset.id){var i=parseInt(n.dataset.id);e.isIntersecting?void 0===t.observed_items[i]&&(t.observed_items[i]={type:v.n.TYPE_CATALOG_BANNER_ITEM,start_view:t.productCollector.getCurrentTime(),end_view:"0",position:je([],n.parentElement.children).indexOf(n)+1}):t.sendViewStat(i)}}))},e}();!function(e){e.Click="click",e.Close="close"}(he||(he={}));var Ce,Ee=function(){function e(e,t){this.blockContent=e,this.blockId=t;var n=this.getBanners();this.bannerStatCollector=new Se(n,t)}return e.prototype.getBanners=function(){return Array.from(this.blockContent.querySelectorAll(".BannerItem"))},e.prototype.setBannersEvents=function(){var e=this;this.getBanners().forEach((function(t){if(t.dataset.id){var n=parseInt(t.dataset.id);e.addConsumableClick(t,n),e.addConsumableCloseClick(t,n)}}))},e.prototype.checkItems=function(){this.getBanners().length||this.blockContent&&this.blockContent.remove()},e.prototype.destroy=function(){this.bannerStatCollector.destroy()},e}(),Te=(Ce=function(e,t){return(Ce=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ce(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Ie=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},Me=function(e){var t=e.split(" "),n=(t=t.slice(0,t.length-1)).join(" ");return n&&(n+="..."),n},Pe=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.initLoop(),i.truncateTexts(),i.setBannersEvents(),i}return Te(t,e),t.initBannerBlocks=function(){var e=document.querySelectorAll(".AudioBlock_catalog_banners");return Ie([],e).map((function(e){return new t(e,e.dataset.blockId||"")}))},t.prototype.truncateTexts=function(){this.getBanners().forEach((function(e){var t=e.querySelector(".Banner__subheader");if(t instanceof HTMLElement&&t.scrollHeight/t.clientHeight>1.1)for(var n=t.clientHeight,i=t.innerHTML;i&&t.scrollHeight/n>1.1;)i=Me(i),t.innerHTML=i;var a=e.querySelector(".Banner__header");if(a instanceof HTMLElement&&a.scrollHeight>a.clientHeight)for(var o=a.innerHTML;o&&a.scrollHeight>a.clientHeight;)o=Me(o),a.innerHTML=o}))},t.prototype.addConsumableClick=function(e,t){var n=this;if(e.classList.contains("BannerItem--consumable")&&e.dataset.id){var i=e.querySelector(".Banner__link");if(i instanceof HTMLElement){var a=i.onclick;i.onclick=null,i.addEventListener("click",(function(i){n.consumeBanner(t,he.Click),n.removeBanner(t),a&&a.call(e,i)}))}}},t.prototype.addConsumableCloseClick=function(e,t){var n=this,i=e.querySelector(".Banner__dismiss");i instanceof HTMLElement&&(i.onclick=function(e){n.consumeBanner(t,he.Close),n.removeBanner(t),n.checkItems(),e.stopPropagation(),e.preventDefault()})},t.prototype.removeBanner=function(e){this.blockContent.querySelectorAll('.BannerItem[data-id="'+e+'"]').forEach((function(e){return e.remove()})),this.loopSlider&&this.loopSlider.init()},t.prototype.initLoop=function(){if((this.blockContent.classList.contains("AudioBlock_slider")||this.blockContent.classList.contains("AudioBlock_large_slider"))&&this.blockContent.querySelector(".Slider--loop")){var e=this.blockContent.querySelector(".Slider__scroll");e instanceof HTMLElement&&(e.onwheel=null,this.loopSlider=new Oe.a(e,this.blockContent.querySelector(".Slider__line")))}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.loopSlider&&this.loopSlider.destroy()},t.prototype.consumeBanner=function(e,t){V.a.post("/audio",{act:"consume_banner",id:e,ref:this.blockId,reason:t})},t}(Ee),xe="",Le=function(){function e(){}return e.initBanners=function(){Pe.initLoop()},e.getContainerElement=function(){return document.querySelector("."+e.CONTAINER)},e.getSection=function(t){return document.querySelector("."+e.BASE_SELECTOR+"__"+t)},e.getAllSections=function(){return Array.from(document.querySelectorAll("."+e.BASE_SELECTOR))},e.setSectionContent=function(e,t){var n=document.querySelector("."+e);n&&(n.innerHTML=t)},e.onSearchLoaded=function(t,n,i,a,o){xe===a&&e.toggleSearch(a,o)},e.onSearchFiltered=function(t,n){xe=t,e.toggleSearch(t,n)},e.toggleSearch=function(t,n){e.getAllSections().forEach((function(e){var i=n===e?!!t:!t,a=e.querySelector(".show_more");a instanceof HTMLElement&&(i?delete a.dataset.disabled:a.dataset.disabled="1"),Object(o.uc)(e,i)}))},e.handlePagination=function(t,n){var i=e.getSection(n.name),a=window.cdf(t);if(i&&a){var o=void 0,r=i.querySelectorAll(".AudioBlock"),s=r[r.length-1];(o=s instanceof HTMLElement&&s.dataset.view_type&&["list","music_chart_list"].includes(s.dataset.view_type)?s.querySelector(".AudioBlock__content"):i)&&o.append(a)}},e.BASE_SELECTOR="AudioSection",e.CONTAINER="AudioSerp",e}(),Re=n("lPa4"),Be=n("1UEa");function Ne(e){var t=!1,n={onStart:function(){Object(o.a)("wia_item--loading",this.link)},onDone:function(){var i=e.onDone&&e.onDone.apply(this,arguments);if(i){var a=i.wdHTML,r=i.data,s=i.onDoneEnd;if(a){var c=Wd.elem(a);Object(o.ac)(c,this.link.parentNode),r&&!t&&Snackbar.init({text:r.title,action:{url:r.href,text:r.undo_title,callback:function(e,i){var a=i.id;e.preventDefault(),t=!0,ajax.click(c.querySelector("a"),n),Snackbar.close(a)}}}),t=!1}s&&s()}}};return n}var De={onDone:function(e,t,n,i,a){var r=window,s=r.photo;if(Re.a.onDone.apply(this,arguments),this.photo_id){var c=s.get(this.photo_id);if(c){Object(o.k)("div",{innerHTML:t});var l,u=Object(o.k)("div",{innerHTML:i});c.likes=Object(o.zc)(d),c.likes_cnt=Object(o.mb)(((null==u.querySelector||null==(l=u.querySelector("[data-like_count]"))?void 0:l.getAttribute("data-like_count"))||"").replace(/\D+/g,"")),c.likes_me=a,c.liked_people=t,c.like_buttons=i;var d=Object(o.k)("div",{innerHTML:c.actions}),_=Object(o.O)("like_wrap",d);Object(o.zc)(_,i),s.save(c)}}},onFail:Re.a.onFail},He={onDone:function(e){var t=window.photo;if(this.photo_id){if(!e.error){var n={};"confirm"===e.type?n={type:q.e,text:getLang("mobile_msg_photos_tag_confirmed")}:"delete"===e.type&&(n={type:q.e,text:getLang("mobile_msg_photos_tag_deleted")}),Snackbar.init(n)}var i=t.get(this.photo_id);i&&(i.tag_info="",t.save(i));var a=Object(o.O)("photo_view"),r=Object(o.O)("pv_tag_wrap",a);Object(o.zc)(r,"")}}},Ue=Ne({onStart:function(e){console.log(this,e)},onDone:function(e,t,n,i){var a=photo.get(t);a&&(a.isDeleted=n,photo.save(a)),Popup.close(Object(z.a)(".Popup_open"));var r=Object(z.a)(".PhotoviewPage");r&&r.classList.toggle("PhotoviewPage--deleted",n);return{wdHTML:e,data:i,onDoneEnd:function(){var e=Object(z.a)("#photo_actions"),t=$$(".ContextMenu__list li",e);Array.from(t).forEach((function(e){n&&"delete"!==domData(e,"name")&&Object(o.hb)(e),n||Object(o.lc)(e)})),a&&(a.actions=e.innerHTML,photo.save(a))}}}}),Ve={onDone:function(e,t){var n=window.isNewMail&&Object(z.a)(".messenger")&&this.link.closest(".msg");if(Object(o.zc)(e,t),n){var i=Number(n.className.match(/msg_id_(\d+)/)[1]);store.mail.msgs[i].textFull=n.$(".msg__text").innerHTML}}},Fe={onDone:function(e){this.link&&(Object(o.c)(cdf(e),Object(o.eb)("pic_body_wrap",this.link)),Object(o.hb)(this.link))}},We=Ne({onStart:function(){Object(o.a)("cm_item_loading",this.link)},onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};this.link&&Object(o.zc)(this.link.parentNode,e)}}),qe={onDone:function(e,t,n){if(void 0===n&&(n={}),e){var i=window.photo;Object(o.Xb)(e+"_msg");var a=Object(o.M)(e);if(a){if(n.remove)re(a),re(e+"_msg");else if(t){var r=Object(o.k)("div",{id:e+"_msg",className:(a.className||"")+" post_message_item"}),s=n.no_wrap?t:'<div class="pi_cont">'+t+"</div>";Object(o.zc)(r,s),Object(o.c)(r,a),Object(o.hb)(a),Object(o.O)("rtm_reply_wrap",a)&&window.reply&&window.reply.edithide()}else Object(o.lc)(e);if(this.photo_id){var c=i.get(this.photo_id);if(c){var l=Object(o.O)("photoview"),u=Object(o.O)("comments_wrap",l);c.comments_html=Object(o.zc)(u)}}}}}},ze={onDone:function(e,t,n,i){if(e){Object(o.Xb)(e+"_msg");var a=Object(o.M)(e);if(a)if(t){var r=(/^([a-z]+)_item$/i.exec(n||"")||[])[1]||"inline",s=Object(o.k)("div",{id:e+"_msg",className:r+"_item "+r+"_message_item"}),c=i||"message_item_cont";Object(o.zc)(s,'<div class="'+c+'">'+t+"</div>"),Object(o.c)(s,a),Object(o.hb)(a)}else!1===t?(a.classList.add("_deleted"),Object(o.hb)(a)):Object(o.lc)(a)}}},Ye={onDone:function(e,t,n){if(e){var i=Object(o.M)(e),a=Object(o.db)(i)||Object(o.db)(e+"_msg"),r=Object(o.U)(i)||Object(o.U)(e+"_msg"),s=a+(u<320?r:0)-Object(o.gc)();if(Object(o.Xb)(e+"_msg"),i){var c=Object(o.gb)("wall_item",i)||Object(o.gb)("post",i)?"wall":"post";if(n){var l=Object(o.k)("div",{id:e+"_msg",className:c+"_item post_message_item"});Object(o.zc)(l,'<div class="pi_cont">'+n+"</div>"),Object(o.c)(l,i)}if(t){Object(o.D)(Object(o.N)(c+"_item"),(function(){var e=!!this.id&&this.id.match(/^wall((-?\d+)_(-?\d+)(_\d+)?)$/),i=Object(o.g)(this,"data-copy"),a=!!i&&i.match(/^(-?\d+)_(-?\d+)$/);if(!e)return!0;(!e[4]&&e[2]==t||e[4]&&e[3]==t||a&&a[1]==t)&&Object(o.vc)("post_item_ignored",this,n)}));var u=Object(o.T)(),d=(a=Object(o.db)(i)||Object(o.db)(e+"_msg"),r=Object(o.U)(i)||Object(o.U)(e+"_msg"),a+(u<320?r:0)-s);Object(o.O)("wall_item")===i&&(d=0),Object(o.gc)(d);var _=Object(z.a)(".ContextMenu",i);_&&ve.c.close(_)}}}}},Ge={onDone:function(e,t){if(e){var n=Object(o.M)(e);if(Object(o.Xb)(e+"_msg"),n&&t){var i=Object(o.gb)("wall_item",n)||Object(o.gb)("post",n)?"wall":"post",a=Object(o.k)("div",{id:e+"_msg",className:i+"_item post_message_item"});Object(o.zc)(a,'<div class="pi_cont">'+t+"</div>"),Object(o.c)(a,n)}Object(o.vc)("post_item_ignored",n,t)}}},Qe={onDone:function(e,t,n){if(e){var i=Object(o.M)(e);if(Object(o.Xb)(e+"_msg"),i){if(n){var a=Object(o.k)("div",{id:e+"_msg",className:"wall_item post_message_item"});Object(o.zc)(a,'<div class="pi_cont">'+n+"</div>"),Object(o.c)(a,i)}Object(o.vc)("post_item_ignored",i)}}}},Ke={onStart:function(){var e=Object(o.eb)("show_more_wrap",this.link),t=Object(o.O)("show_more",e)||this.link,n=Object(o.k)("div",{id:"show_more_loading",className:"show_more_loading show_more_loading--spinner",innerHTML:Object(me.a)({spinner:!0})}),i=Object(o.k)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent"});Object(o.g)(n,"data-href",Object(o.V)(t)),i.appendChild(n),Object(o.i)(i,e),Object(o.Xb)(e)},onDone:function(e){var t=window.cur;ajax.tAlProcess=(new Date).getTime();var n=Object(o.M)("show_more_wrap"),i=cdf(e);Object(o.i)(i,n),Object(o.Xb)(n),ajax.prepare_click("mcont"),Object(o.Lb)(100),ajax.tAlModule=t.module,ajax.tAlRender=(new Date).getTime(),ajax.onPostsLoad(),Gif.onUpdate(),window.UnauthorizedFeed&&UnauthorizedFeed.onUpdate(),Object(H.a)()}},Xe={onStart:Ke.onStart,onDone:function(e){Ke.onDone.apply(null,arguments),Object(ye.a)(".SearchItemServicesInfo__textMatch")}},$e={onStart:Ke.onStart,onDone:function(e,t){Ke.onDone.apply(null,arguments),Bookmarks.pushItemsToStore(t)}},Je={onStart:Ke.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var i=Object(o.O)("photos_page","mcont"),a=Object(o.M)("show_more_wrap"),r=cdf(t);e=e.replace(/<img src="([^"]+)" class="/gi,'<img data-src="$1" class="_image ');var s=cdf(e);i&&i.appendChild(s),Object(o.i)(r,a),Object(o.Xb)(a),ajax.prepare_click("mcont"),Object(o.Lb)(100),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime(),Object(H.a)()}},Ze={onStart:Ke.onStart,onDone:function(e,t){var n=window.cur;ajax.tAlProcess=(new Date).getTime();var i=Object(o.O)("audios_block",Object(o.O)("audios","mcont")),a=Object(o.M)("show_more_wrap"),r=cdf(t),s=cdf(e);i&&i.appendChild(s),Object(o.i)(r,a),Object(o.Xb)(a),ajax.prepare_click("mcont"),ajax.tAlModule=n.module,ajax.tAlRender=(new Date).getTime()}},et={onStart:Ke.onStart,onDone:function(e,t){var n=window.cur,i=e[0],a=e[1],r=Object(o.M)("show_more_wrap");ajax.tAlProcess=Date.now(),Le.handlePagination(i,t),Object(o.Xb)(r);var s=Le.getSection(t.name);s&&s.appendChild(cdf(a)),ajax.prepare_click("mcont"),Object(o.Lb)(100),ajax.tAlModule=n.module,ajax.tAlRender=Date.now()}},tt=Ne({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=Object(o.M)(e);i&&i.parentNode&&t&&Object(o.ac)(cdf(t),i.parentNode)}}),nt=Ne({onDone:function(e,t,n){return void 0===n&&(n={}),n.snackbar&&Snackbar.init(n.snackbar),{wdHTML:e,data:t}}}),it={onStart:function(){Object(o.a)("mva_item_loading",this.link)},onDone:function(e,t){Object(o.Yb)("mva_item_loading",this.link),ownerPhotoUpload&&ownerPhotoUpload.newAvatarStoryOptions.shouldCreateNewAvatarStory&&(ownerPhotoUpload.newAvatarStoryOptions={}),e.upload_url||t&&nav.hard_go(t),Object(C.b)("mvk_new_avatar_crop")||ownerPhotoUpload&&ownerPhotoUpload.crop(e)||t&&nav.hard_go(t)},onFail:function(){Object(o.Yb)("mva_item_loading",this.link)}},at={onStart:function(){var e=this.link,t=Object(o.eb)("notify_lite",e);if(t)return Object(o.Xb)(t);for(;e=e.parentNode;)if(Object(o.gb)("notify_item",e)){Object(o.gb)("notify_panel",e.parentNode)?Object(o.Xb)(e.parentNode):Object(o.Xb)(e);break}}},ot={onStart:function(){var e=Object(o.N)("pagination","mcont");Object(o.D)(e,(function(e,t){Object(o.i)(Object(o.k)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t,n){var i=window.mail,a=Object(o.M)("messages"+t);a&&(Object(o.zc)(a,e),i.onMessagesRepainted(!0),!this.save&&Object(o.ec)()),this.save&&i.saveDialog({messages:e},t),this.clear&&(Object(o.zc)(Object(o.R)("textarea","write_form"),""),Object(o.Xb)(Object(o.O)("pi_medias","write_form"))),Object(o.Yb)("cp_attach_btn_sel",Object(o.O)("cp_attach_btn")),window.isNewMail&&MailScrap.clearSystemMessage2(),n&&n.play_animation_msg_id&&StickersSettings.getAutoplay()&&StickersAnimation.loadStickerInMvkIMAndPlay(n.play_animation_msg_id)},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:this.link.form&&this.link.form.submit()}}},rt={onStart:function(){var e=Object(o.N)("pagination","mcont");Object(o.D)(e,(function(e,t){Object(o.i)(Object(o.k)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}))},onDone:function(e,t){var n=window.mail,i=Object(o.M)("dialogs");i&&(Object(o.zc)(i,e),!this.no_scroll&&Object(o.ec)(),n.cacheDialogsPage()),n.save(t)}},st={onFail:function(e,t){if(e===ajax.RESPONSE_CAPTCHA){var n=this.link&&this.link.form;t+="&code="+(n&&n.code?n.code.value:""),nav.hard_go(t)}}},ct={onStart:function(){var e=Object(o.eb)("friendsList__showMoreBtnWrap",this.link),t=Object(o.O)("friendsList__showMoreBtn",e)||this.link,n=Object(o.k)("div",{id:"show_more_loading",className:"show_more_loading",innerHTML:'<i class="i_loading">&nbsp;</i>'}),i=Object(o.k)("div",{id:"show_more_wrap",className:"show_next_wrap show_next_wrap_transparent friendsList__showMoreBtnWrap"});Object(o.g)(n,"data-href",Object(o.V)(t)),i.appendChild(n),Object(o.i)(i,e),Object(o.Xb)(e)},onFail:function(){var e=this,t=this.link.getAttribute("data-href")||this.link.getAttribute("href");setTimeout((function(){ajax.post(t,{_ajax:1},{onDone:ct.onDone.bind(e),onFail:ct.onFail.bind(e)})}),500)},onDone:Ke.onDone},lt=Ne({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=Object(o.M)(e);i&&i.parentNode&&t&&Object(o.ac)(cdf(t),i.parentNode)}}),ut=Ne({onDone:function(e,t,n){if(!e)return{wdHTML:t,data:n};var i=Object(o.N)(e);if(i.length&&t)for(var a=0,r=i.length;a<r;a++)i[a].parentNode&&Object(o.ac)(cdf(t),i[a].parentNode)}}),dt={onStart:function(){var e=this.link;e.classList.contains("wia_item")&&e.classList.add("wia_item--loading")},onDone:function(e,t,n,i,a){if(e){var r=Object(o.N)(e);if(r.length&&t)for(var s=0,c=r.length;s<c;s++)r[s].parentNode&&Object(o.ac)(cdf(t),r[s].parentNode);Share.setBookmarkState(i,a),n&&Bookmarks.showSuccessSnack(n);var l=Object(be.f)(e);l&&Object(Ae.b)({event:a?we.c.ADD_ITEM_TO_BOOKMARKS:we.c.REMOVE_ITEM_FROM_BOOKMARKS,ownerId:l.ownerId,itemId:l.itemId,instant:!0}),n&&31===n.item_type&&a&&Object(Be.c)(Be.a.addToBookmarks,n.item_oid,n.item_id,Be.b.other)}}},_t=Ne({onDone:function(e,t,n,i,a,r){if(!e)return{wdHTML:a,data:r};var s=Object(o.M)(e);if(!s)return{wdHTML:a,data:r};var c=Object(o.O)("wia_close",s);if(c&&(Object(o.zc)(c,n),c.href=t),!Object(o.gb)("single_wall_item",s))return{wdHTML:a,data:r};var l=Object(o.M)("nc_form"),u=Object(o.O)("wall_replies");return l?Object(o.uc)(l,!!i):i&&(u?domInsert(u,i):(domInsertAfter(Object(o.k)("div",{innerHTML:i}),s),u=Object(o.O)("wall_replies"))),Object(o.vc)("closed_comments",u,!i),{wdHTML:a,data:r}}}),pt={onStart:function(){var e=domPN(this.link),t=Object(o.O)("Loading",e);t||(t=Object(o.l)(Object(me.a)({})),append(t,e)),Object(o.a)("RepliesThreadNext_loading",e)},onDone:function(e,t,n,i){var a,r=domPN(this.link),s=Object(o.gb)("RepliesThreadNext_prev",r),c=0,l=cdf(e);if(domChildren(l).forEach((function(e){Object(o.M)(e.id)&&re(e)})),s?(a=Object(o.eb)("wall_replies",r),c=Object(o.U)(a),Object(o.c)(l,r)):Object(o.i)(l,r),i?(this.link.href=i,Object(o.Yb)("RepliesThreadNext_loading",r)):re(r),Gif.onUpdate(),Object(H.a)(),n&&(cur.replyNames=Object(o.K)(cur.replyNames||{},n)),t&&t.length&&Mention.addItems(t),s){var u=Object(o.U)(a)-c;Object(o.gc)(Object(o.gc)()+u)}Object(o.Lb)()},onFail:function(){var e=domPN(this.link),t=Object(o.O)("i_loading",e);Object(o.hb)(t),Object(o.lc)(this.link),Object(o.Yb)("RepliesThreadNext_loading",e)}},ht={onDone:function(e,t,n){var i=Object(o.O)("RepliesWrap");i.innerHTML=e,Gif.onUpdate(),Object(H.a)(),n&&Object(o.K)(cur.replyNames,n),t&&t.length&&Mention.addItems(t),Object(o.gc)(Object(o.U)(i)+Object(o.db)(i))}},ft={onDone:function(e,t,n,i){if(e){var a=Object(o.M)(e);if(a){if(i)Object(o.N)("ReplyItem__message_type_"+i,a).forEach((function(e){re(e)}));var r=Object(o.O)("ReplyItem__wrap",a),s=Object(o.N)("ReplyItem__message",a),c=s.pop();if(t){var l=cdf(t);Object(o.hb)(c||r),Object(o.c)(l,c||r),Object(o.O)("rtm_reply_wrap",a)&&window.reply&&window.reply.edithide()}else i||(re(c),c=s.pop()),Object(o.lc)(c||r);if(n){var u=Object(o.M)("RepliesThread"+n);u&&Object(o.uc)(u,!t)}}}}},mt={onStart:function(){Btn.setLoading(document.querySelector("#email_soft_bouncing a.Btn"),!0)},onDone:function(e){1===e&&document.getElementById("email_soft_bouncing").remove(),Btn.setLoading(document.querySelector("#email_soft_bouncing a.Btn"),!1)}};window.Like=Re.a,window.PhotoLike=De,window.PhotoTag=He,window.PhotoDelete=Ue,window.Poll=Ve,window.CopyHistory=Fe,window.ToggleMenu=We,window.Comment=qe,window.ItemDelete=ze,window.FeedIgnore=Ye,window.FeedIgnoreItem=Ge,window.FeedIgnoreComments=Qe,window.Wall=Ke,window.SearchServices=Xe,window.Bookmark=$e,window.BookmarkToggle=dt,window.Photos=Je,window.Audios=Ze,window.AudioSection=et,window.FixPost=tt,window.ContextMenuCommonAction=nt,window.ProfileMove=it,window.Notify=at,window.Dialog=ot,window.Dialogs=rt,window.LoginCheckAuthCodePage=st,window.WallSubscribe=lt,window.FeedSubscribe=ut,window.ImportedFriends=ct,window.CloseComments=_t,window.RepliesNext=pt,window.RepliesLast=ht,window.ReplyAction=ft,window.MiniAppsCatalogResetRecent=function(e){if(e.dataset.section){var t={act:"mini_apps_reset_recent",hash:e.dataset.hash||""};ajax.post("/apps.php",t,{onDone:function(){var t=Object(o.M)("mini_apps_"+e.dataset.section);t&&t.remove()}})}},window.ResetEmailSoftBounce=mt;n("AeId"),n("Gzds"),n("kYGI");var vt=n("Qz23"),gt=n("dONA"),bt=n("uEFA"),At=!1,wt={NEED_MENU_PARAM:"_nlm",NEED_MENU:1,FORCE_NEED_MENU:2,enabled:function(e){return!1},opened:function(){return Object(o.gb)("lm_opened",window.bodyNode)},toggle:function(e,t){return Object(o.n)(e),!0},open:function(e){window.zlayer;return Object(o.n)(e),!0},close:function(e){return Object(o.n)(e),!0},fix_size:function(e){var t=Object(o.M)("l"),n=Object(o.M)("m"),i=Object(o.M)("mhead"),a=i&&i.offsetHeight||0,r=wt._st||0;t&&n&&(e?n.style.minHeight="0":(r=r>a?r:0,n.style.minHeight=t.offsetHeight+r+"px"),!wt.fixed||Object(o.T)()<320?e?n.style.marginTop="0":(t.style.minHeight=Object(o.S)()+"px",n.style.marginTop=-r+"px"):t.style.minHeight="0")},clear_hover:function(){thover.clear()},hasMenu:function(){return window.al&&window.al.menu},isMenuHasItems:function(){return wt.hasMenu()&&Object(o.ob)(window.al.menu)&&window.al.menu.length||Object(o.tb)(window.al.menu)&&Object.keys(window.al.menu).length},refreshCounters:function(e){if(!wt.hasMenu())return!0;if(!e)return!0;if(Object(o.ob)(e)&&!e.length)return!0;if(Object(o.tb)(e)&&!Object.keys(e).length)return!0;if(Object(o.ob)(e)&&!Object(o.ob)(window.al.menu))return!1;if(Object(o.tb)(e)&&!Object(o.tb)(window.al.menu))return!1;if(Object(o.ob)(e)&&e.length!=window.al.menu.length)return!1;if(Object(o.tb)(e)&&Object.keys(e).length!=Object.keys(window.al.menu).length)return!1;void 0!==e[bt.c]&&Tabbar.setCounter(Tabbar.TAB_ID_NOTIFICATION,e[bt.c]),void 0!==e[bt.b]&&Tabbar.setCounter(Tabbar.TAB_ID_MESSAGES,e[bt.b]);var t=e[bt.c];"number"==typeof t&&isFinite(t)&&(Bell.setCount(t),window.store&&(store.notificationsCount=t));var n=window.al,i=Object(z.a)(".main_menu",document.getElementById("l"));return Object.entries(e).forEach((function(e){var t=e[0],a=e[1];if(void 0===a)return!0;var r=n.menu[t],s=Object(z.a)(".mmi_"+r[0],i),c=Object(z.a)(".mm_item",s),l=Object(z.a)(".mmi_wrap",s),u=Object(z.a)(".mm_counter",l);Object(o.g)(c,"data-href",!1),a?(r[3]&&Object(o.g)(c,"href",r[3]),u?Object(o.zc)(u,a):Object(o.f)(Object(o.k)("em",{className:"mm_counter",innerHTML:a}),l)):(r[2]&&Object(o.g)(c,"href",r[2]),Object(o.Xb)(u)),ajax.prepare_click(c)})),!0},refreshSingleCounter:function(e,t){var n;wt.hasMenu()&&(Object(o.ob)(window.al.menu)&&((n=new Array(al.menu.length))[e]=t),Object(o.tb)(window.al.menu)&&(n={},Object.entries(window.al.menu).forEach((function(i){i[0];var a=i[1];parseInt(a,10)===parseInt(e,10)?n[a]=t:n[a]=void 0}))),wt.refreshCounters(n))},refreshNotifications:function(e){window.store&&(store.menuNotifications=e);var t=Object(z.a)(".mmi_apps .mmi_wrap");if(t){var n=Object(z.a)('[data-id="menu-apps-notification"]',t);!e[bt.a]&&n&&n.remove(),e[bt.a]&&!n&&(t.innerHTML+=_.a.render(Object(gt.a)({id:"menu-apps-notification"})))}},refresh:function(e){e=e||{},ajax.refreshLinks(e.fv_link,e.app_link),void 0!==e.pp&&!1!==e.pp&&Object(o.zc)("lm_prof_panel",e.pp),void 0!==e.tn&&!1!==e.tn&&Object(o.zc)("lm_top_notify",e.tn),void 0!==e.bn&&!1!==e.bn&&Object(o.zc)("lm_bottom_notify",e.bn),e.lm&&Object(o.zc)("l",e.lm),e.counters&&wt.refreshCounters(e.counters),e.notifications&&wt.refreshNotifications(e.notifications),e.tab&&Tabbar.setCurrentId(e.tab),e.topbar||Object(o.Xb)("vk_topbar")},initEvents:function(){var e=wt.getStickedScrollingHandler();e&&(Object(o.Kb)(e),e(Object(o.dc)())),Object(o.Jb)((function(){var t=Object(o.M)("vk_wrap"),n=t&&t.offsetWidth,i=Object(o.gb)("_hfixed",window.bodyNode);n>=882&&wt.close(),wt.fix_size(!wt.opened(),i),e&&e(Object(o.dc)())}))},init:function(){wt.fixed=Object(o.gb)("_hfixed",window.bodyNode),wt.initEvents(),Object(o.b)(window,"orientationchange",(function(){var e=Object(o.M)("vk_wrap").offsetWidth,t=wt._st||0;e>=882&&t>44&&wt.close()}));var e=Object(z.a)(".leftMenu__content");e&&Object(vt.e)(e,{topBanner:!!U.a.ipad&&void 0,overscrollY:!1,standalone:!0})},blockScroll:function(e){var t=Object(o.M)("vk_wrap");wt.opened()&&Object(o.ab)(t)<882&&Object(o.Tb)(e)},qsOpened:!1,qsOpen:function(){wt.qsOpened||(wt.qs_st=Object(o.gc)(),Object(o.a)("qs_opened","vk_wrap"),Object(o.a)("qs_opened",window.bodyNode),Object(o.ab)("vk_wrap")<882&&Object(o.gc)(0),wt.qsOpened=!0)},qsClose:function(){wt.qsOpened&&(Object(o.Yb)("qs_opened","vk_wrap"),Object(o.Yb)("qs_opened",window.bodyNode),Object(o.ab)("vk_wrap")<882&&Object(o.gc)(wt.qs_st||0),wt.qsOpened=!1)},initSearch:function(){At||(At=!0,Object(o.b)("lm_search_items","mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),Object(o.b)(Object(z.a)(".head_search",document.getElementById("l")),"mousedown touchstart",(function(e){e.stopPropagation()}),{passive:!0}),Object(o.b)(document,"mousedown touchstart",(function(e){Object(o.M)("vk_wrap");wt.qsOpened&&(wt.qsClose(),Object(o.E)("lm_search_field"))}),{passive:!0}))},closeSearch:function(){return!0},cancelSearch:function(){return!0},headerAction:function(e,t){return Object(o.ab)("vk_wrap")>=882?nav.go(e,t):wt.toggle()},getStickedScrollingHandler:function(){var e=Object(z.a)(".leftMenu__content"),t=document.body;if(e&&t&&t.classList.contains("_hfixed")&&!t.classList.contains("_touch")){var n,i=Object(o.dc)(),a=Object(o.dc)(),r=!1,s=function(t,n){void 0===n&&(n=0),e.style.position=t,e.style.top=n+"px",e.style.bottom=""};return function(t){if(!(t<0||t+window.innerHeight>document.body.scrollHeight||Object(o.T)()<882)){var c=e.getBoundingClientRect(),l=Math.round(c.top),u=Math.floor(c.height);if(0!==u){var d=document.body,_=document.documentElement;if(u+56>=Math.max(d.scrollHeight,d.offsetHeight,_.clientHeight,_.scrollHeight,_.offsetHeight))s("absolute");else if(!(u+56>_.scrollHeight)){if((t>i||t===i&&t>0)&&(n="down"),t<i&&(n="up"),i=t,u<window.innerHeight)return s("fixed"),void(a=t+l-56);switch(n){case"down":r=u+l<=window.innerHeight;break;case"up":r=0<=l-56}var p,h;r?("down"===n?(p="fixed",void 0===h&&(h=0),e.style.position=p,e.style.top="",e.style.bottom=h+"px"):s("fixed"),a=t+Math.round(e.getBoundingClientRect().top)-56):s("absolute",a)}}else s("absolute")}}}}};window.menu=wt;var yt=n("wTgh"),Ot=n("cZev"),kt=function(){var e={},t={},n=null,i=!1,a={},r={},s={},c=null;function l(){if(n){var t=[],i=!1;if(each(geByClass("_unread"),(function(){var e=+attr(this,"data-id");e&&t.push(e),i=kt.getPeerByMsg(e),replaceClass("_unread","_read",this)})),i){var a=ge("messages"+i);a&&e[i]&&(e[i].messages=val(a))}if(t.length)kt.sendMarkAsRead(n,t);else{var o=e[n].last_msg;kt.sendMarkAsRead(n,o?[o]:[]),kt.updateMarkAsUnread(n,!1)}}}function u(e,t){t?(addClass("lvi",e),toggleClass("mlvi",e,!!U.c[t])):(removeClass("lvi",e),removeClass("mlvi",e))}function d(e){(0,e.updater)(document.body),each(e.caches,(function(t,n){var i=n.storage,a=n.getter,o=function(e,t){var n,i=t.split("."),a=i.length,o=e;for(n=0;n<a;n++)if(!(o=o[i[n]]))return null;return o}(i,a);if(o){var r="string"==typeof o;r&&(o=ce("div",{innerHTML:o})),e.updater(o),function(e,t,n){var i,a,o=t.split("."),r=o.length-1,s=e;for(a=0;a<r;a++)s=s[i=o[a]]||(s[i]={});s[o[r]]=n}(i,a,r?o.innerHTML:o)}}))}return!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(e,t,n){if(nav.getQuery("community")&&(!n||!n.ignore_cur_process)&&"/mail"===("string"==typeof e?e:attr(e,"href")||attr(e,"data-href")))return nav.go(e,t,{ignore_cur_process:!0}),!0})),!window.isNewMail&&window.nav&&window.nav.onBeforeGo((function(){if(nav.getQuery("community"))var e=ajax.post("/",{_ajax:1,act:"ping"},{onDone:function(){try{var t=JSON.parse(e.response),n=t&&t[1]&&t[1][2];kt.actualizeMessagesCornerCounter(n)}catch(e){}}})})),{wrapLinks:yt.a,wrapMention:St,onShowDialogFromCache:Object(o.hc)(),onShowWritePageFromCache:Object(o.hc)(),onShowDialogsPageFromCache:Object(o.hc)(),onMessagesRepainted:Object(o.hc)(),init:function(t,a){var o=window.im;window.cur.destroy.push((function(){AudioMessagePlayer.detachPlayer()})),a&&(cur.ref=a.ref,cur.refSource=a.ref_source),t&&(n=t,a&&(kt.saveDialog(a,t),e[t])),i||(i=!0,addEvent(document,U.b?"touchstart":"mousedown",l)),setTimeout((function(){o.on()}))},unpinMessage:function(t){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(hide),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.remove("head_actions_has_pinned")})),e.$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.classList.add("pinnedMsg_hidden")}))}})},pinMessage:function(t,n){d({caches:[{storage:e,getter:t+".write_form"}],updater:function(e){e.$$(".cm_unpin").forEach(show),e.$$(".head_actions_wrap").forEach((function(e){return e.classList.add("head_actions_has_pinned")})),$$(".pinnedMsg_peer_"+t).forEach((function(e){return e.outerHTML=n}))}})},clear:function(){nav.clear();var o=window.im;e={},t={},a={},n=null,removeEvent(document,U.b?"touchstart":"mousedown",l),i=!1,o.off()},send:function(e,t){if(mediaUpload&&!mediaUpload.checkUploading())return!1;var n=ajax.click(e,extend({clear:!0,save:!0},Dialog),{lock:!0,url_params:{ref_source:cur.refSource,ref:cur.ref}});return cur.ref=void 0,cur.refSource=void 0,n},save:function(t){each(t,(function(t,n){e[t]&&n.last_msg==e[t].last_msg&&delete n.messages,kt.saveDialog(n,t)}))},saveDialog:function(t,n){e[n]||(e[n]={});var i=e[n];extend(i,t),i.msgs&&each(i.msgs,(function(e,t){a[t]=n}))},getPeerByMsg:function(e){return a[e]||!1},cacheDialogsPage:function(){nav.getQuery("community")&&nav.getQuery("tab")||(t.page=val("m"),nav.getQuery().act?t.link=jt("/mail"):t.link=nav.cur)},keyup:function(e,t,n){var i=c||"",a=e.value||"";i.length==a.length&&i==a||(kt.myTyping(t,n),c=a)},myTyping:function(e,t){if(!(e<=-2e9)){var n=vkNow();s[e]&&n-s[e]<5e3||(s[e]=n,ajax.post("/mail",{_ajax:1,act:"typing",peer:e,hash:t,community:nav.getQuery("community")}))}},typing:function(e,t){t=t||e;e>2e9?(r[e]||(r[e]={}),r[e][t]=vkNow()):r[e]=vkNow(),kt.updateTyping(e)},updateTyping:function(e){var t=function(e,t){return e.getAttribute&&e.getAttribute(t)},n=window.lang,i=ge("dialog_near"+e),a=geByClass1("di_current_peer",i),o=geByClass1("di_typing",i);if(i){var s=[],c=vkNow();if(e>2e9)each(r[e]||{},(function(e,n){t(o,"data-u"+e)&&n&&c-n<6e3&&s.push(e)}));else{var l=r[e];t(o,"data-u"+e)&&l&&c-l<6e3&&s.push(e)}if(s.length){if(1==s.length){var u=s[0],d=t(o,"data-u"+u),_=t(o,"data-s"+u);val(o,'<i class="i_typing"></i>'+(n.mobile_mail_typing[_]||"").replace("{user}",d))}else{each(s,(function(e,n){s[e]=t(o,"data-u"+n)}));var p=s.pop();val(o,'<i class="i_typing"></i>'+(n.mobile_mail_multi_typing||"").replace("{users}",s.join(", ")).replace("{last_user}",p))}a.offsetWidth&&setStyle(o,"minWidth",a.offsetWidth),addClass("di_typing_now",i),setTimeout((function(){addClass("di_typing_animated",i)}),10),setTimeout((function(){kt.updateTyping(e)}),2e3)}else val(o,""),setStyle(o,"minWidth",0),removeClass("di_typing_animated",i),removeClass("di_typing_now",i)}},updateOnline:function(t,n){var i=ge("messages"+t);if(i&&remove(geByClass1("di_activity",i)),each(geByClass("_lv"+t,"mcont"),(function(e,t){u(t,n)})),e[t]){if(e[t].write_form){var a=ce("div",{innerHTML:e[t].write_form});each(geByClass("_lv"+t,a),(function(e,t){u(t,n)})),e[t].write_form=val(a)}if(e[t].messages){a=ce("div",{innerHTML:e[t].messages});remove(geByClass1("di_activity",a)),e[t].messages=val(a)}}},updateImportantMessages:function(n,i,a){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(jt("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("dialogs_filter_button_important",e);if(t){var n=intval(val(t))+a;val(t,n),toggleClass("dialogs_filter_without_important",geByClass1("dialogs_filter",e),0===n)}}}),d({caches:[{storage:e,getter:n+".messages"}],updater:function(e){var t=geByClass1("_msg"+i,e);t&&toggleClass("msg_item_important",t,1===a)}})},updateImportantDialog:function(e,n){nav.getQuery("community")&&d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(jt("/mail")),getter:"html"}],updater:function(t){var i=geByClass1("_peer"+e,t);i&&toggleClass("dialog_item_important",i,n)}})},markAsListened:function(t){var i=+t.getAttribute("data-msg");if(i&&n){var a=e[n];a&&a.hash&&ajax.post("/mail",{_ajax:1,act:"listen_audiomsg",msg_id:i,hash:a.hash},{onDone:function(){var e=$$('.audio-msg-track[data-msg="'+i+'"]');if(e&&(e.forEach((function(e){e.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened")})),a&&a.messages)){var t=ce("div",{innerHTML:a.messages}),n=geByClass1("_msg"+i,t),o=$('.audio-msg-track[data-msg="'+i+'"]',n);o&&o.closest(".im_msg_audiomsg").classList.add("im_msg_audiomsg_listened"),a.messages=val(t)}}})}},sendMarkAsRead:function(t,n){isArray(n)||(n=[n]);var i=e[t];i&&i.hash&&ajax.post("/mail",{_ajax:1,act:"mark_read",peer:t,msgs:n.join(","),mark_conversation_as_read:0===n.length,hash:i.hash,community:nav.getQuery("community")},{onDone:function(e){e&&each(n,(function(e,n){kt.markAsRead(t,n)}))}})},markAsRead:function(t,n){window.im;var i=ge("messages"+t);if(i){var a=geByClass1("_msg"+n,i);hasClass("_read",a)||removeClass("mi_unread",a);var o=e[t];if(o&&o.messages){var r=ce("div",{innerHTML:o.messages});a=geByClass1("_msg"+n,r);hasClass("_read",a)||removeClass("mi_unread",a),o.messages=val(r)}}},markPeerAsRead:function(n,i,a){var o=ge("messages"+n);if(o&&(each(geByClass("msg_item",o),(function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),(l=e[n])&&l.messages)){var r=ce("div",{innerHTML:l.messages});each(geByClass("msg_item",r),(function(){if(!a==!hasClass("_unread",this))return!0;+attr(this,"data-id")<=i&&!hasClass("_read",this)&&removeClass("mi_unread",this)})),l.messages=val(r)}var s=ge("dialogs"),c=a?"di_unread_outbox":"di_unread_inbox";if(s)(l=geByClass1("_peer"+n,s))&&hasClass(c,l)&&(removeClass(c,l),remove(geByClass1("di_unread_cnt",l)));else if(t.page){var l;r=ce("div",{innerHTML:t.page});(l=geByClass1("_peer"+n,r))&&hasClass(c,l)&&(removeClass(c,l),remove(geByClass1("di_unread_cnt",l))),t.page=val(r)}d({caches:[{storage:nav.page_get(jt("/mail")),getter:"html"}],updater:function(e){var t=geByClass1("_peer"+n,e);t&&hasClass(c,t)&&(removeClass(c,t),remove(geByClass1("di_unread_cnt",t)))}})},markAsDeleted:function(t,n){var i=ge("messages"+t);if(i){remove(geByClass1("_msg"+n,i));var a=e[t];if(a&&a.messages){var o=ce("div",{innerHTML:a.messages});remove(geByClass1("_msg"+n,o)),a.messages=val(o)}}ajax.click(jt(nav.path),extend({no_scroll:!0},Dialogs))},updateMarkAsUnread:function(e,t){d({caches:[{storage:nav.page_get(jt("/mail")),getter:"html"}],updater:function(n){var i=$("._peer"+e,n);if(i){i.classList.toggle("di_unread_inbox",t);var a=$(".di_head",i);if(t){var o=$(".di_chat_user",i),r=document.createElement("span");r.classList.add("di_unread_cnt"),r.innerHTML="&nbsp;",a.insertBefore(r,o)}else{var s=$(".di_unread_cnt",i);s&&s.remove()}}}})},addMessage:function(t,n,i,o){if(t<2e9?delete r[t]:r[t]&&delete r[t][i],kt.updateTyping(t),!0!==o){if(t&&n&&(a[n]=t),!geByClass1("_msg"+n)){var s=e[t];if(s&&s.messages){s.msgs&&s.msgs.push(n);var c=ce("div",{innerHTML:s.messages});(u=geByClass1("di_activity",c))?(after(cdf(o),u),s.messages=val(c)):s.messages=o+s.messages,(l=ge("messages"+t))&&(val(l,s.messages),kt.onMessagesRepainted(!0))}else{var l,u;if(l=ge("messages"+t))(u=geByClass1("di_activity",l))?after(cdf(o),u):val(l,o+val(l))}}}else if(ge("dialogs")&&"/mail"==nav.path){var d=nav.getQuery();d.act||d.offset||d.q||ajax.click(jt(nav.path),extend({no_scroll:!0},Dialogs))}},replaceMessage:function(t,n,i,a){var o=ge("messages"+t),r=e[t];if(r&&r.messages){var s=ce("div",{innerHTML:r.messages}),c=geByClass1("_msg"+n,s);c&&(c.outerHTML=a),r.messages=val(s),val(o,r.messages)}else geByClass1("_msg"+n).outerHTML=a},getMsgHTML:function(t,n,i,a,o,r,s,c){var l=window,u=l.vk,d=l.lang,_=2&n?u.id:s&&s.from||i;if(!_)return!1;if(!ge("messages"+i))return!0;if(s.attach1||s.fwd||s.geo||s.emoji)return!1;if(s.source_act)return!1;if(!e[i]||!e[i].hash)return!1;var p="_u"+_,h=geByClass1(p,"mcont","a"),f=stripTags(attr(h,"data-name")||val(h)||""),m=getHref(h),v=geByClass1(p,"mcont","img"),g=v&&v.src||"";if(!f||!m||!g)return!1;i=intval(i),t=intval(t),o=o&&-1==o.toString().indexOf(" ... ")&&i<2e9?o:"";var b,A,w,y=1&n?" mi_unread":"";return!(2&n)&&1&n&&(y+=y?" _unread":""),r=kt.wrapLinks(r,n),r=kt.wrapMention(r),('<a name="msg{{msgId}}"></a><div  class="msg_item _msg{{msgId}}{{msgClass}}"  data-id="{{msgId}}"  onclick="return MessagesActions.onMessageClick(event);">  <div class="mi_iwrap">    <a class="al{{cl}}" href="{{href}}">      <img src="{{photo}}" class="mi_img {{cl}}" />    </a>  </div>  <div class="mi_cont">    <div class="mi_head">      <a class="mi_date" href="'+jt("/mail?act=msg&id={{msgId}}").replace(/\&/g,"&amp;")+'">        {{time}}      </a>      {{edited}}\n      <a class="mi_author al{{cl}} {{cl}}" href="{{href}}" data-name="{{dataName}}">        {{name}}      </a>    </div>    <div class="mi_body">      {{mi_title}}      <div class="mi_text">{{text}}</div>    </div>  </div></div>').replace(/{{msgId}}/g,t).replace(/{{cl}}/g,p).replace(/{{href}}/g,m).replace("{{msgClass}}",y).replace("{{edited}}",c?'<span class="mi_edited">'+d.mobile_mail_edited+"</span>":"").replace("{{photo}}",g).replace("{{time}}",(b=new Date(1e3*a),A=b.getHours(),w=b.getMinutes(),A+":"+(w<10?"0":"")+w)).replace("{{dataName}}",escapeAttr(f)).replace("{{name}}",f.split(" ").shift()).replace("{{mi_title}}",o?'<div class="mi_title">'+o+"</div>":"").split("{{text}}").join(r)},updateStickers:function(){window.cur;var t=window.post,i=e[n];if(i){var a=i.write_form?(Ot.a.getStickerPanel()||"").split("mail-0").join("mail"+n):"",o=ge("stickers_panel");o&&(replace(cdf(a),o),o=null,t.stickersInit())}},showDialog:function(i,a,o){window.cur;var r=window,s=r.MessagesActions,l=r.Mention,u=r.Dialog,d=window.post;if(s.hasFwdMessages())return s.attachFwdMessages(a),!1;t.scroll_top=scrollTop();var _=e[a];if(_){var p=ce("div",{innerHTML:val("m")}),h=geByClass1("mhb_back",p);if(h&&_.header){var f=ce("div");val(f,_.header),before(f.firstElementChild,h),remove(h)}var m=_.write_form?(Ot.a.getStickerPanel()||"").split("mail-0").join("mail"+a):"";val(geByClass1("pcont",geByClass1("mcont",p)),_.write_form+m+(a?'<div id="messages'+a+'" class="messages bl_cont">'+(_.messages||"")+'<div id="al_loading"></div></div>':"")),val("m",p.innerHTML),d.stickersInit(),ajax.refreshLinks(_.fv_link,_.app_link),alLoadingFix(),n=a,_;var v=getHref(i);nav.go(v,null,{push_only:!0,no_push:o}),a?(c=null,kt.updateTyping(a),ajax.click(v,extend({save:a},u),{scroll:!0})):kt.onShowWritePageFromCache(!0),kt.onShowDialogFromCache(!0),scrollTop(0,10)}else nav.al_go(_&&_.cur_link||getHref(i)||nav.cur);nav.getQuery("community")&&"unread"===nav.getQuery("ctab")&&removeClass("al_back",geByClass1("mhb_back"));var g=geByClass1("MentionContainer"),b=parseJSON(attr(g,"data-mentions"))||[];return b.length&&l.init({url:!1,appendTo:g,defaultItems:b,items:b,preferDomain:!0}),AudioMessagePlayer.events.on("listened",kt.markAsListened),!1},backToDialogs:function(e){if(t.page)nav.go(t.link,null,{push_only:!0,no_push:e}),ajax.click(t.link,extend({no_scroll:!0},Dialogs)),val("m",t.page),ajax.refreshLinks(attr("fv_link","href")||attr("fv_link","data-href"),"vkontakte://vk.com/mail"),n=null,scrollTop(t.scroll_top||0),kt.onShowDialogsPageFromCache(!0);else{var i=jt(t.link||"/mail");nav.go(i,null,{push_only:!0,no_push:e}),nav.al_go(i)}},actualizeMessagesCornerCounter:function(e){d({caches:[{storage:t,getter:"page"},{storage:nav.page_get(jt("/mail")),getter:"html"}],updater:function(t){var n=geByClass1("mhi_notify",t),i=geByClass1("mh_notify_counter",n);i||(i=ce("em",{className:"mh_notify_counter"}),append(i,n)),e?i.innerText=e:n.innerHTML="&nbsp;"}})}}}();function jt(e){var t=window.nav.getQuery(),n=t.community,i=t.ctab,a=n&&-1===e.indexOf("community=")?"community="+n:"",o=n&&i&&-1===e.indexOf("ctab=")?"&ctab="+i:"";return a?e+(e.indexOf("?")>=0?"&":"?")+a+o:e}function St(e){return e.replace(/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,(function(e,t,n,i,a){return'<a href="/'+(t+n)+'" class="mem_link">'+a+"</a>"}))}window.mail=kt,window.makeUrl=jt,window.Scroller=function(e,t){var n,i,a,o,r,s=t&&t.ignoreMouseWheel,c=t&&t.noAutoScroll,l=!isUndefined(document.ontouchmove),u=!0,d=!1,_=!1,p=!1,h=!1,f=0,m=0,v=!1,g=0,b=!1,A=!1,w=!1,y=!1;function O(e){var t=e.touches,n=getX(i),a=getY(i);return{x:((t&&t[0]?t[0].pageX:e.pageX)||0)-n,y:((t&&t[0]?t[0].pageY:e.pageY)||0)-a}}function k(e){v||(v=[]),v.push([vkNow(),e]),v=v.slice(-20)}function j(){v=!1}function S(){if(!v||v.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=v.pop(),i=v.length-1;i>=0;i--){if((a=e-v[i][0])>150)break;t=v[i]}if(!t||!n)return[0,0,0];var a,o=n[1].x-t[1].x,r=n[1].y-t[1].y,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}function C(e){"touchstart"==e.type?u=!e.touches||1==e.touches.length:"touchmove"==e.type?u=!1:"click"==e.type&&(u||(cancelEvent(e),u=!0))}function E(e){if(!(window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger")||y&&e.touches&&e.touches.length>1)){if(j(),_){if(m<=1)return}else if(getW(i)-getW(a)>=0)return;p=O(e),k(h=p),w=!0,setStyle.animate(a)}}function T(e){if(p&&(y||w)){thover&&thover.cancel(e);var t=O(e);if(k(h=t),w){var n=p.x-t.x,o=p.y-t.y;if(Math.abs(n)>=Math.abs(o)&&(cancelEvent(e),y=!0),w=!1,y){var r=getY(i),s=getH(i),l=scrollTop(),u=getCh();!c&&(r-7<l?scrollTop(r-7):r+s+7>l+u&&scrollTop(r+s+7-u))}}if(y)if(cancelEvent(e),_){var v=getW(i);n=p.x-t.x;(f<=0&&n<0||f>=m-1&&n>0)&&(n/=3);var b=-f-n/v,A=d?100*b+"%":b*v;setStyle.transform(a,{translate:[A,0]})}else{var j=getW(i)-getW(a);n=p.x-t.x;if(j>0&&(j=0),(b=g-n)<j)A=j-(j-b)/3;else if(b>0)A=0+(b-0)/3;else A=g-n;x(A),setStyle.transform(a,{translate:[A,0]})}}}function I(e){if(p&&y){if(cancelEvent(e),_){var t=4.7*S()[1],n=p.x-h.x,o=getW(i),r=Math.abs(n)>=o/2;(f>0&&(r&&n<0||t>1)||f<m-1&&(r&&n>0||t<-1))&&(f+=n>0?1:-1);var s=-f,c=d?100*s+"%":s*o;p=!1,j(),L(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[c,0]})}else{var l=function(){if(!v)return!1;var e=S(),t=e[0],n=e[1];if(j(),!t)return!1;var i=t/4.7,a=n*i-4.7*i*i/2;return i*=530,a*=140,clog("dx",a,"t",i),!(t<.1||!a)&&{dx:a,t:i}}(),u=getW(i)-getW(a);n=p.x-h.x,s=g-n;l&&(s+=l.dx),u>0&&(u=0),g=s<u?u:s>0?0:s;var b={duration:200,func:"ease"};l&&(b={duration:l.t,func:"cubic-bezier(0, 1, 1, 1)"}),x(g),setStyle.animate(a,"transform",b),setStyle.transform(a,{translate:[g,0]})}y=!1}}function M(e){if(!(s||window.isNewMail&&e.target.closest(".stickers_panel")&&e.target.closest(".messenger"))){if(preventEvent(e),_){if(m<=1)return}else if((n=getW(i)-getW(a))>=0)return;var t=(e.detail?e.detail:e.wheelDelta)>0?3:-3;if(!1===b&&(b=0),b+=t,!_){var n=getW(i)-getW(a),o=g-b;if(n>0&&(n=0),o<n)var r=n-(n-o)/3;else if(o>0)r=0+(o-0)/3;else r=g-b;x(r),setStyle.transform(a,{translate:[r,0]})}clearTimeout(A),A=setTimeout((function(){if(_){(f>0&&b<0||f<m-1&&b>0)&&(f+=b>0?1:-1);var e=-f,t=getW(i),n=d?100*e+"%":e*t;L(),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[n,0]})}else{var o=getW(i)-getW(a);o>0&&(o=0),(e=g-b)<o?g=o:e>0?g=0:g-=b,x(n),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]})}b=!1}),200)}}function P(e){if(_){var t=f;if(e&&e.target){var n=hasClass("sp_ppt",e.target)?e.target:gpeByClass("sp_ppt",e.target),o=+attr(n,"data-i");f=o<0?0:o>m-1?m-1:o}p=!1,j(),y=!1;var r=getW(i),s=-f,c=d?100*s+"%":s*r;L(),t!=f&&setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[c,0]})}}function x(e){if(!_){e=e||g;var t=getW(i)-getW(a);toggleClass("sw_left",i,e<0),toggleClass("sw_right",i,e>t)}}function L(){if(_){var e=geByClass1("sp_ppt_sel",n);e&&e===r[f]||(removeClass("sp_ppt_sel",e),addClass("sp_ppt_sel",r[f]))}}extend(this,{init:function(){i=geByClass1("scroller_wrap",n),a=geByClass1("scroller_cont",i),_?(o=geByClass1("sp_pages_pts",n),r=geByClass("sp_ppt",o),m=(geByClass("scroller_page",a)||[]).length,f=0,L()):x(g=0),v=!1,setStyle.transform(a,{translate:[0,0]}),l?(addEvent(i,"touchstart touchmove click",C),addEvent(i,"touchstart",E),addEvent(i,"touchmove",T),addEvent(i,"touchend touchcancel",I)):(addEvent(i,"mousewheel",M),addEvent(o,"click",P)),d||onBodyResize(P)},destroy:function(){l?(removeEvent(i,"touchstart touchmove click",C),removeEvent(i,"touchstart",E),removeEvent(i,"touchmove",T),removeEvent(i,"touchend touchcancel",I)):(removeEvent(i,"mousewheel",M),removeEvent(o,"click",P)),d||onBodyResize("__clear",P)},onShow:function(){_?L():x(g)},canClick:function(){return u}}),n=e,(t=t||{}).byPage?(_=!0,d=!U.a.android):(_=!1,d=!1,this.showElem=function(e){if(!_){var t=getX(e)-getX(i),n=t+g,o=n+getW(e),r=getW(i),s=!1;n<0?s=0-t+20:o>r&&(s=r-getW(e)-t-20);var c=getW(i)-getW(a);if(c>0&&(c=0),s<c)s=c;else if(s>0)s=0;clog(t,g,n,o,0,r,s),!1!==s&&(x(g=s),setStyle.animate(a,"transform",{duration:200,func:"ease"}),setStyle.transform(a,{translate:[g,0]}))}})};var Ct=n("izth"),Et=function(){var e=null,t={},n=1,i=null,a=!1,o=!1;function r(){n<64&&(n*=2)}function s(e,t){!1===e&&(e=getNotify()+(t||1)),setNotify(e),menu.refreshSingleCounter(bt.b,e)}function c(e){return Object.keys(e).some((function(e){return-1!==e.indexOf("attach")}))||e.fwd||e.emoji||e.geo}function l(e,t,n){var i=toInt(e.from_admin)||null,a=toInt(nav.getQuery("community"));return i&&a?a:2&t?window.vk.id:toInt(e.from)||n}function u(){return Number(nav.getQuery("offset"))>0}function _(e){try{return JSON.parse(e)}catch(e){return null}}return{onNewMsg:Object(d.a)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(d.a)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(d.a)("msgId","dialogId"),onMsgReadByOther:Object(d.a)("msgId","dialogId"),onOnlineChange:Object(d.a)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onTyping:Object(d.a)("dialogId","authorId"),onMultiTyping:Object(d.a)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(d.a)("msgId"),onMsgImportantAdd:Object(d.a)("msgId"),onMsgRemove:Object(d.a)("msgId"),onMsgRestore:Object(d.a)("msgId"),onPeerKeyboard:Object(d.a)("peerId"),onPeerBanner:Object(d.a)("peerId"),onDialogImportant:Object(d.a)("peerId","isImportant"),onDialogMarkedUnread:Object(d.a)("peerId","isMarkedUnread"),onDialogPin:Object(d.a)("peerId"),onDialogUnpin:Object(d.a)("peerId"),onUnreadCount:Object(d.a)("event"),onResync:Object(d.a)(),isLongPollingEnabled:function(){return!!a},init:function(t){e||(Object(Ct.a)(),e=ce("iframe",{src:t.frameUrl},{display:"none"}),onDOMReady((function(){append(e,window.bodyNode),!0}))),Et.refreshParams(t),setTimeout(Et.check,1e3)},on:function(){clog("[longpoll] start"),a=!0,setTimeout(Et.check,1e3)},off:function(){clog("[longpoll] pause"),a=!1},refreshParams:function(e){extend(t,e||{}),extend(Et,t)},getKey:function(){if(i)try{i.abort()}catch(e){}i=ajax.post("/mail",{_ajax:1,act:"im_get_key",community:nav.getQuery("community")},{onDone:function(e){/[0-9a-f]{40}/i.test(e)?(Et.refreshParams({key:e}),Et.check()):clog("[longpoll] invalid key")},onFail:function(e){setTimeout(Et.getKey,1e3*n),clog("[longpoll] from getKey delaying getKey for "+n+"secs"),r()}})},check:function(){if(a&&!o)if(Et.makeRequest)try{Et.makeRequest((function(e,t){if(o=!1,a)if(window.vk.__debug)Et.checked(parseJSON(t))&&(Et.check(),n=1);else try{Et.checked(parseJSON(t))&&(Et.check(),n=1)}catch(e){try{clog("[longpoll] error",e.message||"no message",e.type||"no type",e.stack||"no stack")}catch(e){}setTimeout(Et.check,1e3*n),r()}}),(function(){o=!1,setTimeout(Et.check,1e3*n),r()})),o=!0}catch(e){clog("[longpoll] makeRequest failed")}else setTimeout(Et.check,1e3)},checked:function(e){var i,a,o,d=e.failed;if(1==d||t.ts>=e.ts+256){if(Et.refreshParams({ts:e.ts}),d)return!0}else{if(2==d)return clog("[longpoll] delaying getKey for "+n+"secs"),setTimeout(Et.getKey,1e3*n),r(),!1;if(d)return void clog("[longpoll]",e)}if(Et.refreshParams({ts:e.ts}),e.updates){var p=[],h=!1;for(var f in e.updates){if(116==e.updates[f][0])var m=e.updates[f][1],v=[e.updates[f][0],m.id,m.flags,m.peer_id,m.date,m.title||"",m.message,m.kludges,m.random_id];else v=e.updates[f];var g=intval(v[0]),b=intval(v[1]),A=intval(v[2]),w=intval(v[3]);if(1===A){if(10===g){mail.updateImportantDialog(b,!1);continue}if(12===g){mail.updateImportantDialog(b,!0);continue}}if(A&1<<20){if(10===g){mail.updateMarkAsUnread(b,!1);continue}if(12===g){mail.updateMarkAsUnread(b,!0);continue}}if(8&A){if(2===g){if(window.isNewMail){Et.onMsgImportantAdd(b);continue}mail.updateImportantMessages(w,b,1);continue}if(3===g){if(window.isNewMail){Et.onMsgImportantRemove(b);continue}mail.updateImportantMessages(w,b,-1);continue}}if(51!=g)if(61!=g)if(62!=g)if(8!=g)if(9!=g)if(6!=g&&7!=g)if(80!=g||!b||nav.getQuery("community"))if(52!=g){if(w)if(4!=g&&5!=g&&116!=g)if(0!=g)if(2!=g);else{if(128&A){if(window.isNewMail){Et.onMsgRemove(b);continue}mail.markAsDeleted(w,b)}window.isNewMail&&64&A&&Et.onMsgRemove(b)}else{if(window.isNewMail){Et.onMsgRemove(b);continue}mail.markAsDeleted(b)}else{var y=5==g||116==g;if(window.isNewMail){var O=v,k=O[1],j=O[3],S=O[4],C=O[6],E=O[7],T=void 0===E?{}:E,I=O[8],M=c(T),P=(i=void 0,a=void 0,o=void 0,i=new Date(1e3*S),a=i.getHours(),o=i.getMinutes(),a+":"+(o<10?"0":"")+o),x=toInt(T.from_admin)||null,L=(toInt(nav.getQuery("community")),l(T,A,j)),R=!!T.source_act,B=T.keyboard?_(T.keyboard):null;if(y){var N={peerId:j,msgId:k,authorId:L,text:C,date:P,hasAttachments:M,flags:A,adminId:x,randomId:I};116==g?N.refreshed=1:N.edited=Math.floor(Date.now()/1e3),Et.onEditMsg(N)}else Et.onNewMsg({peerId:j,msgId:k,authorId:L,text:C,date:P,hasAttachments:M,flags:A,adminId:x,randomId:I,isService:R,keyboard:B});continue}var D=window.vk,H=2&A?D.id:v[7]&&v[7].from||w,U=v[7]&&v[7].source_act;h||(h=!!need("PinnedMsg").getByMsgId(b));var V=v[7].from_admin||U||h?null:mail.getMsgHTML(b,A,w,v[4],v[5],v[6],v[7],116!=g?y:"");if(V&&(y?mail.replaceMessage(w,b,H,V):u()||mail.addMessage(w,b,H,V),2&A||nav.getQuery("community")||s(!1,1)),"chat_kick_user"===U&&v[7].source_mid==D.id){var F=v[3];mail.unpinMessage(F)}V&&"chat_pin_message"!==U&&"chat_unpin_message"!==U||p.push({peer:w,msg_id:b,from_id:H,source_act:U,edited:y})}}else{var W=v,q=W[1],z=W[2];if(!window.isNewMail)continue;11==q&&Et.onPeerKeyboard(z),10==q&&Et.onPeerBanner(z)}else s(b);else{if(window.isNewMail){var Y=v[1],G=v[2];6===g?Et.onMsgReadByMe(G,Y):Et.onMsgReadByOther(G,Y);continue}mail.markPeerAsRead(b,A,7==g)}else{if(window.isNewMail){Et.onOnlineChange({userId:-b,isOnline:!1,lastActionTime:w});continue}mail.updateOnline(-b,0)}else{if(window.isNewMail){Et.onOnlineChange({userId:-b,isOnline:!0,onlinePlatform:7===(A||7)?"desktop":"mobile"});continue}mail.updateOnline(-b,A||7)}else{if(window.isNewMail){var Q=2e9+A,K=b;Et.onTyping(Q,K);continue}mail.typing(2e9+A,b)}else{if(window.isNewMail){var X=b,$=b;Et.onTyping(X,$);continue}mail.typing(b)}}if(p.length){var J=[];each(p,(function(e,t){J.push(t.msg_id)}));var Z={_ajax:1,act:"get_messages",msgs:J.join(","),community:nav.getQuery("community")};h&&(Z.force_pinned=1),ajax.post("/mail",Z,{onDone:function(e,t){var n=window.cur,i=u();each(p,(function(t,n){var a=e[n.msg_id],o=n.peer;a.text&&!i&&(n.edited?mail.replaceMessage(n.peer,n.msg_id,n.from_id,a.text):mail.addMessage(n.peer,n.msg_id,n.from_id,a.text)),a.unpin&&mail.unpinMessage(o),a.pinned&&mail.pinMessage(o,a.pinned)})),t&&(t.play_animation_msg_id&&StickersAnimation?StickersAnimation.loadStickerInMvkIMAndPlay(t.play_animation_msg_id):(extend(n,t),mail.updateStickers()))}})}}return!0}}}(),Tt=Et,It=n("WwUR");window.isNewLongpoll?window.im=It.a:window.im=Tt;n("gNTM"),n("eoxF");var Mt=n("j80l"),Pt=n("y/eL");function xt(){var e=nav.cur||window.location.pathname||"",t=location.protocol+"//"+location.host+e,n=window.page.lastTrackedPage&&window.page.lastTrackedPage!==t?location.protocol+"//"+location.host+window.page.lastTrackedPage:"";window.page.lastTrackedPage=e,Object(Pt.a)(t,n)}var Lt=n("Fbxv"),Rt={};function Bt(e){var t,n,i;Bt.getQueryREs=re;var a,s,c,l,u,_,p,h,f,m,v,g,b,A=!1,w=[],y={},O={},k={},j={},S=!1,E=null,T=null,I=null,M=0,P=[],L=null,R=null,B=null,N=!1,D=!1,H=10,U=[],V=!0,q=!1,Y=!1,G=!1,Q={},K=[],X=!1,$="",J=!1,Z=null,ee=0,te=0,ne=!1,ie={},ae=e&&"AudioSectionSearch_field"===e.field,oe=Wd.elem({class:["show_next_wrap","show_next_wrap_transparent"],inner:{class:"show_more_loading",inner:{tag:"i",class:"i_loading",inner:""}}});function re(e){var t,n,i;e=e.replace(/https?:\/\/(m\.)?vk\.com\/([^#]+#\/)?/,"");for(var a=D,r=[e,n=Object(o.Sb)(e,a)||e,i=Object(o.Rb)(e,a)||e,Object(o.Qb)(n),Object(o.Ob)(i)],s={},c=[],l=0,u=r.length;l<u;l++)r[l]&&!s[r[l]]&&(s[r[l]]=!0,t=(t=Object(o.H)(r[l])).replace(/[её]/gi,"[её]").replace(/(e|yo)/gi,"(?:e|yo)"),c.push(new RegExp("(^|\\s|\\(|>)("+t+")","gi")));return c}function se(e){return void 0===e&&(e=""),"_"+e+(Q&&Object(o.Bb)(Q)?JSON.stringify(Q):"")}function ce(e,n,i,r){if(clearTimeout(T),!i)return T=setTimeout((function(){ce(e,n,!0)}),10),!1;var s=Object(o.zc)(e)||"";if(E===s&&!r)return!1;var c,l=se(s),u=O[l],d=re(s);if(!ae&&!u&&s.length>2&&O["_"+s.slice(0,-2)]){var v="_"+s.slice(0,-2);O[v]&&j[v]&&!O[v].length&&(!G||G&&!k[v])&&(j[l]=!0,u=O[l]=[],G&&(k[l]=""))}r&&(delete j[l],delete O[l],delete k[l]);var g=0;if(!u){u=[];if(Nt.isCachedPage)g=(Object(o.O)("_si_container",a)||a).childNodes.length;if(!s&&w.length)for(var b=M,A=M+Math.min(Math.max(H,g),w.length);b<A;b++)u.push([w[b]]);else{var P={},x=0;for(b=0,A=w.length;b<A;b++){var L=w[b];if(y[L]){if(P[L]=!0,(c=_e(d,y[L][0]))&&(u.push([L,c]),++x>=30))break;0}}if(x<30)for(var L in y)if(!P[L]&&(c=_e(d,y[L][0]))){if(u.push([L,c]),++x>=30)break;0}}j[l]=j[l]||!s&&w.length||u.length>2*H,j[l]=j[l]||G&&u.length>H}var R=!h||!!s;(!j[l]&&(V||G)||r)&&!p&&R&&function e(n,i,r){var s=ae?800:200;if(clearTimeout(I),!r)return I=setTimeout((function(){e(n,i,!0)}),s),!1;Object(C.b)("mvk_quick_search_canceled_requests")&&null!==Z&&(ue("aborted",i),Z.abort());Z=window.ajax.post(t,Object(o.K)({_ajax:1,q:i},Q),{onDone:function(e,t,r){var s;"string"==typeof f?(s=Wd).handle2.apply(s,[[f],null].concat(Array.prototype.slice.call(arguments),[i,a])):f&&f.apply(void 0,Array.prototype.slice.call(arguments).concat([i,a]));for(var c,l=se(i),u=O[l]||[],d={},p=re(i),h=0;h<u.length;h++)d[u[h][0]]=!0;for(var m=0;m<t.length;m++){var v=t[m];d[v]||((c=_e(p,e[v][0]))||N||!i)&&u.push([v,c])}j[l]=!0,O[l]=u,G&&(k[l]=r||""),y=Object(o.K)(e,y),ie._cache=y,V=!q||Object(o.Bb)(y)<q,E===i?(pe(u,k[l]),Object(o.Lb)(),xt()):delete O[l],V||Object(o.Yb)("input_loading",n),_&&(V=!1,q=Object.keys(y).length),ue("successful",i),Z=null},onFail:function(){var e=se(i);delete O[e],Object(o.Yb)("input_loading",n),ue("failed",i)}}),ue("sent",i),Object(o.O)("al_loading",a)||Object(o.a)("input_loading",n)}(e,s),O[l]=u;var B=E!==s;if(E=s,pe(u,k[l]),"string"==typeof m?Wd.handle2([m],null,s,a):m&&m(s,a),(Y||!E||B)&&(ee=Math.max(H,g)),X&&S){var D=Object(Mt.c)(nav.cur),U=Object(o.Ub)(D.search.replace("?","")),W=Object.keys(U).reduce((function(e,t){return K.includes(t)?e[t]=Q[t]:K.includes(t)||(e[t]=Object(o.vb)(e[t])?U[t]:e[t]),e}),Object(o.K)(Object(o.r)(Q),{q:s})),z=Mt.a.make(nav.path,Object(F.a)({act:W.act},W)),$=Object(o.K)(nav.page_get(nav.cur)||{},{page:Object(o.M)("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}});nav.set({replace:!0,nav:Object(o.K)({},nav,{cur:nav.path,path:nav.path||"",push:z||"",params:Object(o.Ib)(W).replace("?","")||""})}),page.save(z,$)}return Object(o.Lb)(),!1}function le(e){void 0===e&&(e="");var t=e.length;if(t<10)return t.toString();var n=t.toString().length,i=Math.pow(10,n-1),a=Math.floor(t/i)*i;return a+" - "+(a+i)}function ue(e,t){void 0===t&&(t=""),Object(C.b)("mvk_quick_search_canceled_requests_stats")&&Object(x.d)({name:"mvk_quick_search_requests",value:window.vk.id,keys:[e,le(t),$,window.cur.module]})}function de(){var e=a&&a.querySelector(".show_next_wrap");e&&e.remove()}function _e(e,t){if(!t)return!1;"string"!=typeof t&&(t=t.toString());var n=[t],i=/([№])/gi;-1!==t.search(i)&&n.push(t.replace(i,""));for(var a=0;a<n.length;a++)for(var o=0,r=e.length;o<r;o++)if(-1!==n[a].search(e[o]))return e[o];return!1}function pe(e,t,n){var i="";if(R&&a){var c=Object.keys(U).filter((function(e){return!!U[e]})).map((function(e){return e+""}));c.length&&""===E&&(e=e.filter((function(e){return!c.includes(String(e[0]))})),c.forEach((function(t){e.unshift([t,!1])})));for(var d=function(t){var n=e[t],a=n[0],o=n[1];if(!y[a])return"continue";var r=y[a].slice(1);if(o)for(var s in P){var c=P[s];r[c]&&(r[c]=r[c].replace(o,'$1<em class="found">$2</em>'))}i+=R.apply({id:a,q:E,highlight:function(e){if("string"!=typeof e)throw new Error("Highlighting expected string but got "+typeof e);return e.replace(o,'$1<em class="found">$2</em>')},template:function(e,t){var n=this;return e.replace(/%(\d+)%|#(\d+)#/g,(function(e,i,a){return a&&t[a-1]?n.highlight(t[a-1]):i&&t[i-1]?t[i-1]:""}))}},r)},_=0;_<e.length;_++)d(_);if(!i&&!j[se(E)]&&(V||G)&&!p){de(),Object(o.Yb)("_si_container_loading",a);var h=Wd.html({class:"al_loading qs_loading",inner:Object(W.a)(Object(Lt.a)())});i=E?h:'<div id="al_loading"></div>'}if(!i&&B&&(i=B(E)),Object(o.Yb)("input_loading",s),n&&(i+=n),t||i!==b||J){var f=L?L(i,E,Y,t):i+(t||"");Object(o.zc)(a,f)}if(b=i,l){var m=Object(z.a)('[data-prefix="'+$+'"]');m&&m.classList.toggle("qs_with_clear",!!E)}u&&Object(o.uc)(u,!!E),!E&&Object(r.a)(),Object(z.a)(".al_loading",a)&&(ne=!0),v&&v(E)}}Object(o.K)(this,{go:function(e){return!s||(ce(s,e,!0,!0),s.blur(),Object(o.j)(e),!1)},redraw:function(){var e=se(E);pe(O[e],k[e]),Object(o.Lb)()},clear:function(e,t){return Object(o.zc)(s,""),t?Object(o.F)(s):Object(o.E)(s),this.setSearchParams({}),this.go(e),Object(o.j)(e),!1},blur:function(){Object(o.E)(s)},toggleAttach:function(e,t){U[e]=t},setSearchParams:function(e){var t=Object(o.r)(Q);if(isArray(e)){var n=nav.getQuery()||{};Q=Object(o.K)(Q,e.reduce((function(e,t){var i=n[t];return i&&(e[t]=i),e}),{}))}else Q=e;var i=JSON.stringify(t)!==JSON.stringify(Q);this.onSearchParamsChange(Q,t,i);var a=Object(z.a)('[data-prefix="'+$+'"]');if(a){var r=Object(z.a)(".filter_btn",a);r&&(Object(o.uc)(r,!!E),S&&i&&(y={}))}},getSearchParams:function(){return Q},onSearchParamsChange:Object(d.a)(),init:function(e){var r=this;if(e=e||{},a=Object(o.M)(e.container)||null,s=Object(o.M)(e.field)||null,c=Object(o.M)(e.btn)||null,l=Object(o.M)(e.clear_btn)||null,u=Object(o.M)(e.filter_btn)||null,E=null,!Object(o.g)(a,"data-qsearch-inited")){if(!S||t!=e.action||!e.init_once){O={},k={},j={},t=e.action||"",A=null!==e.next_from,i=e.next_from,n=e.al_action||t,w=e.top_items||[],y=e._cache||{},J=e.forceRerender||!1,P=e.hl_fields||[],L=e.tpl||null,R=e.item_tpl||null,B=e.null_tpl||null,N=e.soft_filter||!1,D=e.need_invalid_keys||!1,H=e.top_len||10,q=e.load_limit||!1,f=e.onLoaded||!1,m=e.onFiltered||!1,v=e.onRendered||!1,g=e.onFocusChanged||!1,Y=e.al_need||!1,M=!Y&&e.init_offset||0,G=e.global_search||!1,p=e.no_search_query||!1,h=e.search_non_empty_query||!1,_=e.load_once||!1,X=e.updateQuery||!1,K=e.availableSearchParams||[],$=e.prefix||"";var d=e.action+e.container;Rt[d]?ie=Rt[d]:(ie._cache=y,ie.top_items=w,Rt[d]=ie),Nt.isCachedPage&&(w=ie.top_items,y=ie._cache,i=ie.next_from),K.length&&(this.setSearchParams(K),window.onDOMReady((function(){r.setSearchParams(K),Object(o.Jb)((function(){r.setSearchParams(K)}))})))}var b=null;t&&a&&s&&R&&(V=!0!==t&&(!q||Object(o.Bb)(y)<q),Object(o.b)(s,"focus",(function(e){e&&e.preventDefault();clearTimeout(b),g&&g.call({q:E},!0),function t(n){!n&&ce(s,e,!0),b=setTimeout(t,100)}(!0)})),Object(o.b)(s,"keydown keypress change blur",(function(e){"blur"==e.type&&(clearTimeout(b),g&&g.call({q:E},!1)),ce(s,e,"keydown"!=e.type&&"keypress"!=e.type)})),e._new||c&&!Object(o.g)(c,"onclick")&&Object(o.g)(c,"onclick","return qsearch.go(event);"),!Y||S&&e.init_once||(ee=H,te=Object(o.Bb)(y),Object(o.kb)((function(){var e=(Object(o.O)("_si_container",a)||a).childNodes;return e[ee]||e[e.length-1]}),(function(){var e=Object(o.O)("_si_container",a)||a;if(!ne&&!E)if(A?!!i:ee+H>te&&V)ne=!0,a&&a.append(oe),Object(o.a)(e,"_si_container_loading"),window.ajax.post(n,{_ajax:1,offset:te,next_from:i,q:E},{onDone:function(n,a,r,s){i=r;var c,l=s?s.needLoad:void 0,u=s&&s.html||"";"string"==typeof f?(c=Wd).handle2.apply(c,[[f],null].concat(Array.prototype.slice.call(arguments))):f&&f.apply(void 0,arguments);var d=Object(o.Bb)(n);if(ne=!1,de(),Object(o.Yb)(e,"_si_container_loading"),q||(w=w.slice(0,te).concat(a),ie.top_items=w),te+=d,y=Object(o.K)(n,y),ie._cache=y,ie.next_from=i,V=!0!==t&&(!q&&d||Object(o.Bb)(y)<q),!1===l&&(V=!1),!E){ee+=H;for(var _=[],p=0,h=Math.min(ee,w.length);p<h;p++)_.push([w[p]]);pe(_,k._,u),Object(o.Lb)()}},onFail:function(){ne=!1,de(),Object(o.Yb)(e,"_si_container_loading")}});else if(ee<w.length){ee+=H;for(var r=[],s=0,c=Math.min(ee,w.length);s<c;s++)r.push([w[s]]);pe(r,k._),Object(o.Lb)()}}))),e.common_cache&&(e.common_cache&&e.common_cache._gq_cache&&(k=e.common_cache._gq_cache),e.common_cache._q_loaded&&(j=e.common_cache._q_loaded)),!e.skip_init_filter&&ce(s,null,!0),Object(o.g)(a,"data-qsearch-inited",!0),S=!0)}}}),e&&this.init(e)}var Nt=new Bt;window.QuickSearch=Bt,window.QuickSearchCache=Rt,window.qsearch=Nt;var Dt={onClose:Object(d.a)(),inited:!1,width:!1,height:!1,onResize:null,_lastNav:!1,_opened:!1,_destroy:!1,init:function(){Dt.inited||(Dt.inited=!0,Dt.initEvents())},initEvents:function(){var e=function(e){Dt.fixHeight(vkNow()+2e3,e)};addEvent(window,"orientationchange",e),onBodyResize(e),e(!0)},opened:function(){return hasClass("z_opened",window.bodyNode)!==Dt.opened&&toggleClass("z_opened",window.bodyNode,Dt._opened),Dt._opened},toggle:function(e,t){return!!checkEvent(e)||(Dt.opened()?Dt.close(e,t):Dt.open(e,t),!1)},open:function(e,t){return!!checkEvent(e)||(Dt.opened()||(thover.clear(),Dt.init(),Dt._st=scrollTop(),Dt._lastNav=!1,addClass("z_opened",window.bodyNode),Dt._opened=!0,Dt.fixHeight(vkNow()+2e3,!0),scrollTop(0)),!1)},close:function(e,t){return!!checkEvent(e)||!!Dt.opened()&&(thover.clear(),val("z",""),removeClass("z_opened",window.bodyNode),Dt._lastNav={cur:nav.cur,path:nav.path,params:nav.params,hash:nav.hash},Dt._opened=!1,Dt._destroy&&(Dt._destroy(),Dt._destroy=!1),scrollTop(Dt._st,1),Dt._st=!1,Dt.onResize=null,Dt.onClose(),!1)},updateSize:function(){var e=ge("z");e&&e.offsetWidth&&e.offsetHeight&&(Dt.width=e.offsetWidth,Dt.height=e.offsetHeight,Dt.onResize&&Dt.onResize())},fixHeight:function(e,t){if((Dt._opened||t)&&(e&&!(vkNow()>e)||t)){var n=getCw(),i=getCh();(Dt._lastWidth!=n||Dt._lastHeight!=i||t)&&(Dt._lastWidth=n,Dt._lastHeight=i,setStyle("z","height",i),Dt.updateSize(),scrollTop()||scrollTop(0)),clearTimeout(Dt._fixTo),Dt._fixTo=setTimeout(Dt.fixHeight,50,e)}},create:function(e,t){val("z",e),Dt._destroy=t}};window.zlayer=Dt;var Ht=n("rc7J"),Ut=n("GVTI"),Vt="photo",Ft="audio",Wt=n("6Rqf"),qt=n("xAJ7");function zt(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText;return t.remove(),n}var Yt=n("3W//"),Gt=n("vWwi");window.photo=function(){var e,t,n,i,a,o,r,s,c,l,u=4,_=!1,p={},h={},f={},m=null,v=null,g=!1,b=null,A=null,w=!0,O=0,k=!1,j=!1,S=!1,E=Object(C.b)("mvk_mediaview");function T(){if(!(e=Object(z.a)(".PhotoviewPage")))return nav.al_go(nav.cur),!1;if(geByClass1("pv_summary",e),geByClass1("photo_msg",e),r=geByClass1("pv_tag_wrap",e),n=geByClass1("PhotoviewPage__thumb",e),t=geByClass1("pv_nav",n),o=geByClass1("PhotoviewPage__photo",e),a=Object(z.a)(".PhotoviewPage__photo img",n),geByClass1("pv_footer",e),_=hasClass("pv_touch_full",e),t){var u=geByClass1("pv_nav_left",t),d=geByClass1("pv_nav_z",t),p=geByClass1("pv_nav_right",t);s=geByClass1("pv_nav_link",u),l=geByClass1("pv_nav_link",d),c=geByClass1("pv_nav_link",p),attr(s,"onclick","return photo.prev(event);"),attr(c,"onclick","return photo.next(event);"),attr(i,"onclick",!_&&"return photo.next(event);"),ajax.prepare_click([s,c,i])}return removeEvent(window,"orientationchange",H),addEvent(window,"orientationchange",H),removeEvent(window,"keydown",U),addEvent(window,"keydown",U),removeEvent(window,"resize",V),addEvent(window,"resize",V),PostPhotoRestriction.onClear.off(V),PostPhotoRestriction.onClear(V),!0}var I=!1;function M(t){void 0===t&&(t=[]);var n,i=[];(t.id&&(t=[t]),Object.keys(t).forEach((function(e){var n=t[e];if(!n)return!0;i.push(p[n.id]=n)})),Object.keys(h).forEach((function(e){h[e]=h[e].map((function(e){return p[null==e?void 0:e.id]||e}))})),v&&h[v]&&(m=L(v)),E)&&(null==(n=Object(Yt.b)())||n.setItems(B(m,v)),function(){if(!m)return;var e=m.filter((function(e){return!e||!e.isDeleted}));e.length!==m.length&&(clog("Filter deleted"),delete h[v],x(v,e,e.length))}());return m&&window.photoview&&!E&&window.photoview.saveSource(R(m)),e&&!E&&W(O,!0),i}function P(e){return p[e]||{}}function x(e,t,n){var i;if(null!==t){n=n||len(t),h[e]||(h[e]=new Array(n),E&&h[e].fill(null)),Object(Yt.b)()&&E&&Object(Yt.b)().setItemsCount(n);var a=h[e];g&&a.reverse(),extend(a,t),M(t),a=h[e],g?(m=copy(a),a.reverse()):m=a,Object(Yt.b)()&&E&&!0!==(null==(i=m[0])?void 0:i.original_src)&&Object(Yt.b)().setItems(B(m,e))}else delete h[e]}function L(e){if("string"!=typeof e)return e;var t=h[e]||[];return g?copy(t).reverse():t}function R(e){var t=L(e),n=new Array(t.length);E&&n.fill(null);var i=qs2obj(nav.params);for(var a in delete i.z,t){var o=m[a],r="";if(o){var s="";o.hash&&(s=obj2qs({hash:o.hash,mp4:!0})),o.isDoc?(r="doc"+o.id+s,n[a]={id:o.id,photo_url:"/"+r,src:o.original_src,isDoc:!0,hasVideo:o.hasVideo}):(r="photo"+o.id+"?list="+v+(g?"&rev=1":"")+(A?"&from="+A:""),n[a]={id:o.id,photo_url:"/"+r,like_url:"/like?act="+(o.likes_me?"del":"add")+"&object=photo"+o.id+"&from="+encodeURIComponent(r)+"&list="+v+"&hash="+o.like_hash,likes_me:o.likes_me,src:o.original_src,max_src:o.max_src,tags:o.tags,caption:o.caption,likes_cnt:o.likes_cnt,replies_cnt:o.replies_cnt,market_tags:o.market_tags,restriction:o.restriction})}}return n}function B(e,t){return e.map((function(e){return function(e,t){var n,i,a,o,r,s;if(void 0===t&&(t=null),!e)return null;var c=e.tags&&Object.keys(e.tags).map((function(t){var n=e.tags[t];if("number"!=typeof n){var i=n[0];return{layout:"user",id:t,description:"",left:i[0],top:i[1],width:i[2],height:i[3],avatar:n[4],text:zt(n[1]),appereance:{arrow:!!n[2]}}}})).filter((function(e){return!!e})),l=null==(n=e.market_tags)||null==(i=n.tags)?void 0:i.map((function(e,t){return{layout:"market",id:"market_"+t,left:100*e.x,top:100*e.y,width:0,height:0,title:zt(e.title),text:e.price}})),u=null;!("block"!==(null==(a=e.restriction)?void 0:a.type)&&("blur"!==(null==(o=e.restriction)?void 0:o.type)||window.PostPhotoRestriction.isCleared("photo"+e.id)))&&(u={type:e.restriction.type,text:"blur"===e.restriction.type?e.restriction.title:e.restriction.text});var d=document.createElement("div");d.innerHTML=e.description||"",d.innerHTML+=e.caption||"";var _=Object(z.a)(".pi_text_more",d);_&&_.removeAttribute("onclick"),d.remove();var p=e.original_src||e.photo,h=e.photo&&e.original_src&&!0!==e.original_src;return{id:e.id,src:"boolean"==typeof p?"":p,description:d.innerHTML||"",type:1,list_id:t,tags:c,overlayTags:l,restriction:u,hasContextMenu:!0,action:(null==(r=e.market_tags)||null==(s=r.tags)?void 0:s.length)?{icon:null,text:window.lang.mobile_photos_show_market_items}:null,counters:h?{likes:{state:!!e.likes_me,count:+e.likes_cnt},replies:{state:!1,href:"/photo"+e.id+"?list={list_id}",count:+(e.replies_cnt||0)},shares:{count:+e.share_cnt}}:null}}(e,t)}))}function N(e,t){for(var n in t||(t=m),t){var i;if((null==(i=m[n])?void 0:i.id)==e)return+n}return-1}function H(){nav.hash||onDOMReady((function(){if(geByClass1("photo_view")){var e=scrollTop();n&&getY(n)<e&&scrollToEl(n)}}))}function U(e){if(zlayer.opened())return!1;switch(e.which){case 37:e.preventDefault(),photo.prev();break;case 39:e.preventDefault(),photo.next()}}function V(t){e&&document.body.contains(e)&&(document.activeElement&&["INPUT","TEXTAREA"].includes(document.activeElement.tagName)||isVisible(Object(z.a)("#stickers_panel"))||W(O,!0))}function W(t,d,p){var h=window.cur,v=window.lang,y=m[t],k=1==m.length;if(y){var j;nav.hash?scrollToHash(nav.hash):H();var S={};b&&(S.list=b),g&&(S.rev=1),A&&(S.from=A);var C=obj2qs(S),E="photo"+y.id+C,T=y.photo,I=(Q(t-1)||{}).id,M=(Q(t+1)||{}).id;if(k||(o&&(o.href="/photo"+M+C),s&&(s.href="/photo"+I+C),c&&(c.href="/photo"+M+C),ajax.prepare_click([s,c,i])),_){var P="photo"+y.id+"/"+b+(g?"/rev":""),x=extend({},S,{z:P}),L="/photo"+y.id+obj2qs(x);if(zlayer._lastNav){var R=zlayer._lastNav;(x=qs2obj(R.params)).z=P,L=R.path+obj2qs(x)+R.hash}l&&(l.href=L),ajax.prepare_click(l),attr(l,"onclick","return photo.fullscreen('"+escapeAttr(L)+"', event);")}if(a&&a.src!=T){a.onload=null,remove(a);var B;B=Wd.html(Object(Ut.a)(y.tags)),val(o,'<img src="'+(T||"/images/blank.gif")+'" alt="" class="ph_img" />'+B),a=geByTag1("img",o)}toggleClass("photo_deleted",e,!!y.deleted),toggleClass("pv_one_photo",n,1==m.length),val(r,y.tag_info||"");var N=(Ot.a.getStickerPanel()||"").split("photo-0_0").join("photo"+y.id),D=y.comments_html||"";N&&(D=D.split("\x3c!--stickers_panel--\x3e").join(N)),e.classList.toggle("PhotoviewPage--deleted",!!y.isDeleted),e.childNodes[0].setAttribute("id","photo"+y.id);var U=Object(z.a)(".wi_like_wrap",e);U&&(U.innerHTML=y.liked_people||"",U.classList.toggle("is_empty",!y.liked_people));var W,q=Object(z.a)(".PhotoviewPage__restrictedInfo"),Y=!!(y.restriction&&"block"===y.restriction.type||y.restriction&&"blur"===y.restriction.type&&!PostPhotoRestriction.isCleared("photo"+y.id));Y&&(W=Object(F.a)({},y.restriction,{forceText:!0,raw:"photo"+y.id,width:getW(o),height:getH(o)}),a.complete||a.onload||(a.onload=V)),e.classList.toggle("pv_touch--hideZOpen",Y),toggle(q,Y),o.classList.toggle("PhotoviewPage__photo--block",!(!W||"block"!==W.type)),o.classList.toggle("PhotoviewPage__photo--blur",!(!W||"blur"!==W.type)),Y&&q&&(q.innerHTML=Wd.html(PostPhotoRestriction(W)));var G=Object(z.a)(".wi_buttons",e);val(G,y.like_buttons||"");var X=Object(z.a)(".AlbumInfoRow",e);X&&(X.outerHTML=Wd.html(Object(Ht.a)({url:y.album_href,author_url:y.author_href,avatar:y.avatar,id:y.owner_id,name:y.owner_name,title:Wd.wrap(y.album_title),subtitle:Wd.wrap(y.album_info_subtitle),withoutBottomBorder:!y.has_replies})));var $=Object(z.a)(".PhotoviewPage__description",e);if($){y.description&&y.description,$.innerHTML=y.description,$.classList.toggle("PhotoviewPage__description--empty",!y.description)}var J=Object(z.a)(".PhotoviewPage__caption",e);if(J){var Z="";y.caption&&(Z+=y.caption),val(J,Z)}var ee=Object(z.a)(".Replies");ee&&(ee.outerHTML=y.replies_html);var te=Object(z.a)(".RepliesField"),ne=Ot.a.getStickerPanel();te&&y.reply_field_html&&ne&&(te.outerHTML=y.reply_field_html.replace("\x3c!--stickers_panel--\x3e",ne));var ie=Object(z.a)("#mhead .HeaderSubtitle__subtitle");ie&&(ie.innerHTML=v.mobile_photos_photo_header.replace("%s",O+1).replace(/%s|{count}/,m.length));var oe=ge("photo_actions");if(oe&&(oe.innerHTML=Wd.render(y.actions)),null==(j=nav.getQuery())?void 0:j.description_expanded){var re=Object(z.a)(".pi_text_more",$);re&&re.click()}if(post.stickersInit(),h.replyTo=0,ajax.refreshLinks(y.fv_link,y.app_link),photo.closeTags(),!d){var se="/"+E;nav.go(se,null,{no_push:d,push_only:!0,replace:p}),page.save(se,{st:scrollTop(),page:ge("m"),state:page.stash(),cur:window.cur,options:{replacePrevPage:!0}},!1)}setTimeout((function(){var e=Object(ae.y)("autoload")||{};Replies.init(e.enable||!1,y.author_id||y.owner_id)}))}w||(K(),function(){for(var e=0,t=O+1;e<u;e++){var n=Q(e+t),i=n&&n.photo;if(i&&!f[i]){var a=f[i]=new Image;a.src=i,a.onload=function(){f[i]=!0}}}}())}function q(e,t){void 0===t&&(t={});var n=t,i=n.isDoc,a=n.hash,o=n.hasVideo,r=window.photoview,s=m[e];m.length;if(!t.no_open||S){if(s){var c=qs2obj(nav.params);if(c.z=i?"doc"+s.id+"/"+a:"photo"+s.id+"/"+b+(g?"/rev":""),t.no_open||(t.local||t.crop||!E?(window.clog("Open Photoview"),r.open(e,R(m),{local:t.local,showControls:t.showControls,isDoc:i,hasVideo:o})):setTimeout((function(){Object(Yt.b)().setItemsCount(m.length),Object(Yt.b)().setItems(B(m,v)),Object(Yt.b)().mediaViewManager.setCurrentItemIndex(e),Object(Yt.b)().mediaViewManager.open(t.wrap)}))),!t.local&&!t.crop){var l=nav.path+obj2qs(c)+nav.hash;nav.go(l,null,{no_push:t.no_push,push_only:!0,replace:t.replace,nav_init:!E&&!t.no_open,nav_incr:!E&&!t.replace})}}t.local||t.crop||K(!0,i)}}function Y(e){void 0===e&&(e={});var t=qs2obj(nav.params);delete t.z;var n=!!t.z;if($$(".mediaview_target").forEach((function(e){return e.classList.remove("mediaview_target")})),S=!1,nav.onBeforeGo.off(X),e.preventHistoryBack)return!0;if(!e.local&&!e.crop){if(n&&history.length>1&&nav.tryHistoryBack())return clog("History back done"),!1;var i=nav.path+obj2qs(t)+nav.hash;nav.go(i,null,{push_only:!0,replace:E})}return!0}var G=!1;function Q(e){if(m)return e>0?e%=m.length:e=(100*m.length+e)%m.length,m[e]}function K(e,t){if(void 0===t&&(t=!1),G)clog("Prevent photos preload");else{for(var n=!1,i=1,a=0;a<5;a++){if(!(r=Q(o=a+O))||!r.owner_id){n=o,i=1;break}}if(!1===n)for(a=-1;a>-3;a--){var o,r;if(!(r=Q(o=a+O))||!r.owner_id){n=o,i=-1;break}}if(!1!==n){var s=Q(O);if(s){G=!0,show(void 0);var c=window.cur,l=s.owner_id||(s.id||"").split("_")[0],u=Gif.isMp4Supports()&&s.hasVideo,d=o==O&&s.id?(t?"/doc":"/photo")+s.id+(s.hash?"?hash="+s.hash:"")+(u?(s.hash?"&":"?")+"mp4":""):"/photos.php",_={_ajax:1,oid:l,list:v,offset:n,direction:i,rev:g?1:0};Ot.a.getStickerPanel()||(_.need_stickers=1),nav.getQuery("community")&&(_.community=nav.getQuery("community"));var p=!0===s.original_src||m.every((function(e){return!e||!e.owner_id||!e.max_src}));ajax.post(d,_,{onDone:function(t,n,i,a){if(s=Q(O),hide(void 0),G=!1,i&&(c.replyNames||(c.replyNames={}),extend(c.replyNames,i)),a&&extend(c,a),E&&Object(Yt.b)().setItemsCount(n),x(v,t,n||m.length),e){if(!S)return!1;E&&(p&&(O=N(s.id)),Object(Yt.b)().mediaViewManager.setCurrentItemIndex(O)),window.photoview&&!E&&window.photoview.saveSource(R(v),!1,!0)}else t.some((function(e){return(null==e?void 0:e.id)===s.id}))&&W(O,!0)},onFail:function(){return hide(void 0),G=!1,!1}})}else clog("Can't find current photo "+O)}else clog("Preload offset is false")}}function X(e,t,n){var i;if(!E)return!1;var a,o="string"==typeof e?e:e.href,r="string"==typeof o?qs2obj((null==(i=o.split("?")[1])?void 0:i.split("#")[0])||""):{};bt.f.test(r.z)||(null==(a=Object(Yt.b)())||a.mediaViewManager.close({preventHistoryBack:!0}))}function $(e,t,n,i,a){m=[];if(e){var o=gpeByClass("thumbs_list",e)||gpeByClass("wiki_body",e)||gpeByClass("thumbs_list",e)||gpeByClass("photos_page",e);o&&$$(".thumb_map_img_as_div, ._image, .ph_img",o).forEach((function(e,t){var n=domData(e,"id"),i=JSON.parse(domData(e,"restriction")),a=unescape(domData(e,"src_big"));if(!n||!a)return!0;var o=(a=a.split("|"))[0]||attr(e,"src"),r=+a[1]||0,s=+a[2]||0;m.push({id:n,original_src:o,width:r,height:s,restriction:i})}))}m.length||m.push({id:t,original_src:!0,isDoc:n,hasVideo:i,hash:a}),E&&(Object(Yt.b)().setItemsCount(m.length),Object(Yt.b)().setItems(B(m,v)))}function J(){addClass("pv_icons_hide",n)}return{save:M,get:P,saveSource:x,getSource:L,getCurrentListID:function(){return v},clear:function(){removeEvent(window,"resize",V),removeEvent(window,"orientationchange",H),removeEvent(window,"keydown",U)},open:function(e,t,n,i,a){if(checkEvent(n))return!0;if(!T())return!0;if(g=!1,"/rev"==t.substr(-4)&&(t=t.slice(0,-4),g=!0),A=i||null,t)v=t;else{var o=P(e);v=o.album?"album"+o.album:""}if(b=v,m=L(v),-1===(O=N(e,m))){if(!(o=P(e)).id)return!1;m=[o],O=0}w=m.length<2,!1;var r=m[O]&&e!=m[O].id;return W(O,a&&!r,r),!1},prev:function(e){return!!checkEvent(e)||!(G&&!Q(O-1))&&(!T()||(w?photo.close():(--O<0&&(O=m.length-1),W(O),J(),!1)))},next:function(e){return!!checkEvent(e)||!(G&&!Q(O+1))&&(!T()||(w||(++O>=m.length&&(O=0),W(O),J()),!1))},close:function(e,t){return!!checkEvent(e)},fullscreen:function(e,t){return!!hasClass("pv_photo_tags_selected",n)||nav.go(unescapeAttr(e),t,{need_restore:!0})},showIcons:function(){var e=geByClass1("PhotoviewPage","m");if(!e)return!1;setTimeout((function(){removeClass("pv_hidden_icons",e),setTimeout((function(){addClass("pv_icons_hide",e)}),2e3)}),10)},selectTag:function(e,t,i){if(i&&!hasClass("pv_photo_tags_selected",n))return!0;var a=ge("pv_tag"+e),o=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),r=ge("pv_tag_label"+e),s=geByClass1("pv_tag_label_selected","pv_tags_list");return hasClass("pv_tag_selected",a)||(removeClass("pv_tag_selected",o),addClass("pv_tag_selected",a)),hasClass("pv_tag_label_selected",r)?nav.go(r,t):(removeClass("pv_tag_label_selected",s),addClass("pv_tag_label_selected",r),addClass("pv_photo_tags_selected",n),cancelEvent(t),!1)},closeTags:function(e){if(!hasClass("pv_photo_tags_selected",n))return!0;var t=geByClass1("pv_tag_selected","pv_photo_tags_wrap"),i=geByClass1("pv_tag_label_selected","pv_tags_list");return t&&removeClass("pv_tag_selected",t),i&&removeClass("pv_tag_label_selected",i),removeClass("pv_photo_tags_selected",n),cancelEvent(e),!1},openDeletePhotoPopup:function(e,t){if(t){var n=Object(z.a)(".Popup_open");n&&Popup.close(n),e.preventDefault(),e.stopPropagation();var i=Object(qt.a)({title:Object(ae.t)("mobile_photos_delete_confirm_title"),text:Object(ae.t)("mobile_photos_delete_confirm_text"),buttons:{yes:{text:Object(ae.t)("mobile_delete"),href:t,onClick:"return ajax.click(this, PhotoDelete)"},no:{text:Object(ae.t)("mobile_cancel")}}}),a=Wd.elem(i);return Popup.open(a,!0)}},init:function(e,t,n,i,a,o,r){u=isUndefined(r.preload)?1:r.preload,g=!!a,photo.saveSource(e,t,n),onDOMReady((function(){photo.open(i,e+(a?"/rev":""),null,o,!0)}))},zopen:function(t,n,i,a,o){if(void 0===o&&(o={}),checkEvent(n))return!0;if(y.a.isIntegrated)return y.a.sendMessage("photo",{id:i+"_"+(o.key||"")}),!1;if(n&&n.isTrusted&&!o.forceUnauth&&!window.vk.id&&Object(C.b)("unauthorized_media_layer_box")&&document.querySelector(".PageBottomBanner--unauth"))return o.forceUnauth=!0,window.Unauthorized.showMoreBox(null,0,Vt,(function(){window.photo.zopen(t,n,i,a,o)})),!1;var r=o,s=r.isDoc,c=r.hasVideo,l=r.hash,u=(a||"").split("/"),_=u[0],p=u[1];return function(){var t=window.photoview;return t||E?j?Promise.reject():k?Promise.resolve():E?(window.clog("MediaView loading started"),Object(Yt.a)().then((function(){k=!0,Object(D.a)(bt.e,"init","photo");var e=L(v);e&&x(v,e,e.length),window.clog("MediaView loading done")})).catch((function(e){throw window.clog("MediaView loading failed"),e}))):(k=!0,t.onPhotoChange=function(e,t){O=e,q(e,t)},t.onClose=function(t){if(uRegisterFloatBtn.show(),!Y(t))return!0;var n=qs2obj(nav.params);e&&n.list==v&&W(O,!0)},Promise.resolve()):Promise.reject()}().then((function(){if(clog("z photoview initialized"),g="rev"===p,delete qs2obj(nav.params).z,A=o.from||!1,_)v=_;else{var n=P(i);v=n.album?"album"+n.album:""}b=v,(m=L(v))[0]&&m[0].isDoc&&m[0].hasVideo!==c&&(m=[]);var a=E?!!Object(Yt.b)():!!window.photoview;if(!m.length&&a&&$(t,i,s,c,l),-1===(O=N(i,m))&&a&&($(t,i,s,c,l),O=N(i,m)),-1===O){if(!(n=P(i)).id)return!0;m=[n],O=0}w=m.length<2,!1;var r=m[O]&&i!=m[O].id;q(O,{no_push:o.no_push&&!r,replace:r,local:o.local,showControls:o.showControls,isDoc:s,hasVideo:c,hash:l,wrap:t}),Object(d.b)(nav.onBeforeGo,X),function(){if(E&&!I){var t=Object(Yt.b)();if(!t)throw new Error("Subscribe to mediaview events before load");var n=t.actionBridge,i=[];window.clog("Subscribe MediaView events"),I=!0,i.push(n.handle("visibilityChanged",(function(t){var n=t.state,a=t.params,o=extend({},void 0===a?{}:a);if(!n&&S){Y({preventHistoryBack:o.preventHistoryBack});var r=qs2obj(nav.params);e&&r.list===v&&W(O,!0),window.clog("Unsubscribe MediaView events"),I=!1,i.forEach((function(e){return e()})),Object(Gt.b)(),Object(C.b)("mvk_mediaview_ios_fix")?Object(vt.d)():window.zlayer.close()}else n&&!S&&(S=!0,Object(C.b)("mvk_mediaview_ios_fix")?Object(vt.c)({topBanner:!1}):zlayer.open(),Object(Gt.a)(Object(z.a)("#MediaView_container")))}))),i.push(n.handle("getActionHrefs",(function(e){var t=e.item;return{replies:Object(Wt.a)("/photo"+t,{list:v,rev:g?1:0})+"#comments"}}))),i.push(n.handle("setItemIndex",(function(e){var t=Q(e);return!!t&&(O=e,q(e,{no_open:!0,replace:!0}),Promise.resolve({target:t?Object(z.a)('[data-id="'+t.id+'"]'):null}))}))),i.push(n.handle("repliesOpen",(function(e){var t=P(e.id);if(!t)return!0;var n=Object(Wt.a)("/photo"+t.id,{list:v,rev:g?1:0})+"#comments";return nav.go(n,null,{alMode:"photo"})}))),i.push(n.handle("tagClick",(function(e){var t=Q(O),n=t.tags,i=t.market_tags;if(e.startsWith("market")){var a=parseInt(e.split("market_")[1]),o=i.tags[a];o.url&&nav.go(o.url)}else{var r=n[e];r&&r[2]&&nav.go(r[2])}}))),i.push(n.handle("openContextMenu",(function(e){e.list;var t=P(e.item);t.actions?ve.a.open(Wd.elem(t.actions),null,{pureMenu:!0}):clog("Photo has no actions")}))),i.push(n.handle("unblurRestriction",(function(e){var t=e.item;return new Promise((function(e,n){var i=P(t),a=i.restriction;if(!a)return e(!1);window.PostPhotoRestriction.clear(null,null,a.text,a.button,"photo"+i.id,a.hash).then((function(t){var n,i=t.result,a=t.isFullyAvailable;(e(i),a)&&(null==(n=Object(Yt.b)())||n.mediaViewManager.unblurAllRestrictions())}))}))}))),i.push(n.handle("onActionClick",(function(e){var t,n,i=P(e.item);(null==(t=i.market_tags)||null==(n=t.tags)?void 0:n.length)&&(Object(D.a)(bt.e,"action","market"),window.ItemsList._openItemsPopup(escape(JSON.stringify(i.market_tags.tags))))})))}}(),E||(S=!0),uRegisterFloatBtn.hide()})).catch((function(){j=!0,i&&window.open(Object(Wt.a)("/photo"+i,{list:_,rev:"rev"===p?1:0}),"_blank")})),cancelEvent(n),!1},zclose:function(e,t){return uRegisterFloatBtn.show(),!!checkEvent(e)}}}();var Qt=function(){function e(){}return e.follow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_follow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.add("MusicAuthorCover__followBtn__followed"),a.onclick=function(o){o.preventDefault(),e.unfollow(t,n,i,a)}},onFail:function(){return unlockButton(a)}})},e.unfollow=function(t,n,i,a){lockButton(a),ajax.post("/audio",{_ajax:1,act:"artist_unfollow",ref:n,hash:i,artist_id:t},{onDone:function(i){unlockButton(a),a.classList.remove("MusicAuthorCover__followBtn__followed"),a.classList.contains("MusicAuthorCover__followBtn__canFollow")&&(a.onclick=function(o){o.preventDefault(),e.follow(t,n,i,a)})},onFail:function(){return unlockButton(a)}})},e.trackToOfficial=function(e,t){ajax.post("/audio",{_ajax:1,act:"artist_track_to_official",hash:e,url:t})},e}(),Kt=n("29dZ"),Xt=function(){function e(){}return e.follow=function(t,n,i){Kt.a.setDisabled(i,!0),ajax.post("curator.php",{_ajax:1,act:"follow",hash:n,curator_id:t},{onDone:function(n){Kt.a.setDisabled(i,!1),i.classList.add("MusicAuthorCover__followBtn__followed"),i.onclick=function(a){a.preventDefault(),e.unfollow(t,n,i)}},onFail:function(){return Kt.a.setDisabled(i,!1)}})},e.unfollow=function(t,n,i){Kt.a.setDisabled(i,!0),ajax.post("curator.php",{_ajax:1,act:"unfollow",hash:n,curator_id:t},{onDone:function(n){Kt.a.setDisabled(i,!1),i.classList.remove("MusicAuthorCover__followBtn__followed"),i.onclick=function(a){a.preventDefault(),e.follow(t,n,i)}},onFail:function(){return Kt.a.setDisabled(i,!1)}})},e}(),$t=n("lkNA"),Jt=n("rEJs"),Zt=0,en=1,tn=2,nn=3,an=4,on=5,rn=6,sn=8,cn=9,ln=10,un=11,dn=12,_n=13,pn=14,hn=15,fn=16,mn=17,vn=18,gn=19,bn=20,An=21,wn=22,yn=24,On=25,kn=2,jn=4,Sn=8,Cn=32,En=128,Tn=512,In=1024;function Mn(e){if(!e)return!1;var t=isObject(e)?e.extra:e[dn];return isObject(t)||(t=JSON.parse(t||"{}")),!!t.podcast}var Pn=function(){function e(e,t,n){this._isPlaying=!1,this._adsCurrentProgress=0,this._adman=null,this._admanLoaded=!1,this._adEvents=[],this.player=e||{},this.playerVersion=t||null,this._startAdsTO=null,this._adsConfig=null,this._duration=0,this.isMvk=Boolean(n),this.adsStatUrl=this.isMvk?"audio":"al_audio.php"}var t=e.prototype;return t.isPlaying=function(){return this._isPlaying},t.setAdsConfig=function(e){this._adsConfig=e},t.getCurrentProgress=function(){return this._adsCurrentProgress},t.getDuration=function(){return this._duration},t.loadAdman=function(t){var n=this,i=function(e){return t&&t(e)};if(this._admanLoaded)i();else{var a=0;Object($t.a)(e.ADMAN_SRC,{onLoad:function(){n._admanLoaded=!0,i()},onError:function(){window.abp?(n._admanLoaded=!0,i()):(3===(a+=1)&&(n._admanLoaded=!0),i("script_load_fail"))}})}},t._fetchAd=function(t,n,i,a,o){var r=this;this.loadAdman((function(s){if(!window.AdmanHTML)return r._sendEvent("no_adman",n,e.AD_TYPE,s),a&&a();r._adman=new AdmanHTML;var c=r._adsConfig||vk.audioAdsConfig||window.audioAdsConfig,l={_SITEID:276,ver:251116,vk_id:vk.id,duration:t.duration,content_id:xn(t.ownerId,t.id),vk_catid:e.CAT_IDS[n]||e.CAT_IDS.other,sign:c.sign||""};extend(l,t.ads||{}),nav.objLoc&&nav.objLoc.preview&&(l.preview=intval(nav.objLoc.preview)),cur.adsPreview&&(l.preview=1,l.vk_id=398724832),r._adman.setDebug(!!l.preview),r._adman.onError((function(){return a&&a()})),r._adman.onReady((function(){if(r._adman){var t=r._adman.getBannersForSection(e.AD_TYPE);t&&t.length?"statistics"===t[0].type?(r._play(!0,n),a&&a()):(r._sendEvent("received",n),i?(r._sendEvent("rejected",n,e.AD_TYPE,o),r.deinit(),a&&a()):(r._sendEvent("ready",n),r.player.notify(Jt.a.AD_READY),r._play(!1,n,a))):(i||r._sendEvent("not_received",n),a&&a())}})),r._adman.init({slot:3514,wrapper:r.isMvk?ce("div"):se("<div></div>"),params:l,browser:{adBlock:!!window.abp,mobile:!1}}),r._sendEvent("requested",n)}))},t._sendEvent=function(e,t,n,i){var a=this,o=n?"/"+n:"",r=i?"/"+i:"";this._adEvents.push(e+"/"+t+o+r),clearTimeout(this._adEventDelay),this._adEventDelay=setTimeout((function(){ajax.post(a.adsStatUrl,{act:"ad_event",events:a._adEvents.join(","),v:a.playerVersion,abp:intval(window.abp)},{onFail:function(){return!0}}),a._adEvents=[]}),500)},t._play=function(t,n,i){var a=this;this._adman.onCompleted((function(){a.deinit(!0),t?a._sendEvent("statistics",n):(a.player.notify(Jt.a.PROGRESS,0),a.player.notify(Jt.a.AD_COMPLETED),a._isPlaying=!1,a._adsCurrentProgress=0,a._sendEvent("completed",n),window.setDocumentTitle&&window.setDocumentTitle(a._adsPrevTitle),i&&i())})),this._adman.onStarted((function(){t||(a.player.setIsPlaying(!0),a.player.notify(Jt.a.PLAY),a.player.notify(Jt.a.PROGRESS,0),a.player.notify(Jt.a.AD_STARTED),a.updateVolume(),a._sendEvent("started",n),window.statlogsValueEvent&&statlogsValueEvent("audio_web_ad_link","show"))})),this._adman.onPaused((function(){a.player.setIsPlaying(!1),a.player.notify(Jt.a.PAUSE)})),this._adman.onPlayed((function(){a.player.setIsPlaying(!0),a.player.notify(Jt.a.PLAY)}));var o=[.25,.5,.75];if(this._adman.onTimeRemained((function(e){a._duration=isNaN(e.duration)?0:e.duration,a._adsCurrentProgress=(isNaN(e.percent)?0:e.percent)/100,a.player.notify(Jt.a.PROGRESS,a._adsCurrentProgress,a._duration),each(o,(function(e,t){if(a._adsCurrentProgress>=t)return o.shift(),a._sendEvent("progress_"+intval(100*t),n),!1}))})),this._adman.start(e.AD_TYPE),t)return i&&i();this._isPlaying=!0,this._adsPrevTitle=document.title,this.isMvk||setDocumentTitle(getLang("global_audio_ad"))},t.updateVolume=function(){this._adman&&this._adman.setVolume(.7*this.player.getVolume())},t.deinit=function(e){this._adman=null,!e&&this.player.notify(Jt.a.AD_DEINITED)},t.pause=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.pause())},t.stop=function(){this._adman&&(this.player.setIsPlaying(!1),this._adman.stop())},t.resume=function(){this._adman&&(this.player.setIsPlaying(!0),this._adman.resume(),this.player.notify(Jt.a.PLAY))},t.checkPlay=function(t,n){var i=this.player._getPlayingContextSection(),a=this._isAllowed(t),o=a.type,r=a.reason,s=function(){return n&&n()};switch(o){case e.ALLOW_ALLOWED:this._fetchAd(t,i,!1,s);break;case e.ALLOW_DISABLED:s();break;case e.ALLOW_REJECT:this._fetchAd(t,i,!0,!1,r),s()}},t._isAllowed=function(t){if(vk.widget)return{type:e.ALLOW_DISABLED};if(Mn(t))return{type:e.ALLOW_DISABLED};if(window.browser&&window.browser.safari)return{type:e.ALLOW_DISABLED};var n=this._adsConfig||vk.audioAdsConfig||window.audioAdsConfig;if(n){if(!n.enabled)return{type:e.ALLOW_DISABLED};if(cur.adsPreview)return{type:e.ALLOW_ALLOWED};if(n.day_limit_reached)return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_LIMIT};var i=this.player._getPlayingContextSection();return n.sections.indexOf(i)>-1?{type:e.ALLOW_ALLOWED}:{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_SECTION}}return{type:e.ALLOW_REJECT,reason:e.REJECT_REASON_UNKNOWN}},t.startPlay=function(e,t){this.checkPlay(e,t)},e}();function xn(e,t){for(var n=e.toString(16),i=t.toString(16);i.length<8;)i="0"+i;return n+i}Pn.ADMAN_SRC="//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",Pn.CAT_IDS={my:101,my_playlists:101,audio_feed:109,recent:113,user_wall:104,group_wall:104,user_list:102,group_list:103,user_playlists:102,group_playlists:103,feed:105,search:110,global_search:110,replies:104,im:106,group_status:104,user_status:104,recs:107,recs_audio:107,recs_album:107,other:114},Pn.AD_TYPE="preroll",Pn.ALLOW_DISABLED=1,Pn.ALLOW_ALLOWED=2,Pn.ALLOW_REJECT=3,Pn.REJECT_REASON_UNKNOWN="unknown",Pn.REJECT_REASON_LIMIT="track_limit_exceeded",Pn.REJECT_REASON_SECTION="section_not_allowed";var Ln=function(){function e(e){this.audioplayer=e}var t=e.prototype;return t.notify=function(e){var t,n=this.audioplayer.getCurrent();switch(e){case Jt.a.AD_COMPLETED:case Jt.a.AD_STARTED:this.audioplayer.notify(e,n);break;case Jt.a.PAUSE:case Jt.a.PLAY:this.audioplayer.notify(e,n.fullId);break;case Jt.a.PROGRESS:for(var i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(t=this.audioplayer).notify.apply(t,[e,n.fullId].concat(a))}},t.setIsPlaying=function(e){this.audioplayer.setIsPlaying(e)},t.getVolume=function(){var e=Object(o.nc)("audio_vol");return null===e?1:e},t._getPlayingContextSection=function(){return window.playerAdapter.getContext()},e}(),Rn=n("Po+v");function Bn(e,t){function n(e){var t=["Webkit","Moz","O","ms"],n=document.createElement("div");if(void 0!==n.style[e])return!0;for(var i in e=e.charAt(0).toUpperCase()+e.slice(1),t)if(void 0!==n.style[t[i]+e])return!0;return!1}function i(e,t){new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)||(e.className+=" "+t)}function a(e,t){e.className=e.className.replace(new RegExp("(\\s+|^)"+t+"(\\s+|$)","g")," ").replace(/^\s+|\s+$/g,"")}function o(e,t){0>e?e=0:e>v-1&&(e=v-1);for(var n=O.dots.length-1;n>=0;n--)a(O.dots[n],C.activeDot);return i(O.dots[e],C.activeDot),j=e,r(-e*O.width,void 0===t?S.speed:t),_(),S.onSlideChange&&S.onSlideChange(e),e}function r(e,t){var n=t?t+"ms":"";b.style.webkitTransitionDuration=b.style.MozTransitionDuration=b.style.msTransitionDuration=b.style.OTransitionDuration=b.style.transitionDuration=n,c(e)}function s(e,t){if(y&&clearInterval(y),t){var n=+new Date,i=O.left;y=setInterval((function(){function a(e,t){return(t-e)*s+e}var o,r,s=(+new Date-n)/t,l=[0,.7,1,1];return s>=1?(c(e),void clearInterval(y)):(o=e-i,r=a(a(a(l[0],l[1]),a(l[1],l[2])),a(a(l[1],l[2]),a(l[2],l[3]))),void c(Math.floor(r*o+i)))}),15)}else c(e)}function c(e){b.style.webkitTransform="translate("+e+"px,0) translateZ(0)",b.style.msTransform=b.style.MozTransform=b.style.OTransform=b.style.transform="translateX("+e+"px)",O.left=e}function l(e){b.style.left=e+"px",O.left=e}function u(){var e=j+1;return e>v-1&&(e=0),o(e)}function d(){w=!0,_()}function _(){w&&(A&&clearTimeout(A),A=setTimeout((function(){u()}),S.slideshowInterval))}function p(){A&&clearTimeout(A)}function h(){w=!1,A&&clearTimeout(A)}function f(){O.width=e.offsetWidth,b.style.width=O.width*v+"px";for(var t=0;v>t;t++)O.slides[t].style.width=O.width+"px";r(-j*O.width)}function m(e,t,n,i){t&&(e.addEventListener?e.addEventListener(t,n,!!i):e.attachEvent("on"+t,n))}var v,g,b,A,w,y,O={slides:[],dots:[],left:0},k=200,j=0,S={speed:300,touchSpeed:300,slideshow:!1,slideshowInterval:4e3,stopSlideshowAfterInteraction:!1,startSlide:0,mouseDrag:!0,disableIfOneSlide:!0,cssPrefix:"peppermint-",dots:!1,dotsPrepend:!1,dotsContainer:void 0,slidesContainer:void 0,onSlideChange:void 0,onSetup:void 0};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(S,t);var C={inactive:S.cssPrefix+"inactive",active:S.cssPrefix+"active",mouse:S.cssPrefix+"mouse",drag:S.cssPrefix+"drag",slides:S.cssPrefix+"slides",dots:S.cssPrefix+"dots",activeDot:S.cssPrefix+"active-dot",mouseClicked:S.cssPrefix+"mouse-clicked"},E={transforms:n("transform"),transitions:n("transition")};return function(){var t=S.slidesContainer||e,n=S.dotsContainer||e;if(!(S.disableIfOneSlide&&t.children.length<=1)){(!E.transforms||window.opera)&&(c=l),(!E.transitions||window.opera)&&(r=s),i(b=S.slidesContainer||document.createElement("div"),C.slides);for(var u=0,_=t.children.length;_>u;u++){var A=t.children[u],w=document.createElement("li");O.slides.push(A),w.setAttribute("tabindex","0"),w.setAttribute("role","button"),w.innerHTML="<span></span>",function(t,n){m(n,"click",(function(){o(t),S.stopSlideshowAfterInteraction&&h()})),m(n,"keyup",(function(e){13==e.keyCode&&(o(t),S.stopSlideshowAfterInteraction&&h())})),m(n,"mouseup",(function(){i(n,C.mouseClicked)})),m(n,"blur",(function(){a(n,C.mouseClicked)}),!0),m(A,"focus",A.onfocusin=function(){e.scrollLeft=0,setTimeout((function(){e.scrollLeft=0}),0),o(t)},!0)}(u,w),O.dots.push(w)}v=O.slides.length,100/v,i(e,C.active),a(e,C.inactive),S.mouseDrag&&i(e,C.mouse),O.width=e.offsetWidth,b.style.width=O.width*v+"px";for(u=0;v>u;u++)O.slides[u].style.width=O.width+"px",b.appendChild(O.slides[u]);if(S.slidesContainer||e.appendChild(b),S.dots&&v>1){i(g=document.createElement("ul"),C.dots);for(u=0,_=O.dots.length;_>u;u++)g.appendChild(O.dots[u]);S.dotsPrepend?n.insertBefore(g,n.firstChild):n.appendChild(g)}m(window,"resize",f),m(window,"orientationchange",f),setTimeout((function(){o(S.startSlide,0)}),0),S.slideshow&&d(),Nn(b,{mouse:S.mouseDrag,start:function(){i(e,C.drag)},move:function(e,t,n){p(),n.x=n.x/(!j&&n.x>0||j==v-1&&n.x<0?Math.abs(n.x)/O.width*2+1:1),r(n.x-O.width*j)},end:function(t,n,i){if(i.x){var r=Math.abs(i.x)/O.width,s=Math.floor(r)+(r-Math.floor(r)>.25?1:0);s+=i.time<k+k*s/1.8&&Math.abs(i.x)-s*O.width>(s?-O.width/9:20)?1:0,i.x<0?o(j+s,S.touchSpeed):o(j-s,S.touchSpeed),S.stopSlideshowAfterInteraction&&h()}a(e,C.drag)}}),setTimeout((function(){S.onSetup&&S.onSetup(v)}),0)}}(),{slideTo:function(e,t){return o(parseInt(e,10),t)},next:u,prev:function(){var e=j-1;return 0>e&&(e=v-1),o(e)},start:d,stop:h,pause:p,getCurrentPos:function(){return j},getSlidesNumber:function(){return v},recalcWidth:f}}function Nn(e,t){function n(e,t,n,a){return t?(e.addEventListener?e.addEventListener(t,n,!!a):e.attachEvent("on"+t,n),{remove:function(){i(e,t,n,a)}}):void 0}function i(e,t,n,i){t&&(e.removeEventListener?e.removeEventListener(t,n,!!i):e.detachEvent("on"+t,n))}function a(e){}function o(e){if((m={x:(_?e.clientX:e.touches[0].clientX)-f.x,y:(_?e.clientY:e.touches[0].clientY)-f.y,time:Number(new Date)-f.time}).time-g[g.length-1].time){for(var t=0;t<g.length-1&&m.time-g[t].time>80;t++);v={x:(m.x-g[t].x)/(m.time-g[t].time),y:(m.y-g[t].y)/(m.time-g[t].time)},g.length>=5&&g.shift(),g.push({x:m.x,y:m.y,time:m.time})}}function r(e,t){A=!0,O[_=t](e)||(n(document,y[_][1],s),n(document,y[_][2],c),n(document,y[_][3],c),u.preventDefault,f={x:_?e.clientX:e.touches[0].clientX,y:_?e.clientY:e.touches[0].clientY,time:Number(new Date)},d=void 0,m={x:0,y:0,time:0},v={x:0,y:0},g=[{x:0,y:0,time:0}],u.start(e,f))}function s(e){!u.preventScroll&&d||O[_](e)||(o(e),(Math.abs(m.x)>u.clickTolerance||Math.abs(m.y)>u.clickTolerance)&&(A=!1),void 0===d&&3!==_&&(d=Math.abs(m.x)<Math.abs(m.y)&&!u.preventScroll)||(u.preventDefault,u.move(e,f,m,v)))}function c(e){_&&o(e),!A&&e.target&&e.target.blur&&e.target.blur(),i(document,y[_][1],s),i(document,y[_][2],c),i(document,y[_][3],c),u.end(e,f,m,v)}var l=function(){},u={preventDefault:!0,clickTolerance:0,preventScroll:!1,mouse:!0,start:l,move:l,end:l,click:l};t&&function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(u,t);var d,_,p=!!window.navigator.pointerEnabled,h=!!window.navigator.msPointerEnabled,f={},m={},v={},g=[],b=[],A=!0,w=p?1:h?2:0,y=[["touchstart","touchmove","touchend","touchcancel"],["pointerdown","pointermove","pointerup","pointercancel"],["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerCancel"],["mousedown","mousemove","mouseup",!1]],O=[function(e){return e.touches&&e.touches.length>1||e.scale&&1!==e.scale},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&"touch"!==e.pointerType&&"pen"!==e.pointerType},function(e){return!e.isPrimary||e.buttons&&1!==e.buttons||!u.mouse&&e.pointerType!==e.MSPOINTER_TYPE_TOUCH&&e.pointerType!==e.MSPOINTER_TYPE_PEN},function(e){return e.buttons&&1!==e.buttons}];return b.push(n(e,y[w][0],(function(e){r(e,w)}))),b.push(n(e,"dragstart",a)),u.mouse&&!w&&b.push(n(e,y[3][0],(function(e){r(e,3)}))),b.push(n(e,"click",(function(e){A&&u.click(e)}))),{getClicksAllowed:function(){return A},kill:function(){for(var e=b.length-1;e>=0;e--)b[e].remove()}}}window.jQuery&&function(e){e.fn.Peppermint=function(t){return this.each((function(){e(this).data("Peppermint",Bn(this,t))})),this}}(window.jQuery),window.Peppermint=Bn,window.EventBurrito=Nn;var Dn=Bn,Hn=function(){function e(){this.initPopup(),this.popup&&(this.connectEvents(),this.initSlider(),e.sendStat("show_screen"))}e.sendStat=function(e){Object(o.oc)("audio_onboarding",e)};var t=e.prototype;return t.initPopup=function(){var e=document.querySelector(".audioRestrictionSplash");e&&(this.popup=Rn.a.open(e,!0,{forceScrollDisable:!0}))},t.connectEvents=function(){var t=this;this.popup.querySelectorAll(".audioRestrictionSplash__closeIcon").forEach((function(n){n.addEventListener("click",(function(n){Object(o.eb)("audioRestrictionSplash__firstScreen",n.target)?e.sendStat("skip_1screen"):Object(o.eb)("audioRestrictionSplash__secondScreen",n.target)&&e.sendStat("skip_2screen"),t.close()}))})),this.popup.querySelector(".audioRestrictionSplash__explain").addEventListener("click",(function(){return e.sendStat("click_more")})),this.popup.querySelector(".audioRestrictionSplash__continueFreeLink").addEventListener("click",(function(){e.sendStat("continue_free"),t.close()})),this.popup.querySelector(".audioRestrictionSplash__continueButton").addEventListener("click",(function(){t.slider.next(),e.sendStat("next_1screen")})),this.popup.querySelector(".audioRestrictionSplash__specialLink").addEventListener("click",(function(){return e.sendStat("get_offer")}))},t.initSlider=function(){this.screens=this.popup.querySelector(".audioRestrictionSplash__screens"),this.slider=Dn(this.screens,{dots:!0,speed:500})},t.close=function(){Rn.a.close(this.popup)},e}(),Un=n("r/ag"),Vn=function(){function e(){this.visibleCallbacks=[],this.hiddenCallbacks=[],this.visibilityPrefix="",this.hiddenStateName="hidden",this.isHidden=!1,this.listen()}e._supports=function(e){return e+"Hidden"in document};var t=e.prototype;return t.onVisible=function(e){this.visibleCallbacks.push(e)},t.onHidden=function(e){this.hiddenCallbacks.push(e)},t.listen=function(){var e=this,t=arguments;try{var n=U.a.version.split(".")[0];if(U.a.safari_mobile&&n<=7)return window.addEventListener("pagehide",(function(){return e._hidden()})),void window.addEventListener("pageshow",(function(){return e._visible()}));var i=U.a.android&&U.a.safari&&n<5,a=!i&&this.isSupported();a?(document.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)})),window.addEventListener(this.visibilityPrefix+"visibilitychange",(function(){return e._nativeSwitch(t)}))):document.addEventListener?(window.addEventListener("focus",(function(){return e._visible()}),1),window.addEventListener("blur",(function(){return e._hidden()}),1)):(document.attachEvent("onfocusin",(function(){return e._visible()})),document.attachEvent("onfocusout",(function(){return e._hidden()})))}catch(e){}},t.isSupported=function(){for(var t=0;t<e.prefixes.length;t++){var n=e.prefixes[t];if(e._supports(n))return this.hiddenStateName=(n?n+"H":"h")+"idden",this.visibilityPrefix=n,!0}return!1},t._visible=function(){this.isHidden=!1,this.visibleCallbacks.forEach((function(e){return e()}))},t._hidden=function(){this.isHidden=!0,this.hiddenCallbacks.forEach((function(e){return e()}))},t._nativeSwitch=function(){!0===document[this.hiddenStateName]?this._hidden():this._visible()},e}();function Fn(e){var t=null;if(e.action_button){var n=e.action_button;t={class:"AudioPopup__actionButtonWrapper",inner:{class:["AudioPopup__actionButton","button"],onclick:n.onclick,href:n.href,inner:n.text}}}var i=["AudioPopup"];e.popupClass&&i.push(e.popupClass);var a={class:"AudioPopup__content",inner:[{class:"AudioPopup__title",inner:e.title},{class:"AudioPopup__description",inner:e.description},t,e.additional_link]};return new Un.a({content:a,class:i.join(" ")})}Vn.prefixes=["webkit","o","ms","moz",""];var Wn=n("J8bf"),qn=function(){function e(){audioSubscribe||(this.isIdle=!1,this.showAlertCountToday=function(e,t){void 0===t&&(t=0);var n=parseInt(Object(Wn.a)(e),10);if(isNaN(n,10))return t;return n}(e.SHOW_ALERT_COOKIE),this.initVisibilityChangeEvent())}e.writePopupStat=function(e){statlogsValueEvent("mvk_audio_background_popup",e)},e.createPopup=function(){var t={href:e.EXPLANATION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("explanation_click");',class:"AudioPopup__explanation",inner:getLang("mobile_audio_background_restriction_explanation")};return Wd.elem(Fn({popupClass:"AudioRestrictionPopup",title:getLang("mobile_audio_background_restriction_title"),description:getLang("mobile_audio_background_restriction_description"),action_button:{href:e.REMOVE_RESTRICTION_LINK,onclick:'AudioBackgroundRestriction.writePopupStat("link_click");',text:getLang("mobile_audio_background_restriction_button")},additional_link:t}))};var t=e.prototype;return t.onIdle=function(){window.audio.playing()&&this.triggerRestriction()},t.showBackgroundMessage=function(){var t=e.createPopup();this.showAlertCountToday+=1,Object(Wn.b)("remixaudio_show_alert_today",this.showAlertCountToday,1),this.showAlertCountToday%3||(Un.a.open(t,!0),e.writePopupStat("show"))},t.triggerRestriction=function(){audio.pause(),this.showBackgroundMessage()},t.initVisibilityChangeEvent=function(){var e=this;this.pageVisibility=new Vn,this.pageVisibility.onVisible((function(){e.isIdle=!1})),this.pageVisibility.onHidden((function(){e.isIdle=!0,e.onIdle()}))},e}();qn.SHOW_ALERT_COOKIE="remixaudio_show_alert_today",qn.REMOVE_RESTRICTION_LINK="/offermusic",qn.EXPLANATION_LINK="https://vk.cc/9uFgyl";var zn=n("L9Nh"),Yn=function(e){this.queueHandler=e},Gn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Qn=function(e){function t(t){return e.call(this,t)||this}return Gn(t,e),t.prototype.connect=function(e){var t=this;e&&this.listenQueueKey!==e.key&&(this.listenQueueKey=e.key,zn.a.addQueue({key:e.key,ts:e.timestamp},(function(e,n){return t.queueHandler(n)})),zn.a.start())},t}(Yn);var Kn=0,Xn=function(){function e(){this.audioQueueListener=new Qn(this.handleAudioQueueMessage),this.subscriptionQueueListener=new Qn(this.handleSubscriptionQueueMessage)}return e.prototype.connect=function(e){var t=this;if(void 0===e&&(e=!1),zn.a.initialized){var n=window.audio.getCurrent(),i=!e&&(this.audioQueueListener.listenQueueKey||this.subscriptionQueueListener.listenQueueKey);n&&!i&&window.ajax.post("/audio",{act:"queue_params",audio_id:n.id,owner_id:n.ownerId,hash:n.actionHash},{onDone:function(e){var n,i,a=(i={},(n=e)&&n.length&&n.filter((function(e){return!!e})).map((function(e){return e.queues&&e.queues[0]})).forEach((function(e){return i[e.type]=e})),i);a.audio&&t.audioQueueListener.connect(a.audio),a.subscription&&t.subscriptionQueueListener.connect(a.subscription),e&&(t.listenQueueRefreshTO&&clearTimeout(t.listenQueueRefreshTO),t.listenQueueRefreshTO=window.setTimeout((function(){return t.connect(!0)}),3e4))},onFail:function(){return Kn<3&&(Kn++,setTimeout((function(){return t.connect()}),5e3)),!0}})}},e.prototype.handleAudioQueueMessage=function(t){for(var n=window.audio.playing(),i=0;i<t.events.length;i++){var a=t.events[i].data;if("start"===a.type&&window.audio.getDeviceId()!==a.uuid&&!e.startPlaybackBox&&n){window.audio.pause(),e.showMultipleStreamPopup(a);break}}},e.prototype.handleSubscriptionQueueMessage=function(e){e.events.length&&e.events.forEach((function(e){if(1===e.data.product_id){var t=window.audioAdsConfig||window.vk.audioAdsConfig;t&&(t.enabled=!e.data.active)}}))},e.showMultipleStreamPopup=function(t){var n=e.createPopup(t.device_name);Un.a.open(n,!0,{oncloseCallback:function(){return e.startPlaybackBox=!1}}),document.querySelector(".AudioPopup__actionButton").addEventListener("click",(function(){Un.a.close()})),e.startPlaybackBox=!0},e.createPopup=function(e){return _.a.elem(Fn({title:Object(ae.t)("mobile_audio_start_playback_title"),description:Object(ae.t)("mobile_audio_start_playback_body").replace("{device_name}",e),action_button:{text:Object(ae.t)("mobile_audio_continue")}}))},e.startPlaybackBox=!1,e}(),$n="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",Jn=n("xk4V"),Zn=n.n(Jn),ei=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},ti=function(){function e(){this.subscriptions={}}return e.prototype.subscribe=function(e,t){var n=this;return Array.isArray(e)&&e.forEach((function(e){return n.subscribe(e,t)})),this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),{unsubscribe:function(){return n.unsubscribe(e,t)}}},e.prototype.unsubscribe=function(e,t){if(this.subscriptions[e]){var n=this.subscriptions[e].indexOf(t);n>=0&&this.subscriptions[e].splice(n,1)}},e.prototype.emit=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this.precheck&&!this.precheck.apply(this,ei([e],n))||(this.onAnyCallBack&&setTimeout((function(){return t.onAnyCallBack.apply(t,ei([e],n))})),this.subscriptions[e]&&this.subscriptions[e].forEach((function(e){return setTimeout((function(){return e.apply(void 0,n)}))})))},e}(),ni="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMN0PQRSTUVWXYZO123456789+/=",ii={v:function(e){return e.split("").reverse().join("")},r:function(e,t){var n;e=e.split("");for(var i=ni+ni,a=e.length;a--;)~(n=i.indexOf(e[a]))&&(e[a]=i.substr(n-t,1));return e.join("")},s:function(e,t){var n=e.length;if(n){var i=function(e,t){var n=e.length,i=[];if(n){var a=n;for(t=Math.abs(t);a--;)t=(n*(a+1)^t+a)%n,i[a]=t}return i}(e,t),a=0;for(e=e.split("");++a<n;)e[a]=e.splice(i[n-1-a],1,e[a])[0];e=e.join("")}return e},i:function(e,t){return ii.s(e,t^vk.id)},x:function(e,t){var n=[];return t=t.charCodeAt(0),each(e.split(""),(function(e,i){n.push(String.fromCharCode(i.charCodeAt(0)^t))})),n.join("")}};function ai(e){if((!window.wbopen||!~(window.open+"").indexOf("wbopen"))&&~e.indexOf("audio_api_unavailable")){var t,n,i=e.split("?extra=")[1].split("#"),a=""===i[1]?"":oi(i[1]);if(i=oi(i[0]),"string"!=typeof a||!i)return e;for(var o=(a=a?a.split(String.fromCharCode(9)):[]).length;o--;){if(t=(n=a[o].split(String.fromCharCode(11))).splice(0,1,i)[0],!ii[t])return e;i=ii[t].apply(null,n)}if(i&&"http"===i.substr(0,4))return i}return e}function oi(e){if(!e||e.length%4==1)return!1;for(var t,n,i=0,a=0,o="";n=e.charAt(a++);)~(n=ni.indexOf(n))&&(t=i%4?64*t+n:n,i++%4)&&(o+=String.fromCharCode(255&t>>(-2*i&6)));return o}function ri(e,t){var n="";return e.forEach((function(i,a){var o="/audio?performer=1&q="+encodeURIComponent(i.name),r=window.getWebHost?window.getWebHost():"";i.id&&(o="/artist/"+i.id),n+=t?'<a class="artist_link" href="'+r+o+'">'+i.name+"</a>":i.name,a<e.length-1&&(n+=", ")})),n}function si(e){if(!e)return null;if(isObject(e))return e;if("string"==typeof e)return{id:e};var t=(e[_n]||"").split("/"),n=(e[pn]||"").split(","),i=function(e,t){void 0===t&&(t=!0);var n="",i=!Mn(e)&&t;if(isArray(e[mn])&&(n=ri(e[mn],i)),isArray(e[vn])&&(n+=" feat. ",n+=ri(e[vn],i)),!n){var a=e[an]?e[an].replace(/<\/?em>/g,""):"";if(i)n='<a class="artist_link" data-performer="'+a+'" href="'+("/audio?performer=1&q="+encodeURIComponent(a))+'">'+a+"</a>";else n=a}return n}(e,!1);return{id:intval(e[Zt]),owner_id:intval(e[en]),ownerId:e[en],fullId:e[en]+"_"+e[Zt],title:e[nn]||"",subTitle:e[fn],performer:i,mainArtists:e[mn],featArtists:e[vn],authorLink:e[sn],duration:intval(e[on]),lyrics:e[cn]||"",url:e[tn],flags:e[ln],context:e[un],extra:e[dn],accessKey:e[yn],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[ln]&Cn,canAdd:!!(e[ln]&kn),coverUrl_s:n[0],coverUrl_p:n[1],isClaimed:!!(e[ln]&jn),isFromQueue:!!(e[ln]&Sn),isExplicit:!!(e[ln]&In),isUMA:!!(e[ln]&En),isReplaceable:!!(e[ln]&Tn),ads:e[hn],album:e[gn],albumId:intval(e[rn]),albumPart:intval(e[wn]),trackCode:e[bn],restrictionStatus:e[An],chartInfo:e[On]}}function ci(e){try{return e.play()||Promise.resolve()}catch(e){return Promise.reject(e)}}var li,ui=n("Xrg9"),di=function(){return(di=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},_i=function(){function e(e,t){var n=this;this.fullyLoaded=!1,this.url="",this.audioElement=new Audio,this.audioElement.crossOrigin="anonymous",this.audioElement.preload="auto",this.volume=e.volume,this.addEventListeners(e),t&&this.setUrl(t).then((function(){n.audioElement.load()}));var i=new L;this.audioNetworkStatCollector=new B(i)}return Object.defineProperty(e.prototype,"isFullyLoaded",{get:function(){return this.fullyLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this.audioElement.error||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"played",{get:function(){return this.audioElement.played},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"src",{get:function(){return this.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hls",{get:function(){return this.hlsInstance||null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return isFinite(this.audioElement.duration)?this.audioElement.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.audioElement.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this.audioElement.currentTime},set:function(e){this.audioElement.currentTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.audioElement.volume},set:function(e){this.audioElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playbackRate",{set:function(e){this.audioElement.playbackRate=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentProgress",{get:function(){return isNaN(this.audioElement.duration)?0:Math.max(0,Math.min(1,this.audioElement.currentTime/this.audioElement.duration))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentBuffered",{get:function(){return this.audioElement.buffered.length?Math.min(1,this.audioElement.buffered.end(0)/this.audioElement.duration):0},enumerable:!1,configurable:!0}),e.prototype.play=function(){return ci(this.audioElement).catch((function(e){switch(e.code){case e.NOT_SUPPORTED_ERR:case e.ABORT_ERR:break;default:throw e}}))},e.prototype.pause=function(){this.audioElement.pause()},e.prototype.addEventListeners=function(e){var t=this;this.audioElement.addEventListener("pause",(function(){return e.onPause()})),this.audioElement.addEventListener("play",(function(){return e.onPlay()})),this.audioElement.addEventListener("progress",(function(){if(e.onBufferUpdate(),!t.hlsInstance){var n=t.audioElement.buffered;n.length&&Math.abs(n.end(n.length-1)-t.audioElement.duration)<1&&(t.fullyLoaded=!0)}})),this.audioElement.addEventListener("timeupdate",(function(){e.onProgressUpdate&&e.onProgressUpdate()})),this.audioElement.addEventListener("ended",(function(){e.onEnd&&e.onEnd()})),this.onFail=e.onFail||function(){},this.audioElement.addEventListener("error",(function(){t.onFail()})),this.audioElement.addEventListener("canplay",(function(){e.onCanPlay&&e.onCanPlay()})),this.audioElement.addEventListener("durationchange",(function(){e.onDurationChange&&e.onDurationChange()}))},e.isHlsUrl=function(e){return ai(e).includes(".m3u8")},e.prototype.setUrl=function(t){var n=this,i=ai(t);return this.url=i,e.isHlsUrl(i)&&!e.shouldUseNativeHls()&&"function"==typeof window.MediaSource?this.initHls(i).catch((function(){return n.onFail()})):(this.hlsInstance&&this.hlsInstance.destroy(),this.audioElement.src=i,this.audioElement.load(),Promise.resolve())},e.shouldUseNativeHls=function(){var e=window.browser.version.split(".")[0],t=parseInt(e);return window.browser.safari||window.browser.msie_edge&&t>11&&t<78},e.prototype.initHls=function(t){var n=this;return e.loadHls().then((function(e){var i=e.default;return new Promise((function(e){var a=!1,o=!!ui.a.get("_audio_hls_debug");n.hlsInstance&&n.hlsInstance.destroy();var r=new i({debug:o,maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5,maxFragLookUpTolerance:.2});r.on(i.Events.BUFFER_EOS,(function(){return n.fullyLoaded=!0})),r.on(i.Events.ERROR,(function(e,t){t.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(a=!0),(o||t.fatal)&&console.log("audio hls error",e,t),t.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(r.stopLoad(),r.startLoad()),t.fatal&&n.onFail({type:t.type,details:t.details,url:t.frag&&t.frag.url||t.context&&t.context.url,code:t.networkDetails?t.networkDetails.status:0})})),r.on(i.Events.FRAG_BUFFERED,(function(e,t){var i=function(){try{return window.isMVK?window.audio.getCurrent():si(window.getAudioPlayer().getCurrentAudio())}catch(e){return{id:0,ownerId:0}}}(),o={owner_id:i.ownerId,audio_id:i.id,fragment_id:t.frag.sn.toString(),fragment_duration:Math.ceil(1e3*t.frag.duration).toString(),time_to_first_byte:Math.ceil(t.stats.tfirst-t.stats.trequest).toString(),time_to_first_frame:Math.ceil(t.stats.tload-t.stats.trequest).toString(),buffering_time:Math.ceil(t.stats.tbuffered-t.stats.trequest).toString()};a&&n.audioNetworkStatCollector.logEvent(di(di({},o),{event_type:j.FRAGMENT_STALLED}),E.a.getConnectionType(),E.a.getConnectionEffectiveType()),a=!1,n.audioNetworkStatCollector.logEvent(di(di({},o),{event_type:j.FRAGMENT_LOADED}),E.a.getConnectionType(),E.a.getConnectionEffectiveType())})),r.loadSource(t),r.attachMedia(n.audioElement),n.hlsInstance=r,e()}))}))},e.loadHls=function(){return n.e("vendor~hls").then(n.t.bind(null,"ulZh",7))},e}(),pi=function(){function e(e){this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t.getCurrentTime=function(){return this._currentAudioEl.currentTime},t.clearAudioNode=function(){this._currentAudioEl=this._createAudioNode($n)},t.isCurrent=function(e){return e===this._currentAudioEl},t._createAudioNode=function(e){var t=this,n=new _i({onBufferUpdate:function(){t.isCurrent(n)&&t.opts.onBufferUpdate(t.getCurrentBuffered())},onProgressUpdate:function(){t.isCurrent(n)&&t.opts.onProgressUpdate(t.getCurrentProgress(),t.getPlayedTime(),t.getCurrentTime())},onEnd:function(){t.isCurrent(n)&&n.src!==$n&&t.opts.onEnd()},onSeeked:function(){t.isCurrent(n)&&t.opts.onSeeked()},onSeek:function(){t.isCurrent(n)&&t.opts.onSeek()},onFail:function(e){t._prefetchAudioEl===n?t._prefetchAudioEl=t._createAudioNode():t.isCurrent(n)&&n.src!==$n&&(t._hlsError=e,t.opts.onFail&&t.opts.onFail())},onDurationChange:function(){t.isCurrent(n)&&t._seekOnReady&&n.duration>0&&(t.seek(t._seekOnReady),t._seekOnReady=!1)},onCanPlay:function(){t.isCurrent(n)&&t.opts.onCanPlay&&t.opts.onCanPlay()},onPause:this.opts.onPause,onPlay:this.opts.onPlay,volume:this.hasOwnProperty("_volume")?this._volume:this.opts.defaultVolume},e);return n},t.onReady=function(e){e()},t.prefetch=function(e){this._prefetchAudioEl&&this._prefetchAudioEl.url===ai(e)||(this._prefetchAudioEl=this._createAudioNode(e))},t.seek=function(e){var t=this._currentAudioEl;t.duration>0&&t.src&&t.src!==$n?t.currentTime=t.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t.setPlaybackRate=function(e){this._currentAudioEl.playbackRate=e},t.getCurrentProgress=function(){return this._currentAudioEl.currentProgress},t.getCurrentBuffered=function(){return this._currentAudioEl&&this._currentAudioEl.currentBuffered},t.getDuration=function(){return this._currentAudioEl&&this._currentAudioEl.duration},t.isFullyLoaded=function(){return this._currentAudioEl.isFullyLoaded},t.setUrl=function(e,t){var n,i=this;if(void 0===t&&(t=function(){}),!e)return t&&t(!1);var a=ai(e),o=this._currentAudioEl;if(this._currentAudioEl.src&&this._currentAudioEl.src!==$n&&(this._seekOnReady=!1),this._currentAudioEl.src===a)return this.opts.onCanPlay&&this.opts.onCanPlay(),void(t&&t(!0));if(this._prefetchAudioEl){if(this._prefetchAudioEl.src===a)return this._currentAudioEl.pause(),this._currentAudioEl.setUrl($n),this._prefetchAudioEl.readyState>=3&&setTimeout((function(){return i.opts.onCanPlay&&i.opts.onCanPlay()})),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=null,void(t&&t(!0));a!==$n&&this._prefetchAudioEl.setUrl($n)}o.src!==a&&(n=o.setUrl(a).then((function(){return i._stopFrequencyAnalise()}))),n?n.then((function(){return t(!0)})).catch((function(){return t(!1)})):t(!0)},t.play=function(){this._stopFrequencyAnalise();var e=this._currentAudioEl;if(e.src){var t=e.play();return this._startFrequencyAnalise(),t}return Promise.resolve()},t.preparePlay=function(){if(browser.safari)return this._currentAudioEl.play()},t._startFrequencyAnalise=function(){var e=this;function t(e,t,n,i){return(n-t)*e/i+t}function n(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,a=null,o=null;this._freqUpdateInterval=setInterval((function(){var r;e._currentAudioEl.paused?r=[0,0,0,0]:(++i>3&&(i=0,a=o,o=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)],a||(a=[n(.7,1),n(.55,.8),n(.3,.55),n(.03,.45)])),r=[t(i,a[0],o[0],3),t(i,a[1],o[1],3),t(i,a[2],o[2],3),t(i,a[3],o[3],3)]),e.opts.onFrequency&&e.opts.onFrequency(r)}),50)},t._stopFrequencyAnalise=function(){clearInterval(this._freqUpdateInterval),this.opts.onFrequency&&this.opts.onFrequency([0,0,0,0])},t.pause=function(){this._currentAudioEl.pause(),this._stopFrequencyAnalise()},t.stop=function(){this._currentAudioEl.pause(),this.seek(0),this._stopFrequencyAnalise()},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t,n){var i=this;e=Math.max(0,Math.min(1,e));var a=this._currentAudioEl,o=0;if(t){var r=e-a.volume;o=r/(t/20||1)}else o=e<a.volume?-.06:.001;if(Math.abs(e-a.volume)<=.001)return this._setFadeVolumeInterval(),n&&n();var s=a.volume;this._setFadeVolumeInterval((function(){!t&&o>0&&(o*=1.35),s+=o;if(o<0?s<=e:s>=e)return i.setVolume(e),i._setFadeVolumeInterval(),n&&n();i.setVolume(s)}))},t.getErrorData=function(){var e=this._currentAudioEl.error||{};return{is_hls:this._currentAudioEl.hls?1:0,url:this._currentAudioEl.src,error_code:e.code,error_message:e.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}},e}();!function(e){e.URL="url",e.PLAYBACK_RATE="playback_rate",e.DELAY="delay",e.SEEK="seek",e.PAUSE="pause",e.PLAY="play",e.VOL_SET="vol_set",e.VOL_UP="vol_up",e.VOL_DOWN="vol_down"}(li||(li={}));var hi=function(){function e(e){this.impl=e,this.taskIDCounter=1,this.tasks=[],this.taskInProgress=null,this.taskAbort=null}return e.prototype.newTask=function(e,t){var n,i,a=new Promise((function(e,t){n=e,i=t}));return this.tasks.push({name:e,fn:function(){return t().then(n).catch(i)},id:e+"_"+this.taskIDCounter++}),this.doTasks(),a},e.prototype.clearAllTasks=function(){this.taskAbort=this.taskInProgress,this.taskInProgress=null,this.tasks=[]},e.prototype.clearTask=function(e){this.tasks=this.tasks||[],this.tasks=this.tasks.filter((function(t){return t.name!==e}))},e.prototype.doTasks=function(){var e=this;if(!this.taskInProgress){var t=this.tasks.shift();t&&(this.taskInProgress=t.id,this.ensureImplReady().then((function(){return t.fn()})).then((function(){e.taskAbort!==t.id?(e.taskInProgress=null,e.doTasks()):e.taskAbort=null})))}},e.prototype.ensureImplReady=function(){var e=this;return new Promise((function(t){return e.impl.onReady(t)}))},e.prototype.delay=function(e){return this.newTask(li.DELAY,(function(){return new Promise((function(t){return function(e,t){if(!window.Worker||!window.Blob)return setTimeout(e,t);var n=new Blob(["\n      var timeout;\n      onmessage = function(e) {\n        clearTimeout(timeout);\n        if (e.data == 'start') {\n          timeout = setTimeout(function() { postMessage({}); }, "+t+");\n        }\n      }\n    "]);try{var i=new Worker(window.URL.createObjectURL(n));return i.onmessage=function(){i.terminate(),e()},i.postMessage("start"),i}catch(n){return setTimeout(e,t)}}(t,e)}))}))},e.prototype.setUrl=function(e){var t=this;return this.newTask(li.URL,(function(){return new Promise((function(n){return t.impl.setUrl(e,n)}))}))},e.prototype.seekImmediate=function(e){this.impl.seek(e)},e.prototype.seek=function(e){var t=this;return this.clearTask(li.SEEK),this.newTask(li.SEEK,(function(){return new Promise((function(n){t.seekImmediate(e),n()}))}))},e.prototype.pause=function(){var e=this;return this.newTask(li.PAUSE,(function(){return new Promise((function(t){e.impl.pause(),t()}))}))},e.prototype.play=function(){var e=this;return window.browser.safari&&this.impl.play(),this.newTask(li.PLAY,(function(){return new Promise((function(t,n){e.impl.play().then(t).catch(n)}))}))},e.prototype.setVolume=function(e,t,n){var i=this;if(void 0===n&&(n=null),t){var a=e?li.VOL_UP:li.VOL_DOWN;return this.newTask(a,(function(){return new Promise((function(t){return i.impl.fadeVolume(e,n,(function(){return t()}))}))}))}return this.newTask(li.VOL_SET,(function(){return new Promise((function(t){i.impl.setVolume(e),t()}))}))},e.prototype.updatePlaybackRate=function(e){var t=this;return this.newTask(li.PLAYBACK_RATE,(function(){return new Promise((function(n){t.impl.setPlaybackRate(e),n()}))}))},e}();function fi(e){return Object(o.N)("audio_item_"+e)}function mi(e){return fi(e)[0]}function vi(e){var t=mi(e);if(!t)return null;if(t.dataset&&t.dataset.playlistId)return t.dataset.playlistId;var n=Object(o.eb)("AudioPlaylistRoot",t);if(!n)return console.log("no playlist Element found"),null;var i=n.dataset.playlistId;return i||(console.log("no playlist Id found"),null)}var gi=n("iwo4"),bi=window.audio||function(){var e=Object(o.nc)("audio_vol"),t="number"==typeof e?e:.8,n={onPause:function(){Object(D.a)("mvk_audio_player_listening",f[m].id,bi.getCurrentProgress()),A&&(A=!1,ssSet("audio_play","0"),clearTimeout(O));s.emit(Jt.a.PAUSE,I())},onPlay:function(){A||(A=!0,ssSet("audio_play","1"),clearTimeout(O),O=setTimeout(P,100));if(audioBackgroundRestriction&&audioBackgroundRestriction.isIdle)return void bi.pause();s.emit(Jt.a.PLAY,I())},onBufferUpdate:function(e){s.emit(Jt.a.BUFFERED,I(),e,bi.duration())},onEnd:function(){if(c>0)return;s.emit(Jt.a.ENDED,I()),y?(y=!1,bi.next()):w=!0},onProgressUpdate:function(e,t,n){if(Ai.isPlaying())return;if(!e&&n)try{e=n/bi.duration()}catch(e){}s.emit(Jt.a.PROGRESS,I(),e,bi.duration(),t),e>.01&&(C=t);ssSet("audio_pos",e),!y&&a.getDuration()-a.getCurrentTime()<.5&&(y=!0);if(e>.8&&S){var i=function(){var e=m+1;if(e&&f&&e<f.length)return f[e];return null}();i&&a.isFullyLoaded()&&(S=!1,function(e){e&&e.url&&a.prefetch(e.url)}(i))}w&&(w=!1,bi.next())},defaultVolume:t},i=!(browser.safari||browser.chrome&&browser.version<50),a=new pi(n),r=new hi(a),s=new ti,c=0,l=null,u={},_=new Xn,p=!1,h=srand(),f=[],m=null,v={},g="",b=null,A=!1,w=!1,y=!1,O=null,k=!1,j=!1,S=!1,C=0;function E(e,t){if(void 0===t&&(t=!1),!bi.support)return!1;var n;if(A&&bi.pause(),s.emit(Jt.a.DESELECT,T()),(n=bi.canRepeat!==gi.a.ONE||t?m+e:m)>=f.length||n<0){if(bi.canRepeat!==gi.a.ALL&&bi.canRepeat!==gi.a.ONE)return!1;n=n>=f.length?0:Math.max(0,f.length-1)}Object(D.a)("mvk_audio_player_listening",f[m].id,bi.getCurrentProgress());var i=f[n];bi.play(i.fullId).then((function(t){t||E(e>0?e+1:e-1)})).catch((function(){}))}function T(){return f[m]||!1}function I(){return T().fullId||!1}function M(e){return function(e){return new Promise((function(t,n){l&&l(),l=n;var i=[];if(u=u||{},e)if(e.url)t(e);else{var a=v[e.fullId];if(a>=0)for(var o=a;o<a+3;o++){var r=f[o];r&&!r.url&&!u[r.fullId]&&r.urlHash&&(i.push(r.fullId+"_"+r.actionHash+"_"+r.urlHash),u[r.fullId]=!0)}ajax.post("/audio",{act:"reload_audio",ids:i.join(",")},{onDone:function(i){i?(i.forEach((function(n){var i=si(n),a=f[v[i.fullId]];a&&(a.url=i.url),fi(i.fullId).forEach((function(e){try{var t=JSON.parse(e.dataset.audio);t[tn]=i.url,e.dataset.audio=JSON.stringify(t)}catch(e){}})),i.fullId===e.fullId&&(e.url=i.url,t(e)),delete u[i.fullId]})),n()):n()},onFail:n})}else n()})).catch((function(){return u={}}))}(e).then((function(e){r.clearTask(li.URL);var t=e.url;if(!t)throw new Error;return r.setUrl(t).then((function(t){t?c=0:(r.clearAllTasks(),s.emit(Jt.a.FAILED),A&&c<2&&(e.pause(),e.next(),c++))}))}))}function P(){if(A){var e=lsGet("audio_current_player");h!=e?bi.pause():O=setTimeout(P,100)}}function x(e){ssSet("audio_query",e),k&&Object(Wn.b)(k+"q",encodeURIComponent(e),1)}return{support:!0,canRepeat:gi.a.ALL,shuffled:!1,onInit:Object(d.a)(),init:function(e){!j&&bi.support&&(j=!0,e.cookie&&(k=e.cookie,e.cookie_path||"/"),onDOMReady((function(){!function(e){var t=Object(o.nc)("audio_id"),n=Object(o.nc)("audio_pos"),i=Object(Wn.a)(k+"_playlist");e.playlist&&e.playlist.length&&(i&&bi.setPlaylistId(i),bi.playlist((e.playlist||[]).map(si),{q:e.playlist_q||""})),t&&bi.select(t).then((function(){n<1&&bi.setPosition(n,!0)})).catch((function(){}))}(e),bi.onInit()})))},subscribe:function(e,t){return s.subscribe(e,t)},unsubscribe:function(e,t){return s.unsubscribe(e,t)},notify:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];s.emit.apply(s,[e].concat(n))},getCurrent:T,getCurrentId:I,operate:function(e){if(!bi.support)return!1;!e||f[m]&&e===I()?A?bi.pause():bi.play():(Object(D.a)("mvk_audio_player_listening",T().id,bi.getCurrentProgress()),bi.play(e))},setPlaylistId:function(e){e!==b&&(b=e,s.emit(Jt.a.PLAYLIST_CHANGED))},playing:function(){return A},select:function(e){if(!bi.support)return Promise.reject();if(!e)return Promise.reject();f.length||s.emit(Jt.a.EMPTY_PLAYLIST,e);var t=f[v[e]];return t?(I()&&s.emit(Jt.a.DESELECT,T()),M(t).then((function(){m=v[e],S=!0,s.emit(Jt.a.SELECT,f[m]);var t,n=vi(e);n&&b!==n&&bi.setPlaylistId(n),t=I(),ssSet("audio_id",t),k&&(Object(Wn.b)(k,t,1),Object(Wn.b)(k+"_playlist",b,1))})).catch((function(){return Promise.reject()}))):(s.emit(Jt.a.NOT_FOUND_PLAYLIST,e),Promise.reject())},autoplay:function(e){bi.play(e)},getCurrentPlaylistId:function(){return b},play:function(e){var t=this;if(bi.support)return new Promise((function(n){var o=e===I();return A&&o?(bi.pause(),n(!0)):Ai.isPlaying()?(e&&!o?(bi.select(e).catch((function(){})),Ai.resume()):A?Ai.pause():Ai.resume(),n(!0)):(A=!0,!e||o?(t._play(),n(!0)):(a.setUrl($n),void bi.select(e).then((function(){if(s.emit(Jt.a.PLAY_REQUESTED,e),!i)return t._play(),n(!0);r.clearAllTasks(),Ai.startPlay(f[v[e]],(function(){return t._play(),n(!0)}))})).catch((function(){return A=!1,I()&&bi.select(I()),n(!1)}))))}))},_play:function(){T()&&(r.play().then((function(){ssSet("audio_play","1"),_.connect()})).catch((function(){A=!1,s.emit(Jt.a.PAUSE)})),lsSet("audio_current_player",h))},clearCurrentPlaylist:function(){if(!bi.support)return!1;A&&!Ai.isPlaying()&&bi.pause(),T()&&s.emit(Jt.a.DESELECT,T()),f=[],g="",m=null,bi.setPlaylistId(null),v={},x(g)},pause:function(){if(!bi.support)return!1;A&&(Ai.isPlaying()?Ai.pause():a.pause(),A=!1,ssSet("audio_play","0"))},getDeviceId:function(){var e=lsGet("audio_player_device_id");return e||(e=Zn()(),lsSet("audio_player_device_id",e)),e},getPosition:function(){return bi.isAdsPlaying()?Ai.getCurrentProgress()*Ai.getDuration():a.getCurrentTime()},getCurrentProgress:function(){return bi.isAdsPlaying()?Ai.getCurrentProgress():a.getCurrentProgress()},setPosition:function(e,t){if(!bi.support)return!1;var n=0;t?n=e:e&&bi.duration()&&(n=e/bi.duration()),r.seek(n).then((function(){ssSet("audio_pos",n),s.emit(Jt.a.SEEK,I(),n,bi.duration())}))},volume:function(e){if(!bi.support)return!1;if(void 0===e)return t;var n=Math.min(1,Math.max(0,e));t=n,r.setVolume(t),ssSet("audio_vol",t),Ai.updateVolume(),s.emit(Jt.a.VOLUME,I(),t)},loaded:function(){return a.getCurrentBuffered()},duration:function(){if(this.isAdsPlaying())return Ai.getDuration();var e=a.getDuration(),t=f[m]&&f[m].duration;return e||t||0},played:function(){return a.getPlayedTime()},getListenedTime:function(){return C},next:function(e){return void 0===e&&(e=!1),E(1,e)},prev:function(e){return void 0===e&&(e=!1),E(-1,e)},shuffle:function(){var e=bi.isPlaying()&&!bi.isAdsPlaying(),t=bi.getPosition(),n=bi.getCurrentId();bi.pause(),bi.shuffled=!bi.shuffled,bi.shuffled?(f.forEach((function(e,t){return e.position=t})),f.sort((function(){return Math.random()-.5}))):f.sort((function(e,t){return e.position-t.position})),v=f.reduce((function(e,t,n){return e[t.fullId]=n,e}),{}),n&&(bi.select(n),bi.setPosition(t),e&&requestAnimationFrame((function(){return bi.play()})))},repeat:function(){switch(bi.canRepeat){case gi.a.NONE:bi.canRepeat=gi.a.ALL;break;case gi.a.ALL:bi.canRepeat=gi.a.ONE;break;case gi.a.ONE:bi.canRepeat=gi.a.NONE;break;default:bi.canRepeat=gi.a.NONE}},playlist:function(e,t){return!!bi.support&&(void 0===e?f:(A&&!Ai.isPlaying()&&bi.pause(),T()&&s.emit(Jt.a.DESELECT,T()),f=e,g=t&&t.q||"",m=null,v={},each(e,(function(e,t){return v[t.fullId]=e})),void x(g)))},addToPlaylist:function(e,t){var n={},i=t||f.length;f.forEach((function(e){return n[e.fullId]=!0})),e.forEach((function(e){n[e.fullId]||(t?f.splice(i,0,e):f.push(e))}))},playlist_q:function(){return g},setIsPlaying:function(e){A=e},isAdsPlaying:function(){return Ai.isPlaying()},isPlaying:function(){return A},initSplash:function(){p||(window.audioRestrictionSplash=new Hn,p=!0)},playNothing:function(){a.setUrl($n,(function(){}))},events:Jt.a}}();window.Artist=Qt,window.Curator=Xt;var Ai=new Pn(new Ln(bi),null,!0);bi.ads=Ai,window.audio=bi,window.AudioBackgroundRestriction=qn,window.audioBackgroundRestriction=null,document.addEventListener("DOMContentLoaded",(function(){Object(C.b)("audio_mvk_background_restriction_enabled")&&(window.audioBackgroundRestriction=new qn)})),document.addEventListener("DOMContentLoaded",(function(){"audio"===cur.module&&bi.initSplash()})),window.page.onChange((function(){"audio"===cur.module?bi.initSplash():window.audioRestrictionSplash&&window.audioRestrictionSplash.popup&&window.audioRestrictionSplash.close()}));var wi,yi,Oi=function(){function e(e){this.player=e,this.listeners=[]}var t=e.prototype;return t.listen=function(e,t,n){var i=t.bind(n||this);this.listeners.push({event:e,fn:t,listener:i}),this.playerListen(e,i)},t.unListen=function(e,t){var n=-1;if(each(this.listeners,(function(i,a){if(a.event===e&&a.listener===t)return n=i,!1})),!(n<0)){var i=this.listeners[n];this.playerUnListen(e,i.listener),this.listeners.splice(n,1)}},t.unListenAll=function(){for(var e;e=this.listeners[0];)this.unListen(e.event,e.listener)},t.listenPlay=function(e,t){this.listen(Jt.a.PLAY,e,t)},t.listenPause=function(e,t){this.listen(Jt.a.PAUSE,e,t)},t.listenStop=function(e,t){this.listen("stop",e,t)},t.listenProgress=function(e,t){this.listen(Jt.a.PROGRESS,e,t)},t.listenVolume=function(e,t){this.listen(Jt.a.VOLUME,e,t)},t.listenSeek=function(e,t){this.listen(Jt.a.SEEK,e,t)},t.listenPlaylistChanged=function(e,t){this.listen(Jt.a.PLAYLIST_CHANGED,e,t)},t.listenEnded=function(e,t){this.listen(Jt.a.ENDED,e,t)},t.listenPlayNext=function(e,t){this.listen(Jt.a.PLAY_NEXT,e,t)},t.listenAdCompleted=function(e,t){this.listen(Jt.a.AD_COMPLETED,e,t)},t.playerListen=function(e,t){this.player.subscribe(e,t)},t.playerUnListen=function(e,t){this.player.unsubscribe(e,t)},t.getPausedBy=function(){return null},t.getState=function(){return document.hidden?1:3},t.getProgress=function(){return this.player.playerGetProgress()},t.getProgressInSeconds=function(){return this.player.getProgressInSeconds()},t.getVolume=function(){return this.player.getVolume()},t.getAudioId=function(){return this.player.getAudioId()},t.getAudio=function(){return this.player.getAudio()},t.getAudioTrackCode=function(){return this.player.getAudioTrackCode()},t.getPrevAudioId=function(){return this.player.getPrevAudioId()},t.getPrevPlaylistId=function(){return this.player.getPrevPlaylistId()},t.getPlaylistId=function(){return this.player.getPlaylistId()},t.getContext=function(){return this.player.getContext()},t.getSequence=function(){return this.player.getSequence()},t.getType=function(){return this.player.getType()},t.getListenedTime=function(){return isNaN(this.player.getListenedTime())?0:Math.round(this.player.getListenedTime())},t.getSearchParams=function(){return this.player.getSearchParams()},t.isPlaying=function(){return this.player.isPlaying()},t.isAutoPlayed=function(){return this.player.isAutoPlayed()},t.isRepeatCurrentAudio=function(){return this.player.isRepeatCurrentAudio()},t.isRepeatAll=function(){return this.player.isRepeatAll()},t.isShuffledPlaylist=function(){return this.player.isShuffledPlaylist()},t.isRealPlaylist=function(){return this.player.isRealPlaylist()},t.isRealPrevPlaylist=function(){return this.player.isRealPrevPlaylist()},t.isPodcast=function(){return this.player.isPodcast()},t.isAdPlaying=function(){return this.player.ads.isPlaying()},t.isLastTrack=function(){return this.player.isLastTrack()},t.hasPrevAudio=function(){return this.player.hasPrevAudio()},t.hasPrevPlaylist=function(){return this.player.hasPrevPlaylist()},t.hasPlaylist=function(){return this.player.hasPlaylist()},t.hasSearchParams=function(){return this.player.hasSearchParams()},t.isDebug=function(){return!1},t.sendListenedData=function(e){return this.player.sendListenedData(e)},e}(),ki=n("BJj/"),ji=((wi={}).start=1,wi.stop=2,wi.volume=3,wi.rewind=4,wi.play_further=5,wi.added=6,wi.removed=7,wi.recommendation_removed=8,wi.show_album=9,wi.share_audio=10,wi.broadcast=11,wi.curator=12,wi),Si=((yi={}).default=1,yi.next_track=2,yi.prev_track=3,yi.auto=4,yi.interruption=5,yi.pause=6,yi.new=7,yi.close_app=8,yi.queue=9,yi.pause=10,yi.upload=11,yi.on=12,yi.off=13,yi.follow=14,yi.unfollow=15,yi),Ci=function(){function e(e){if(this.playerAdapter=e,this.listenedData=null,this.sendTimeout=null,this.currentAudioId=null,this.currentAudio=null,this.currentAudioTrackCode=null,this.pausedAudioId=null,this.playlistChanged=!1,this.currentPosition=0,this.currentListened=0,this.playedTime=0,this.adsCompleted=!1,this.wasEnded=!1,vk.id)this.uniqueUserId=null;else{var t=ui.a.get("audio_unique_unauth_id");t?this.uniqueUserId=t:(this.uniqueUserId=Zn()(),ui.a.set("audio_unique_unauth_id",this.uniqueUserId))}this.debug=e.isDebug(),this.onVolume=Object(ki.a)(this.onVolume.bind(this),300),this.playerAdapter.listenPlay(this.onPlay,this),this.playerAdapter.listenPause(this.onPause,this),this.playerAdapter.listenStop(this.onPause,this),this.playerAdapter.listenProgress(this.onProgress,this),this.playerAdapter.listenVolume(this.onVolume,this),this.playerAdapter.listenSeek(this.onSeek,this),this.playerAdapter.listenPlaylistChanged(this.onPlaylistChanged,this),this.playerAdapter.listenEnded(this.onEnded,this),this.playerAdapter.listenPlayNext(this.onPlayNext,this),this.playerAdapter.listenAdCompleted(this.onAdCompleted,this),this.onPageClose=this.onPageClose.bind(this),addEvent(window,"beforeunload",this.onPageClose)}var t=e.prototype;return t.canOperate=function(){return!this.playerAdapter.isPodcast()&&!this.playerAdapter.isAdPlaying()},t.getCurrentAudioParams=function(){var e=this.currentAudioId||this.playerAdapter.getAudioId();if(e){var t=e.split("_");return{ownerId:t[0],audioId:t[1],trackCode:this.currentAudioTrackCode||this.playerAdapter.getAudioTrackCode()}}return{}},t.getEnvParams=function(){return{state:this.playerAdapter.getState(),context:this.playerAdapter.getContext(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):""}},t.getListenedTime=function(){return Math.round(this.playerAdapter.getListenedTime())||0},t.getPlaySubtype=function(){if(this.playerAdapter.isAutoPlayed())return"auto";var e=this.playerAdapter.getSequence();if(e)return e>0?"next_track":"prev_track";var t=this.pausedAudioId,n=this.playerAdapter.getAudioId();return t&&n===t?"pause":"new"},t.onPlay=function(){if(this.canOperate()){var e=this.playerAdapter.getAudio(),t=e.fullId,n=this.currentAudioId===t||!this.currentAudioId,i=this.currentAudioId!==this.pausedAudioId,a=this.playerAdapter.getListenedTime();!n&&i&&this.onTrackSwitch(this.currentAudio,this.currentPlaylistId),this.playedTime=vkNow(),this.currentAudioId=t,this.currentAudio=e,this.currentAudioTrackCode=this.playerAdapter.getAudioTrackCode(),this.currentPlaylistId=this.playerAdapter.getPlaylistId(),this.wasEnded||this.playerAdapter.hasPrevAudio()&&(!this.pausedAudioId||this.playerAdapter.isAutoPlayed())?(this.currentPosition=0,a=0):this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=a,this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition,listened:a}),this.pausedAudioId=null,this.playlistChanged=!1,this.wasEnded=!1}},t.onPause=function(){var e=this,t=this.playerAdapter.getAudioId();if(this.canOperate()&&t){var n=this.collectListenedData();this.sendListenedDataDelayed(1e3,n),setTimeout((function(){if(!(e.currentAudio&&t!==e.currentAudio.fullId||vkNow()-e.playedTime<150)){e.pausedAudioId=t;var n=e.playerAdapter.getPausedBy(e.playedTime);e.sendCurrentAudioEvent({type:"stop",subtype:n?"queue"===n?"queue":"interruption":"pause"})}}),100)}},t.onProgress=function(){this.playerAdapter.getProgress()<.01||!this.playerAdapter.isPlaying()||(this.currentPosition=this.playerAdapter.getProgressInSeconds(),this.currentListened=this.playerAdapter.getListenedTime(),!this.pausedAudioId&&vkNow()-this.playedTime>150&&this.collectListenedData(),this.adsCompleted&&(this.sendCurrentAudioEvent({type:"start",subtype:this.getPlaySubtype(),position:this.currentPosition}),this.adsCompleted=!1))},t.onVolume=function(){this.canOperate()&&this.sendCurrentAudioEvent({type:"volume",subtype:"default"})},t.onSeek=function(){if(this.canOperate()){var e={position:this.currentPosition,positionTo:this.playerAdapter.getProgressInSeconds()};e.position!==e.positionTo&&this.sendCurrentAudioEvent(Object(F.a)({type:"rewind",subtype:"default"},e))}},t.onPlaylistChanged=function(){this.canOperate()&&(this.playlistChanged=!0)},t.onEnded=function(){this.listenedData&&this.playerAdapter.isLastTrack()&&(this.listenedData.end_stream_reason="session_end"),this.wasEnded=!0,this.playerAdapter.isRepeatCurrentAudio()?(this.sendCurrentAudioEvent({type:"stop",subtype:"auto"}),this.collectListenedData(),this.sendListenedData()):this.sendListenedDataDelayed(150)},t.onPlayNext=function(e,t){if(this.canOperate()){var n=t.split("_"),i=n[0],a=n[1];this.sendAudioEvent({type:"play_further",subtype:"default",ownerId:i,audioId:a})}},t.onAdCompleted=function(){this.adsCompleted=!0},t.onTrackSwitch=function(e,t){if(e){var n="new",i=this.playerAdapter.getSequence(),a=e.fullId.split("_"),o=a[0],r=a[1];this.playerAdapter.isAutoPlayed()?n="auto":i&&(n=i>0?"next_track":"prev_track"),this.sendCurrentAudioEvent({type:"stop",subtype:n,position:this.currentPosition,listened:this.currentListened,trackCode:e.trackCode,playlistId:t,ownerId:o,audioId:r}),this.wasEnded=!0,this.collectListenedData(e),this.collectListenedDataSwitch();var s=this.listenedData;this.listenedData=null,this.sendListenedData(s)}},t.onPageClose=function(){this.playerAdapter.isPlaying()&&(this.sendCurrentAudioEvent({type:"stop",subtype:"close_app"}),this.sendListenedData())},t.collectListenedDataSwitch=function(){if(this.listenedData){if("session_end"===this.listenedData.end_stream_reason)return;var e=this.playerAdapter.isAutoPlayed(),t=this.getListenedTime(),n=this.playerAdapter.getSequence(),i=null;n&&!e?i=n>0?"next_btn":"prev":this.playlistChanged&&(i="playlist_change"),!i&&e&&(i="playlist_next"),this.listenedData.end_stream_reason=i||"new",t&&(this.listenedData.listened=t)}},t.collectListenedData=function(e){void 0===e&&(e=null);var t=e||this.currentAudio;if(this.canOperate()&&t){var n=t.fullId,i=t.trackCode||this.playerAdapter.getAudioTrackCode(),a=this.getListenedTime(),o=t.urlHash;if(o||console.log("no url hash"),a&&o){var r={audio_id:n,listened:a,context:this.playerAdapter.getContext(),hash:o};return window.cur&&vk.widget&&(r.ref=cur.widgetReferrer||""),this.playerAdapter.hasSearchParams()&&(r.search_params=JSON.stringify(this.playerAdapter.getSearchParams())),this.playerAdapter.hasPlaylist()&&(this.playerAdapter.isRealPlaylist()&&(r.playlist_id=this.playerAdapter.getPlaylistId()),this.playerAdapter.isShuffledPlaylist()&&(r.shuffled=1)),i&&(r.track_code=i),this.playerAdapter.isRepeatCurrentAudio()?r.repeat="one":this.playerAdapter.isRepeatAll()&&(r.repeat="all"),this.playerAdapter.isAutoPlayed()&&(r.auto=1),this.playerAdapter.hasPrevAudio()&&(r.prev_audio_id=this.playerAdapter.getPrevAudioId()),this.playerAdapter.hasPrevPlaylist()&&this.playerAdapter.isRealPrevPlaylist()&&(r.prev_playlist_id=this.playerAdapter.getPrevPlaylistId()),this.playerAdapter.isPlaying()||(r.end_stream_reason="stop_btn"),r.state=document.hidden?"background":"app",this.listenedData=r,this.sendListenedDataDelayed(1e4,r),r}}},t.sendListenedData=function(e){void 0===e&&(e=null),clearTimeout(this.sendTimeout);var t=e||this.listenedData;this.listenedData=null,t&&t.listened&&(this.uniqueUserId&&(t.unique_id=this.uniqueUserId),this.playerAdapter.sendListenedData(t))},t.sendListenedDataDelayed=function(e,t){var n=this;void 0===e&&(e=0),void 0===t&&(t=null),clearTimeout(this.sendTimeout),this.sendTimeout=setTimeout((function(){return n.sendListenedData(t)}),e)},t.serializeEvent=function(e){var t=[ji[e.type],Si[e.subtype],1];return e.audioId?t.push(e.ownerId+"_"+e.audioId):t.push(0),e.trackCode?t.push(e.trackCode):t.push(0),e.state?t.push(e.state):t.push(0),e.ref?t.push(e.ref):t.push(""),e.context?t.push(e.context):t.push("other"),e.volume||0===e.volume?t.push(e.volume):t.push(this.playerAdapter.getVolume()),e.position||0===e.position?t.push(e.position):t.push(this.playerAdapter.getProgressInSeconds()),e.shuffle?t.push(e.shuffle?1:0):t.push(0),e.repeat?t.push(e.repeat):t.push(0),e.listened?t.push(Math.max(e.listened,0)):t.push(0),e.playlistId?t.push(e.playlistId):t.push(""),e.targetOwnerId?t.push(e.targetOwnerId):t.push(0),this.uniqueUserId?t.push(this.uniqueUserId):t.push(""),e.positionTo?t.push(e.positionTo):t.push(null),t},t.sendEvent=function(e){this.debug&&(console.log("audio stats event",e.type,e.subtype,e),window._statForTest||(window._statForTest=[]),window._statForTest.push(e)),D.a.apply(void 0,["audio_sts"].concat(this.serializeEvent(e)))},t.sendCurrentAudioEvent=function(e){this.sendEvent(Object(F.a)({shuffle:this.playerAdapter.isShuffledPlaylist(),repeat:this.playerAdapter.isRepeatCurrentAudio()?1:this.playerAdapter.isRepeatAll()?2:0,volume:this.playerAdapter.getVolume(),position:this.playerAdapter.getProgressInSeconds(),listened:this.getListenedTime(),playlistId:this.playerAdapter.getPlaylistId()},this.getEnvParams(),{},this.getCurrentAudioParams(),{},e))},t.sendAudioEvent=function(e){var t=Object(F.a)({},e,{},this.getEnvParams());!vk.id&&this.uniqueUserId&&(t.uniqueUnauthId=this.uniqueUserId),this.sendEvent(t)},t.destroy=function(){this.playerAdapter.unListenAll(),removeEvent(window,"beforeunload",this.onPageClose),this.playerAdapter=null,this.listenedData=null,clearTimeout(this.sendTimeout)},e}(),Ei=n("dI71"),Ti=function(e){function t(){return e.apply(this,arguments)||this}Object(Ei.a)(t,e);var n=t.prototype;return n.getPausedBy=function(e){return ge("StoriesView")?"stories":null},n.getState=function(){var t=e.prototype.getState.call(this),n=this.getAudioId();return n&&ge("audio"+n)?2:t},n.getProgress=function(){var e=this.player.getCurrent();return e?this.player.getPosition()/e.duration:0},n.getProgressInSeconds=function(){return Math.round(this.player.getPosition())},n.getVolume=function(){return Math.round(100*this.player.volume())},n.getAudioId=function(){return this.player.getCurrentId()},n.getAudio=function(){return this.player.getCurrent()},n.getAudioTrackCode=function(){try{return this.player.getCurrent().trackCode}catch(e){return!1}},n.getPrevAudioId=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();if(e){var n=t.lastIndexOf(e);if(-1!==n)return t[n-1]}},n.getPlaylistIdFromAudioId=function(e){return vi(e)},n.getPlaylistTypeFromAudioId=function(e){if(e&&isString(e)){var t=e.split("_"),n=t[0],i=t[1],a=t[2],o=t[3];return n&&i?a&&0===a.indexOf("playlist")?a.replace("playlist","")+"_"+o:a:void 0}},n.getPrevPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getPrevAudioId())},n.getPlaylistId=function(){return this.getPlaylistIdFromAudioId(this.getAudioId())},n.updateContext=function(){var e=this.getPlaylistTypeFromAudioId(this.getAudioId());if(e){var t=this.getContextByType(e);"other"===t&&nav.getQuery("from")?this.context=this.getContextByType(nav.getQuery("from")):this.context=t}else this.context="other"},n.getContextByType=function(e){if(void 0===e&&(e=""),0===e.indexOf("recoms"))return nav.getQuery("q")?"search":"recs";if(0===e.indexOf("audios")){var t=intval(e.replace("audios",""));return t===vk.id?"my":t<0?"group_list":"user_list"}return 0===e.indexOf("popular")?"recs_audio":0===e.indexOf("search")?"search":0===e.indexOf("wall")?"group_list":0===e.indexOf("mail")?"im":0===e.indexOf("feed")?"feed":"other"},n.getContext=function(){return this.context||"other"},n.getSequence=function(){return 0},n.getSearchParams=function(){return null},n.getType=function(){return"html5"},n.isPlaying=function(){return this.player.playing()},n.isAutoPlayed=function(){return window.audioplayer.isAutoPlayed()},n.isRepeatCurrentAudio=function(){return!1},n.isRepeatAll=function(){return!1},n.isShuffledPlaylist=function(){return!1},n.isPodcast=function(){return!1},n.isAdPlaying=function(){return!1},n.isRealPlaylist=function(){return!0},n.isRealPrevPlaylist=function(){return!0},n.isLastTrack=function(){var e=this.player.getCurrent(),t=this.player.playlist();return!!e&&(!(!e||t&&t.length)||t.indexOf(e)+1===t.length)},n.hasPrevPlaylist=function(){return!1},n.hasPlaylist=function(){var e=this.player.playlist();return Boolean(e&&e.length>1)},n.hasPrevAudio=function(){var e=this.getAudioId(),t=window.audioplayer.getPlaybackQueue();return Boolean(e&&t.length>1)},n.hasSearchParams=function(){return!1},n.isDebug=function(){return Boolean(lsGet("audio_stats_debug"))},n.sendListenedData=function(e){var t=nav.getQuery("from");ajax.post("/audio",{_ajax:1,act:"playback",audio:e.audio_id,track_code:e.track_code,prev:e.prev_audio_id,state:e.state,from_block:t,listened:e.listened,hash:e.hash,playlist_id:e.playlist_id,end_stream_reason:e.end_stream_reason,auto:e.auto,unique_user_id:e.unique_id})},t}(Oi),Ii=n("jE6c"),Mi=n("TZ9a"),Pi=n("N25v"),xi=n("EDm3");function Li(e){var t=["ai_controls"];e.position&&t.push("ai_has_position");var n=e.can_del?"true":"false",i="return window.audioplayer.morePopup(event, '"+e.audio_id+"', '"+e.access_key+"', "+n+");",a=e.is_authenticated?"audioplayer.setPosition(this, event);":null,o=e.is_authenticated?"audioplayer.sliderMove(event);":null,r=e.is_authenticated?"audioplayer.sliderUp(event);":null,s="aic_line";e.is_authenticated||(s+=" aic_line_blocked");var c=["ai_chart_info_state"],l="";switch(e.chart_info_state){case"new_release":c.push("ai_chart_info_state-new_release"),l=Object(xi.m)();break;case"no_changes":c.push("ai_chart_info_state-no_changes"),l=Object(xi.k)();break;case"moved_up":c.push("ai_chart_info_state-moved_up"),l=Object(xi.t)();break;case"moved_down":c.push("ai_chart_info_state-moved_down"),l=Object(xi.h)();break;case"crown":c.push("ai_chart_info_state-crown"),l=Object(xi.g)();break;default:l=""}return(e.chart_info_position||l)&&t.push("ai_controls_chart"),{inner:[{inner:[Ri(e),e.has_actions_menu?{inner:[{class:"i_pointer",tag:"i"},{class:"ai_menu_toggle_button",onClick:i,"aria-label":Object(ae.t)("mobile_more"),tag:"button"}],class:"ai_menu_wrap",tag:"div"}:null,{inner:[e.chart_info_position||l?{inner:[e.chart_info_position?{inner:[e.chart_info_position],class:"ai_chart_info_position",tag:"div"}:null,l?{inner:[l],class:c,tag:"div"}:null],class:"ai_chart_info",tag:"div"}:null,e.duration?{inner:[e._duration_title],class:"ai_dur","data-dur":e.duration,onClick:"audioplayer.switchTimeFormat(this, event);",tag:"time"}:null,{inner:[{inner:[Wd.wrap(e.title),e.subtitle?{inner:[Wd.wrap(e.subtitle)],class:"ai_subtitle",tag:"span"}:null],class:"ai_title",tag:"span"},e.title?{inner:[Wd.wrap(" &ndash; ")],class:"divider",tag:"span"}:null,{inner:[Wd.wrap(e.artist)],class:"ai_artist",tag:"span"}],class:"ai_label",tag:"div"},{type:"hidden",value:e.url,tag:"input"}],class:"ai_body",tag:"div"}],class:"ai_info",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{class:"aic_ln aic_load_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:s,onTouchStart:e.is_mobile?a:null,onMouseDown:e.is_mobile?null:a,onTouchMove:e.is_mobile?o:null,onTouchEnd:e.is_mobile?r:null,onTouchCancel:e.is_mobile?r:null,onMouseMove:e.is_mobile?null:o,onMouseUp:e.is_mobile?null:r,onClick:"cancelEvent(event);",tag:"div"}],class:"aic_progress_wrap",tag:"td"},{inner:[{inner:[{class:"aic_ln aic_back_line",onClick:"cancelEvent(event);",tag:"div"},{inner:[{inner:[{class:"aic_slider",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_progress_line",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_ln aic_pl_wrap",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_line",onTouchStart:e.is_mobile?"audioplayer.setVolume(this, event);":null,onMouseDown:e.is_mobile?null:"audioplayer.setVolume(this, event);",onTouchMove:e.is_mobile?"audioplayer.sliderMove(event);":null,onTouchEnd:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onTouchCancel:e.is_mobile?"audioplayer.sliderUp(this, event);":null,onMouseMove:e.is_mobile?null:"audioplayer.sliderMove(event);",onMouseUp:e.is_mobile?null:"audioplayer.sliderUp(event);",onClick:"cancelEvent(event);",tag:"div"}],class:"aic_volume_wrap",tag:"td"}],tag:"tr"}],class:"row_table",tag:"table"}],class:t,tag:"div"}],tag:"div"}}function Ri(e){var t=e.is_playlist_forced?", true":"",n="audioplayer.playPause(event, '"+e.audio_id+"'"+t+");",i="",a=e.has_cover?Object(W.a)(Object(Mi.a)()):Object(xi.T)(),o=e.has_cover?Object(W.a)(Object(Pi.a)()):Object(xi.P)();return e.has_cover&&!e.cover_style&&(i={inner:[Object(xi.xb)()],class:"ai_cover_placeholder",tag:"span"}),{inner:[i,{inner:[a],class:"i_play",tag:"span"},{inner:[o],class:"i_pause",tag:"span"}],class:"ai_play",style:e.cover_style,onClick:n,tag:"button"}}var Bi=function(e){var t=e.is_playlist_forced?", true":"",n=e.is_disabled?"":"audioplayer.playPause(event, '"+e.audio_id+"'"+t+")",i=e.classes||[],a={};a[e.audio_id]=!0;var o=[u.a.class("audio_item",a,"_"),e.is_no_progress&&"ai_noProgress",e.is_focus&&"ai_focus",e.is_explicit&&"audio_item_explicit",e.is_disabled&&"audio_item_disabled",(e.can_add||e.can_del)&&"ai_has_btn",!e.has_actions_menu&&"ai_no_menu",e.has_cover&&"ai_has_cover"];e.is_attachment&&o.push("ai_select");var r=Object(ae.Q)(o,i).filter((function(e){return e})).join(" ");return e.is_attachment?{inner:[Li(e)],"data-id":e.audio_id,class:r,"data-audio":e.serialized,href:e.attachment_action,tag:"a"}:{inner:[Li(e)],"data-id":e.audio_id,"data-playlist-id":e.playlist_id,class:r,onClick:n,"data-audio":e.serialized,tag:"div"}},Ni=window.audio,Di=function(){if(!HTMLAudioElement)return{init:function(){},initAudio:function(){}};var e=!1,t="1"==lsGet("audio_time_left"),n={},i=!1,a=!1,o=!1,r=[],s=null,l=[];function u(e){if(e){$$("#lm_player").forEach((function(e){show(e)})),$$("#lm_audio").forEach((function(t){t&&(t.querySelector(".ai_artist").innerHTML=e.performer,t.querySelector(".ai_title").innerHTML=e.title,t.querySelector(".ai_play").style.backgroundImage=e.coverUrl_p?"url("+e.coverUrl_p+")":""),Ni.isAdsPlaying()&&V(e,!0)}));var t=fi(e.fullId);t&&each(t,(function(t,n){Ni.isAdsPlaying()?(H(e,!0),addClass("ai_playing",n)):(S(n,0),E(n,0),j(n,M(0,Ni.duration()))),T(n,Ni.volume()),addClass("ai_current",n)}))}else $$("#lm_player").forEach((function(e){hide(e)}))}function p(e){var t=e.fullId,i=e.duration;$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}));var a=fi(t);a&&(each(a,(function(e,t){j(t,I(i)),removeClass("ai_playing",t),removeClass("ai_current",t)})),n[t]&&delete n[t],Ni.isAdsPlaying()&&H(e,!1))}function h(e,t,i,a){var o=fi(e);if(o.length){var r=t*(i||0);each(o,(function(e,n){v||E(n,t),j(n,Di.getFormatedTime(r,i))})),r>1&&(n[e]=1)}}function f(e,t){window.audio.playNothing(),ajax.post("/audio",{act:"block_playlist",block_id:e},{onDone:function(n){if(n){var i=n.map((function(e){return si(e)}));Ni.playlist(i),Ni.setPlaylistId(e),t&&t(i)}}})}function m(e,t){void 0===t&&(t=!1);var n=mi(e),i=gpeByClass("audios_list",n)||gpeByClass("AudioBlock",n),a=geByClass("audio_item",i),o=[],r=!1;each(a,(function(t,n){var i=JSON.parse(domData(n,"audio"));if(i){var a=si(i);o.push(a),a.fullId===e&&(r=!0)}})),Ni.playlist(o,{q:attr(i,"data-query")}),t&&r&&r&&Ni.play(e)}onDOMReady((function(){window.playerAdapter=new Ti(Ni),new Ci(window.playerAdapter),l=Pe.initBannerBlocks()})),window.page.onChange((function(){"audio"===cur.module&&(l&&l.forEach((function(e){return e.destroy()})),l=Pe.initBannerBlocks())})),Ni.subscribe(Jt.a.PLAY,(function(e){var t=Ni.getCurrent();t&&Ni.playing()&&!Ni.isAdsPlaying()&&ajax.post("/audio",{act:"start_playback",audio_id:t.id,owner_id:t.ownerId,hash:t.actionHash,uuid:Ni.getDeviceId()});e,$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}));var n=fi(e);if(!n)return;each(n,(function(e,t){addClass("ai_playing",t),addClass("ai_current",t)})),r[r.length-1]!==e&&r.push(e);o?o=!1:(a=i,i=!1,Di.onPlay(e));B()})),Ni.subscribe(Jt.a.PLAY_REQUESTED,(function(e){D(e)})),Ni.subscribe(Jt.a.PAUSE,(function(e){$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)})),B();var t=fi(e);if(!t.length)return;each(t,(function(e,t){removeClass("ai_playing",t),addClass("ai_current",t)})),o||(Di.onPause(e),B())})),Ni.subscribe(Jt.a.SELECT,u),Ni.subscribe(Jt.a.DESELECT,p),Ni.subscribe(Jt.a.PROGRESS,h),Ni.subscribe(Jt.a.SEEK,h),Ni.subscribe(Jt.a.AD_STARTED,(function(e){H(e,!0),V(e,!0)})),Ni.subscribe(Jt.a.AD_COMPLETED,(function(e){H(e,!1),V(e,!1),h(e.id,0,0)})),Ni.subscribe(Jt.a.NOT_FOUND_PLAYLIST,m),Ni.subscribe(Jt.a.EMPTY_PLAYLIST,m),Ni.subscribe(Jt.a.ENDED,(function(e){var t=geBySel('.audio_item[data-id="'+e+'"]');t&&(each(t,(function(e,t){E(t,1)})),i=!0,window.Unauthorized&&window.vk&&!window.vk.id&&Object(C.b)("audio_unauth_preview_box")&&(i=!1,window.audio.pause(),window.Unauthorized.showMoreBox(null,0,Ft)),Di.onEnded(e))})),Ni.subscribe(Jt.a.VOLUME,(function(e,t){var n=geBySel('.audio_item[data-id="'+e+'"]');n&&(each(n,(function(e,n){T(n,t)})),Di.onVolume(e,t))}));var v=null,g=null,b=!1,A=!1,w=!1;function y(e){if(v){w||(addEvent(document,U.b?"touchmove":"mousemove",y),addEvent(document,U.b?"touchend touchcancel":"mouseup",O),w=!0);var t=gpeByClass("audio_item",v),n=k(v,e);e&&cancelEvent(e);var i=fi(attr(t,"data-id"));each(i,(function(e,t){b&&E(t,n),A&&(T(t,n),Ni.volume(n))})),g=n}}function O(e){if(v){w=!1,removeEvent(document,U.b?"touchmove":"mousemove",y),removeEvent(document,U.b?"touchend touchcancel":"mouseup",O);var t=gpeByClass("audio_item",v),n=k(v,e)||g;e&&cancelEvent(e);var i=geBySel('.audio_item[data-id="'+attr(t,"data-id")+'"]');each(i,(function(e,i){b&&(E(i,n),Ni.setPosition(n,!0)),A&&T(t,n)})),b&&(o=Ni.playing(),Di.onSeek(n)),v=g=null,b=A=!1}}function k(e,t){var n=gpeByClass("Slider__scroll",e),i=hasClass("touch",window.bodyNode)?10:8,a=(t.pageX||t.touches&&t.touches[0]&&t.touches[0].pageX||0)-(n?e.getBoundingClientRect().left:getX(e))-i/2,o=e.offsetWidth-i;return o?Math.max(0,Math.min(a/o,1)):0}function j(e,t){if(e){var n=geByClass1("ai_dur",e);val(n,t)}}function S(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_load_line",n);i&&(i.style.width=100*Math.max(0,Math.min(t,1))+"%")}}function E(e,t){if(e){var n=geByClass1("aic_progress_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function T(e,t){if(e){var n=geByClass1("aic_volume_wrap",e),i=geByClass1("aic_progress_line",n);i&&(i.style.width=100*t+"%")}}function I(e){var t,n,i,a=e<0;return t=(n=(e=Math.round(a?-e:e))%60)<10?"0"+n:n,t=(i=(e=Math.floor(e/60))%60)+":"+t,(e=Math.floor(e/60))>0&&(i<10&&(t="0"+t),t=e+":"+t),a&&(t="-"+t),t}function M(e,n){return I(t&&n?e-n:e)}function P(e){var t=window.cur;t.deletedAudios||(t.deletedAudios={}),t.deletedAudios[e]=!0}function x(e){var t=window.cur;t.deletedAudios&&delete t.deletedAudios[e]}function L(e,t,n){void 0===n&&(n=null),t?function(e){var t=window.cur;t.addedAudios||(t.addedAudios={}),t.addedAudios[e]=!0}(e):function(e){var t=window.cur;t.addedAudios&&delete t.addedAudios[e]}(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_added",n,t),val(geByClass1("ai_add",n),t?lang.global_delete_audio:lang.global_add_to_audio)}));var a=geBySel1('body > [id="ai_menu_'+e+'"]'),o=geByClass1("ai_add",a);val(o,t?lang.global_delete_audio:lang.global_add_to_audio),W[e]=t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_delete_audio:lang.global_add_to_audio),ActionMenu.update()}function R(e,t,n){void 0===n&&(n=null),t?P(e):x(e);var i=geBySel('.audio_item[data-id="'+e+'"]');each(i,(function(e,n){toggleClass("ai_deleted",n,t),val(geByClass1("ai_del",n),t?lang.global_add_to_audio:lang.global_delete_audio)}));var a=geBySel1('body > [id="ai_menu_'+e+'"]'),o=geByClass1("ai_del",a);val(o,t?lang.global_add_to_audio:lang.global_delete_audio),W[e]=!t,n&&((n.querySelector(".Btn__text")||n).innerText=t?lang.global_add_to_audio:lang.global_delete_audio),ActionMenu.update()}function B(){var e=window.audio.getCurrentId(),t=fi(e),n=[],i=window.audio.playing();i&&e&&t.length&&t.forEach((function(e){var t=gpeByClass("audios_list",e)||gpeByClass("mcont",e);n.push(t)})),each(geByClass("_AudioPlayStatus"),(function(e,t){var n=i&&t.dataset.playlistId===Ni.getCurrentPlaylistId();toggleClass(t,"playing",n)}))}function N(e,t,n){if(window.isArticleWebView)return Article.audioPlay(Ni.getCurrentId(),Ni.playlist()),cancelEvent(e),!1;var i=window.lang;if(Ni.support){var a=mi(t);if(a&&hasClass("ai_deleted",a)&&!hasClass("ai_current",a))return!0;n&&t!==Ni.getCurrentId()||vi(t)!==Ni.getCurrentPlaylistId()?m(t,!0):Ni.operate(t)}else alert(i.mobile_audio_player_not_support);return cancelEvent(e),!1}function D(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var i=fi(e);Ni.playing()?(each(i,(function(e,t){addClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){addClass("ai_playing",e)}))):(each(i,(function(e,t){removeClass("ai_playing",t)})),$$("#lm_audio").forEach((function(e){removeClass("ai_playing",e)}))),null!==t&&null!==n&&each(i,(function(e,i){S(i,t/n),addClass("ai_current",i)}))}function H(e,t){var n=mi(e.fullId);toggleClass("ad_mode",n,t);var i=geByClass1("ai_title",n);val(i,t?Object(ae.t)("global_audio_ad"):e.title),toggleClass("ad_placeholder",i,t)}function V(e,t){geBySel(".audio_item.al_player").forEach((function(n){if(n){var i=geByClass1("ai_title",n);val(i,t?Object(ae.t)("global_audio_ad"):e.title),toggleClass("ad_placeholder",i,t),toggleClass("ad_mode",n,t),toggle(geByClass1("ai_artist"),!t)}}))}var W={},q={};return page.onChange((function(){W={},q={}})),{init:function(t){e||(e=!0,onDOMReady((function(){window.nav&&window.audio&&window.audioplayer&&"#player"==nav.hash&&Ni.playlist().length&&Di.openPlayer(geByClass1("AudioPlayerMini"),!0)})))},initAudio:function(){each(geByClass("ai_current"),(function(e,t){p(t=function(e){if(!(e=ge(e))||!e.dataset.audio)return null;var t=null;try{t=JSON.parse(e.dataset.audio)}catch(e){return null}return si(t)}(t))}));var e=Ni.loaded(),t=Ni.getPosition(),n=Ni.duration(),i=n?t/n:0;D(Ni.getCurrentId(),e,n),u(Ni.getCurrent()),h(Ni.getCurrentId(),i,n),setTimeout((function(){B()}),1)},getDOMFromAudio:function(e,t,n,i){if(!Object.keys(e).length)return'<div class="audio_item audio_item_disabled"></div>';var a=si(e);if(!a)return"";var o=Object(Ii.f)(a.ownerId+"_"+a.id),r=a.coverUrl_p||a.coverUrl_s,s=e,c=[];if(function(e){var t=window.cur;return!!t.deletedAudios&&t.deletedAudios[e]}(o)){if(n)return"";c.push(" ai_deleted")}(function(e){var t=window.cur;return!!t.addedAudios&&t.addedAudios[e]})(o)&&c.push("ai_added"),o===Ni.getCurrentId()&&(Ni.playing()&&c.push("ai_playing"),c.push("ai_current"));var l=!!vk.id&&(!a.isClaimed||a.canDelete);vk.id||c.push("ai_no_menu");var u=new Bi({is_playlist_forced:t,is_disabled:a.isClaimed,audio_id:o,is_authenticated:!!vk.id,login_redirect_url:"",is_explicit:a.isExplicit,can_add:a.canAdd,can_del:a.canDelete,serialized:JSON.stringify(s),classes:c,has_cover:i,cover_style:r?"background-image: url("+r+")":"",has_actions_menu:l,position:a.chartInfo?a.chartInfo.position:"",duration:a.duration,is_mobile:U.b,_duration_title:I(a.duration),title:a.title,subtitle:a.subtitle,artist:a.performer,url:a.url});return _.a.html(u)},morePopup:function(e,t,n,i){if(void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),null===t){var a=Ni.getCurrent()||{};t=a.fullId,n=a.accessKey,i=a.canDelete,q[t]=a}var o="";o=void 0!==W[t]?W[t]?Object(ae.t)("global_delete_audio"):Object(ae.t)("global_add_to_audio"):i?Object(ae.t)("global_delete_audio"):Object(ae.t)("global_add_to_audio"),ne.f.open(_.a.elem(Object(ne.f)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[{tag:"ul",class:"ContextMenu__list",inner:[!i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:o,onclick:"return audioplayer.add('"+t+"', '"+n+"', event, this);"}]},i&&{tag:"li",class:"ContextMenu__listItem",inner:[{tag:"a",class:"ContextMenu__listLink",href:"#",inner:o,onclick:"return audioplayer.del('"+t+"', event, this);"}]}]}]})),!0),e&&cancelEvent(e)},add:function(e,t,n,i){void 0===t&&(t=null),void 0===i&&(i=null);var a=mi(e);if(!hasClass("ai_ajax",a)){var o=a?si(JSON.parse(a.dataset.audio)):q[e]||{};q[e]||(q[e]=Object(F.a)({},o));var r=!1;a?(r=hasClass("ai_added",a),q[e].deleteid=attr(a,"data-deleteid"),q[e].deleteHash=attr(a,"data-delete-hash")):void 0!==W[e]&&(r=W[e]),o.deleteid=o.deleteid||q[e].deleteid,o.deleteHash=o.deleteHash||q[e].deleteHash,o.restoreHash=o.restoreHash||q[e].restoreHash,L(e,!r,i),addClass("ai_ajax",a),Di.onAdd(),i&&(i.disabled=!0),ajax.post("/audio",{_ajax:1,act:r?"delete":"add",audio:r?o.deleteid:o.fullId,hash:r?o.deleteHash:o.addHash,access_key:t,track_code:o.trackCode,source_playlist_id:vi(o.fullId)},{redirectToLoginPage:!0,onDone:function(t,n){removeClass("ai_ajax",a),t?(q[e].deleteid=t,q[e].deleteHash=n,attr(a,"data-deleteid",t),attr(a,"data-delete-hash",n)):L(e,r,i),i&&(i.disabled=!1)},onFail:function(){removeClass("ai_ajax",a),L(e,r,i);var n=Array.prototype.slice.call(arguments),s=n.shift();switch(s){case 2:nav.go("/audio?act=add&audio="+e+"&hash="+(r?o.deleteHash:o.addHash)+"&access_key="+t)}i&&(i.disabled=!1)}}),n&&cancelEvent(n)}},del:function(e,t,n){void 0===n&&(n=null);var i=mi(e),a=!1;i?a=hasClass("ai_deleted",i):void 0!==W[e]&&(a=!W[e]),R(e,!a,n);var o=i?si(JSON.parse(i.dataset.audio)):q[e]||{};q[e]||(q[e]=Object(F.a)({},o)),a?x(e):P(e),Di.onDel(),n&&(n.disabled=!0),o.deleteid=o.deleteid||q[e].deleteid,o.deleteHash=o.deleteHash||q[e].deleteHash,o.restoreHash=o.restoreHash||q[e].restoreHash,ajax.post("/audio",{_ajax:1,act:a?"restore":"delete",audio:e,playlist_id:vi(e),hash:a?o.restoreHash:o.deleteHash},{redirectToLoginPage:!0,onDone:function(t){t||R(e,a,n),n&&(n.disabled=!1)},onFail:function(){R(e,a,n);var t=Array.prototype.slice.call(arguments),i=t.shift();switch(i){case 2:nav.go("/audio?act="+(a?"restore":"delete")+"&audio="+e+"&hash="+(a?o.restoreHash:o.deleteHash))}n&&(n.disabled=!1)}}),t&&cancelEvent(t)},playPause:N,getFormatedTime:M,switchTimeFormat:function(e,n){var i=gpeByClass("audio_item",e);return!(hasClass("ai_current",i)&&!hasClass("ai_select",i))||(t=!t,lsSet("audio_time_left",t?"1":"0"),j(mi(Ni.getCurrentId()),M(Ni.getPosition(),Ni.duration())),n&&cancelEvent(n),!1)},setPosition:function(e,t){v||Ni.isAdsPlaying()||(v=e,b=!0,y(t))},setVolume:function(e,t){v||(v=e,A=!0,y(t))},openPlayer:function(e,t){var n=window.audio,i=nav.path,a=n.getCurrentPlaylistId(),o=nav.params;a&&!o.includes("playlist_id")&&(o=(o?o+"&":"")+"playlist_id="+a);var r=i+(o?"?":"")+o+"#player";return nav.al_go(r,null,{local:!0,target:e,nav:{push:r,path:i,params:o,hash:"#player"},no_push:t})},getCurrentElem:function(){return Object(z.a)(".ai_current")},playFirst:function(e,t){e&&cancelEvent(e);var n=Ni.getCurrent(),i=gpeByClass("_audioPlaylist",t),a=n?n.fullId:null;if(!a||!geByClass1("ai_current",i)){var o=(i||ge("mcont")).$(".audio_item");a=o&&o.getAttribute("data-id")}a&&N(e,a)},hasArticleWebViewClientAudioSupport:function(){return window.clientWebviewAudioSupport},getPlaybackQueue:function(){return r},isAutoPlayed:function(){return a},playBlock:function(e,t,n){t.preventDefault(),Ni.getCurrentPlaylistId()!==e?f(e,(function(t){if(t.length){var i=t[0].fullId;Ni.select(i).then((function(){Ni.play(i),n.classList.add("playing"),n.dataset.playlistId=e}))}})):Ni.operate()},playShuffledBlock:function(e,t){e.preventDefault(),f(t.dataset.blockId,(function(e){if(e.length){var t=e[0].fullId;window.audio.play(t)}}))},openModal:function(e,t){var n=t.parentElement.querySelector(".Popup");return ne.f.open(n,!0),s=Object(c.a)(t),cancelEvent(e),!1},closeModal:function(e){ne.f.close(e),s&&s()},onAdd:Object(d.a)(),onDel:Object(d.a)(),onPlay:Object(d.a)(),onPause:Object(d.a)(),onProgress:Object(d.a)(),onVolume:Object(d.a)(),onSeek:Object(d.a)(),onPlaylistChanged:Object(d.a)(),onEnded:Object(d.a)(),sliderMove:y,sliderUp:O}}();window.audioplayer=Di,window.Section=Le;var Hi=n("vR9X");function Ui(e){var t=Object(ae.f)("PhotoMarketItem__fave",{"PhotoMarketItem__fave--added":e.isFave}),n=["ItemsList._toggleFave",{event:"event",el:"this",type:e.type,typeInt:e.typeInt,ownerId:e.ownerId,itemId:e.itemId,href:e.href,faveHash:e.faveHash}];return{class:t,"data-is-fave":e.isFave?"fave":"",onclick:n,tag:"a"}}function Vi(e){return{inner:[{src:e.thumb,class:"PhotoMarketItem__thumb",tag:"img"},{inner:[e.title],class:"PhotoMarketItem__title",tag:"div"},{inner:[e.price],class:"PhotoMarketItem__price",tag:"div"},Ui({type:e.type,typeInt:e.typeInt,isFave:e.isFave,itemId:e.itemId,ownerId:e.ownerId,href:e.href,faveHash:e.faveHash})],class:"PhotoMarketItem","data-item-id":e.itemId,tag:"div"}}function Fi(){for(var e=[],t=0;t<10;t++)e.push({class:"PhotoItemsList__item PhotoItemsList__item--filler",tag:"div"});return e}function Wi(e){var t=JSON.parse(unescape(e.itemsJSON));return{inner:[{inner:[{class:"PhotoItemsList__closeIcon",onClick:e.onClose,tag:"div"},Object(ae.t)("mobile_photos_market_items_title")],class:"PhotoItemsList__header",tag:"div"},{inner:[t.map((function(e){return{inner:[Vi({itemId:e.item_id,thumb:e.thumb,title:e.title,price:_.a.wrap(e.price),href:e.href,faveHash:e.fave_hash,type:e.type,typeInt:e.type_int,ownerId:e.owner_id,isFave:Wi._faveCache[e.item_id]||e.is_fave})],onClick:["ItemsList._goToItem",e],class:"PhotoItemsList__item",tag:"div"}})),Fi()],class:"PhotoItemsList__body",tag:"div"}],class:"PhotoItemsList",tag:"div"}}var qi={_faveCache:{},_itemsPopup:void 0,_onClose:function(){},_goToItem:function(){},_toggleFave:function(){},_openItemsPopup:function(){}},zi=function(){qi._itemsPopup&&(Un.a.close(qi._itemsPopup),delete qi._itemsPopup)};qi._onClose=zi;var Yi=function(e){var t,n;(null===(t=window.cur.destroy)||void 0===t?void 0:t.includes(qi._onClose))||null===(n=window.cur.destroy)||void 0===n||n.push(qi._onClose),window.nav.go(e.url)};qi._goToItem=Yi;var Gi=function(e){var t=e.event,n=e.el,i=e.type,a=e.typeInt,o=e.ownerId,r=e.itemId,s=e.href,c=e.faveHash;t.stopPropagation();var l=n.dataset.isFave;window.ajax.post("/bookmarks.php",{_ajax:1,item_type:a,act:l?"bookmark_remove":"bookmark_add",hash:c,item_oid:o,item_id:r,link_url:s},{onDone:function(e){if(e){qi._faveCache[r]=!l;var t=document.querySelector(".PhotoItemsList");if(!t)return;t.querySelectorAll(".PhotoMarketItem").forEach((function(e){if(e.dataset.itemId===r.toString()){var t=e.querySelector(".PhotoMarketItem__fave");if(!t)return;t.outerHTML=_.a.html(Ui({type:i,typeInt:a,isFave:!l,ownerId:o,itemId:r,href:s,faveHash:c}))}}))}}})};qi._toggleFave=Gi;var Qi=function(e){var t=Object(ne.f)({class:"Photo__marketItemsModal",body:Wi({itemsJSON:e,onClose:["ItemsList._onClose"]})});qi._itemsPopup=Un.a.open(_.a.elem(t),!0)};qi._openItemsPopup=Qi,Object.assign(Wi,qi),Wi._onClose=zi,Wi._goToItem=Yi,Wi._toggleFave=Gi,Wi._openItemsPopup=Qi,window.ItemsList=Wi;var Ki=browser.meizu||browser.mi||browser.uc_mini||0!==browser.ios&&browser.ios<10||browser.chrome&&browser.version.split(".")[0]<53,Xi=!Ki&&!!l.e.getFlag(l.b);onDOMReady((function(){Ji.onUpdate(),page.onChange((function(){Ji.onUpdate()}))}));var $i={gifs:[],currentAutoplayElement:null,ignore:[]},Ji={isBadBrowser:Ki,isMp4Supports:function(){return Xi},openPopup:function(e,t,n){if(void 0===n&&(n={}),this.autoplayTest(),e&&cancelEvent(e),function(e){cur.loadedGifs||(cur.loadedGifs={});return!cur.loadedGifs[e.raw]}(n)&&n.needConfirm){var i=function(e){return Object(o.l)(_.a.html(Object(Rn.a)({scrollable:!0,header:{title:getLang("mobile_wall_gif_size_warning_popup_title")},content:[getLang("mobile_wall_gif_size_warning").replace("{size}",e.size),{class:"Popup__buttons",inner:[Object(Kt.a)({onClick:'Gif.confirm(this, "'+e.raw+'")',use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:_.a.wrap(getLang("mobile_continue"))}),Object(Kt.a)({onClick:"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"secondary",inner:_.a.wrap(getLang("mobile_cancel"))})]}]})))}(n,t.getAttribute("data-media"));return domInsertBefore(i,t),void Rn.a.open(i,!0)}Object(C.b)("mvk_mediaview")?Ji.openMediaView(n.raw,n.hash,{hasVideo:n.hasVideo,no_push:n.no_push}):photo.zopen(null,null,n.raw,"",{no_push:n.no_push,isDoc:!0,hasVideo:n.hasVideo,hash:n.hash})},openMediaView:function(e,t,n){void 0===n&&(n={});var i=makeUrl("/doc"+e+(n.hasVideo?"?mp4":""),{hash:t});Object(Yt.a)().then((function(a){var r=a.mediaViewManager,s=a.actionBridge,c=a.setItems;Object(o.oc)(bt.e,"init","gif");var l=s.handle("visibilityChanged",(function(i){if(i.state){var a=nav.getQuery(),r=Object(F.a)({},a,{z:"doc"+e+"/"+(t||"")}),s=!!a.z,c=nav.path+Object(o.Ib)(r)+nav.hash;nav.go(c,null,{no_push:n.no_push,push_only:!0,replace:s})}else{var u;if(l(),null==(u=i.params)?void 0:u.preventHistoryBack)return;var d=qs2obj(nav.params);if(!!d.z&&history.length>1)return history.back(),clog("History back done"),!1;var _=nav.path+Object(o.Ib)(d)+nav.hash;nav.backToTabHistory(null,{href:_,replace:!0,restore:!0})}}));c([{type:2,id:e,gifType:n.hasVideo?"video":"image",src:i}]),r.open()})).catch((function(){window.open(i,"_blank")}))},init:function(e){zlayer.create(Zi()),zlayer.open()},close:function(){var e=Object(F.a)({},nav.getQuery());delete e.z;var t=nav.path+Object(o.Ib)(e)+nav.hash;nav.go(t,null,{push_only:!1,nav_incr:!0})},confirm:function(e,t){cur.loadedGifs[t]=!0,Rn.a.close(e),Object(o.P)('[data-media="'+t+'"]').click()},autoplayTest:function(){l.e.detectAutoplay().then((function(e){Xi=l.e.getFeatures().mp4&&e&&l.e.getFlag(l.b)&&!Ki}))},activateGIF:function(){if("/mail"!==nav.path){var e=scrollTop(),t=e+window.innerHeight,n=e+window.innerHeight/2,i={};Array.from($i.gifs||[]).forEach((function(a){var o=getXY(a)[1],r=o>=e&&o<=t,s=Math.abs(n-o);r&&(i[s]=a)}));var a=i[Math.min.apply(Math,Object.keys(i))];a?a.classList.contains("current_gif")||-1===$i.ignore.indexOf(a)&&(post.toggleGif(a,!1,!1,!0),$i.currentAutoplayElement=a):post.hidePlayingGifs(!1,!0)}},onUpdate:function(){l.e.getFlag(l.a)&&($i.gifs=[].concat(Array.from($$(".doc_preview_rows_1 .doc_preview_gif")||[])),onBodyScroll(Object(o.sc)(Ji.activateGIF,200)))},getState:function(){return $i},setState:function(e,t){$i[e]=t}};function Zi(e){void 0===e&&(e=!1);var t='<img class="zpv_img" alt="">';return e&&(t='<video class="zpv_img" alt="" autoplay preload="metadata" crossorigin="anonymous" poster="/images/blank.gif" webkit-playsinline playsinline controls loop muted>'),'\n    <div id="z_photoview">\n      <div class="zpv_siblings">\n        <div id="zpv_left" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n        <div id="zpv_right" class="zpv_thumb_item">\n          <img class="zpv_img" alt="">\n        </div>\n      </div>\n      <div class="zpv_body">\n        <div id="zpv_center" class="zpv_thumb_item">\n          '+t+'\n        </div>\n      </div>\n      <div class="zpv_close_msg_wrap">\n        <div class="zpv_close_msg"> '+lang.mobile_zphoto_move_to_close+'</div>\n      </div>\n      <div class="zpv_controls">\n        <div class="mhead zpv_header">\n          <a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a>\n          <div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div>\n        </div>\n      </div>\n      <div class="zpv_tags"></div>\n      <div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div>\n    </div>\'\n  '}window.Gif=Ji;function ea(e){return void 0===e&&(e={}),Object(Un.a)({on_overlay_click_native:"QRPhotoPosting.back();",class:"QRPhotoPosting",content:[{class:"QRPhotoPosting__img",inner:Wd.wrap(e.svg)},{class:"QRPhotoPosting__title",inner:Wd.wrap(e.title)}]})}function ta(){return{inner:[Object(xi.U)()],class:"QRPhotoPosting__button",onclick:"QRPhotoPosting.show();",tag:"div"}}var na,ia=n("wZQE"),aa=n.n(ia);function oa(e){var t=/photo(-?\d+)_(\d+)/i.exec(e||nav.cur);return Object(ae.A)(t)||(t=["",0,0]),{album:Object(o.mb)(t[1]),photo:Object(o.mb)(t[2])}}function ra(e){return-86529522===oa(e).album&&Object(C.b)("mvk_photo_fest_qr_sharing")?ta():""}function sa(e){var t=Object(z.a)("#z_photoview .zpv_values"),n=_.a.elem(ra(e));Object(o.f)(n,t)}window.QRPhotoPosting=ea,Object(o.K)(ea,{show:function(){var e=oa(),t="https://vk.com/fest?publish_photo="+e.photo,n=aa.a.createQR(t,271,"QRPhotoPosting__svg",{isShowLogo:!0});na=Un.a.open(_.a.elem(ea({svg:n,title:window.lang.mobile_photo_qr_popup_title})),!0),nav.go(nav.path+"?z=publish_photo"+e.photo,null,{push_only:!0,nav_init:!1,nav_incr:!0})},close:function(){na&&Un.a.close(na)},back:function(){window.history?window.history.back():window.location="/"},getQRPhotoButton:ra,QRPhotoPosting:ea,QRPhotoPostingButton:ta,appendQRPhotoButton:sa});var ca=n("vhZE"),la=n("he4e"),ua=window.ajax,da=window.thover,_a=window.nav,pa=(window.page,window.PhotoLike),ha=window.zlayer,fa=window.photo,ma=function(){var e=!1,t=!1,n=!1,i=!1,a=!1,o=!1,r=!1,s=!1,c=!1,l=!1,u=!1,p=!1,h=!1,f=!1,m=!1,v=!1,g=!1,b=!1,A=!1,w=!1,y=!1,O=!1,k=!1,j=!0,S=!1,E={},T=1,I=3,M=1.5,P=20,x=250,L=0;function R(e){var t=getCw()/2,n=getCh()/2;if(e.touches){for(var i=0,a=0,o=0,r=Math.min(2,e.touches.length);i<r;i++)a+=e.touches[i].pageX,o+=e.touches[i].pageY;return r?{pageX:a/r-t,pageY:o/r-n}:{pageX:-t,pageY:-n}}return{pageX:e.pageX-t,pageY:e.pageY-n}}function B(e,t){var n=null,i=(domData(e,"fake-size")+"").split(",");if(i[0]>0&&i[1]>0)return{width:i[0],height:i[1]};var a=t?attr(u,"data-original-src")||u.src:e.src;if(E[a])return E[a];if(t&&(e=function(){var e=ce("img");return e.src=attr(u,"data-original-src")||u.src,e}()),void 0!==e.naturalWidth)n={width:e.naturalWidth,height:e.naturalHeight};else if("VIDEO"===e.tagName)n={width:e.clientWidth,height:e.clientHeight};else{(new Image).src=e.src,n={width:e.width,height:e.height}}return n.width&&n.height&&(E[a]=n),n}function N(e){var t=attr(e,"data-id");return D((an($t).tags||{})[t]||[])}function D(e){return e[0]?{coords:{x:e[0][0],y:e[0][1],w:e[0][2],h:e[0][3]},name:e[1],href:e[2],al:e[3]}:{}}function H(e){setStyle(t,"overflow",e?"visible":"hidden")}var U=null,V=null;function q(e,n,i,o,r,s,c,l,d){if(!L||d){var _=!1,p=!!l&&function(){_||(_=!0,l())};s?(t&&setStyle.animate(t,"transform",{duration:s,func:c},p),u&&setStyle.animate(u,!1===r?"transform":"transform, opacity",{duration:s,func:c},p),f&&setStyle.animate(f,!1===r?"transform":"transform, opacity",{duration:s,func:c},p),m&&setStyle.animate(m,!1===r?"transform":"transform, opacity",{duration:s,func:c},p),v&&setStyle.animate(v,!1===r?"transform":"transform, opacity",{duration:s,func:c},p),a&&setStyle.animate(a,!1===r?"transform":"transform, opacity",{duration:s,func:c},p),Ue=!0):Ue&&(t&&setStyle.animate(t),u&&setStyle.animate(u),f&&setStyle.animate(f),m&&setStyle.animate(m),v&&setStyle.animate(v),a&&setStyle.animate(a),Ue=!1),setStyle.transform(t,{translate:[n,0]}),setStyle.transform(u,e,[i,o]),Nt(e,i,o),!1!==r&&(setStyle(u,"opacity",r),Oe||ke?(setStyle(f,"opacity",r),je=!0):(setStyle(m,"opacity",r),Ee=!0),setStyle(v,"opacity",r),function(e,t){var n=window.lang;if(e){var i=ha.height,o=i/5,r=i/3.5,s=Math.abs(e),c=s>20?e+(e>0?20-e:-20-e)/M:e,l=0===t?0:Math.max(0,Math.min((s-20)/o,.75));t>0&&setStyle.transform(a,{translate:[0,c]}),setStyle(a,"opacity",l);var u=s>r,d=u?"":e>0?" zpv_close_move_down":" zpv_close_move_up",_=u?n.mobile_zphoto_release_to_close:n.mobile_zphoto_move_to_close;val(a,'<div class="zpv_close_msg'+d+'">'+_+"</div>"),(a.is_down&&e<0||!a.is_down&&e>0)&&xt(e>0)}else setStyle.transform(a,{translate:[0,0]}),setStyle(a,"opacity",0)}(o,r)),Pt(e)}else U=[e,n,i,o,r,s,c,l,!0],V||z()}function z(){U&&(q.apply(window,U),U=null),clearTimeout(V),V=L?setTimeout(z,1e3/L):null}function Y(e,t,n){ft(!0),q(ue,ne,se,le,Ve,e,t,n),Ve=!1}function G(e,t,n,i){q(e.currentScale,e.curBodyX,e.currentX,e.currentY,!1,t,n,i)}function Q(e){e=function(e){if(!e)return e;var t={width:u.width||u.clientWidth,height:u.height||u.clientHeight},n=t.width/2,i=t.height/2;return[e[0]+n,e[1]+i]}(e||[0,0]),setStyle.transformOrigin(u,e)}function K(){(S=Zt.max_src&&ue>2)?u.src!==Zt.max_src&&(attr(u,"data-original-src",Zt.src),attr(u,"data-src",Zt.max_src),rn(Zt.max_src)):S||u.src===Zt.src||!u||O||k||(attr(u,"data-src",Zt.src),sn(Zt.src),u.style.width="")}var X,$,J,Z,ee,te,ne,ie,oe,re,se,le,ue,de,_e,pe,he,fe,me,ve,be,Ae,we,ye,Oe,ke,je,Se,Ce,Ee,Te,Ie,Me,Pe,xe,Le,Re,Be,Ne,De,He,Ue,Ve,Fe=!1,We=!1,qe=null;function ze(e){var t=e[1].pageX-e[0].pageX,n=e[1].pageY-e[0].pageY;return{distance:Math.sqrt(t*t+n*n),angle:180*Math.atan2(n,t)/Math.PI}}function Ye(e){var t=ze(e);if(Fe){var n=t.distance/Fe.scale,i=t.angle-Fe.rotation;i<-180&&(i+=360),i>180&&(i-=360),extend(Fe,{startDistance:n,startAngle:i})}else Fe={startDistance:t.distance,startAngle:t.angle,scale:1,rotation:0}}function Ge(e){return extend({originalEvent:e},e,function(e){if(!Fe)return{scale:1,rotation:0};if(e.length<2)return{scale:Fe.scale,rotation:Fe.rotation};var t=ze(e),n=t.distance/Fe.startDistance,i=t.angle-Fe.startAngle;i<-90&&(i+=360),i>270&&(i-=360);var a={scale:n,rotation:i};return extend(Fe,a),a}(e.touches),R(e))}function Qe(e){var t=e.touches;t&&(t.length>5||t.length<2?Fe&&(Mt(Ge(e)),Fe=!1):(Fe||Tt(Ge(e)),Ye(t)))}function Ke(e){var t=e.touches;t&&(t.length>5||t.length<2?Fe&&(Mt(Ge(e)),Fe=!1):Fe&&It(Ge(e)))}function Xe(e){var t=e.touches;t&&((t.length>5||t.length<2)&&Fe&&(Mt(Ge(e)),Fe=!1),Fe&&Ye(t))}function $e(e){preventEvent(e);var t=(e.detail?e.detail:e.wheelDelta)>0?1.05:.95,n=extend({originalEvent:e},e);We||(We=1,St(e),Tt(extend(n,{scale:We}))),We*=t,It(extend(n,{scale:We})),clearTimeout(qe),qe=setTimeout((function(){Mt(extend(n,{scale:We})),Et(e),We=!1}),200)}function Je(){X=0,$=0,J=0,Z=0,ee=1,te=!0,ne=0,ie=0,oe=0,re=1,se=0,le=0,ue=1,de=!1,_e=!1,pe=!1,he=!1,fe=!1,me=!1,ve=!1,be=!1,Ae=!1,je=!1,Se=!1,Ce=!1,Ee=!1,Te=!1,Ie=!1,Me=!1,!1,Be=!1,Ne=!1,De=!1,He=!1}function Ze(){return{lastScale:ee,deltaX:X,deltaY:$,pointX:J,pointY:Z,curScale:re,currentScale:ue,curX:ie,curY:oe,currentX:se,currentY:le,curBodyX:ne}}function et(e,t,n){n=n||Ze(),e=e||{};var i=extend({},n,e);if(isUndefined(e.deltaX)||isUndefined(e.deltaY)?isUndefined(e.pointX)||isUndefined(e.pointY)?isUndefined(e.lastScale)?isUndefined(e.currentScale)?isUndefined(e.curScale)||(i.currentScale=i.lastScale*i.curScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=i.currentScale/i.lastScale,i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.curScale=1,i.currentScale=i.curScale*i.lastScale):(i.curX=i.pointX-i.deltaX*i.curScale,i.curY=i.pointY-i.deltaY*i.curScale,i.currentX=i.curX/i.currentScale,i.currentY=i.curY/i.currentScale):(i.pointX=i.curX+i.deltaX*i.curScale,i.pointY=i.curY+i.deltaY*i.curScale),isUndefined(e.curX)||(i.curX=e.curX,i.currentX=i.curX/i.currentScale),isUndefined(e.curY)||(i.curY=e.curY,i.currentY=i.curY/i.currentScale),t)return i;X=i.deltaX,$=i.deltaY,J=i.pointX,Z=i.pointY,ee=i.lastScale,re=i.curScale,ue=i.currentScale,ie=i.curX,oe=i.curY,se=i.currentX,le=i.currentY,ne=i.curBodyX}function tt(){var e=ha.width||getCw(),t=ha.height||getCh();if(k)var n=e,i=Math.min(x,n-2*P),a=i,o=i;else a=e,o=t;return{width:a,height:o}}function nt(e){var t=tt().width,n=((u.width||u.clientWidth)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function it(e){var t=tt().height,n=((u.height||u.clientHeight)*e-t)/2,i=-n;return n<=0&&(i=n=0),{min:i,max:n}}function at(){var e=1,t=I;if(k){e=1,t=(Kt?Kt[0]:{max_scale:I}).max_scale}else{var n=B(u,!0);e=T,t=Math.max(I,n.width/getCw(),(n.height||n.clientHeight)/getCh())}return Zt.restriction&&(e=1,t=1),{min:e,max:t}}function ot(e){var t=ha.height||getCh(),i=Math.abs(Jt)>=10,a=Math.abs(e)>1,o=t/3.5,r=Math.abs(oe);return oe*e<0&&(i=!0),e=e||0,r>o||!i&&a?(function(e){var t=ha.height||getCh(),i=2*Math.abs(le)>t?.85:1.7;et({curY:(e>1?t:e<-1?-t:oe>0?t:-t)/i}),Ve=0,Y(150,"ease-in",rt),setStyle(n,"width",0),Le=!0}(e),!0):(kt()&&(Ve=1,Y(300),he=!1,ke&&(ke=!1,Ht(!0))),!1)}function rt(){w&&ma.close()}function st(){!1!==Pe&&(H(!1),dn(Pe),setStyle.transform(p),setStyle.transform(h),q(1,0,0,0,1),Q(),Pe=!1)}function ct(){var e=1.05*(ha.width||getCw());se-=(e+ne)/ue,ne=-e,Pe=$t+1,Jt--,Y(300,"ease-out",st),zt(!1,!0),ke=!1,ma.onPhotoChange&&ma.onPhotoChange($t+1,{no_open:!0,local:y,crop:k})}function lt(){var e=1.05*(ha.width||getCw());se+=(e-ne)/ue,ne=e,Pe=$t-1,Jt++,Y(300,"ease-out",st),zt(!1,!0),ke=!1,ma.onPhotoChange&&ma.onPhotoChange($t-1,{no_open:!0,local:y,crop:k})}function ut(){if(!Ne)return!1;var e=function(){if(!Ne||Ne.length<2)return[0,0,0];for(var e=vkNow(),t=!1,n=Ne.pop(),i=Ne.length-1;i>=0;i--){if((a=e-Ne[i][0])>150)break;t=Ne[i]}if(!t||!n)return[0,0,0];var a,o=n[1].pageX-t[1].pageX,r=n[1].pageY-t[1].pageY,s=Math.sqrt(o*o+r*r);return(a=n[0]-t[0])?[s/a,o/a,r/a]:[0,0,0]}(),t=e[0],n=e[1],i=e[2];if(_t(),!t)return!1;var a=pe||he?5.1:4.7,o=t/a,r=n*o-a*o*o/2,s=i*o-a*o*o/2;if(o*=530,r*=140,s*=140,t<.1||!r&&!s)return!1;if(!he){var c={};pe||(c.curX=ie+r,c.curY=oe+s),et(c);var l=nt(ue);c={},ie<l.min?c.curBodyX=te?ie-l.min:0:ie>l.max&&(c.curBodyX=te?ie-l.max:0),et(c)}return pe?4.7*n:he?4.7*i:o}function dt(e){Ne||(Ne=[]),Ne.push([vkNow(),e]),Ne=Ne.slice(-20)}function _t(){Ne=!1}function pt(e,t){var n,i,a,o,r,s,c,l,u,d=(n=[e.curX,e.curY],i=e.currentScale,a=[t.curX,t.curY],o=t.currentScale,r=n[0],s=n[1],c=a[0],l=a[1],1!=(u=o/i)&&[r+(r-c)/(u-1),s+(s-l)/(u-1)]);if(!d)return!1;var _=d[0],p=d[1];return e.deltaX=_-e.curX,e.deltaY=p-e.curY,e.currentX=e.curX/e.currentScale+_-_/e.currentScale,e.currentY=e.curY/e.currentScale+p-p/e.currentScale,t.deltaX=_-t.curX,t.deltaY=p-t.curY,t.currentX=t.curX/t.currentScale+_-_/t.currentScale,t.currentY=t.curY/t.currentScale+p-p/t.currentScale,d}function ht(e,t,n){var i,a,o,r,s,c,l,d,_,p,h,f,m,v,g,b=ha.width||getCw(),A=ha.height||getCh(),w=!1,y=(Math.min(50,b/7),B(u)),O=b/y.width,k=A/y.height,j=Math.min(1,O,k),S=N(e).coords,C=geByClass1("zpv_tl",e),E=getW(C),T=getH(C),I=(Math.min((b-30)/Math.max(S.w*y.width*j/100,E),(A-30)/(S.h*y.height*j/100+T+5)),function(){a=y.width*j*n.currentScale,o=y.height*j*n.currentScale,r=b/2-a/2+n.currentX*n.currentScale,s=A/2-o/2+n.currentY*n.currentScale,d=r+S.x*a/100,_=s+S.y*o/100,c=S.w*a/100,l=S.h*o/100,i=d+c/2-E/2,_+l+5,h=Math.min(d,i),p=Math.max(c,E),m=h+p,v=(f=_)+(l+T+5),g={}});return n=(n=et(g,t,n))||Ze(),I(),h<15?(g.curX=n.curX+(15-h),w=!0):m>b-15&&(g.curX=n.curX-(m-b+15),w=!0),f<15&&(g.curY=n.curY+(15-f),w=!0),n=(n=et(g,t,n))||Ze(),I(),v>A-15&&(g.curY=n.curY-(v-A+15),w=!0),n=et(g,t,n),t?n:w}function ft(e){He&&(He=!1,Q(),e||Y(),Lt(Oe,!0),Rt(!Oe,!0),setTimeout((function(){K()}),300))}function mt(e,t,n){var i={};return n=n||Ze(),i.lastScale=e,n=et(i,t,n),!!t&&n}function vt(e,t,n){var i={};if(n=n||Ze(),!jt())return!!t&&n;i.curScale=e,n=(n=et(i,t,n))||Ze();var a=at();return i={currentScale:n.currentScale},n.currentScale<a.min?i.currentScale=n.currentScale+(a.min-n.currentScale)/M:n.currentScale>a.max&&(i.currentScale=n.currentScale+(a.max-n.currentScale)/M),n=et(i,t,n),!!t&&n}function gt(e,t){if(!jt())return!1;var n=!1,i={};t=t||Ze();var a=at();return t.currentScale<a.min?(i.currentScale=a.min,n=!0):t.currentScale>a.max&&(i.currentScale=a.max,n=!0),t=et(i,e,t),e?t:n}function bt(e){if(!jt())return!1;var t={pageX:0,pageY:0},n=Ze(),i=null,a=pt(n,i=kt(!0,i=yt(t,!0,i=gt(!0,i=vt(e=1==e?1/ee:e,!0,i=wt(t,!0,n))))));a&&(Q(a),G(n),He=!0),He&&(Lt(!1,!0),Rt(!1,!0)),wt(t),vt(e),gt(),yt(t),kt(),He?G(i,300,!1,ft):Y(300),mt(ue)}function At(e){if(!jt())return!1;var t=Ze(),n=null,i=pt(t,n=kt(!0,n=gt(!0,n=ht(e,!0,t))));i&&(Q(i),G(t),He=!0),ht(e)&&(Ce||(Ce=t)),He&&(Lt(!1,!0),Rt(!1,!0)),gt(),kt(),He?G(n,300,!1,ft):Y(300),mt(ue)}function wt(e,t,n){var i={};return n=n||Ze(),i.deltaX=(e.pageX-n.curX)/n.curScale,i.deltaY=(e.pageY-n.curY)/n.curScale,n=et(i,t,n),!!t&&n}function yt(e,t,n){var i={};n=n||Ze(),i.pointX=e.pageX,i.pointY=e.pageY;var a=nt(n.currentScale),o=it(n.currentScale),r=(!de&&!o.max&&!o.min||pe||!jt())&&!he;(he||k&&!de&&!a.max&&!a.min)&&(i.curX=0),r&&(i.curY=n.curY),n=et(i,t,n),i={};var s=!1;return(n=n||Ze()).curX<=a.min?fe?(s=!0,i.curBodyX=n.curX-a.min):(i.curX=n.curX+(a.min-n.curX)/M,i.curBodyX=te?i.curX-a.min:0):n.curX>=a.max&&(me?(s=!0,i.curBodyX=n.curX-a.max):(i.curX=n.curX+(a.max-n.curX)/M,i.curBodyX=te?i.curX-a.max:0)),n.curY<o.min?r?i.curY=o.min:he||(i.curY=n.curY+(o.min-n.curY)/M):n.curY>o.max&&(r?i.curY=o.max:he||(i.curY=n.curY+(o.max-n.curY)/M)),n=et(i,t,n),t?n:s}function kt(e,t){var n=!1,i={},a=nt((t=t||Ze()).currentScale),o=it(t.currentScale),r=!de&&!o.max&&!o.min||pe||!jt()&&!he;return he&&(i.curX=0),r&&(i.curY=t.curY),t.curX<a.min?(i.curX=a.min,i.curBodyX=0,n=!0):t.curX>a.max&&(i.curX=a.max,i.curBodyX=0,n=!0),t.curY<o.min?(i.curY=o.min,n=!0):t.curY>o.max&&(i.curY=o.max,n=!0),t=et(i,e,t),e?t:n}function jt(){return!A&&(!!k||!Zt.restriction&&Xt[Zt.src])}function St(e){if(scrollTop()||scrollTop(0),!Le){if(e&&"mousedown"==e.type&&preventEvent(e),e.touches&&e.touches.length||!g){if(st(),!_e&&!de){Be=R(e);var t=nt(ue);ie<=t.min&&(fe=!1!==an($t+1)),ie>=t.max&&(me=!1!==an($t-1))}if(_e||A)ve=be=Ae=!1,we=!1;else{clearTimeout(ye);var n=R(e);ve&&vkNow()-ve<500&&be&&(i=n,o=(a=be).pageX-i.pageX,r=a.pageY-i.pageY,Math.sqrt(o*o+r*r)<50)?(Ae=vkNow(),we=!1):(ve=vkNow(),be=n,we=vkNow())}A||(_e=!0)}var i,a,o,r;de||(te=!0,H(!0)),Ie=R(e),_t(),dt(Ie),wt(Ie)}}function Ct(e){if(!Le&&(preventEvent(e),_e)){if(ve=be=Ae=!1,we=!1,dt(Ie=R(e)),De){if(!(De<vkNow()))return void _t();De=!1,wt(Ie),Y()}if(Be&&!pe&&!he){var t=Math.abs(Ie.pageX-Be.pageX),n=Math.abs(Ie.pageY-Be.pageY),i=it(ue);if(!(n>5||t>5))return;n>5&&t<=5&&(1!=ue||de||A||k?(i.max||i.min)&&(fe=me=!1):(he=!0,Oe&&(ke=!0),Ht(!1),xt(Ie.pageY-Be.pageY>0))),Be=!1,wt(Ie)}!yt(Ie)||pe||he||A||(pe=!0,Ie.pageX),function(){if(!he)return;var e=Math.abs(oe),t=ha.height/2;Ve=1-.5*e/t}(),Y(),pe&&Math.abs(ne)>getCw()&&Et(extend({originalEvent:e},e,{touches:[]}))}}function Et(e){if(!Le)if(Re)Re=!1;else{if(preventEvent(e),e.touches&&!e.touches.length||!g){var t=ut();if(pe)c=t,l=(ha.width||getCw())/2,c=c||0,((ne<-l||c<-1)&&fe?(ct(),1):(ne>l||c>1)&&me?(lt(),1):(kt()&&Y(300),0))&&(Je(),H(!0));else if(he)ot(t);else if(Ae&&vkNow()-Ae<1e3){!function(e){if(!jt())return!1;var t=at(),n={pageX:J,pageY:Z},i=(ue>1?1:t.max)/ee,a=Ze(),o=null;o=kt(!0,o=yt(n,!0,o=vt(i,!0))),e&&(o=kt(!0,o=ht(e,!0,o)));var r=pt(a,o);r&&(Q(r),G(a),He=!0),He&&(Lt(!1,!0),Rt(!1,!0)),vt(i),yt(n),kt(),e&&(ht(e),kt()),He?G(o,300,!1,ft):Y(300),mt(ue),Ut()}(o=e&&je&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target))),ve=be=Ae=!1}else kt()?Y(300):t&&(kt(),Y(t,"cubic-bezier(0, 1, 1, 1)"));if(setTimeout((function(){K()}),300),we)if(vkNow()-we>700||e&&"touchcancel"==e.type)we=!1;else{if(we=!1,e)var n=hasClass("zpv_header",e.target)?e.target:gpeByClass("zpv_header",e.target),i=hasClass("zpv_zoom_btns",e.target)?e.target:gpeByClass("zpv_zoom_btns",e.target),a=hasClass("zpv_bottom_body",e.target)?e.target:gpeByClass("zpv_bottom_body",e.target),o=je&&(hasClass("zpv_tag",e.target)?e.target:gpeByClass("zpv_tag",e.target)),r=Ee&&e.target.closest(".Photo__marketTag"),s=je&&e.target.closest(".Photo__marketShowMoreButton");e&&(n||i||a||o||r||s)?o?function(e,t){if(!xe)return!1;if(!je)return!0;N(e);if(hasClass("zpv_tag_selected",e))return hasClass("zpv_tl_wrap",t.target)||gpeByClass("zpv_tl_wrap",t.target)?_a.go(e,t):(At(e),cancelEvent(t),!1);Se&&(ve=be=Ae=!1),removeClass("zpv_tag_selected",Se),Se=e,Dt(e),addClass("zpv_tag_selected",Se);Oe&&(ke=!0);Ht(!1),At(e),cancelEvent(t)}(o,e):i?(ve=be=Ae=!1,hasClass("zpv_zoomin",e.target)||gpeByClass("zpv_zoomin",e.target)?function(e){!!xe&&(da.highlight=!1,da.end(e),de||pe||at().max<=ue||(cancelEvent(e),bt(k?1.25:1.45)))}(e):function(e){!!xe&&(da.highlight=!1,da.end(e),de||pe||at().min>=ue||(cancelEvent(e),bt(k?.8:1)))}(e)):r?_a.go(r.dataset.url):s&&Wi._openItemsPopup(s.dataset.itemsJson):Se?zt(e):k||(ye=setTimeout((function(){Ht(),Lt(Oe),Rt(!Oe)}),500))}_e=!1,pe=fe=me=!1,_t()}var c,l;e.touches&&(e.touches.length>1||1==e.touches.length&&pe)&&wt(Ie=R(e)),(e.touches&&!e.touches.length||!g)&&(Be=!1)}}function Tt(e){if(!Le&&(preventEvent(e),ve=be=Ae=!1,we=!1,_t(),!pe&&!he)){re=1,ee=ue,de=!0,fe=me=!1;var t=nt(ue);(t.min>=-5||t.max<=5)&&(te=!1,H(!1)),wt(R(e)),Lt(!1,!0),Rt(!1,!0)}}function It(e){Le||(preventEvent(e),ve=be=Ae=!1,we=!1,_t(),pe||he||(Me=R(e),vt(e.scale),yt(Me),Y(),Ut()))}function Mt(e){Le||(preventEvent(e),ve=be=Ae=!1,we=!1,_t(),pe||he||(gt()&&((e.touches&&e.touches.length||!g)&&yt(Me),kt(),Y(100),De=vkNow()+100),de=!1,Lt(Oe,!0),Rt(!Oe,!0)))}function Pt(e){var t=at(),n=e<t.max,i=e>t.min;toggleClass("zpv_zb_disabled",c,!n),toggleClass("zpv_zb_disabled",l,!i)}function xt(e){e?setStyle(a,{top:-35,bottom:"auto"}):setStyle(a,{top:"auto",bottom:-35}),a.is_down=e}function Lt(e,t){var n=je;if(e){if(!jt())return;if(!Oe&&!ke||de)return}je=e,e&&Nt(ue,se,le,t||n!==e),n!==e&&(e&&Dt(Se),Bt(f,e,t))}function Rt(e,t){var n=Ee;Zt.restriction&&(e=!1,t=!0),Ee=e,e&&Nt(ue,se,le,t||n!==e),Bt(m,e,t)}function Bt(e,t,n){e&&setStyle.animate(e,!n&&"opacity",{duration:200,func:"linear"},(function(){setStyle(e,"visibility",t?"visible":"hidden")})),e&&setStyle(e,"visibility",t||!n?"visible":"hidden"),e&&setStyle(e,"opacity",t?1:0)}function Nt(e,t,n,i){if(!de){var a=ha.width||getCw(),o=ha.height||getCh(),r=B(u),s=a/r.width,c=o/r.height,l=Math.min(1,s,c),d=r.width*l*e,_=r.height*l*e,p=a/2-d/2+t*e,h=o/2-_/2+n*e;je&&(i&&f&&setStyle.animate(f),setStyle(f,{width:Math.round(d),height:Math.round(_)}),setStyle.transform(f,{translate:[Math.round(p),Math.round(h)]})),Ee&&(i&&m&&setStyle.animate(m),setStyle(m,{width:Math.round(d),height:Math.round(_)}),setStyle.transform(m,{translate:[Math.round(p),Math.round(h)]}),Te||(!function(){function e(e,t){var n=e.getBoundingClientRect(),i=m.getBoundingClientRect();n.left<i.left+t?e.style.left=i.left-n.left+t+"px":n.right>i.left+i.width-t&&(e.style.left=i.left+i.width-n.right-t+"px")}m&&Array.from(m.children).forEach((function(t){if(t.classList.contains("Photo__marketTag")){var n=t.$(".Photo__marketTagInner"),i=t.$(".Photo__marketTagArrow");e(n,10),e(i,20)}}))}(),Te=!0)),i&&v&&setStyle.animate(v),setStyle(v,{width:Math.round(d),height:Math.round(_)}),setStyle.transform(v,{translate:[Math.round(p),Math.round(h)]})}}function Dt(e){if(e){var t=B(u),n=ha.width||getCw(),i=ha.height||getCh(),a=n/t.width,o=i/t.height,r=Math.min(1,a,o),s=t.width*r*ue,c=t.height*r*ue,l=N(e).coords,d=geByClass1("zpv_tl",e),_=getW(d),p=getH(d),h=l.x*s/100,f=l.y*c/100,m=l.w*s/100,v=l.h*c/100,g=h+m/2-_/2,b=f+v+5,A=n>s?0-(n-s)/2:0,w=n>s?s+(n-s)/2:s,y=i>c?c+(i-c)/2:c,O=0,k=0;g<A+2?O=A+2-g:g+_>w-2&&(O=w-2-g-_),b+p>y-5&&(k=v>3*p?y-5-b-p:-v-p-10),setStyle.transform(d,{translate:[Math.ceil(O),Math.ceil(k)]})}}function Ht(e){if(void 0!==e){if(Oe===e)return;Oe=!e}else ke=!1;setStyle(n,"width","auto"),n&&setStyle.animate(n,"opacity",{duration:200,func:"linear"},(function(){setStyle.animate(n),setStyle(n,"width",Oe?"auto":0)})),Oe?(setStyle(n,"opacity",0),Oe=!1):(setStyle(n,"opacity",1),Oe=!0)}function Ut(){ha.height<604&&!Se&&!k&&(ue>1.25?(Oe&&(ke=!0),Ht(!1)):ke&&(ke=!1,Ht(!0)))}function Vt(e){xe&&(_e||de||pe||e&&e.touches&&e.touches.length>1||(cancelEvent(e),ma.close()))}function Ft(e){if(!(_e||de||pe||!e||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=nt(ue);37==e.keyCode?(cancelEvent(e),ie>=t.max&&!1!==an($t-1)&&(H(!0),lt())):39==e.keyCode?(cancelEvent(e),ie<=t.min&&!1!==an($t+1)&&(H(!0),ct())):27==e.keyCode&&Vt(e)}}function Wt(){k?pn():(ln(),dn($t),qt())}function qt(){Lt(je,!0),Rt(Ee,!0),Nt(ue,se,le)}function zt(e,t){return!(!xe&&!t)&&(!Se||(removeClass("zpv_tag_selected",Se),Se=!1,ke&&ue<=1.25&&(ke=!1,Ht(!0)),cancelEvent(e),!1))}function Yt(e){"touchstart"==e.type?xe=!e.touches||1==e.touches.length:"touchmove"==e.type?(xe=!1,preventEvent(e)):"click"==e.type&&(xe||(cancelEvent(e),xe=!0))}function Gt(e){"touchstart"==e.type?Le=!0:"touchmove"==e.type?(Le=!0,preventEvent(e)):(Le=e.touches&&e.length,Re=!Le)}function Qt(){Kt&&Kt[$t]&&Kt[$t].restriction&&"blur"===Kt[$t].restriction.type&&delete Kt[$t].restriction,Wt()}var Kt=!1,Xt={},$t=!1,Jt=!1,Zt=!1,en=!1,tn=!1;function nn(e,t,n,i){var a=t||len(e);if(e&&!n||(Kt=null),Kt||(Kt=new Array(a)),Kt.length!=a){var o=Kt;Kt=new Array(a),extend(Kt,o)}e=e.map((function(e){return e&&e.restriction&&"block"===e.restriction.type&&(e.src="/images/mobile/blank.gif"),e})),extend(Kt,e);var r=function(e){for(var t in Kt)if(Kt[t].id==e)return+t;return-1}(Zt.id);-1==r&&(r=$t),i||dn(r)}function an(e){return!(e>=Kt.length)&&(!(e<0)&&(Kt[e]||{src:!0}))}function on(e,t,n){var i=B(e),a=tt();k&&(Kt[0].loaded=t,t&&(i.width>i.height?setStyle(e,{height:a.height}):setStyle(e,{width:a.width}),setStyle(e,{minWidth:0,maxWidth:"none"})),pn(!0));if(un()){if(2*i.width>=a.width){var o=a.width/(i.width||i.clientWidth);if(i.height*o>=a.height)return;re=o,ee=o,ue=o,setStyle.transform(u,o)}"VIDEO"===e.tagName&&e.play()}show(e),u===e&&(Lt(t,!t),Rt(t&&!Oe,!t))}function rn(e,t){if(void 0===t&&(t=!1),Xt[e])sn(e);else if(t){var n=ce("video",{src:e}),i=!1,a=function(){i||(i=!0,Xt[e]=!0,sn(e),n=null)};addEvent(n,"canplay",a),addEvent(n,"onload",a),n.load()}else{var o=new Image;o.addEventListener("load",(function t(){Xt[e]=!0,sn(e),ln(),qt(),o.removeEventListener("load",t),o=null}),!1),o.src=e}}function sn(e){[u,p,h].forEach((function(t){var n=gpeByClass("zpv_thumb_item",t),i=attr(t,"data-src");i===e&&(t.src=i,on(t,!0),"VIDEO"!==t.tagName&&removeClass("zpv_ti_loading",n),attr(t,"data-src",!1),un()&&statlogsValueEvent("gif_play",0,"VIDEO"===t.tagName?"mp4":"gif"))}))}function cn(e,t,n,i){void 0===i&&(i=!1);var a=gpeByClass("zpv_thumb_item",e);i&&(addClass("zpv_ti_loading",a),setTimeout((function(){setStyle(u,{display:"block"})}))),i&&(n=!1),t?!0!==t?e.src===t?on(e,!0):Xt[t]?(e.src=t,on(e,!0)):(n?(e.src=n,on(e,!1)):hide(e),attr(e,"data-src",t),rn(t,i),addClass("zpv_ti_loading",a)):(n?(e.src=n,on(e,!1)):hide(e),addClass("zpv_ti_loading",a)):hide(e)}function ln(){if(w){!function(){window.lang;var e="";if(un())e=getLang("mobile_gif_popup_title");else{e=getLang("mobile_photos_photoview_header")||"";var t=!1!==Pe?Pe:$t;e=(e=e.replace("%s",t+1)).replace(/%s|{count}/,Kt.length)}val("zpv_summary",e)}(),Pt(ue);var e,t=an(!1!==Pe?Pe:$t);if(k||O||t&&!0!==t.src){if(!k&&!O){var n="";each(t.tags,(function(e,t){if(!e||0==e)return!0;var i=D(t),a=i.coords,o=i.href?' data-href="'+i.href+'" data-name="'+escapeAttr(i.name)+'"':"",r=i.al?(i.href?" al"+i.al:"")+" "+i.al:"";n+='<div class="zpv_tag'+r+'" style="left: '+a.x+"%; top: "+a.y+"%; width: "+a.w+"%; height: "+a.h+'%;" data-id="'+e+'"'+o+'><div class="fill"></div><div class="zpv_tl_wrap" id="zpv_tl_wrap"><div class="zpv_tl'+(i.href?"":" zpv_tl_plain")+'">'+htsc(i.name)+"</div></div></div>"}));var a,s="",c=t.market_tags&&t.market_tags.tags,l=c&&c.length&&!t.restriction,d="";l&&(d=_.a.html((e={items:escape(JSON.stringify(c))},{inner:[{inner:[Object(xi.j)()],class:"Photo__marketShowMoreButtonIcon",tag:"div"},Object(ae.t)("mobile_photos_show_market_items")],class:"Photo__marketShowMoreButton","data-items-json":e.items,tag:"div"})),c.forEach((function(e){s+=_.a.html(function(e){var t=e.y<.5,n=100*e.x,i=100*e.y;return{inner:[{inner:[{inner:[e.title],class:"Photo__marketTagTitle",tag:"div"},{inner:[_.a.wrap(e.price)],class:"Photo__marketTagPrice",tag:"div"},{inner:[Object(W.a)(Object(Hi.a)())],class:"Photo__marketTagIcon",tag:"div"}],class:Object(ae.f)("Photo__marketTagInner",{"Photo__marketTagInner--down":t}),tag:"div"},{class:Object(ae.f)("Photo__marketTagArrow",{"Photo__marketTagArrow--down":t}),tag:"div"}],class:"Photo__marketTag","data-url":e.url,style:"left: "+n+"%; top: "+i+"%",tag:"div"}}(e))})));var p=B(u);t.restriction&&"blur"===t.restriction.type&&!Object(la.b)("photo"+t.id)?(Lt(!1,!0),Rt(!1,!0),a=Object(ca.a)(Object(F.a)({},t.restriction,{raw:"photo"+t.id,width:p.width,height:p.height}))):t.restriction&&"block"===t.restriction.type&&(a=Object(ca.a)(t.restriction)),val(f,n),val(m,s),val(v,a?_.a.html(a):null),val(o,'<div class="zpv_photo_desc">'+(t.caption||"")+"</div>"+d+'<div class="zpv_bottom_bg"></div>'),toggle(o,!!t.caption||!!l);var h="";if(y||_a.getQuery("community")||!j)h="";else{var g=t.tags&&t.tags[0]||0;h="<tr>"+('<td class="row_table_column"><a href="'+t.like_url+'" class="item_button item_like'+(t.likes_me?" item_likes_me":"")+'" onclick="return photoview.likePhoto(this, \''+t.id+'\');"><i class="i_icon i_like"></i>'+(t.likes_cnt?'<b class="v_value v_like">'+formatNum(t.likes_cnt)+"</b>":"")+"</a></td>")+('<td class="row_table_column"><a href="'+t.photo_url+'#comments" class="item_button item_replies al_photo" onclick="return photoview.openPhoto(this, event, true);"><i class="i_icon i_replies"></i>'+(t.replies_cnt?'<b class="v_value v_replies">'+t.replies_cnt+"</b>":"")+"</a></td>")+('<td class="row_table_last_column"><a href="'+t.photo_url+'" class="item_button item_tags al_photo" onclick="return photoview.openPhoto(this, event);"><i class="i_icon i_tags"></i>'+(g?'<b class="v_value v_tags">'+g+"</b>":"")+"</a></td>")+"</tr>"}val(r,h),sa(t.photo_url),show(i)}}else hide(i)}}function un(){return Zt.isDoc}function dn(e){if(w){$t=Math.max(0,Math.min(e||0,Kt.length)),Zt=an($t),tn=an($t-1),en=an($t+1),u.classList.toggle("zpv_img--blur",!!Zt.restriction&&"blur"===Zt.restriction.type&&!Object(la.b)("photo"+Zt.id)),h.classList.toggle("zpv_img--blur",!!en.restriction&&"blur"===en.restriction.type&&!Object(la.b)("photo"+en.id)),p.classList.toggle("zpv_img--blur",!!tn.restriction&&"blur"===tn.restriction.type&&!Object(la.b)("photo"+tn.id));var t=tt();[u,h,p].forEach((function(e,n){var i;0===n?i=Zt:1===n?i=en:2===n&&(i=tn);var a=i.restriction&&"blur"===i.restriction.type&&(!window.CSS||!CSS.supports("filter: blur(20px) brightness(0.75) contrast(1.25)"));e.classList.toggle("zpv_img--blurUnsupported",!a),e.classList.toggle("zpv_img--block",i.restriction&&"block"===i.restriction.type);var o,r,s=domData(e,"fake-size");i.restriction&&"block"===i.restriction.type?(r=Math.max(Math.min(t.width,600),400),o="600,600"):(s||i.restriction&&"blur"===i.restriction.type)&&(r=Math.max(Math.min(t.width,600),400),o=t.width+","+r),i.restriction&&"block"===i.restriction.type||i.restriction&&!Object(la.b)("photo"+i.id)||(o=null,r=null),setStyle(e,{"min-height":r||null}),domData(e,"fake-size",o||null)})),cn(u,Zt.src,"/images/mobile/blank.gif",Zt.hasVideo),cn(h,en.src),cn(p,tn.src),ln(),qt(),ma.onUpdate&&ma.onUpdate()}}function _n(){if(w&&O&&Kt){var e=Kt[0];if(!e.loaded&&e.progress){var t=geByClass1("zpvu_progress","zpv_center");setStyle(t,{width:100*e.progress+"%",visibility:"visible"})}if(!e.read&&e.thumb){e.read=!0;var n=geByClass1("zpv_upload_box","zpv_center"),i=geByClass1("zpv_upload_img",n);setStyle(i,{backgroundImage:"url("+e.thumb+")"}),removeClass("zpv_thumb_uploading",n)}}}function pn(t){if(w&&k&&Kt){var n=Kt[0],i=!!n.saving;if(toggleClass("item_disabled","zpv_save_button",i||!n.loaded),toggleClass("item_disabled","zpv_cancel_button",i),toggleClass("zpv_crop_saving",e,i),A=i,t||cn(u,n.src,"/images/mobile/blank.gif"),n.loaded&&n.rect&&!n.rect_inited){n.rect_inited=!0;var a=tt(),o=n.rect[0],r=n.rect[1],s=n.rect[2],c={};c.currentScale=1/s,et(c),gt(),kt(),c={};var l=(u.width||u.clientWidth)*ue,d=(u.height||u.clientHeight)*ue,_=o*l,p=r*d;c.curX=(l-a.width)/2-_,c.curY=(d-a.height)/2-p,et(c),kt(),Y(0)}}}function hn(d,_){void 0===d&&(d=!1),void 0===_&&(_=!1),w||(we=!1,ye=!1,Oe=!0,ke=!1,Pe=!1,xe=!0,Le=!1,Re=!1,Ue=!1,Ve=!1,A=!1,y=!1,O=!1,k=!1,Je(),function(d,_){void 0===d&&(d=!1),void 0===_&&(_=!1);var g=window.lang,b="";b=d?Zi(_):'<div id="z_photoview" scheme="space_gray"><div class="zpv_siblings"><div id="zpv_left" class="zpv_thumb_item"><img class="zpv_img" alt=""></div><div id="zpv_right" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_body"><div id="zpv_center" class="zpv_thumb_item"><img class="zpv_img" alt=""></div></div><div class="zpv_close_msg_wrap"><div class="zpv_close_msg">'+g.mobile_zphoto_move_to_close+'</div></div><div class="zpv_controls"><div class="mhead zpv_header"><a class="zpv_close_btn" onclick="return photoview.closePhoto(event);"><i class="zpv_close_icon"></i></a><div class="hb_wrap"><h1 id="zpv_summary" class="hb_btn mh_header"></h1></div></div><div class="zpv_zoom_btns"><a class="zpv_zoom_btn zpv_zoomin"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a><a class="zpv_zoom_btn zpv_zoomout"><b class="zpv_zb_wrap"><i class="i_icon"></i></b></a></div><div class="zpv_bottom"><div class="zpv_photo_desc_wrap"></div><div class="zpv_bottom_body"><table class="zpv_values like_box row_table"></table></div></div></div><div class="zpv_restriction"></div><div class="zpv_tags"></div><div class="zpv_market_tags"></div><div class="zpva zpv_crop"><div class="zpv_crop_box"></div><div class="zpv_crop_loading"></div></div></div>';var A="/images/mobile/zpv_icons"+(hasClass("x2",window.bodyNode)?"_2x":"")+".png?2";(new Image).src=A,ha.create(b,fn),e=ge("z_photoview"),geByClass1("zpv_body",e),t=geByClass1("zpv_siblings",e),n=geByClass1("zpv_controls",e),s=geByClass1("zpv_zoom_btns",e),a=geByClass1("zpv_close_msg_wrap",e),i=geByClass1("zpv_bottom",e),o=geByClass1("zpv_photo_desc_wrap",e),r=geByClass1("zpv_values",i),c=geByClass1("zpv_zoomin",s),l=geByClass1("zpv_zoomout",s),f=geByClass1("zpv_tags",e),m=geByClass1("zpv_market_tags",e),v=geByClass1("zpv_restriction",e),geByClass1("zpv_crop",e),u=geByClass1("zpv_img","zpv_center"),p=geByClass1("zpv_img","zpv_left"),h=geByClass1("zpv_img","zpv_right"),"VIDEO"===u.tagName&&(u.controls=!1)}(d,_),function(){if(g=void 0!==document.ontouchmove,b=!1,ca.a.onClear(Qt),g){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);addEvent(t,"touchstart touchmove touchend touchcancel",Gt),addEvent(n,"touchstart touchmove touchend touchcancel",Gt),addEvent(e,"touchstart touchmove click",Yt),addEvent(e,"touchstart",St),addEvent(e,"touchmove",Ct),addEvent(e,"touchend touchcancel",Et),b?(addEvent(e,"gesturestart",Tt),addEvent(e,"gesturechange",It),addEvent(e,"gestureend",Mt)):(addEvent(e,"touchstart",Qe),addEvent(e,"touchmove",Ke),addEvent(e,"touchend touchcancel",Xe),addEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else addEvent(e,"mousedown",St),addEvent(e,"mousemove",Ct),addEvent(window,"mouseup",Et),addEvent(window,"mousewheel",$e),addEvent(window,"keydown",Ft)}(),w=!0,reflow(e),scrollTop()||scrollTop(0))}function fn(){w&&(!function(){if(ca.a.onClear("__clear",Qt),g){var t=geByClass1("zpv_header",e),n=geByClass1("zpv_bottom_body",e);removeEvent(t,"touchstart touchmove touchend touchcancel",Gt),removeEvent(n,"touchstart touchmove touchend touchcancel",Gt),removeEvent(e,"touchstart touchmove click",Yt),removeEvent(e,"touchstart",St),removeEvent(e,"touchmove",Ct),removeEvent(e,"touchend touchcancel",Et),b?(removeEvent(e,"gesturestart",Tt),removeEvent(e,"gesturechange",It),removeEvent(e,"gestureend",Mt)):(removeEvent(e,"touchstart",Qe),removeEvent(e,"touchmove",Ke),removeEvent(e,"touchend touchcancel",Xe),removeEvent(e,"gesturestart gesturechange gestureend",cancelEvent))}else removeEvent(e,"mousedown",St),removeEvent(e,"mousemove",Ct),removeEvent(window,"mouseup",Et),removeEvent(window,"mousewheel",$e),removeEvent(window,"keydown",Ft)}(),e=t=n=a=!1,i=r=!1,s=c=l=!1,u=p=h=f=!1,v=!1,w=!1,Kt=null)}return{onShow:Object(d.a)(),onHide:Object(d.a)(),likePhoto:function(e,t){return!!xe&&(da.highlight=!1,da.end(),window.Unauthorized?(window.Unauthorized.onActionClick(null,"like","photo"+t),!1):(Zt.likes_me?(Zt.likes_me=!1,--Zt.likes_cnt):(Zt.likes_me=!0,++Zt.likes_cnt),ln(),ua.click(e,extend({photo_id:t},pa))))},openPhoto:function(e,t,n){var i=window.cur;if(!xe&&!Object(C.b)("mvk_mediaview"))return!1;var a=i.replyNames,o=Ot.a.getStickerPanel(),r=Ot.a.getStickers(),s=_a.go(e,t,{local:!0,fast:!0,beforeAppend:function(e){val(geByClass1("mcont",e),'<div class="pcont"><div class="media_view photo_view"><div class="pv_summary"><div class="summary_loading" style="display: none;"><i class="i_loading"></i></div></div><div class="pv_tag_wrap"></div><div class="pv_body pv_touch pv_touch_full pv_hidden_icons"><a class="thumb_item"><div class="pv_photo_wrap" id="pv_photo_tags" onclick="return photo.closeTags(event);"><img src="/images/mobile/blank.gif" class="ph_img" alt="" /></div></a><div class="pv_nav"><table class="row_table pv_nav_cont"><tr><td class="pv_nav_left"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_z"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td><td class="pv_nav_right"><a class="pv_nav_link"><span class="pv_icon"><i class="i_icon"></i></span></a></td></tr></table></div></div><div class="pv_footer"></div></div></div>'),val("m",e.innerHTML)}});if(extend(i,{replyNames:a,sticker_panel:o,stickers:r,processNav:function(e){var t;if(t=/^\/photo(-?\d+_\d+)$/i.exec(e.nav.path)){var n=qs2obj(e.nav.params),i=qs2obj(_a.params);if(n.act)return!1;if(n.offset!=i.offset)return!1;if(n.list!=i.list&&!i.z)return!1;if(n.reply!==i.reply)return!1;if(n.reply_to!==i.reply_to)return!1;e.onPreNav&&e.onPreNav();var a=n.list||"",o=n.rev?"/rev":"";return!fa.open(t[1],a+o,null,n.from,!0)}return!1}}),i.destroy.push((function(){fa.clear()})),window.lang,!s&&!(s=_a.go(e,t,{force:!0}))){if(ha._lastNav){var c=ha._lastNav,l=qs2obj(c.params);delete l.z,c.path+obj2qs(l)+c.hash}fa.showIcons()}return!0},closePhoto:Vt,savePhoto:function(e,t){if(!xe)return!1;if(da.highlight=!1,da.end(),hasClass("item_disabled",e))return!1;if(!k||!Kt)return!1;var n=Kt[0],i=tt(),a=u.width*ue,o=(u.height||u.clientHeight)*ue,r=(a-i.width)/2-ie,s=(o-i.height)/2-oe,c=1/ue,l=r/a,d=s/o;return n.onSelect&&n.onSelect(l,d,c),!1},cancelPhoto:function(e,t){return!!xe&&(da.highlight=!1,da.end(),!hasClass("item_disabled",e)&&Vt())},onClose:null,onUpdate:null,onPhotoChange:null,saveSource:nn,_toggleTouches:function(e){ma.opened()&&(A=!e,e||(_e=!1))},opened:function(){return w},openCrop:function(t,n){n=n||{};var a=!w;O?O=!1:hn(),k=!0,A=!1,Kt=[t],a&&(ha.open(),ha.onResize=Wt),function(){if(w&&k){var t=window.lang;val("zpv_summary",t.mobile_zphoto_owner_crop_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_crop",e),Pt(ue),u.parentNode||(val("zpv_center",""),append(u,"zpv_center"));var n='<tr><td class="row_table_column"><a class="item_button" id="zpv_save_button" onclick="return photoview.savePhoto(this);"><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" id="zpv_cancel_button" onclick="return photoview.cancelPhoto(this);"><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(r,n),r.classList.add("zpv_values--upload"),show(i),pn()}}()},updateCrop:function(e){if(!Kt)return!1;e=extend(Kt[0]||{},e),Kt=[e],pn()},openUpload:function(t,n){n=n||{},hn(),O=!0,A=!0,Kt=[t],ha.open(),ha.onResize=Wt,function(){if(w&&O){var t=window.lang;val("zpv_summary",t.mobile_zphoto_upload_header),removeClass("zpv_mode_[a-z]+",e,!0),addClass("zpv_mode_upload",e);remove(u),val("zpv_center",'<div class="zpva zpv_upload_box zpv_thumb_uploading"><div class="zpv_upload_img"></div><div class="zpvu_progress_wrap"><div class="zpvu_progress"></div></div></div>');var n='<tr><td class="row_table_column" width="50%"><a class="item_button item_disabled" onclick="return false;"><span class="v_value">'+t.mobile_zphoto_save_btn+'</span></a></td><td class="row_table_last_column" width="50%"><a class="item_button" onclick="return photoview.cancelPhoto(this);"><span class="v_value">'+t.mobile_zphoto_cancel_btn+"</span></a></td></tr>";val(r,n),r.classList.add("zpv_values--upload"),show(i),_n()}}()},updateUpload:function(e){if(!Kt)return!1;e=extend(Kt[0]||{},e),Kt=[e],Zt=!1,_n()},open:function(e,t,n){var i,o;ma.onShow(),hn((n=n||{}).isDoc,n.hasVideo),y=n.local||!1,j=!1!==n.showControls,t&&nn(t,!1,!1,!0),dn(e),Jt=0,ha.open(),ha.onResize=Wt,i=geByClass1("zpv_close_msg",a),o=getW(i),setStyle(a,{width:o||250})},close:function(){ma.onHide(),ma.onClose&&ma.onClose({local:y})||ha.close()}}}();window.photoview=ma;n("ldCb");window.FeedNotifications={webActionsAcceptHandlers:{reveal_bdya:function(e,t,n,i,a){var o=gpeByClass("_block",e);return ajax.post("profileEdit.php",{act:"reveal_birthday",from:"feed_assistance",hash:a},{onDone:function(e){var t=window.Snackbar;t&&t.init&&t.init({text:e.msg}),remove(o)}}),!0}},webActionsDeclineHandlers:{},withoutNavActions:["enable_browser_notifications","reveal_bdya"],hide:function(e){function t(t,n,i,a,o,r,s,c){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,i,a,o,r,s){var c={_ajax:1,act:"hide_internal_notification",reason:i,id:t,hash:n},l={},u=gpeByClass("_block",e),d=!0;if("decline"==i){var _=this.webActionsDeclineHandlers[o];d=this.runActionHandler(_,e,c,l,r,n),hide(u)}else{var p=this.webActionsAcceptHandlers[o];d=this.runActionHandler(p,e,c,l,r,n),lockButton(e),"add_custom_newsfeed"==o&&(Object(Wn.b)("remixcustom_feed_added",r),c.action=o,c.action_section=r.section,c.action_hash=r.hash)}return l.onDone=function(){"compact"===s&&"accept"===i||cur.destroy.push((function(){return remove(u)})),~this.withoutNavActions.indexOf(o)||nav.go(e,a)}.bind(this),l.onFail=function(){unlockButton(e)},Promise.resolve(d).then((function(e){(e||isUndefined(e))&&ajax.post("/index.php",c,l)})),!1})),runActionHandler:function(e,t,n,i,a,o){return!isFunction(e)||e(t,n,i,a,o)},addWebActionAcceptHandler:function(e,t){this.webActionsAcceptHandlers[e]=t},addWebActionDeclineHandler:function(e,t){this.webActionsDeclineHandlers[e]=t}},function(){function e(){if(geByClass1("tabs_block_hideable")){var e=geByClass1("tabs_block");geByClass1("tabs_list").offsetHeight>geByClass1("tabs_list_more").offsetHeight?removeClass("tabs_block_without_show_more",e):addClass("tabs_block_without_show_more",e)}}onDOMReady(e),onBodyResize(e),window.Tabs={actualizeShowMoreVisibility:e,toggle:function(e){var t=gpeByClass("tabs_block",e);hasClass("tabs_block_opened",t)?Object(Wn.b)("remixm_tabs_expanded","",-1):Object(Wn.b)("remixm_tabs_expanded",1),toggleClass("tabs_block_opened",t)}}}(),window.Podcast={toggleFave:function(e,t,n){var i="snippet__favorite_active",a=hasClass(e,i);ajax.post("fave.php",{act:"fave_podcast",add:!a,hash:n,audio_id:t,ref:cur.module}),attr(e,"aria-label",a?lang.mobile_bookmarks_actions_add:lang.mobile_bookmarks_actions_remove),a?removeClass(e,i):addClass(e,i)},onOpenClick:function(e,t){var n=$(".snippet__popup",e.closest(".snippet")),i="";cur&&cur.module?i=cur.module:nav&&"/feed"===nav.cur?i="feed":!nav||"/feed?section=podcasts"!==nav.cur&&"/feed/podcasts"!==nav.cur||(i="feed_podcasts"),statlogsValueEvent("mvk_podcasts_actions","mvk_open_popup",t,i),Un.a.open(n,!0)}};var va=n("p5n7");function ga(e,t){var n=Object(o.M)("select-copyright"),i=Object(z.a)('input[name="copyright"]'),a=Object(z.a)(".create_post__source-option"),r=Object(z.a)(".Btn__text",a);e?(n.style.display="inline-block",n.onclick=function(n){return window.posting.openCopyright(n,!0,t,encodeURIComponent(e))},a.onclick=function(n){return window.posting.openCopyright(n,!0,t,encodeURIComponent(e))},r.innerHTML=Object(ae.t)("mobile_wall_post_copyright_edit_button")):(a.onclick=function(n){return window.posting.openCopyright(n,!1,t,encodeURIComponent(e))},Object(o.jc)(a,"display","table"),r.innerHTML=Object(ae.t)("mobile_wall_post_copyright_add_button"),Object(o.hb)(n)),Object(o.zc)(i,e),window.post.checkCopyright()}var ba={open:function(e,t,n){void 0===e&&(e=!1),void 0===n&&(n="");var i=new RegExp("{link}(.*){/link}"),a=i.exec(Object(ae.t)("mobile_wall_post_copyright_mb_text"))[1],r="/@adminsclub-citation?from="+encodeURIComponent(nav.cur),s=Object(ae.t)("mobile_wall_post_copyright_mb_text").replace(i,"<a onclick=\"Popup.close(this); nav.go('"+r+'\', null)" href="'+r+'">'+a+"</a>"),c=Object(Rn.a)({class:"AddCopyrightPopup",header:{title:e?Object(ae.t)("mobile_wall_post_copyright_mb_title_text_edit"):Object(ae.t)("mobile_wall_post_copyright_mb_title_text")},content:{inner:[!e&&{tag:"span",inner:Wd.wrap(s)},Object(va.a)({class:"AddCopyrightPopup__input",placeholder:Object(ae.t)("mobile_post_copyright_input_placeholder"),value:decodeURIComponent(n),spellcheck:!1,on_key_down:["posting.saveSource",t]}),{class:"AddCopyrightPopup__error",style:"display: none;"},{class:"Popup__buttons",inner:[Object(Kt.a)({class:"Popup__button",inner:e?Object(ae.t)("mobile_wall_post_copyright_edit_button"):Object(ae.t)("mobile_wall_post_copyright_add_button"),theme:"regular",use_native_onclick:!0,on_click:'posting.saveSource("'+t+'", this)'}),e?Object(Kt.a)({class:"Popup__button",inner:Object(ae.t)("mobile_delete"),theme:"secondary",use_native_onclick:!0,on_click:'posting.deleteSource(event, this, "'+t+'")'}):{}]}]}});Rn.a.open(Wd.elem(c),!0);var l=Object(z.a)(".AddCopyrightPopup__input input");l&&Object(o.F)(l)},submit:function(e,t,n){var i=Object(z.a)(".Btn",n.parentNode);i.disabled=!0,window.ajax.post("/wall?act=check_copyright_link",{_ajax:1,link:e},{onDone:function(a){var r=Object(z.a)(".AddCopyrightPopup__error");a.status?(n.classList.remove("TextInput_error"),Object(o.hb)(r),ga(e,t),Rn.a.close(n)):(n.classList.add("TextInput_error"),Object(o.lc)(r),Object(o.zc)(r,a.error)),window.post.saveDraft(null,t),i.disabled=!1}})},remove:function(e,t){t&&Rn.a.close(t),ga("",e),e&&window.post.saveDraft(null,e)}};window.AddCopyrightPopup=ba;var Aa=ba,wa={getHash:function(){var e=Object(z.a)("#feed_add_form"),t=qs2obj(e.action.split("?")[1]);return e.getAttribute("data-hash")||t.hash},openCopyright:function(e,t,n,i){cancelEvent(e);var a=!1;if("BUTTON"===e.target.tagName)a=e.target.disabled;else if("LABEL"===e.target.tagName){a=Object(z.a)("button",e.target).disabled}a||Aa.open(t,n,i)},saveSource:function(e,t){if(t.target){if(13!==t.keyCode)return;t=t.target}var n=Object(z.a)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup")),i=n.querySelector("input");Aa.submit(i.value,e,n)},deleteSource:function(e,t,n){var i=Object(z.a)(".AddCopyrightPopup__input",t.closest(".AddCopyrightPopup"));event&&cancelEvent(e),Aa.remove(n,i)},deleteObject:function(e){e&&cancelEvent(e);var t=nav.params,n=qs2obj(t);delete n.object,delete n.list,n.delete_object=1,post.saveDraft(null,wa.getHash(),""+nav.path+obj2qs(n))}};window.posting=wa;n("wyHI");var ya={},Oa=function(e,t,n,i){delete ya[t],1===i?Emoji.favorite.addFavoriteSticker(e,t,n):-1===i&&Emoji.favorite.deleteFavoriteSticker(e,t,n)};var ka,ja={toggleFavorite:function(e,t,n){if(t&&t.stopPropagation(),!hasClass(e,"on")&&Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers.length>=Emoji.favoriteLimit&&!Emoji.favoriteLimitNoticed){var i=langStr(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);return setTimeout(window.showFastBox(getLang("global_error"),i).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0,!1}var a=attr(e,"data-sticker-id"),o=attr(e,"data-hash");return!(!a||!o)&&(!ya[a]&&(ya[a]=1,toggleClass(e,"on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:a,hash:o},{onDone:Oa.pbind(n,a,e)})))},getStickerUrl:function(e,t){var n={id:e,size:t};if(window.isMVK){var i=String(t);return s.d.isDarkScheme()&&(i=i.replace(/b$/,"")+"b"),rs(window.store.stickers.url_template,{id:e,size:i})}return getTemplate("stickers_sticker_url",n)}},Sa=function(){var e,t,n,i=!1,a=!1,o={},r={},s={},c={};function l(e){var t=_(e),n=1;if(t){hasClass(e,"animation_play")||(hide(geByClass1("sticker_img",e)),addClass(e,"animation_play")),t.play();var i=attr(e,"data-loop-count");i=parseInt(i),isNaN(i)&&(i=3),-1!==i&&(!t._cbs.loopComplete||t._cbs.loopComplete&&0===t._cbs.loopComplete.length)&&t.addEventListener("loopComplete",(function a(o){n++;var r=!0;i>=n&&(r=!1),r&&(d(e,!1),""!==t._cbs.loopComplete&&t.removeEventListener("loopComplete",a),t.stop())}))}}function u(e){var t=attr(e,"data-uid");return t||(t=attr(e,"data-uid",Math.random().toString(32).substr(2))),t}function d(e,t){c[u(e)]=t}function _(e){var t=attr(e,"data-uniq-id");if(!geByClass1("svg_sticker_animation",e))return!1;var n=r[t];return n||!1}function p(e,t){var i=_(e);if(i)"function"==typeof t&&t(i);else{var a=attr(e,"data-uniq-id");if(!c[u(e)]){d(e,!0);var s=attr(e,"data-animation-path"),l=attr(e,"data-sticker-id"),p=!1;if(l&&(p=(o[l]||s)&&f(e)),p){var h=attr(e,"data-animation-class")||"",m={container:e,renderer:"svg",loop:!0,autoplay:!1,name:a,rendererSettings:{scaleMode:"noScale",progressiveLoad:!0,hideOnTransparent:!0,className:"svg_sticker_animation "+h}};o[l]?m.animationData=o[l]:m.path=s;var v=geByClass1("svg_sticker_animation",e);if(v&&re(v),i=n.loadAnimation(m),!o[l])return void i.addEventListener("data_ready",(function(){o[l]=i.animationData,r[a]=i,"function"==typeof t&&t(i)}))}"function"==typeof t&&(r[a]=i,"function"==typeof t&&t(i))}}}function h(){return t().then((function(e){return n=e,e}))}return{init:function(e){t=e.animatorLoader},checkSettingsAndLoadInWeb:function(e){if(StickersSettings.getAutoplay()){var t=ge("fc_msg"+e),n=geByClass1("sticker_animation",t);Sa.loadAndPlaySticker(n)}},checkSettingsAndLoad:function(e){if(StickersSettings.getAutoplay()){var t=$(".msg_id_"+e+" .sticker_animation");Sa.loadAndPlaySticker(t)}},loadStickerInMvkIMAndPlay:function(e,t){var n="_msg"+e;t&&(n="msg_id_"+e);var i=geByClass1("sticker_animation",geByClass1(n));Sa.loadAndPlayStickerWithTimer(i,500)},loadAutoplayAnimationStickers:function(e){if(n){if(e){if(a)return;a=!0}if(!i){i=!0;var t=geByClass("sticker_animation_autoplay");t&&each(t,(function(e,t){p(t,(function(){l(t)}))})),i=!1}}else h().then((function(){Sa.loadAutoplayAnimationStickers(e)}))},loadAndPlaySticker:function(e){e&&(n?requestAnimationFrame((function(){p(e,(function(){l(e)}))})):h().then((function(){Sa.loadAndPlaySticker(e)})))},loadAndPlayStickerWithTimer:function(e,t){if(e&&!s[e]){t||(t=1e3);var n=ge(e);hasClass(n,"sticker_animation_disabled_timer")||(s[e]=setTimeout((function(){!n&&(n=ge(e),hasClass(n,"sticker_animation_disabled_timer"))||(Sa.loadAndPlaySticker(n),clearTimeout(s[e]),s[e]=!1)}),t))}},reloadStickers:function(){r={}},touchStartSticker:function(t){t.addEventListener("contextmenu",Sa.preventContextMenu,!1),e=setTimeout((function(){Sa.loadAndPlaySticker(t)}),500)},touchEndSticker:function(){e&&clearTimeout(e)},preventContextMenu:function(e){e.preventDefault(),e.stopPropagation()}};function f(e){var t=e.getBoundingClientRect().top,n=e.getBoundingClientRect().bottom;return t<window.innerHeight&&n>=0&&isVisible(e)}}(),Ca={autoplay:0,setAutoplay:function(e){this.autoplay=e},getAutoplay:function(){return Ca.autoplay&&!Ca.isPreventAutoplayByCalls()},isPreventAutoplayByCalls:function(){return window.Calls&&window.Calls.isInActiveCall}};function Ea(){return qs2obj(nav.params)}function Ta(e){return"dialogs"===e.tab||!e.q}function Ia(e){var t=nav.getQuery("community");return t?(e?"?":"&")+"community="+t:""}function Ma(){var e=window.lang;qsearch.init({init_once:!0,action:"/mail?act=write&fast=1",container:ge("ma_search_items"),field:ge("ma_search_field"),btn:ge("ma_search_btn"),top_items:[],_cache:{},item_tpl:function(e,t,n,i,a){return this.id>2e9||-1===this.id?'<a href="'+(e||"")+'" class="simple_item'+(-1==this.id?" simple_item_create":"")+'">'+(t||"")+'<div class="si_body"><span class="si_owner">'+this.highlight(n||"")+"</span>"+(i||"")+(a?'<div class="si_slabel">'+a+"</div>":"")+"</div></a>":'<a href="'+(e||"")+'" class="inline_item"><div class="ii_body">'+(t||"")+'<span class="ii_owner">'+this.highlight(n||"")+"</span>"+(i||"")+"</div></a>"},null_tpl:function(){return'<div class="service_msg_box"><div class="service_msg service_msg_null">'+e.mobile_mail_no_peers+"</div></div>"},need_invalid_keys:U.a.desktop,onLoaded:function(e){for(var t in e)mail.saveDialog(e[t][e[t].length-1],t)}})}Sa.init({animatorLoader:function(){return Promise.all([n.e("vendor~lottie"),n.e("mvk-lottie")]).then(n.bind(null,"P3dz")).then((function(e){return e.default}))}}),window.Stickers=ja,window.StickersAnimation=Sa,window.StickersSettings=Ca,window.StickersCache=Ot.a,im.clearSearchInput=function(e){if(preventEvent(e),Ta(Ea())){var t=ge("ma_search_field");val(t,""),im.onFilterKeyDown(t)}else nav.go("/mail"+Ia(!0))},im.onFilterKeyDown=function(e){setTimeout((function(){var t=window.lang,n=encodeURIComponent(e.value),i=Ea();if(toggle(geByClass1("mail_search_clear_button"),n),attr(geByClass1("tab_dialogs_search"),"href",n?"/mail?tab=dialogs&q="+n+Ia():"/mail"+Ia(!0)),attr(geByClass1("tab_messages_search"),"href","/mail?q="+n+Ia()),Ta(i)){var a,o=ge("mail_tabs"),r=ge("ma_search_items"),s=ge("dialogs"),c=i.offset;if(removeClass("mail_show_filtered",geByClass1("mail")),ka&&clearTimeout(ka),toggleClass("dialogs_filter_without_important",ge("dialogs_filter"),n||0===intval(val(geByClass1("dialogs_filter_button_important")))),n)show(o),show(r),hide(s),ka=setTimeout((function(){a="/mail?tab=dialogs&q="+n+(c?"&offset="+c:"")+Ia(),"/mail"!==nav.path||Ea().act||nav.go(a,null,{push_only:!0})}),200);else{if(hide(o),hide(r),show(s),!nav.getQuery("community")){var l=geByClass1("mhb_back"),u=geByClass1("mh_header");val(u,t.mobile_mail_head_title),removeClass("mhi_back",u),l.outerHTML=l.outerHTML.replace("<a","<div").replace("</a>","</div>")}a="/mail"+(c?"?offset="+c:"")+Ia(!c),nav.go(a,null,{push_only:!0})}}}),40)},mail.onShowWritePageFromCache(Ma),mail.onShowDialogsPageFromCache(Ma);var Pa=n("vuIU"),xa="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",La=function(){function e(e){this.opts=e||{},this._trackOptions={},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}e.isSupported=function(e){var t=document.createElement("audio");return!!t.canPlayType&&(!('audio/mpeg; codecs="mp3"'!==(e=e||'audio/mpeg; codecs="mp3"')||!(browser.safari||browser.safari_mobile||browser.ios)||!browser.version.toString().startsWith("14"))||!!t.canPlayType(e).replace(/no/,""))};var t=e.prototype;return t.destroy=function(){},t.getPlayedTime=function(){for(var e=this._currentAudioEl.played,t=0,n=0;n<e.length;n++)t+=e.end(n)-e.start(n);return t},t._setAudioNodeUrl=function(e,t){window.data&&window.data(e,"setUrlTimesetUrlTime",t==xa?0:vkNow()),e.src=t},t._createAudioNode=function(e){var t=new Audio,n=this;return this.opts.onBufferUpdate&&addEvent(t,"progress",(function(){n._currentAudioEl==t&&n.opts.onBufferUpdate(n.getCurrentBuffered());var e=t.buffered;1==e.length&&0==e.start(0)&&e.end(0)==t.duration&&(t._fullyLoaded=!0)})),addEvent(t,"stalled",(function(){n._currentAudioEl==t&&n._isInvalidDuration()&&n._currentAudioEl.currentTime>=n.duration-1&&n._currentAudioEl.dispatchEvent(new Event("ended"))})),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",(function(){n._currentAudioEl==t&&n.opts.onProgressUpdate(n.getCurrentProgress())})),this.opts.onEnd&&addEvent(t,"ended",(function(){n._currentAudioEl==t&&n.opts.onEnd()})),this.opts.onSeeked&&addEvent(t,"seeked",(function(){n._currentAudioEl==t&&n.opts.onSeeked()})),this.opts.onSeek&&addEvent(t,"seeking",(function(){n._currentAudioEl==t&&n.opts.onSeek()})),addEvent(t,"error",(function(){n._prefetchAudioEl==t?n._prefetchAudioEl=n._createAudioNode():n._currentAudioEl==t&&n.opts.onFail&&n.opts.onFail()})),addEvent(t,"canplay",(function(){n._prefetchAudioEl,n._currentAudioEl==t&&(n.opts.onCanPlay&&n.opts.onCanPlay(),n._seekOnReady&&(n.seek(n._seekOnReady),n._seekOnReady=!1))})),e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),t},t.onReady=function(e){e(!0)},t.prefetch=function(e){this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,xa),this._prefetchAudioEl=this._createAudioNode(e)},t.seek=function(e){var t=this._currentAudioEl;this.duration?t.currentTime=this.duration*e:this._seekOnReady=e},t.setVolume=function(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e},t._isInvalidDuration=function(){var e=this._currentAudioEl;return isNaN(e.duration)||e.duration==1/0||0==e.duration},t.getCurrentProgress=function(){var e=this._currentAudioEl;return this.duration?Math.max(0,Math.min(1,e.currentTime/this.duration)):0},t.getCurrentBuffered=function(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0},t.isFullyLoaded=function(){return this._currentAudioEl._fullyLoaded},t.setUrl=function(t,n){var i=this._currentAudioEl;if(this._seekOnReady=!1,this._trackOptions={},n&&"object"==typeof n&&(this._trackOptions=n,n=n.callback),i.src==t)return this.opts.onCanPlay&&this.opts.onCanPlay(),n&&n(!0);if(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING)if(this._prefetchAudioEl.src==t){this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,xa);var a=this;this._prefetchAudioEl.readyState>=e.STATE_HAVE_FUTURE_DATA&&setTimeout((function(){a.opts.onCanPlay&&a.opts.onCanPlay()})),i=this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=!1}else this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,xa);return i.src!=t&&(this._setAudioNodeUrl(i,t),i.load()),n&&n(!0)},t.play=function(t){this._prefetchAudioEl.src==t&&this._prefetchAudioEl.readyState>e.STATE_HAVE_NOTHING&&(this._setAudioNodeUrl(this._currentAudioEl,xa),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var n=this._currentAudioEl;n.src&&ci(n).catch((function(){debugLog("Audio: url set failed (html5 impl)")}))},t.pause=function(){var e=this._currentAudioEl;e.src&&e.pause()},t.stop=function(){var e=this._currentAudioEl;this._setAudioNodeUrl(e,xa)},t._setFadeVolumeInterval=function(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n        var interval;\n        onmessage = function(e) {\n          clearInterval(interval);\n          if (e.data == 'start') {\n            interval = setInterval(function() { postMessage({}); }, 20);\n          }\n        }\n      "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)},t.fadeVolume=function(e,t){e=Math.max(0,Math.min(1,e));var n=this._currentAudioEl,i=0;if(i=e<n.volume?-.04:.001,Math.abs(e-n.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var a=n.volume;this._setFadeVolumeInterval(function(){i>0&&(i*=1.2),a+=i;if(i<0?a<=e:a>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(a)}.bind(this))},Object(Pa.a)(e,[{key:"type",get:function(){return"html5"}},{key:"loaded",get:function(){return!0}},{key:"duration",get:function(){var e=this._currentAudioEl,t=isNaN(e.duration)||e.duration==1/0?0:e.duration;return!t&&this._trackOptions.duration&&(t=parseInt(this._trackOptions.duration)),t}}]),e}();La.STATE_HAVE_NOTHING=0,La.STATE_HAVE_FUTURE_DATA=3,La.HAVE_ENOUGH_DATA=4,La.AUDIO_EL_ID="ap_audio";var Ra=function(){function e(e){this.opts=e||{},window._flashVoiceInstance=this}var t=e.prototype;return t.fadeVolume=function(e,t){return this.setVolume(e),t()},t.destroy=function(){re(e.PLAYER_EL_ID)},t.onReady=function(t){if(this._player)return t(!0);if(!1===this._player)return t(!1);this._onReady=t;ge(e.PLAYER_EL_ID)||document.body.appendChild(ce("div",{id:e.PLAYER_EL_ID,className:"fixed"}));var n=this;renderFlash(e.PLAYER_EL_ID,{url:"/swf/audio_lite.swf",id:"flash_voice_player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"VoicePlayerFlash.onAudioFinishCallback",onLoadProgress:"VoicePlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"VoicePlayerFlash.onAudioProgressCallback"})&&setTimeout((function(){n._checkFlashLoaded()}),50)},t.setUrl=function(e,t){this._trackOptions={},t&&"object"==typeof t&&(this._trackOptions=t,t=t.callback),this._url!=e?(this._url=e,this._player&&this._player.loadAudio(e),t&&t(!0)):t&&t(!0)},t.setVolume=function(e){this._player&&this._player.setVolume&&this._player.setVolume(e)},t.play=function(){this._player&&this._player.playAudio()},t.seek=function(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)},t.pause=function(){this._player&&this._player.pauseAudio()},t.isFullyLoaded=function(){return!1},t.getPlayedTime=function(){return 0},t.getCurrentProgress=function(){return this._currProgress||0},t.getCurrentBuffered=function(){return this._currBuffered||0},t.stop=function(){this._player&&this._player.stopAudio()},t._checkFlashLoaded=function(){var e=ge("flash_voice_player");if(this._checks=this._checks||0,this._checks++,this._checks>10){this._player=!1;var t=this._onReady;return t&&t(!1)}if(e&&e.paused){this._player=e;var n=this._onReady;n&&n(!0),this._onReady=null}else{var i=this;setTimeout((function(){i._checkFlashLoaded()}),100)}},e.onAudioFinishCallback=function(){var e=window._flashVoiceInstance;e.opts.onEnd&&e.opts.onEnd()},e.onAudioProgressCallback=function(e,t){var n=window._flashVoiceInstance;t&&(n._total=t,n._currProgress=e/t,n.opts.onProgressUpdate&&n.opts.onProgressUpdate(n._currProgress))},e.onAudioLoadProgressCallback=function(e,t){var n=window._flashVoiceInstance;n._currBuffered=e/t,n.opts.onBufferUpdate&&n.opts.onBufferUpdate(n._currBuffered)},Object(Pa.a)(e,[{key:"type",get:function(){return"flash"}},{key:"loaded",get:function(){return!!this._player}}]),e}();window.VoicePlayerFlash=Ra,Ra.PLAYER_EL_ID="flash_voice";void 0===window.isTouch&&(window.isTouch=!1);var Ba,Na=function(){function e(e,t){if(!e)throw new Error("No element was provided for Slider");e=ge(e),this.options=t||{size:1},void 0===this.options.logfbase&&(this.options.logfbase=35),this.options.backValue=this.options.backValue||0;var n=100*this.options.backValue,i='<div class="slider_slide"><div class="slider_loading_bar" style="opacity: 0; display: none;"></div> '+(this.options.withBackLine?'<div class="slider_back" style="width:'+n+'%"></div>':"")+' <div class="slider_amount"></div> <div class="slider_handler"></div> </div>';this._el=ce("div",{innerHTML:i,className:"slider",id:e.getAttribute("id")||""});var a=this;if(e.classList)for(var o=e.classList,r=0,s=o.length;r<s;r++)addClass(this._el,o[r]);else this._el.className=e.className;each(this._el.attributes,(function(e,t){"id"==t.name&&"class"==t.name||a._el.setAttribute(t.name,t.value)})),e.parentNode.replaceChild(this._el,e),this._amountEl=geByClass1("slider_amount",this._el),this._handlerEl=geByClass1("slider_handler",this._el),this._slideEl=geByClass1("slider_slide",this._el),this._backEl=geByClass1("slider_back",this._el),this._progressEl=geByClass1("slider_loading_bar",this._el),this.options.color&&(setStyle(this._amountEl,{backgroundColor:this.options.color}),setStyle(this._handlerEl,{backgroundColor:this.options.color})),this.options.backColor&&setStyle(this._slideEl,{backgroundColor:this.options.backColor}),addClass(this._el,"slider_size_"+this.options.size),this.options.debounce&&(this._onValueChangeDebounced=Object(ki.a)(this._onValueChange,this.options.debounce)),!isTouch&&t.formatHint&&(addEvent(this._el,"mousemove",this._ev_onMouseOver=this._onMouseOver.bind(this)),addEvent(this._el,"mouseleave",this._ev_onMouseLeave=this._onMouseLeave.bind(this))),addEvent(this._el,isTouch?"touchstart":"mousedown",this._ev_onMouseDown=this._onMouseDown.bind(this)),addEvent(this._el,"click",cancelEvent),this.setValue(this.options.value||0,!this.options.fireChangeEventOnInit,!1),this.setBackValue(this.options.backValue)}var t=e.prototype;return t.toggleLoading=function(e){e=!!e,toggle(this._progressEl,e),setStyle(this._progressEl,"opacity",e?1:0)},t.destroy=function(){!isTouch&&this.options.formatHint&&(removeEvent(this._el,"mousemove",this._ev_onMouseOver),removeEvent(this._el,"mouseleave",this._ev_onMouseLeave),removeEvent(this._el,"mousedown",this._ev_onMouseDown));var e=window.re||window.remove;e(this._el),e(this._currHintEl)},t._updateHint=function(e,t){this._currHintEl||(this._currHintEl=ce("div",{className:"slider_hint",id:"slider_hint"}),this.options.hintClass&&addClass(this._currHintEl,this.options.hintClass),this._el.appendChild(this._currHintEl));var n=this._getPos(),i=Math.round((e.pageX||e.touches[0].pageX)-n[0]),a=this._width;if((i=t?Math.min(Math.max(0,i),a):i)>=0&&i<=a){var o=i/a;this._currHintEl.innerHTML=this.options.formatHint?this.options.formatHint.call(this,o):o;var r=this._currHintEl.getBoundingClientRect();setStyle(this._currHintEl,{left:this._slideEl.offsetLeft+i-(r.right-r.left)/2,top:this._slideEl.offsetTop-(r.bottom-r.top)-10}),!t&&this._toggleHint(!0)}else!t&&this._toggleHint(!1);this.options.formatHint||this._toggleHint(!1)},t._toggleHint=function(e){toggleClass(this._currHintEl,"visible",e)},t._onMouseOver=function(t){e._currenSliderDrag||hasClass(this._el,"active")||this._updateHint(t)},t._onMouseLeave=function(e){hasClass(this._el,"active")||this._toggleHint(!1)},t._onMouseDown=function(t){(0==t.button||t.touches)&&(delete cur._sliderMouseUpNowEl,addEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove=this._onMouseMove.bind(this)),addEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp=this._onMouseUp.bind(this)),this._onMouseMove(t),e._currenSliderDrag=this,addClass(this._el,"active"),cancelEvent(t))},t._onMouseUp=function(t){cur._sliderMouseUpNowEl=this._el,removeEvent(window,isTouch?"touchmove":"mousemove",this._ev_onMouseMove),removeEvent(window,isTouch?"touchend touchcancel":"mouseup",this._ev_onMouseUp),this._onValueChange(),removeClass(this._el,"active"),e._currenSliderDrag=!1,this._toggleHint(!1),this.options.onEndDragging&&this.options.onEndDragging(this._currValue),cancelEvent(t)},t._onMouseMove=function(e){var t=this._getPos(),n=t[0];n=void 0!==e.touches&&e.touches.length>0?e.touches[0].pageX:e.pageX,n=Math.max(n,t[0]),n=Math.min(n,t[0]+this._width),n-=t[0],this.setValue(n/this._width,!0,!0),this._onValueChangeDebounced?this._onValueChangeDebounced():this._onValueChange(),this._toggleHint(!0),this._updateHint(e,!0),cancelEvent(e)},t._getPos=function(){return this._slidePos=getXY(this._slideEl)},t._logf=function(e){if(!this.options.log)return e;var t=this.options.logfbase;return(Math.pow(t,e)-1)/(t-1)},t._unlogf=function(e){if(!this.options.log)return e;var t,n,i=this.options.logfbase;return t=i,n=1+e*(i-1),Math.log(n)/Math.log(t)},t.setValue=function(e,t,n){if(!hasClass(this._el,"active")||n){var i=n?this._logf(e):e;if(this._currValue!=i){this._currValue=i;var a=n?e:this._unlogf(e);a=100*a+"%",setStyle(this._amountEl,{width:a}),setStyle(this._handlerEl,{left:a}),!t&&this._onValueChange()}}},t.setBackValue=function(e){toggleClass(this._backEl,"slider_back_transition",e>this._backValue),this._backValue=e;var t=100*e+"%";setStyle(this._backEl,{width:t})},t._onValueChange=function(){this._lastValue=this._lastValue||0,this._lastValue!=this._currValue&&(this._lastValue=this._currValue,this.options.onChange&&this.options.onChange(this._currValue))},Object(Pa.a)(e,[{key:"_width",get:function(){if(!this._widthCache){var e=this._el.getBoundingClientRect();this._widthCache=e.right-e.left}return this._widthCache}}]),e}(),Da=window&&window.navigator&&"mediaSession"in window.navigator&&"MediaMetadata"in window;var Ha=!1,Ua=function(){function e(e){var t=this,n=(void 0===e?{}:e).onListened;this._reattach=!1,this._audioEl=null,this._playing=!1,this._timer=null,this._duration=0,this._detaching=!1;var i={onEnd:function(){t.detach()},onFail:function(){i.onEnd()},onCanPlay:function(){},onProgressUpdate:function(e){t._updateProgress(e)}};Ba=!1,La.isSupported()?(La.isSupported('audio/ogg;codecs="opus"')&&!La.isSupported('audio/ogg;codecs="codec_check"')&&(Ba=!0),this._impl=new La(i)):browser.flash&&window.renderFlash&&(this._impl=new Ra(i)),this.onPlayPause=function(e){return cancelEvent(e),t._clearMediaSession(),t.toggle()},this.onDurationClick=function(e){t.durationType=!t.durationType,cancelEvent(e)},this._onListened=function(){n&&n(t._audioEl)},this._initEvents()}var t=e.prototype;return t._updateProgress=function(e){this._audioEl&&(this._duration*e>=1||this._duration<1)&&!this._audioEl._listened&&(this._audioEl._listened=!0,this._onListened()),this._durationEl&&(this.durationType?this._durationEl.innerHTML="-"+formatTime(Math.round(this._duration*(1-e))):this._durationEl.innerHTML=formatTime(Math.round(this._duration*e))),this._progressSlider&&this._progressSlider.setValue(e)},t._initInterface=function(){var e=this;this._el=ce("div",{innerHTML:'<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button><div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>'}).firstChild,window.getLang&&attr(this._el,"aria-label",getLang("mail_audio_message")),this._playBtn=geByClass1("audio-msg-track--btn",this._el);var t=this._audioEl.getAttribute("id");if(t&&this._el.setAttribute("id","vmp_"+t),this._audioEl.classList.contains("audio-msg-track--preview")){this._el.classList.add("audio-msg-track--preview"),this._playBtn.classList.add("audio-msg-track--btnSvg");var n=geByClass1("audio-msg-track--btn",this._audioEl);this._playBtn.innerHTML=n.innerHTML}window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),this._durationEl=geByClass1("audio-msg-track--duration",this._el),this._durationEl.innerHTML=formatTime(this._duration),this._progressSlider=new Na(geByClass1("audio-msg-track--slider",this._el),{value:0,size:0,hintClass:"audio_player_hint",formatHint:function(t){return formatTime(Math.round(t*e._duration))},onEndDragging:function(t){e._impl.seek(t)}});var i=geByClass1("audio-msg-track--wave-wrapper",this._el),a=geByClass1("audio-msg-track__transcriptionButton",this._audioEl),o=geByClass1("audio-msg-track__after",this._audioEl);o&&a&&(i.appendChild(a.cloneNode(!0)),this._el.appendChild(o.cloneNode(!0)),this._el.setAttribute("data-transcription-expanded",this._audioEl.getAttribute("data-transcription-expanded")));var r=geByClass1("audio-msg-track--wave-wrapper",this._audioEl).children[0];geByClass1("slider_slide",this._el).appendChild(r.cloneNode(!0)),geByClass1("slider_amount",this._el).appendChild(r.cloneNode(!0)),addEvent(this._playBtn,"click",this.onPlayPause),addEvent(this._durationEl,"click",this.onDurationClick),this._audioEl.parentNode.prepend(this._el),this._clearMediaSession()},t._clearMediaSession=function(){var e=this;Da&&(navigator.mediaSession.setActionHandler("play",(function(){return e.play()})),navigator.mediaSession.setActionHandler("pause",(function(){return e.pause()})),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",null),navigator.mediaSession.setActionHandler("nexttrack",null),navigator.mediaSession.metadata=new MediaMetadata({title:"",artist:"",album:"",artwork:[]}))},t._destroyInterface=function(){hide(this._el),this._audioEl.parentNode.contains(this._el)&&this._audioEl.parentNode.removeChild(this._el),removeEvent(this._playBtn,"click",this.onPlayPause),this._progressSlider&&(this._progressSlider.destroy(),this._progressSlider=null),this._playBtn=null,this._durationEl=null,this._el=null},t.attachTo=function(e){var t=this;if(this._audioEl!=e){null!=this._audioEl&&(this._reattach=!0),this.detach(),this._audioEl=e,addClass(this._audioEl,"audio-msg-track_player-attached"),this._duration=attr(e,"data-duration"),this._initInterface();var n=this._audioEl.id.split("_");if(n&&n.length>1&&(this._owner_id=n[1]),this._reattach=!1,!this._impl.loaded)return new Promise((function(n,i){t._impl.onReady((function(){t._impl.setUrl(attr(e,Ba?"data-ogg":"data-mp3"),{duration:t._duration,callback:n})}))}));this._impl.setUrl(attr(e,Ba?"data-ogg":"data-mp3"),{duration:this._duration})}return!0},t.detach=function(e){if(void 0===e&&(e=!1),this._audioEl&&this._el&&!this._detaching){if(e&&this.isAttached())return;this._detaching=!0,this.stop(),this._destroyInterface(),removeClass(this._audioEl,"audio-msg-track_player-attached"),this._audioEl._listened=!1,this._audioEl=null}this._detaching=!1},t.play=function(){this._audioEl&&(this._reattach||e.pauseGlobalMedia(),addClass(this._el,"audio-msg-track_playing"),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_pause")),this._playing=!0,this._createTimer(),this._owner_id&&Object(D.a)("audio_message_play",this._owner_id),this._impl.play())},t.pause=function(){this._audioEl&&(!this._reattach&&this._playing&&e.resumeGlobalMedia(),window.getLang&&attr(this._playBtn,"aria-label",getLang("global_audio_play")),removeClass(this._el,"audio-msg-track_playing"),this._playing=!1,this._impl.pause(),this._killTimer())},t.stop=function(){this.pause(),this._impl.stop()},t.toggle=function(){this._playing?this.pause():this.play()},t._createTimer=function(){var e=this;this._duration>0&&(this._killTimer(),this._timer=setInterval((function(){if(e._impl){var t=e._impl.getCurrentProgress();e._updateProgress(t)}}),100))},t._killTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},t._initEvents=function(){var e=this;window.ap?window.ap.on(this,[Jt.a.PLAY_REQUESTED,Jt.a.PLAY],(function(){delete window.ap.pausedByMsg,e.pause()})):window.audio&&window.audio.subscribe([Jt.a.PLAY_REQUESTED,Jt.a.PLAY],(function(){delete window.audio.pausedByMsg,e.pause()})),window.Notifier&&(window.Notifier.addRecvClbk("audio_start","audio_msg",(function(){e.pause()})),window.Notifier.addRecvClbk("video_start","audio_msg",(function(){e.pause()})))},t.isAttached=function(){if(this._audioEl){for(var e=this._audioEl;e.parentNode;)e=e.parentNode;return!!e.body}return!1},e.pauseGlobalMedia=function(){window.Notifier&&(Ha=!0,window.Notifier.lcSend("video_start")),window.ap&&window.ap.isPlaying()?(window.ap.pause(),window.ap.pausedByMsg=!0):window.audio&&window.audio.playing&&window.audio.playing()&&(window.audio.pause(),window.audio.pausedByMsg=!0)},e.resumeGlobalMedia=function(){window.Notifier&&Ha&&(Ha=!1,window.Notifier.lcSend("video_hide")),window.ap&&window.ap.pausedByMsg?(window.ap.play(),delete window.ap.pausedByMsg):window.audio&&window.audio.playing&&window.audio.pausedByMsg&&(ci(window.audio).catch((function(){})),delete window.audio.pausedByMsg)},Object(Pa.a)(e,[{key:"type",get:function(){return this._impl.type}},{key:"durationType",get:function(){return window.AudioPlayer?!!ui.a.get(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE):"1"==ui.a.get("audio_time_left")},set:function(e){window.AudioPlayer?ui.a.set(AudioPlayer.LS_PREFIX+AudioPlayer.LS_DURATION_TYPE,!!e):ui.a.set("audio_time_left",e?"1":"0")}}]),e}(),Va=n("7jDv"),Fa=null;function Wa(e){for(var t=geByClass("audio-msg-track--wave-wrapper",e),n=Object(z.a)(".audio-msg-track__transcriptionButton",e),i=0,a=0;a<t.length;a++){try{var o=n&&parseInt(window.getComputedStyle(n,null).getPropertyValue("width"))||0;i=parseInt(window.getComputedStyle(t[a],null).getPropertyValue("width"))-o-8}catch(e){var r=n&&parseInt(n.currentStyle.width)||0;i=parseInt(t[a].currentStyle.width)-r-8}if(i>0)break}return i}function qa(e,t){t=Math.round(t),e.length!=t&&(e=Object(Va.b)(e,t));for(var n="",i=0,a=0;a<e.length;a++)0===(i=Math.floor(7.5*e[a]*.95))&&(i=.5),n+="M"+(4*a+1)+","+(10-i)+"v"+2*i+"Z";return'<svg class="audio-msg-track--wave" width="'+4*e.length+'px"><path d="'+n+'"></path></svg>'}function za(){for(var e=geByClass("audio-msg-track"),t=0;t<e.length;t++){var n=Object(o.g)(e[t],"data-wave");if(Object(o.gb)(e[t],"audio-msg-player")&&t>0){var i=e[t].getAttribute("id");if(i.startsWith("vmp_")){var a=document.getElementById(i.replace("vmp_",""));n=Object(o.g)(a,"data-wave")}else n=Object(o.g)(e[t-1],"data-wave")}var r=Wa(e[t]);if(n&&r){n=n.split(",");for(var s=geByClass("audio-msg-track--wave",e[t]),c=qa(n,r/4),l=0;l<s.length;l++){var u=Object(o.k)("div",{innerHTML:c}).firstChild;s[l].parentNode.replaceChild(u,s[l])}}}}function Ya(){return Fa||(Fa=new Ua({onListened:function(e){AudioMessagePlayer.events.emit("listened",e)}})),Fa}addEvent(window,"orientationchange",(function(){return setTimeout(za,500)})),window.mail&&window.mail.onMessagesRepainted&&(onDOMReady(za),window.mail.onMessagesRepainted(za)),window.AudioMessagePlayer={loaded:!0,events:new EventEmitter,togglePlay:function(e,t,n){void 0===n&&(n=null);var i=Ya(),a=i.attachTo(e),o=function(){null!==n?n?i.play():i.pause():i.play()};!0===a?o():a.then((function(){o()}))},detachPlayer:function(e){Ya().detach(e)},getAttachedTrackPlayer:function(){return Object(z.a)(".audio-msg-track_player-attached")},pauseGlobalMedia:function(){Ua.pauseGlobalMedia()},resumeGlobalMedia:function(){Ua.resumeGlobalMedia()},redrawWaves:za,getWave:qa,toggleTranscription:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null),e&&(e.preventDefault(),e.stopPropagation());var i=t||e.target,a=i.closest(".audio-msg-player"),o=a?a.parentNode.querySelector("#"+a.id.replace("vmp_","")):i.closest(".audio-msg-track"),r=a?Object(z.a)(".audio-msg-track__transcriptionButton",o):i,s=null===n?"true"===r.getAttribute("aria-expanded"):!n;i.setAttribute("aria-expanded",s?"false":"true"),a&&r.setAttribute("aria-expanded",s?"false":"true"),o.setAttribute("data-transcription-expanded",s?"false":"true"),a&&a.setAttribute("data-transcription-expanded",s?"false":"true"),this.events.emit("transcription_toggle",!s,o)}};n("G0UO"),n("Mc5h");var Ga=n("O5lf"),Qa=n("9y81"),Ka=(n("AXyT"),n("gy8s")),Xa=(n("KMpi"),n("AgBx"),{_onCloseClick:function(e){e.stopPropagation(),e.preventDefault(),Object(o.Xb)(Object(o.O)(Xa.class.btn))},class:{btn:"FloatBtn"}});Xa.class=Object(F.a)({},Xa.class,{open:Xa.class.btn+"_open"});var $a=Xa,Ja={addContent:function(e,t){t&&Object(z.b)(Za(e)).forEach((function(e){var n=e.$(eo)||e;e.classList.remove(to),n.insertAdjacentHTML("beforeend",t)}))}};window.Pad=Ja;var Za=function(e){return'.Pad[data-id="'+e+'"]'},eo=".Pad__content",to="Pad_empty";var no=Object(o.Hb)("scrollToEl");Object(o.Hb)("page").onChange(ao);var io=function(e){return".Anchor#"+e};function ao(){var e=window.nav&&window.nav.cur;if(e){var t=e.split("#")[1],n=t&&!~t.indexOf("=")&&Object(z.a)(io(t));n&&no(n)}}window.Select={},Select._onChange=ro;var oo=function(e){return'.Select__option[value="'+e+'"]'};function ro(e,t){var n=e.value,i=e.form,a=e.$(oo(n));_.a.handle(t,{$select:e,$option:a,$form:i,value:n,name:e.name,label:a.textContent})}var so=n("Q8gl");window.LoadMore={setUrl:po,destroy:ho},LoadMore._strategy={replace:{onFail:Oo,onSuccess:function(e){var t=e.response;uo.outerHTML=t,ho()}},padsExtend:{onFail:Oo,onSuccess:function(e){var t=e.response,n=t.pads,i=t.nextPageUrl;Object.keys(n).forEach((function(e){var t=n[e];Ja.addContent(e,t)})),i?po(i):ho()}}},LoadMore._onButtonClick=fo,onDOMReady(mo),page.onChange(mo);var co=".LoadMore",lo=".LoadMore__button",uo=null,_o=null;function po(e){_o.setAttribute("href",e)}function ho(e){uo.remove(),uo=null,_o=null,go()}function fo(){yo()||bo()}function mo(){if(uo=Object(z.a)(co)){var e=window.cur;_o=uo.$(lo),vo(0),Object(o.Kb)(vo),e.destroy.push(go)}}function vo(e){if(uo&&!yo()){var t=Object(o.db)(uo),n=Object(o.S)();t-(e+n)<2*n&&bo()}}function go(){Object(o.Kb)("__clear",vo)}function bo(){wo(!0);var e=_o.getAttribute("href");V.a.post(e,{_ajax:1},{onDone:function(e){return Ao(e,!0)},onFail:function(e){return Ao(e,!1)}})}function Ao(e,t){if(wo(!1),uo){var n=t?"data-success-handler":"data-fail-handler";n=uo.getAttribute(n),Wd.handle(n,{$loadMore:uo,response:e}),uo=null,_o=null,go(),mo()}}function wo(e){_o&&uo&&(Kt.a.setLoading(_o,e),uo._loadMore_loading=e)}function yo(){return uo&&uo._loadMore_loading}function Oo(e){console.error("LoadMore: failed to load more",e)}var ko=n("v+Uj");window.SliderTabs={},SliderTabs._onClick=Ro,onDOMReady(Lo),page.onChange(Mo),page.onRestore(Po);var jo="SliderTabs",So="Slider__scroll",Co="SliderTabs__tab_selected",Eo={active:".SliderTabs__tab_selected",tab:".SliderTabs__tab",scroll:"."+So,container:"."+jo},To="",Io=0;function Mo(){var e=Object(o.M)(To),t=Object(z.a)(Eo.container);e?Object(z.a)(Eo.scroll,e).scrollLeft=Io:t?xo():(To="",Io=0)}function Po(){setTimeout((function(){var e=Object(o.M)(To);if(e){var t=Array.from(Object(z.b)(Eo.tab,e));if(t)t.some((function(e){return e.getAttribute("href")===nav.cur}))&&t.forEach((function(e){e.getAttribute("href")===nav.cur?e.classList.add(Co):e.classList.remove(Co)}))}}))}function xo(){var e=Object(z.b)(Eo.container),t=Math.min(Object(o.T)(),882);e.forEach((function(e){var n=Object(z.a)(Eo.scroll,e),i=Object(z.a)(Eo.active,e);if(i){var a=i.offsetWidth,r=Object(o.bb)(i);r+a>t&&(n.scrollLeft=r-t+a,console.log("$scroll.scrollLeft scrollAllToActiveTab",n.scrollLeft))}}))}function Lo(){xo()}function Ro(e,t){var n=Object(o.eb)(jo,t),i=Object(o.eb)(So,t),a=Object(z.a)(Eo.active,n);return a&&a.classList.remove(Co),t.classList.add(Co),Io=i.scrollLeft,To=Object(o.g)(n,"id"),!0}window.SearchPanel={setQuery:function(e,t){var n=Object(z.a)(Ho(e));t=t||"",n.value!==t&&(n.value=t,Wo(n,t))}},SearchPanel._onInput=Vo,SearchPanel._onClearClick=Fo,SearchPanel._onFocus=Uo;var Bo="SearchPanel_hasQuery",No=".SearchPanel",Do=".SearchPanel__input",Ho=function(e){return'.SearchPanel[data-id="'+e+'"] .SearchPanel__input'};function Uo(){}function Vo(e,t){var n=e.value;Wo(e,n),_.a.handle(t,{query:n})}function Fo(e,t){var n=e.closest(No).$(Do);n.value="",n.oninput(),_.a.handle(t)}function Wo(e,t){e.closest(No).classList.toggle(Bo,!!t)}window.TabRow={setSelectedTab:function(e,t){var n=Object(z.a)(zo(e)),i=Object(z.a)(Go,n),a=Object(z.a)(Yo(t),n);i&&i.classList.remove(qo),a&&a.classList.add(qo)},setTabUrl:function(e,t,n){var i=Object(z.a)(zo(e)),a=Object(z.a)(Yo(t),i);a&&a.setAttribute("href",n)}};var qo="TabRow__tab_selected",zo=function(e){return'.TabRow[data-id="'+e+'"]'},Yo=function(e){return'.TabRow__tab[data-id="'+e+'"]'},Go=".TabRow__tab_selected";window.SwitcherConfirm={},SwitcherConfirm._onSwitcherChange=Zo,SwitcherConfirm._onConfirmClick=er,SwitcherConfirm._onCancelClick=function(e){return tr(e.$btn)},SwitcherConfirm._onPopupOverlayClick=function(e){return tr(e.$popup)};var Qo=function(e){return"SwitcherConfirm_checked_"+(e?"yes":"no")},Ko=".SwitcherConfirm",Xo=".SwitcherConfirm__popup",$o=".SwitcherConfirm__confirm",Jo=".SwitcherConfirm__cancel";function Zo(e){var t=e.$control,n=t.closest(Ko),i=Object(z.a)(Xo,n);Un.a.open(i),n.$popup=i,n.$control=t,n.checked=e.checked}function er(e,t){var n=t.$btn.closest(Ko),i=Object(z.a)($o,n),a=Object(z.a)(Jo,n),o=n.checked;n.isSaving=!0,Kt.a.setLoading(i,!0),Kt.a.setDisabled(a,!0),Wd.handle(e,{checked:o,onSuccess:function(){n.isSaving=!1,Un.a.close(n.$popup),Kt.a.setLoading(i,!1),Kt.a.setDisabled(a,!1),n.classList.toggle(Qo(!0),o),n.classList.toggle(Qo(!1),!o)}})}function tr(e){var t=e.closest(Ko);t.isSaving||(so.a.setChecked(t.$control,!t.checked),Un.a.close(t.$popup))}var nr=n("HON1"),ir=function(e){var t=e.items?e.items:[];return{inner:[(t=t.filter((function(e){return e}))).map((function(e){var t=u.a.class("OwnerInfo__row",{extraMargin:e.extraMargin,gray:e.gray,black:e.black});return{inner:[e.href?{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],href:e.href,class:"OwnerInfo__rowInfo",tag:"a"}:{inner:[{inner:[e.left],class:"OwnerInfo__rowLeft",tag:"div"},e.center?{inner:[e.center],class:"OwnerInfo__rowCenter",tag:"div"}:null],class:"OwnerInfo__rowInfo",tag:"div"},e.right?{inner:[e.right],class:"OwnerInfo__rowRight",tag:"div"}:null],class:t,tag:"div"}}))],class:u.a.class("OwnerInfo",{noMargin:e.noMargin}),tag:"div"}};window.OwnerInfo=ir;n("UWnA");n("tlMv");var ar=function(){function e(){}var t=e.prototype;return t.findElement=function(){var e=document.getElementsByClassName("UnsupportedBrowser");return e.length?(this._element=e[0],this._element):null},t.getElement=function(){return this._element?this._element:this.findElement()},t.show=function(){var e,t;this._previousActiveElement=document.activeElement,null==(e=this.getElement())||e.classList.add("UnsupportedBrowser--active"),null==(t=this.getElement())||t.focus(),Object(D.a)("mvk_unsupported_browser_alert","shown")},t.hide=function(){var e,t;null==(e=this.getElement())||e.classList.remove("UnsupportedBrowser--active"),null==(t=this._previousActiveElement)||t.focus(),Object(D.a)("mvk_unsupported_browser_alert","hidden")},e}();window.UnsupportedBrowser=new ar;var or=function(){function e(){}return e.findButtonInEvent=function(e){return e.target.closest(".Btn")},e.onChange=function(t,n){if(void 0===n&&(n=""),"file"===n){var i=t.target.files;if(i&&i[0]){var a=Object(Ii.s)(i[0].name),r=e.findButtonInEvent(t),s=Object(z.a)(".MobileInput__text",r);Object(o.zc)(s,a)}}},e}();window.MobileInput=or;var rr=n("QE8O"),sr=n("HsQo");n("QQoL"),n("rKUZ");var cr=Object(o.Hb)("ajax"),lr=Object(o.Hb)("onDOMReady"),ur=Object(o.Hb)("onBodyResize");window.CookiePolicy={},lr(hr),CookiePolicy._onHideClick=mr;var dr="body",_r="._hfixed",pr=".CookiePolicy";function hr(){Object(z.a)(pr)&&(fr(),ur(fr))}function fr(){if(Object(z.a)(_r)){var e=Object(z.a)(dr),t=Object(z.a)(pr).offsetHeight,n=parseInt(getComputedStyle(e).paddingBottom,10);e.style.paddingBottom=n+t+7+"px"}}function mr(e,t){e.preventDefault();var n=t.getAttribute("href");t.closest(pr).style.display="none",ur("__clear",fr),cr.post(n,{_ajax:1})}var vr=Object(o.Hb)("Btn");window.PrivacyPolicy={},PrivacyPolicy._onAcceptToggle=br;var gr=".PrivacyPolicy__submit";function br(e){var t=e.checked,n=Object(z.a)(gr);vr.setDisabled(n,!t)}n("/88W");onDOMReady((function(){window.page.onChange((function(){Object(z.b)(".ConfirmPopup").forEach((function(e){return Un.a.close(e)}))}))})),window.ConfirmPopup={onOverlayClick:function(e,t){var n=e.closest(".Popup");n&&"false"!==n.dataset.useNavigation&&Object(z.a)('[data-key="no"]',n).click()},onButtonClick:function(e,t){t.preventDefault(),t.stopPropagation();var n=e.closest(".Popup");if(n){var i=Object(Mt.c)(e.href),a=i.pathname+i.search,r=Object(Mt.c)(nav.prev_cur),s=r.pathname+r.search,c="false"!==n.dataset.useNavigation;if(!c||"no"===Object(o.v)(e,"key")&&a===s&&"1"!==Object(o.v)(e,"force"))return c&&history.back(),Un.a.close(n);nav.go(a)}}};var Ar=function(){function e(){}return e.hideDisclaimerAndPlay=function(){var e=Object(z.a)(".vv_inline_video");Object(z.a)(".VideoRestriction__boxWrap").remove(),Object(z.a)(".VideoRestriction__thumb").remove(),Object(z.a)(".VideoRestriction").replaceWith(Object(z.a)(".VideoRestriction").firstChild),Object(z.a)(".VideoPage__video--short")?(Object(o.lc)(Object(z.a)(".ShortVideo")),Object(z.a)(".ShortVideo__overlay").click()):(e.setAttribute("controls","controls"),e.play());var t=Object(z.a)(".VideoPage__video").parentNode.id||"video";window.ajax.post("/"+t+"?act=agree_disclaimer",{},{onDone:function(e){}})},e}();window.VideoRestriction=Ar;n("Qg0H");var wr=function(e){var t=e.bcg,n=t.type;return{class:u.a.class("VotingBcg",{type:n},"_"),style:"photo"===n?yr(t):"gradient"===n?Or(t):"tile"===n?kr(t):null,inner:"photo"===n?jr(e):null}};function yr(e){return Sr({"background-color":e.color})}function Or(e){var t,n=[],i=e.points.length;for(t=0;t<i;t++){var a=e.points[t];n.push(a.color+" "+a.percent+"%")}return Sr({background:"linear-gradient("+(e.angle-90)+"deg, "+(n=n.join(", "))+")"})}function kr(e){return Sr({"background-image":"url('"+e.image+"')","background-position":"top center","background-size":e.width+"px "+e.height+"px"})}function jr(e){var t=e.bcg,n=t.photo,i=t.color;return{class:"VotingBcg__photoBox",style:Sr({height:e.photoHeight+"px"}),inner:[{class:"VotingBcg__photoImage",style:Sr({"background-image":"url('"+n+"')"})},{class:"VotingBcg__photoGradient",style:Sr({background:"linear-gradient(to bottom, rgba(255, 255, 255, 0), "+i+")"})}]}}function Sr(e){var t,n=[],i=Object.keys(e),a=i.length;for(t=0;t<a;t++){var o=i[t],r=e[o];n.push(o+": "+r+";")}return n.join(" ")}var Cr=wr;window.VotingBcg=wr;var Er=function(e,t){return{tag:"label",class:u.a.class("VotingForm__bcg",{light:"default"===t.type},"_"),inner:[{class:"VotingForm__bcgPreview",inner:[Cr({bcg:t,photoHeight:48}),{class:u.a.class("VotingForm__bcgTextGhost",{0:!0},"_")},{class:u.a.class("VotingForm__bcgTextGhost",{1:!0},"_")},{class:u.a.class("VotingForm__bcgTextGhost",{2:!0},"_")},{class:u.a.class("VotingForm__bcgTextGhost",{3:!0},"_")},{class:u.a.class("VotingForm__bcgTextGhost",{4:!0},"_")},{class:u.a.class("VotingForm__bcgTextGhost",{5:!0},"_")}]},{tag:"input",class:"VotingForm__bcgRadio",type:"radio",name:e,checked:t.checked?"checked":null,value:t.id},{class:"VotingForm__bcgControl"}]}};var Tr=function(e){return{class:"VotingForm__option","data-created":e.is_created?"1":"0",inner:[Object(va.a)({class:"VotingForm__optionInput",name:e.name,value:e.value,on_key_down:"VotingForm._onOptionKeyDown"}),{class:"VotingForm__optionRemove",onclick:["VotingForm._onOptionRemoveClick","this"],inner:_.a.wrap(Object(Qa.b)({icon:"close16"}))}]}};var Ir=Object(o.Hb)("Slider");window.VotingForm={},VotingForm._onInit=zr,VotingForm._onAddOptionClick=qr,VotingForm._onExpireChange=Gr,VotingForm._onOptionRemoveClick=Qr,VotingForm._onTitleKeyDown=Vr,VotingForm._onTitleInput=Fr,VotingForm._onOptionKeyDown=Wr,mediaUpload.onComplete($r),mediaUpload.onStart(Jr),mediaUpload.onError(Zr);var Mr="VotingForm_uploading",Pr="VotingForm_withExpire",xr="VotingForm_maxOptions",Lr=".VotingForm",Rr=".VotingForm_maxOptions",Br=".VotingForm__option",Nr=".VotingForm__options",Dr=".VotingForm__upload",Hr=".VotingForm__bcg",Ur=".VotingForm__bcgRadio:checked";function Vr(e){13===e.keyCode&&e.preventDefault()}function Fr(e){var t=+Object(o.g)(e,"maxlength"),n=Object(z.a)(".VotingForm__count");t-e.value.length<=20?n.innerHTML=e.value.length+"/"+t:n.innerHTML=""}function Wr(e){if(Vr(e),13===e.keyCode){if(!Object(z.a)(Rr))if(Object(z.a)(".VotingForm__option:last-child input")===document.activeElement)return Yr(),void Object(z.a)(".VotingForm__option:last-child input").focus();if(document.activeElement){var t=document.activeElement.closest(".VotingForm__option"),n=t.nextElementSibling&&t.nextElementSibling.$("input");n&&(n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length)}}else if(8===e.keyCode){if(1===Object(z.b)(".VotingForm__option").length)return;var i=e.target;i.value||setTimeout((function(){var e=i.closest(".VotingForm__option"),t=e.previousElementSibling;if(e.outerHTML="",Xr(),t){var n=t.$("input");n.focus(),n.selectionStart=n.value.length,n.selectionEnd=n.value.length}}))}}function qr(){Yr(),Object(z.a)(".VotingForm__option:last-child input").focus()}function zr(){var e=Object(z.a)(Ur).closest(Hr);Ir.scrollToElem(e)}function Yr(){var e=Object(z.a)(Nr),t=Tr({});e.insertAdjacentHTML("beforeend",Wd.html(t)),Kr(),Xr()}function Gr(e){var t=e.$control,n=e.checked;t.closest(Lr).classList.toggle(Pr,n)}function Qr(e){e.closest(Br).outerHTML="",Kr(),Xr()}function Kr(){Array.from(Object(z.b)('.VotingForm__option[data-created="0"] input')).forEach((function(e,t){e.setAttribute("name","answers["+t+"]")}))}function Xr(){var e=Object(z.a)(Lr),t=Number(e.getAttribute("data-max-options")),n=Object(z.b)(Br).length;e.classList.toggle(xr,n===t)}function $r(e){if(Object(z.a)(Lr)){var t=Object(z.a)(Dr),n=Wd.html(Er("poll_background_id",{id:"photo_"+e.photo_id,type:"photo",photo:e.src,color:e.color,checked:!0}));t.insertAdjacentHTML("beforebegin",n),es()}}function Jr(){var e=Object(z.a)(Dr);e&&e.classList.add(Mr)}function Zr(e){var t=Object(z.a)(Lr);if(t){var n=t.getAttribute("data-upload-error-msg");es(),alert(n)}}function es(){var e=Object(z.a)(Lr);Object(z.a)(Dr).outerHTML=e.getAttribute("data-upload-html")}window.VotingStatsFilters={},VotingStatsFilters._onCountryChange=is;var ts=".VotingStatsFilters__section_country",ns=".VotingStatsFilters__section_city";function is(e){var t=e.$option,n=Object(z.a)(ts),i=Object(z.a)(ns),a=t.getAttribute("data-city-section-html");i&&(i.outerHTML=""),a&&n.insertAdjacentHTML("afterend",a)}var as=window.Popup,os=window.Btn;window.AuthCheck={},AuthCheck._onDropConfirmationClick=ds,AuthCheck._onResetSessionSubmit=_s,AuthCheck._onCurBrowserDropClick=ps;var ss=function(e){return".AuthCheck__popup_index_"+e},cs=function(e){return'.AuthCheck__dropConfirmation[data-index="'+e+'"]'},ls=".AuthCheck__dropConfirmationSubmit",us="AuthCheck__dropConfirmation_success";function ds(e){var t=Object(z.a)(ss(e));as.open(t)}function _s(e,t){e.preventDefault();var n=e.target,i=Object(z.a)('iframe[name="'+e.target.target+'"]'),a=n.$(ls);n.submit(),os.setLoading(a,!0),Object(o.b)(i,"load",(function(){Object(z.a)(cs(t)).classList.toggle(us),as.close(),os.setLoading(a,!1)}))}function ps(e){var t=e.$btn;os.setLoading(t,!0),window.ajax.click(t,{onDone:function(){Object(z.a)(cs("0")).classList.toggle(us),as.close(),os.setLoading(t,!1)}})}function hs(){var e=Object(z.a)(fs.intro),t=new Scroller(e,{byPage:!0,ignoreMouseWheel:!0,noAutoScroll:!0});t.init(),cur.destroy.push((function(){return t.destroy()}))}window.AppPasswords=new function(){this.showPopup=function(){return Popup.open(Object(z.a)(".AppPasswordsPopup"))},this.hidePopup=function(){return Popup.close(Object(z.a)(".AppPasswordsPopup"))}},window.AuthCheckIntro={},AuthCheckIntro._onMount=hs;var fs={intro:".AuthCheckIntro"};function ms(){Object(z.a)(vs.self).classList.toggle(gs.restCodesShown)}window.ReservedCodes={},ReservedCodes._onShowRestCodesClick=ms;var vs={self:".ReservedCodes"},gs={restCodesShown:"ReservedCodes_restCodesShown"};window.Settings={_privacy:{}},Settings._privacy.onRadioChange=js;var bs=function(e){return'.Settings__privacyPad[data-privacy="'+e+'"]'},As=".Settings__privacySubmitRow",ws=".Settings__privacyForm",ys=".Settings__privacySelectForbiddenLink",Os="Settings__privacyPad_visible",ks="Settings__privacySubmitRow_visible";function js(e,t){if("none"===e)Ss("allowed",!1),Ss("forbidden",!1),Cs(!0);else if("allowed"===e)Ss("allowed",!0),Ss("forbidden",!1),Cs(!1);else if("forbidden"===e){Ss("allowed",!1),Ss("forbidden",!0),Cs(!0);var n=Object(z.a)(ws),i=Object(z.a)(ys),a=t.name,o=t.value,r=n.getAttribute("action")+"&"+a+"="+o+"&forbid";i.setAttribute("href",r)}}function Ss(e,t){Object(z.a)(bs(e)).classList.toggle(Os,t)}function Cs(e){Object(z.a)(As).classList.toggle(ks,e)}window.LoginHistory={_onSubmit:function(e,t,n){var i=geByClass1("LoginHistory__iframe");preventEvent(e),t.submit(),addEvent(i,"load",(function(){return nav.go(n,null,{isForm:!0})}))},showResetSessionModal:function(e,t,n){var i=Object(ne.f)({close:!0,items:[Object(ie.b)({class:"ai_add",inner:Object(ae.t)("mobile_settings_activity_session_reset_title"),onclick:"LoginHistory.resetSession('"+e+"', '"+t+"', '"+n+"');Popup.close(this);"})]});return ne.f.open(_.a.elem(i),!0),!1},resetSession:function(e,t,n){window.ajax.post(e,{reset_data:t,hash:n})}},window.SettingsMenu={onClick:function(e,t){return void 0===t&&(t=!1),Object(o.oc)("settings_menu_click",e),t?fe.a.hard_go(e):fe.a.go(e),!1}};n("vOib"),n("4qEP"),n("0oUU");window.Subscriptions={editSubscription:function(e,t){if(t.context_actions){var n=Wd.html(t.context_actions.map((function(e){return Object(ve.b)({title:e.title,href:e.href})}))),i=Wd.elem(Object(ve.a)({list:n}));i.parentNode.id="container",ve.a.open(i,"#container",{appendToBody:!0})}}};var Es,Ts,Is=function(){function e(e){var t=e.selector,n=e.className;this.element=Object(z.a)(t),this.className=n}var t=e.prototype;return t.show=function(){this.element.classList.add(this.className)},t.hide=function(){this.element.classList.remove(this.className)},e}(),Ms=function(e){function t(){return e.call(this,{selector:".Appearance__fixedSchemes",className:"Appearance__fixedSchemes--active"})||this}return Object(Ei.a)(t,e),t}(Is),Ps=function(e){function t(){return e.call(this,{selector:".Appearance__autoSwitcher",className:"Appearance__autoSwitcher--active"})||this}return Object(Ei.a)(t,e),t}(Is);function xs(e){var t=e.mode;s.a.isSchemesAutoSwitchingSupported()?Ts.show():Es.show(),t===s.b.Auto&&s.a.isSchemesAutoSwitchingSupported()?Es.hide():Es.show();var n=Object(z.a)("[name='mode'][value='"+t+"']");n&&(n.checked=!0)}function Ls(e,t){var n={mode:t,_ajax:1};V.a.post(e,n),s.d.setMode(t),xs({mode:t})}window.Appearance={init:function(){if(s.a.isSchemesSupported()){Es=new Ms,Ts=new Ps;var e=s.d.getMode();s.a.isSchemesAutoSwitchingSupported()||e!==s.b.Auto||(e=s.b.Light),xs({mode:e})}},switchOnChange:function(e,t){var n=t.checked,i=s.d.isDarkScheme()?s.b.Dark:s.b.Light;Ls(e,n?s.b.Auto:i)},radioOnChange:function(e,t){Ls(e,t.value)}};n("yVza"),n("0hva");var Rs=n("EXR0"),Bs=n("GtpT"),Ns=n("k+Df");var Ds=function(e){var t=window.lang,n=(e.albums||[]).map((function(e){var t=Object(Mt.b)(e.url,{act:"add"});return Object(Bs.a)({onClick:["AddPhotoModal.go",t,"this"],album:e})}));return{inner:[Object(Rs.a)({inner:[t.mobile_photos_choose_album_modal_title],onClose:"AddPhotoModal.close(this)"}),n.length?Object(ie.c)({inner:[e.link.createAlbum?Object(Kt.a)({inner:[t.mobile_photos_choose_album_modal_create_album],class:"AddPhotoModal__createAlbum",theme:"secondary",stretch:!0,onClick:["AddPhotoModal.go",e.link.createAlbum]}):null,{inner:[n],class:"ScrollView",tag:"div"}],class:"AddPhotoModal__content"}):Object(Ns.a)({separator:!0,separator_desktop:!0,text:t.mobile_photos_choose_album_modal_empty_text,more_type:"primary",more_text:e.link.createAlbum?t.mobile_photos_placeholder_album_action:null,more_url:e.link.createAlbum,more_onclick:["AddPhotoModal.go",e.link.createAlbum]})],class:"AddPhotoModal",tag:"div"}},Hs="AddPhotoModal";function Us(e){var t=e.closest("."+Hs);ne.f.close(t)}window.AddPhotoModal={open:function(){var e=Object(ae.y)("upload_albums"),t=Object(ae.y)("AddPhotoModal"),n=Object(ne.f)({on_overlay_click:"AddPhotoModal.close(this)",class:Hs,attached:!0,body:Ds({link:{createAlbum:t.owner_id>0&&"/photos?act=select_album"},albums:e})});return ne.f.open(Wd.elem(n),!0,"",{expandable:!0})},close:Us,go:function(e,t){void 0===t&&(t=null),nav.go(e),t&&t.hasOwnProperty("$btn")?Us(t.$btn):Us(t)}},window.LovinaPromotion={click:function(e,t){var n=t?e?"https://trk.mail.ru/c/e3goc2":"https://trk.mail.ru/c/levhn2":"https://trk.mail.ru/c/i01uk8";Object(o.oc)("lovina_promotion",t?1:0),window.nav.hard_go(n)}},window.AudioSpecialForYou={selector:".AudioSpecialForYou",setPlaying:function(e){var t=Object(z.a)(Vs.special);t&&t.classList.toggle(Fs,e)}};var Vs={special:window.AudioSpecialForYou.selector},Fs="AudioSpecialForYou_playing";var Ws=n("mMuO"),qs=n("6Mr/"),zs=function(){function e(){}return e.prototype.sendStoryAnalytic=function(e){var t={event_type:String(e),time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),nav_screen:Be.b.storyArchive};Object(C.b)("narratives_web_analytic_debug")&&console.log("-- story analytic",t),Object(Ws.f)(t)},e.prototype.onSelectManyClick=function(e,t){return this.sendStoryAnalytic("select_some_story"),window.nav.go(e,t)},e.prototype.onActionsClick=function(e,t){return t.preventDefault(),Object(qs.b)(qs.a.ACCOUNT_HINT_MVK_STORIES_ARCHIVE_ACTIONS_HINT)&&Object(qs.e)(qs.a.ACCOUNT_HINT_MVK_STORIES_ARCHIVE_ACTIONS_HINT),window.ContextMenu.open(e,".header__gear",{appendToBody:!0}),!1},e}();window.StoriesArchive=new zs;var Ys=n("6I9u"),Gs=function(){function e(e){this.store=window.Stories.getStore(),this.data=e,this.rawId=e.raw_id,this.canRemove=e.can_remove,this.canReport=e.canReport,this.canBookmark=e.canBookmark,this.canMarkNotInterested=e.canMarkNotInterested,this.isAds=e.isAds,this.trackCode=e.track_code,this.isBookmarked=e.isBookmarked,this.narrative=e.narrative,this.isNarrative=!!e.narrative,this.canAddToNarrative=e.canAddToNarrative&&!this.isNarrative,this.canEditNarrative=this.isNarrative&&e.canAddToNarrative,this.canRemoveFromNarrative=this.isNarrative&&e.canAddToNarrative,this.isPartOfNarrative=e.isPartOfNarrative,this.reportUrl=this.getReportUrl(),this.hideUrl=this.getHideUrl()}var t=e.prototype;return t.needMenu=function(){return this.canRemove||this.canReport||this.canBookmark||this.canMarkNotInterested||this.canAddToNarrative||this.canEditNarrative||this.canRemoveFromNarrative},t.getHideUrl=function(){var e=window.Stories.getHistoryURL(this.rawId),t=window.Stories.getFrom();return this.isAds&&Object(C.b)("ads_new_reports_mvk_histories")?"/reports?act=hide_ad&object="+e+"&refrom="+t+"&track_code="+this.trackCode:""},t.getReportUrl=function(){var e=this.isNarrative?"narrative"+this.narrative.rawId:window.Stories.getHistoryURL(this.rawId),t=window.Stories.getFrom();return this.isAds&&Object(C.b)("ads_new_reports_mvk_histories")?"/reports?act=add_ad&object="+e+"&refrom="+t+"&track_code="+this.trackCode:Object(Ys.c)({type:this.isNarrative?"narrative":"story",rawId:this.isNarrative?this.narrative.rawId:this.rawId,refrom:t})},t.render=function(){return Wd.html({inner:[{inner:[{class:"Story__icon Story__icon_menu",tag:"div"}],class:"StoryMenu__trigger",onClick:"Stories.showMenu();",tag:"div"},{inner:[this.canAddToNarrative?{inner:[{inner:[Object(ae.t)("mobile_stories_menu_add_to_narrative")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.manageStoryInNarratives();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canEditNarrative?{inner:[{inner:[Object(ae.t)("mobile_stories_menu_edit_narrative")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"return Stories.editCurrentNarrative(event);",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canBookmark?{inner:[{inner:[this.isBookmarked?Object(ae.t)("mobile_stories_menu_bookmarked_title"):Object(ae.t)("mobile_stories_menu_bookmark_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.toggleBookmark(this);",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canRemoveFromNarrative?{inner:[{inner:[Object(ae.t)("mobile_stories_menu_remove_from_narrative")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.removeCurrentStoryFromNarrative();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canRemove?{inner:[{inner:[this.isNarrative?Object(ae.t)("mobile_stories_menu_remove_narrative_title"):Object(ae.t)("mobile_stories_menu_remove_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.removeCurrentStory();",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null,this.canReport?{inner:[{inner:[Object(ae.t)("mobile_stories_menu_report_title")],class:"Btn Btn_theme_none StoryMenu__button",href:this.reportUrl,onClick:"return nav.go(this, event);",tag:"a"}],class:"StoryMenu__row",tag:"div"}:null,this.canMarkNotInterested?{inner:[{inner:[Object(ae.t)("mobile_stories_menu_not_interested_title")],class:"Btn Btn_theme_none StoryMenu__button",onClick:"Stories.markCurrentStoryNotInterested('"+this.hideUrl+"');",tag:"button"}],class:"StoryMenu__row",tag:"div"}:null],class:"StoryMenu__container",tag:"div"}],class:"StoryMenu",tag:"div"})},e}(),Qs=n("my9s"),Ks=n("rN7a"),Xs=n("jnUZ"),$s=n("Q+zI"),Js=n("TMW+"),Zs=function(){function e(e,t,n,i,a){if(this.store=window.Stories.getStore(),this.state={authorIndex:i,storyIndex:a},this.date=e.date,this.preview=e.preview_url,this.type=e.type,this.photo_url=e.photo_url,this.video_url=e.video_url,this.first_frame=e.first_frame,this.loaded=!1,this.narrative=t,this.isNarrative=!!t,this.videoSupport=!!window.HTMLVideoElement,this.views=e.views,this.replies=e.replies,this.link=e.link,this.unread=e.unread,this.raw_id=e.raw_id,this.is_expired=e.is_expired,this.isPrivate=e.is_private,this.isDeleted=e.is_deleted,this.isAds=e.isAds,this.isPromo=e.isPromo,this.promoCaption=e.promoCaption,this.track_code=e.track_code,this.can_comment=e.can_comment,this.canLike=e.canLike,this.can_share=e.can_share,this.can_remove=e.can_remove,this.can_report=!e.can_manage,this.can_ask=e.can_ask,this.can_ask_anonymous=e.can_ask_anonymous,this.canPause="video"!==this.type,this.seeking=!1,this.progress=0,this.needShowEmptyStats=e.needShowEmptyStats,this.canAddToNarrative=e.canAddToNarrative,this.isPartOfNarrative=e.isPartOfNarrative,this.isNewQuestions=e.isNewQuestions,this.isLiked=e.isLiked,this.authorName=n.name,this.name=this.narrative?this.narrative.title:n.name,this.authorId=n.id,this.firstName=n.firstName,this.avatar=this.narrative?this.narrative.coverUrl:n.photo,this.href=n.href,this.prometheus=n.verify.includes("page_top_author"),this.verified=n.verify.includes("page_verified"),this.authorIcon=(this.prometheus||this.verified)&&!this.isNarrative,this.content=null,this.paused=!0,this.stats=e.stats,this.app=e.app,this.isMetaStory=!!e.is_groups_meta_story||!!e.is_apps_meta_story,this.isGroupsMetaStory=!!e.is_groups_meta_story,this.isAppsMetaStory=!!e.is_apps_meta_story,this.isOneTime=e.isOneTime&&n.id!==window.vk.id,this.isOneTimeSeen=e.isOneTimeSeen,this.seenProgress=this.isOneTime?e.seenProgress:null,this.onAutoPlay=Object(d.a)(),this.onDestroy=Object(d.a)(),this.onVideoBuffering=Object(d.a)(),this.onVideoData=Object(d.a)(),this.onVideoPlayEvent=Object(d.a)(),this.onVideoPauseEvent=Object(d.a)(),this.onVideoEndedEvent=Object(d.a)(),this.reply=e.reply_to,this.reply){var r=this.reply.list;this.reply=Object(o.K)(this.reply,{onclick:'Stories.openReplies("'+r+'");'})}this.duration=8e3,this.clickable_stickers=e.clickable_stickers,this.stickers=[],this.StoryMenu=new Gs(Object(o.K)(e,{canReport:this.can_report,narrative:t,canBookmark:Boolean(null==t?void 0:t.bookmarkHash),isBookmarked:Boolean(null==t?void 0:t.isBookmarked)})),this.needMenu=this.StoryMenu.needMenu(),this.storyMenuHTML=this.StoryMenu.render()}var t=e.prototype;return t.update=function(e){var t=window.Stories.getCurrentStoryIndex(),n=window.Stories.getCurrentAuthorIndex();this.state.authorIndex===n&&this.state.storyIndex===t?(this.loadContent(e),window.Stories.setHistory(this.raw_id)):(this.destroy(),Object(o.zc)(e,""))},t.setStartTime=function(){this.seenProgress&&(this.startTime=+(this.seenProgress/100*this.getDuration()).toFixed(1))},t.getStartTime=function(){return this.startTime||0},t.getProgressPercentByLeftTime=function(e){return 100-Math.min(Math.max(e,0)/this.getDuration()*100,100)||0},t.getDuration=function(){return this.duration},t.getPreview=function(){return this.preview},t.hasLink=function(){return!!this.link},t.getLinkUrl=function(){var e=this.link.url,t=window.Stories.getFrom(!1);return Mt.a.make(e,{from:t})},t.cantSee=function(){return this.isPrivate||this.is_expired||this.isOneTimeSeen||this.isDeleted},t.loadContent=function(e){var t=window.lang;if(this.cantSee()){window.Stories.hideLoading();var n="";this.is_expired?n=_.a.wrap(t.mobile_stories_error_expired):this.isDeleted?n=_.a.wrap(t.mobile_stories_error_deleted):this.isPrivate&&(n=_.a.wrap(t.mobile_stories_error_private));var i={class:"Story__contentError",inner:this.isOneTimeSeen?[Object(W.a)(Object(Ks.a)()),{tag:"span",class:"Story__contentErrorText Story__contentErrorText--oneTimeSeen",inner:n}]:n},a=window.Stories.getCurrentAuthorEl();Object(o.a)(a,ic),Object(o.zc)(e,_.a.html(i)),window.Stories.restoreAudio()}else if("photo"===this.type){this.isMetaStory||window.Stories.showLoading(),this.img=new Image,this.onLoadImgBind=this.onLoadImg.bind(this),this.onLoadStory=this.onLoadStory.bind(this),Object(o.b)(this.img,"load",this.onLoadImgBind),Object(o.b)(this.img,"load",this.onLoadStory),this.img.src=this.photo_url;var r={style:"background-image: url("+this.photo_url+")",class:"Story__content_image"};this.isGroupsMetaStory?(Object(o.zc)(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",_.a.html(this.renderGroupsMetaStory())),Object(o.b)(Object(o.O)("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),window.Stories.hideLoading()):this.isAppsMetaStory?(Object(o.zc)(e,""),e&&e.parentNode.insertAdjacentHTML("beforeend",_.a.html(this.renderAppsMetaStory())),Object(o.b)(Object(o.O)("MetaStory__recommendations-inner"),"scroll touchmove",this.handleRecommendationsScroll.bind(this)),window.Stories.hideLoading()):Object(o.zc)(e,_.a.html(r)),window.Stories.restoreAudio()}else if("video"===this.type)if(this.videoSupport&&window.Stories.isAutoplaySupport())window.Stories.showLoading(),this.video=Object(o.k)("video",{src:this.video_url,className:"Story__content_video"}),Object(o.g)(this.video,"playsinline","playsinline"),Object(o.g)(this.video,"webkit-playsinline","webkit-playsinline"),Object(o.g)(this.video,"muted",!0),this.video.muted=!0,this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),this.onCanPlayBind=this.onCanPlay.bind(this),this.onVideoWaitingBind=this.onVideoBuffer.bind(this),this.onVideoLoadedDataBind=this.onVideoLoadedData.bind(this),this.onVideoFirstDataLoadedBind=this.onVideoFirstDataLoaded.bind(this),this.onVideoPlayBind=this.onVideoPlay.bind(this),this.onVideoPlayingBind=this.onVideoPlay.bind(this),this.onVideoPauseBind=this.onVideoPause.bind(this),this.onVideoEndedBind=this.onVideoEnded.bind(this),this.onLoadStory=this.onLoadStory.bind(this),this.onVideoSeekingBind=this.onVideoSeeking.bind(this),this.onVideoSeekedBind=this.onVideoSeeked.bind(this),Object(o.b)(this.video,"ended",this.onVideoEndedBind),Object(o.b)(this.video,"play",this.onVideoPlayBind),Object(o.b)(this.video,"pause",this.onVideoPauseBind),Object(o.b)(this.video,"canplaythrough",this.onCanPlayBind),Object(o.b)(this.video,"waiting",this.onVideoWaitingBind),Object(o.b)(this.video,"loadedmetadata",this.onVideoLoadedDataBind),Object(o.b)(this.video,"loadeddata",this.onVideoFirstDataLoadedBind),Object(o.b)(this.video,"canplaythrough",this.onLoadStory),Object(o.b)(this.video,"playing",this.onVideoPlayingBind),Object(o.b)(this.video,"seeking",this.onVideoSeekingBind),Object(o.b)(this.video,"seeked",this.onVideoSeekedBind),Object(o.f)(this.video,e),this.video.load(),window.Stories.restoreAudio(),window.Stories.pauseAudio();else{var s=window.Stories.getAuthorElems()[this.state.authorIndex];this.renderError(s,e,t.mobile_stories_inline_video_error)}},t.onLoadStory=function(){if(this.loaded=!0,this.clickable_stickers){var e=Object(o.O)("Story",this.authorElem);e&&this.renderStickersLayer.call(this,e)}if(this._loadingStartTime){this.loadingTime=Date.now()-this._loadingStartTime,window.Stories._sendViewerStartTime(this.raw_id,this.loadingTime),this._loadingStartTime=0;var t=this.isMetaStory?"group_feed_view":"view_story";window.Stories.sendAnalyticsEvent(t,{preloading_duration:this.loadingTime})}this.isMetaStory||this.isOneTime||window.Stories.markSeenStory()},t.isLoaded=function(){return this.loaded},t.onVideoSeeking=function(){this.seeking=!0,window.Stories.showLoading(),this.onVideoBuffer()},t.onVideoSeeked=function(){this.seeking=!1,this.onVideoPlay()},t.markSeen=function(){this.store.authors[this.state.authorIndex].items[this.state.storyIndex].unread=!1},t.pause=function(){!this.paused&&this.canPause&&(this.paused=!0,this.video&&!this.video.paused&&this.video.pause())},t.play=function(){this.paused&&(this.paused=!1,this.video&&this.video.play())},t.onVideoEnded=function(){this.onVideoEndedEvent()},t.onVideoPlay=function(){this.buffering=!1,window.Stories.hideLoading(),this.onVideoPlayEvent()},t.onVideoPause=function(){this.onVideoPauseEvent()},t.onLoadImg=function(){window.Stories.hideLoading(),this.setStartTime(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoBuffer=function(){this.buffering=!0,window.Stories.showLoading(),this.onVideoBuffering()},t.onVideoLoadedData=function(){if(0===this.video.duration){this.duration=16e3}else this.duration=1e3*this.video.duration+100;this.setStartTime(),this.onVideoData({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex})},t.onVideoFirstDataLoaded=function(){var e=+(this.getStartTime()/1e3).toFixed(1);this.video.currentTime<e&&(this.video.currentTime=e)},t.onCanPlay=function(){window.Stories.hideLoading(),this.onAutoPlay({paused:this.paused,authorIndex:this.state.authorIndex,storyIndex:this.state.storyIndex}),this.store.isStopped&&this.video.pause()},t.getType=function(){return this.type},t.getVideoState=function(){return this.video?this.video.readyState:0},t.getVideo=function(){if(this.video)return this.video},t.renderError=function(e,t,n){var i=this,a={class:"Story__content_expired",inner:_.a.wrap(n)};Object(o.zc)(t,_.a.html(a)),window.Stories.hideLoading(),this.type="broken",Object(o.a)(e,ic),requestAnimationFrame((function(){i.onVideoData({paused:i.paused,authorIndex:i.state.authorIndex,storyIndex:i.state.storyIndex})}))},t.hasSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!Object(ae.A)(t))&&t.some((function(t){return t.type===e}))},t.getSticker=function(e){var t=(this.clickable_stickers||{}).stickers;return!(!t||!Object(ae.A)(t))&&t.find((function(t){return t.type===e}))},t.render=function(){var e,t,n=window,i=n.lang,a=n.winToUtf;Object(o.b)(window,"resize",this._onResizeHandle.bind(this));var r=U.b?"ontouchstart":"onmousedown",s=U.b?"ontouchend":"onmouseup";this._onLoadingStart();var c=this.hasSticker(ac.storyReply),l=this.date;return this.isPromo?l=this.promoCaption:this.isAds?l=i.mobile_stories_is_promo_title:this.narrative&&(l=this.authorName+" · "+this.date),_.a.html({class:"Story",inner:[{class:"Story__header",inner:[this.reply&&!c?{class:"Story__reply",inner:this.reply.is_deleted||this.reply.is_private||this.reply.is_expired?{class:"Story__replyDeleted",inner:{class:"Story__replyDeletedContainer",inner:[{class:u.a.class("Story__icon",{deleted:this.reply.is_deleted,private:this.reply.is_private||this.reply.is_expired},"_")},{class:"Story__replyDeletedTitle",inner:this.reply.is_deleted?i.mobile_stories_reply_deleted_title:this.reply.is_expired?i.mobile_stories_reply_expired_title:i.mobile_stories_reply_private_title}]}}:{class:"Story__replyPreview",onclick:this.reply.onclick,style:"background-image: url("+this.reply.photo_url+")",inner:{class:"Story__replyTitle",inner:a(this.reply.name)}}}:null,{class:"Story__table",inner:[this.isGroupsMetaStory?null:{class:"Story__cell Story__cell_header",inner:[{class:"Story__table Story__link al_empty",href:this.href,onclick:"return Stories.clickAuthor();","data-skiponclick":1,inner:[{class:"Story__cell Story__cell_avatar",inner:{class:"Story__avatar",src:this.avatar,tag:"img"}},{class:"Story__cell Story__cell_title",inner:[{class:"Story__title",inner:[{class:"Story__name",inner:a(this.name)},this.authorIcon?{class:"Story__verified",inner:{class:u.a.class("Story__icon",{verified:this.verified,prometheus:this.prometheus},"_")}}:null]},{class:"Story__date",inner:l}]}]}]},this.isGroupsMetaStory?{class:"Story__cell Story__gridTitle Story__gridTitle--hide",inner:i.mobile_stories_groups_grid_title}:null,this.renderAddToNarrativeIcon(),{class:"Story__cell"+(this.isMetaStory?"":" Story__cell_close"),onclick:"return Stories.clickClose();",inner:{class:"Story__close"+(this.isMetaStory?" Story__close--grid":""),inner:{class:"Story__icon Story__icon_close"}}}]}]},this.renderStoryFooter(),this.can_comment?{class:"Story__form Story__form_comment",inner:[(e={class:"Story__formOverlay"},e[r]="cancelEvent(event);",e[s]="cancelEvent(event);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:this.narrative?i.mobile_stories_comment_narrative_title:i.mobile_stories_comment_title},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__commentTextarea",tag:"textarea",placeholder:i.mobile_stories_comment_textarea,oninput:"Stories.onInputComment(this);"}},{class:"Story__formFooter",inner:[{class:"Story__formSend Story__commentSend",onclick:"Stories.sendComment();",inner:i.mobile_stories_comment_ok},{class:"Story__formCancel",inner:i.mobile_stories_comment_cancel,onclick:"Stories.hideComment();"}]}]}]}:null,this.can_ask?this.renderAskForm():null,(t={class:"Story__overlay"},t[r]="cancelEvent(event);",t[s]="cancelEvent(event); Stories.hideMenu();",t.ontouchmove="cancelEvent(event);",t),this.clickable_stickers?{class:"Story__stickers"}:null,{class:"Story__body",style:"background-image: url("+this.preview+")"}]})},t.renderAddToNarrativeIcon=function(){if(!this.canAddToNarrative||this.narrative)return!1;var e=u.a.class("Story__toNarrative",{active:this.isPartOfNarrative});return{inner:[{inner:[this.isPartOfNarrative?Object(xi.M)():Object(xi.N)(),Object(qs.b)(qs.a.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP)?Object(qs.c)({inner:[Object(ae.t)("mobile_stories_add_stories_to_narrative_hint_text")],"tooltip-id":qs.a.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP,onboarding:!0,pos:"bottom_right"}):null],class:e,tag:"div"}],class:"Story__cell",onClick:"return Stories.manageStoryInNarratives();",tag:"div"}},t.renderStoryFooterStatsReplies=function(){return{class:"Story__replies Story__cell",onclick:'Stories.showViews("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_replies Story__repliesIcon"}},{class:"Story__cell Story__repliesText",inner:this.replies}]}},t.renderStoryFooterStatsViews=function(){return{class:"Story__views Story__cell",onclick:"Stories."+(this.needShowEmptyStats?"showEmptyStats":"showViews")+'("'+this.raw_id+'")',inner:[{class:"Story__cell",inner:{class:"Story__icon Story__icon_views Story__viewsIcon"}},this.views?{class:"Story__cell Story__viewsText",inner:this.views}:null]}},t.renderStoryFooterStats=function(){return{class:u.a.class("Story__cell",{empty:Boolean(this.link)&&!this.replies&&!this.views,hidden:!(this.replies||this.views||this.link||this.needShowEmptyStats),stats:!0},"_"),inner:this.replies||this.views||this.needShowEmptyStats?{class:u.a.class("Story__stats",{new_questions:this.isNewQuestions,new_hint:!this.isNewQuestions&&this.needShowEmptyStats},"_"),inner:[this.replies?this.renderStoryFooterStatsReplies():null,this.views||this.needShowEmptyStats?this.renderStoryFooterStatsViews():null]}:null}},t.renderStoryFooterComments=function(){return{class:"Story__cell Story__cell_comment",inner:{class:"Story__commentButton",inner:{class:"Story__commentButtonText",inner:window.lang.mobile_stories_comment_placeholder},onclick:"Stories.showComment();"}}},t.renderStoryFooterMoreLink=function(){return{class:"Story__cell Story__cell_moreLink",inner:{class:"Story__moreLink",inner:[{class:"Story__moreLinkText",inner:Object(ae.W)(this.link.text)},{class:"Story__icon Story__icon_topArrow"}],href:this.getLinkUrl(),onclick:"Stories.openCustomButton(event, this); return;","data-skiponclick":1}}},t.renderStoryFooterShare=function(){return{class:"Story__cell Story__cell_share",inner:{class:"Story__share",onclick:'Stories.share("'+(this.narrative?this.narrative.ownerId+"_"+this.narrative.id:this.raw_id)+'", '+!!this.narrative+");",inner:{class:"Story__icon Story__icon_share","data-skiponclick":1}}}},t.renderStoryFooterVerticalButtons=function(e){return{class:"Story__verticalButtons",inner:[e?{class:"Story__verticalButton Story__app "+(e.hasNewInteractions?"has_new":""),onclick:"Stories.clickToApp();",inner:Object(xi.Fb)()}:null,this.canLike?{class:"Story__verticalButton Story__like"+(this.isLiked?" Story__like--set":""),onclick:"Stories.toggleLikeForCurrentStory(this)",inner:Object(W.a)(this.isLiked?Object($s.a)():Object(Js.a)())}:null]}},t.renderStoryFooter=function(){var e=this.getSticker(ac.app);return{class:"Story__footer",inner:this.isMetaStory||this.is_expired?null:{class:"Story__table",inner:[this.renderStoryFooterStats(),this.link&&this.link.text?this.renderStoryFooterMoreLink():this.can_comment?this.renderStoryFooterComments():null,this.can_share?this.renderStoryFooterShare():null,this.needMenu?{class:"Story__cell Story__cell_menu",inner:_.a.wrap(this.storyMenuHTML)}:null,e||this.canLike?this.renderStoryFooterVerticalButtons(e):null]}}},t.renderAskForm=function(){var e,t=window.lang,n=U.b?"ontouchstart":"onmousedown",i=U.b?"ontouchend":"onmouseup";return{class:"Story__form Story__form_question",onClick:"Stories.toggleQuestionTooltip(event, true);",inner:[(e={class:"Story__formOverlay"},e[n]="cancelEvent(event);",e[i]="Stories.toggleQuestionTooltip(event, true);",e.ontouchmove="cancelEvent(event);",e),{class:"Story__formPopout",ontouchmove:"cancelEvent(event);",onmousedown:"event.stopPropagation();",ontouchend:"event.stopPropagation();",inner:[{class:"Story__formHeader",inner:{class:"Story__formHeaderInner",inner:[{tag:"button",class:"Btn Btn_theme_none Story__formHeaderBtn Story__questionSelect",inner:t.mobile_stories_ask_question_author_only,onclick:"Stories.changeAskAnonymous(event);","data-selected":1},{class:"QuestionSupport Icon Icon_menu_support",onclick:"Stories.toggleQuestionTooltip(event);",inner:{class:"QuestionSupport__tooltip"}}]}},{class:"Story__formBody",inner:{class:"Story__formTextarea Story__questionTextarea",tag:"textarea",placeholder:t.mobile_stories_ask_question_placeholder,oninput:"Stories.onInputQuestion(this);",maxlength:80}},{class:"Story__formFooter",inner:[Object(Kt.a)({class:"Story__questionSend",theme:"regular",inner:t.mobile_stories_ask_question_ok,on_click:["Stories.sendQuestion"],disabled:!0}),Object(Kt.a)({class:"Story__questionSend",theme:"link",inner:t.mobile_stories_ask_question_cancel,on_click:["Stories.hideAskQuestion"]})]}]}]}},t._getStickerStyle=function(e,t){var n=this.clickable_stickers,i=n.original_width,a=n.original_height,r=e.top,s=e.left,c=e.width,l=e.height,u=e.rotate,d=Object(o.Y)(t),_=d[0],p=d[1],h=_,f=p;return p/_>1.77?h=i*p/a:f=a*_/i,"\n      top: "+(r*f-(f-p)/2)+"px;\n      left: "+(s*h-(h-_)/2)+"px;\n      width: "+c*h+"px;\n      height: "+l*f+"px;\n      transform: rotate("+u+"deg);\n    "},t.renderStickersLayer=function(e){var t,n,i=this,a=Object(o.O)("Story__stickers",e);if(a){var r=(Object(o.tb)(this.clickable_stickers)?this.clickable_stickers:{}).stickers,s=U.b?"ontouchstart":"onmousedown",c=U.b?"ontouchend":"onmouseup";a&&(a.innerHTML=""),a.appendChild(_.a.elem(((t={class:"Story__stickersDisableArea Story__stickersDisableArea--left"})[s]="Stories.onTouchStart(event);",t[c]="Stories.onTouchEnd(event, true);",t.ontouchcancel="Stories.onTouchEnd(event, true);",t))),a.appendChild(_.a.elem(((n={class:"Story__stickersDisableArea Story__stickersDisableArea--right"})[s]="Stories.onTouchStart(event);",n[c]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n))),r.forEach((function(t){var n,r=t.id,l=t.type,u=t.style;if([ac.hashtag,ac.mention,ac.question,ac.place,ac.music,ac.storyReply,ac.owner,ac.link,ac.marketItem,ac.post,ac.poll,ac.app,ac.sticker,ac.situationalTheme].includes(l)){var d=_.a.elem(((n={class:"Story__sticker"})[s]="Stories.onTouchStart(event);",n[c]="Stories.onTouchEnd(event);",n.ontouchcancel="Stories.onTouchEnd(event);",n.style=""+i._getStickerStyle(t,e),n));switch(Object(o.v)(d,"id",r),Object(o.v)(d,"type",l),u&&Object(o.v)(d,"style",u),l){case ac.hashtag:Object(o.v)(d,"hashtag",t.hashtag);break;case ac.mention:Object(o.v)(d,"mentioned_photo_url",t.mentionedPhotoUrl),Object(o.v)(d,"mentioned_owner_href",t.mentionedOwnerHref),Object(o.v)(d,"mentioned_text",t.mentionedText);break;case ac.question:Object(o.v)(d,"question",t.question);break;case ac.place:if(i.store.list==="place"+t.placeId)return;Object(o.v)(d,"place_id",t.placeId);break;case ac.music:var p=window.Stories.getCurrentStory(),h=t.audioId,f=t.audioData,m=t.audioRestriction;if(m){var v=i.getVideo();if(v&&p.needMute){var g=window.Stories.getAuthorElems()[i.state.authorIndex];Object(o.Yb)(g,nc),v.muted=!0}a.appendChild(_.a.elem({class:"StoryRestriction",inner:{class:"StoryRestriction__inner",inner:[{class:"StoryRestriction__title",inner:m.title},m.buttonUrl?{class:"StoryRestriction__link",href:m.buttonUrl,inner:m.buttonText}:null]}})),Object(o.v)(d,"disabled",1)}Object(o.a)(d,"audio_item"),Object(o.a)(d,"audio_item_"+h),Object(o.v)(d,"id",h),Object(o.v)(d,"audio",f);try{Object(o.v)(d,"track-code",JSON.parse(f).track_code)}catch(e){}d.setAttribute("id","audio"+h);break;case ac.storyReply:Object(o.v)(d,"owner-id",t.ownerId),Object(o.v)(d,"story-id",t.storyId),Object(o.v)(d,"link",t.link);break;case ac.owner:Object(o.v)(d,"owner-id",t.ownerId),Object(o.v)(d,"link",t.link);break;case ac.link:Object(o.v)(d,"link",t.link),Object(o.v)(d,"tooltip-text",t.tooltipText);break;case ac.marketItem:Object(o.v)(d,"photoUrl",t.photoUrl),Object(o.v)(d,"link",t.link),t.isRestricted&&Object(o.v)(d,"isRestricted","isRestricted");break;case ac.post:Object(o.v)(d,"post-owner-id",t.postOwnerId),Object(o.v)(d,"post-id",t.postId);break;case ac.poll:Object(o.v)(d,"pollId",t.pollId),Object(o.v)(d,"pollOwnerId",t.pollOwnerId);break;case ac.app:Object(o.v)(d,"app-id",t.appId),Object(o.v)(d,"app-ref",t.appRef),Object(o.v)(d,"app-hash",t.appHash);break;case ac.sticker:Object(o.v)(d,"link","/stickers?stickers_id="+t.stickerPackId),Object(o.v)(d,"tooltip-text",t.tooltipText);break;case ac.situationalTheme:Object(o.v)(d,"situational-app-id",t.situationalAppId),Object(o.v)(d,"situational-theme-id",t.situationalThemeId)}a.appendChild(d),i.stickers.push(d)}}))}},t._onResizeHandle=function(){var e=this,t=Object(o.O)("Story",this.authorElem),n=(Object(o.tb)(this.clickable_stickers)?this.clickable_stickers:{}).stickers;Object(ae.A)(n)&&n.forEach((function(n,i){e.stickers[i]&&Object(o.jc)(e.stickers[i],e._getStickerStyle(n,t))}))},t._createStickerLink=function(e,t){void 0===t&&(t={});var n=Object(o.mb)(Object(o.v)(e,"disabled")),i=window.lang;if(t.type&&!n){var a,r,s,c="a",l=!0,u="Stories__tooltipLink",d=function(){},p={type:t.type,style:Object(o.v)(e,"style")};switch(t.type){case ac.hashtag:var h=Object(o.v)(e,"hashtag")||"",f=h.replace("#","%23");a="/feed?section=search&q="+f,r=i.mobile_stories_show_hashtag_link,s="search",p.text=h;break;case ac.mention:var m=Object(o.v)(e,"mentioned_photo_url"),v=Object(o.v)(e,"mentioned_owner_href"),g=Object(o.v)(e,"mentioned_text");u+=" Stories__tooltipLink--mention",a=v,r=_.a.html([{class:"StoriesTooltipMention",inner:[{class:"StoriesTooltipMention__avatar",style:"background-image: url("+m+")"},{class:"StoriesTooltipMention__text",inner:g}]}]),s="profile";break;case ac.place:var b=Object(o.v)(e,"place_id"),A=window.Stories.getFrom();a="/place"+b,r=i.mobile_stories_go_to_place,this.store.list.includes("place")?l=!0:(a+="?from="+A,d=function(){c="div",l=!1,window.Stories._hideTooltips(!0),window.Stories.showLoading(),nav.go(a)}),s="place";break;case ac.music:c="div",r=i.mobile_stories_music_more,d=function(){var t=Object(o.v)(e,"id"),n=Object(o.v)(e,"audio");window.Stories.openMusicStickerActions(t,n)};break;case ac.storyReply:case ac.owner:var w=this.reply,y=w.is_expired,O=w.list;if(t.type===ac.owner||y)r=Object(o.v)(e,"owner-id")>0?i.mobile_stories_go_to_profile:i.mobile_stories_go_to_group,a=Object(o.v)(e,"link"),s="profile";else c="div",r=i.mobile_stories_go_to_story,d=function(){window.Stories.openReplies(O)};break;case ac.link:r=Object(o.v)(e,"tooltip-text"),a=Object(o.v)(e,"link");break;case ac.marketItem:var k=Object(o.v)(e,"photoUrl"),j=!!Object(o.v)(e,"isRestricted");j&&(d=function(e){e.preventDefault(),window.AlertBox(Object(ae.t)("mobile_stories_market_access_error_text"),Object(ae.t)("mobile_stories_market_access_error_title"))}),r=_.a.html([k&&!j?{class:"Stories__marketItemThumb",tag:"img",src:k}:{class:"Stories__marketItemThumb Stories__marketItemThumb--stub",inner:Object(W.a)(Object(Xs.a)())},{class:"Stories__marketItemText",tag:"span",inner:Object(ae.t)("mobile_stories_market_item_more")}]),a=Object(o.v)(e,"link");break;case ac.post:var S=Object(o.v)(e,"post-owner-id"),C=Object(o.v)(e,"post-id");r=i.mobile_stories_go_to_post,a="/wall"+S+"_"+C;break;case ac.sticker:r=Object(o.v)(e,"tooltip-text"),a=Object(o.v)(e,"link")}return window.Stories._requestStickerStat("click",p),Object(o.k)(c,{href:"a"===c?a:null,target:l?"_blank":null,innerHTML:r+_.a.html({inner:[Object(W.a)({icon:Object(Qs.a)()})],class:"Stories__tooltipLinkIcon",tag:"span"}),className:u,onclick:function(e){d&&d(e),s&&window.Stories._requestStickerStat(s,p),[ac.hashtag,ac.mention,ac.place,ac.storyReply,ac.post,ac.link,ac.sticker,ac.situationalTheme].includes(t.type)&&window.Stories.sendAnalyticsEvent("click_to_tooltip",{clickable_sticker:{id:t.id,type:oc[t.type]}})}})}},t._onLoadingStart=function(){this._loadingStartTime=new Date},t.renderAppsMetaStory=function(){var e="apps",t=window.lang;window.store.stories[e]||(window.store.stories[e]=window.Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var n=window.store.stories[e]&&window.store.stories[e].authors,i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=[];return n&&(this.coverItems=n,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*i/100,this.coverItems.forEach((function(t){var n=t.items.filter((function(e){return e.unread})),i=!!n.length,o=t.items[0],r=t.id?"{ id: '"+t.id+"' }":"{}";i&&(o=n[0]);var s={tag:"span",class:"GridStoryPreview",style:"background-image: url("+o.preview_url+")",onclick:'Stories.openNarrative("'+o.raw_id+"/"+e+'", '+r+")",inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+o.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(i?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};a.push(s)}))),{class:"MetaStory MetaStory--apps",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{tag:"a",href:this.app.url,target:"_blank",class:"MetaStory__appWrapper",inner:[{class:"MetaStory__appIcon",style:"background-image: url("+this.app.photoUrl+")"},{class:"MetaStory__appName",innerHTML:this.app.name},{class:"MetaStory__separator"},{tag:"span",class:"MetaStory__appLink",innerHTML:t.mobile_stories_go_to_app}]}]}]},a.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:a}]}]}:null]}},t.renderGroupsMetaStory=function(){var e="groups",t=window.lang;window.store.stories[e]||(window.store.stories[e]=window.Stories._forceSetStore(this.raw_id+"/"+e,e,window.store.storiesLists[e]));var n=window.store.stories[e]&&window.store.stories[e].authors,i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=[];return n&&(this.coverItems=n,this.coverCount=this.coverItems?this.coverItems.length:0,this.coverRowsCount=Math.ceil(this.coverCount/3),this.scrollOffset=0,this.metaStoryGridMarginTop=40.8*i/100,this.coverItems.forEach((function(t){var n=t.items.filter((function(e){return e.unread})),i=!!n.length,o=t.items[0],r=t.id?"{ id: '"+t.id+"' }":"{}";i&&(o=n[0]);var s={tag:"span",class:"GridStoryPreview",style:"background-image: url("+o.preview_url+")",onclick:'Stories.openNarrative("'+o.raw_id+"/"+e+'", '+r+")",inner:[{class:"GridStoryPreview__inner",style:"background-image: url("+o.small_preview+")",inner:[{tag:"a",href:t.author.href,attrs:{"data-author-id":t.author.id},class:"GridStoryPreview__author"+(i?" GridStoryPreview__author--unread":""),style:"background-image: url("+t.author.photo+")"},{tag:"span",class:"GridStoryPreview__title",innerHTML:t.author.name}]}]};a.push(s)}))),{class:"MetaStory MetaStory--groups",inner:[{class:"MetaStory__infoWrapper",inner:[{class:"MetaStory__info",inner:[{class:"MetaStory__infoTitle",inner:t.mobile_stories_groups_grid_title},{class:"MetaStory__infoDescription",inner:t.mobile_stories_groups_grid_text}]}]},a.length?{class:"MetaStory__recommendations",inner:[{class:"MetaStory__recommendations-inner",inner:[{class:"MetaStory__recommendations-items",inner:a}]}]}:null]}},t.handleRecommendationsScroll=function(){window.event.stopPropagation&&window.event.stopPropagation(),window.event.stopImmediatePropagation&&window.event.stopImmediatePropagation();var e=Object(o.O)("MetaStory__recommendations"),t=Object(o.O)("MetaStory__recommendations-inner");if(t&&e){var n=Math.min(t.scrollTop/(this.scrollOffset/100),70)/100;Object(o.jc)(e,{backgroundColor:"rgba(0, 0, 0, "+n+")"}),t.scrollTop?(Object(o.a)(e,"scroll"),window.Stories.pauseStory()):(window.Stories.playStory(),Object(o.Yb)(e,"scroll")),this.isGroupsMetaStory&&(this.blockHeaderEl||(this.blockHeaderEl=Object(o.O)("Story__gridTitle")),t.scrollTop>this.metaStoryGridMarginTop?Object(o.Yb)(this.blockHeaderEl,"Story__gridTitle--hide"):Object(o.a)(this.blockHeaderEl,"Story__gridTitle--hide"))}},t.pauseAudio=function(){window.Stories.pauseAudio()},t.destroy=function(){this.img&&Object(o.Zb)(this.video,"load",this.onLoadImgBind),this.video&&(Object(o.Zb)(this.video,"ended",this.onVideoEndedBind),Object(o.Zb)(this.video,"play",this.onVideoPlayBind),Object(o.Zb)(this.video,"pause",this.onVideoPauseBind),Object(o.Zb)(this.video,"canplaythrough",this.onCanPlayBind),Object(o.Zb)(this.video,"waiting",this.onVideoWaitingBind),Object(o.Zb)(this.video,"loadedmetadata",this.onVideoLoadedDataBind),Object(o.Zb)(this.video,"playing",this.onVideoPlayingBind),Object(o.Zb)(this.video,"seeking",this.onVideoSeekingBind),Object(o.Zb)(this.video,"seeked",this.onVideoSeekedBind),this.video.src="",this.video.load()),this.onDestroy(),this.onAutoPlay.off(),this.onDestroy.off(),this.onVideoBuffering.off(),this.onVideoData.off(),this.onVideoPlayEvent.off(),this.onVideoPauseEvent.off(),this.onVideoEndedEvent.off(),window.Stories._hideTooltips()},e}(),ec=function(){function e(e,t){var n=Object.assign({},{tick:100,onEnd:function(){},onTick:function(){},onStart:function(){},onPause:function(){},onStop:function(){}},t);this.left=e,this.initialTime=e,this.tick=n.tick,this.onEnd=n.onEnd,this.onTick=n.onTick,this.onStart=n.onStart,this.onPause=n.onPause,this.onStop=n.onStop,this.started=!1}var t=e.prototype;return t.stop=function(e){void 0===e&&(e=!1),this.started&&(this.pause(e),this.left=this.initialTime,e||this.onStop())},t.pause=function(e){void 0===e&&(e=!1),this.timer&&(this.timer=clearInterval(this.timer),this.started=!1,e||this.onPause())},t.start=function(){var e=this;if(this.started)return!1;var t=new Date(Date.now()+this.left).getTime();this.started=!0,this.timer=setInterval((function(){var n=(new Date).getTime();e.left=t-n,e.left<=0?(e.onTick(0),e.onEnd(),e.stop(!0)):e.onTick(e.left)}),this.tick),this.onStart()},t.isStarted=function(){return this.started},t.getTimeLeft=function(){return this.left},e}(),tc=n("0hlj"),nc="StoryAuthor_videoMuted",ic="StoryAuthor--error",ac={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13,situationalTheme:14},oc=Object.entries(ac).reduce((function(e,t){return e[t[1]]=t[0],e}),{}),rc=function(){function e(e,t){var n=this;this.store=window.Stories.getStore(),this.data=t,this.state={authorIndex:e};var i=this.getCurrentStoryIndex();this.setCurrentStoryIndex(i),this.story=new Zs(this.data.items[i],this.data.narrative,this.data.author,e,i),this.authorStoriesHTML=_.a.html(this.story.render()),this.progressItemElems=null,window.Stories.onRender((function(){n.updateStory()}))}var t=e.prototype;return t.getCurrentStory=function(){if(this.story)return this.story},t.destroy=function(){this.story&&this.story.destroy()},t.update=function(){var e=this.data.index;this.destroy(),this.story=new Zs(this.data.items[e],this.data.narrative,this.data.author,this.state.authorIndex,e),this.authorStoriesHTML=_.a.html(this.story.render())},t.updateHeader=function(){this.authorElems=window.Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex],this.progressItemElems=Array.from(Object(o.N)("StoryAuthor__progressItem",this.authorElem)),this.drawFilledProgressItems()},t.updateStory=function(){var e=this;this.authorElems=window.Stories.getAuthorElems(),this.authorElem=this.authorElems[this.state.authorIndex];var t=Object(o.O)("Story__body",this.authorElem);this.story.update(t),this.story.onVideoData((function(n){n.authorIndex,n.storyIndex;var i=e.story.getDuration(),a=e.story.getType(),r=e.store.isStopped,s=e.story.getStartTime(),c=e.story.getProgressPercentByLeftTime(i-s);if(e.drawCurrentProgress(c),Object(o.Yb)("StoryAuthor__progress--hide",Object(z.a)(".StoryAuthor__progress",e.authorElem)),e.countdown=new ec(i-s,{tick:13,onTick:function(t){var n=e.story.getProgressPercentByLeftTime(t);e.drawCurrentProgress(n)},onEnd:function(){"video"!==a&&(e.drawCurrentProgress(100),window.Stories.nextStory(!0),Object(o.Yb)(e.authorElem,"StoryAuthor_paused"))},onPause:function(){e.story.pause(),Object(o.a)(e.authorElem,"StoryAuthor_paused")},onStart:function(){e.story.play(),Object(o.Yb)(e.authorElem,"StoryAuthor_videoHold"),Object(o.Yb)(e.authorElem,"StoryAuthor_paused")}}),"photo"!==a&&"broken"!==a||r){if("video"===a){var l=e.story.getVideoState(),u=e.story.getVideo();Object(o.a)(t,"Story__body_video"),4!==l||r||u.paused||e.countdown.start()}}else e.countdown.start()})),this.story.onVideoEndedEvent((function(){e.drawCurrentProgress(100),e.story.progress=100,window.Stories.nextStory(!0)})),this.story.onVideoPauseEvent((function(){e.countdown&&e.countdown.pause()})),this.story.onVideoBuffering((function(){e.countdown&&e.countdown.pause()})),this.story.onVideoPlayEvent((function(){e.countdown&&!e.store.isStopped&&e.countdown.start()})),this.story.onAutoPlay((function(){var t=window.lang,n=e.story.getVideo();window.Stories.pauseAudio();var i=Object(o.O)("Story__body",e.authorElem),a=window.Stories.isGoodBrowser(),r=n.play();r?r.then((function(){e.story.canPause=!0})):e.story.canPause=!0,n.paused&&!a?e.story.renderError(e.authorElem,i,t.mobile_stories_inline_video_error):!e.countdown||e.store.isStopped||n.paused||e.story.buffering?a&&n.paused&&Object(o.a)(e.authorElem,"StoryAuthor_videoHold"):e.countdown.start(),n.muted&&Object(o.a)(e.authorElem,nc)})),this.story.onDestroy((function(){e.countdown&&(e.countdown.stop(),e.countdown=null)}))},t.getCountDown=function(){if(this.countdown)return this.countdown},t.getFirstUnreadStoryIndex=function(){if(window.Stories._hasContext("all"))return 0;var e=this.data.items.findIndex((function(e){return!0===e.unread}));return-1!==e?e:0},t.getCurrentStoryIndex=function(){if(!this.data.index){var e=this.getFirstUnreadStoryIndex();this.setCurrentStoryIndex(e)}return this.data.index},t.drawCurrentProgress=function(e){if(this.progressItemElems){var t=this.progressItemElems[this.data.index],n=Object(o.O)("StoryAuthor__progressItemCurrent",t),i=Object(o.O)("StoryAuthor__wick",t),a=e/100*t.clientWidth;o.jc.transform(n,void 0,[a,0]),this.story.isOneTime&&o.jc.transform(i,void 0,[a,0])}},t.drawFilledProgressItems=function(){var e=this.data.index;if(this.progressItemElems)for(Object(o.D)(this.progressItemElems,(function(e,t){Object(o.Yb)(t,"StoryAuthor__progressItem_filled")}));e>=0;)Object(o.a)(this.progressItemElems[--e],"StoryAuthor__progressItem_filled")},t.setCurrentStoryIndex=function(e){this.data.index=e,this.drawFilledProgressItems()},t.renderEmpty=function(){var e=this.story.getPreview(),t=window.Stories.getWidth();return _.a.html({class:"StoryAuthor StoryAuthor_empty",style:"width: "+t+"px;",attrs:{"data-src":e}})},t.render=function(){var e,t,n,i=this,a=window.lang,o=window.Stories.getWidth(),r=U.b?"ontouchstart":"onmousedown",s=U.b?"ontouchend":"onmouseup";return _.a.html({class:"StoryAuthor StoryAuthor_inited",style:"width: "+o+"px;",inner:[{class:"StoryAuthor__header",inner:{class:"StoryAuthor__progress"+(this.story.isOneTime?" StoryAuthor__progress--isOneTime StoryAuthor__progress--hide":""),inner:this.data.items.map((function(){return{class:"StoryAuthor__progressItem",inner:[{class:"StoryAuthor__progressItemBar",inner:{class:"StoryAuthor__progressItemCurrent"}},i.story.isOneTime?{class:"StoryAuthor__wick"}:null]}}))}},(e={class:"StoryAuthor__muted"},e[r]="Stories.unMute(this, event);",e.inner=[{class:"Story__icon_unmute",inner:Object(W.a)(Object(tc.a)())},{class:"StoryAuthor__muted_text",inner:a.mobile_stories_unmute}],e),(t={class:"StoryAuthor__next"},t[r]="Stories.onTouchStart(event);",t[s]="Stories.onTouchEnd(event);",t.ontouchcancel="Stories.onTouchEnd(event);",t),(n={class:"StoryAuthor__prev"},n[r]="Stories.onTouchStart(event);",n[s]="Stories.onTouchEnd(event, true);",n.ontouchcancel="Stories.onTouchEnd(event, true);",n),{class:"StoryAuthor__body",inner:this.authorStoriesHTML}]})},e}(),sc=n("c9MT"),cc=n("AWZS");var lc=function(e){void 0===e&&(e={});var t=e.mode||"tint",n=e.size||"s",i=e.imageTheme||"dark",a="image"===t&&"dark"===i,o=u.a.class("Banner",{md:t,sz:n,aside:e.asideMode,inverted:a}),r="image"===t&&e.background,s=null;return e.link&&(s={href:e.link,onClick:"nav.go('"+e.link+"', event);",class:"Banner__link",tag:"a"}),{inner:[{inner:[r?{inner:[e.background],class:"Banner__bg",tag:"div"}:null,e.before?{inner:[e.before],class:"Banner__before",tag:"div"}:null,{inner:[e.link&&s,e.header?{inner:[e.header],class:"Banner__header",tag:"div"}:null,e.subheader?{inner:[e.subheader],class:"Banner__subheader",tag:"div"}:null,e.text?{inner:[e.text],class:"Banner__text",tag:"div"}:null,e.actions?{inner:[e.actions],class:"Banner__actions",tag:"div"}:null],class:"Banner__content",tag:"div"},"expand"===e.asideMode?{inner:[Object(xi.D)()],class:"Banner__expand Btn Btn_theme_none",onClick:e.onExpand,tag:"button"}:null,"dismiss"===e.asideMode?{inner:[Object(W.a)({icon:a?Object(cc.a)():Object(sc.a)()})],class:"Banner__dismiss Btn Btn_theme_none",onClick:e.onDismiss,tag:"button"}:null],class:"Banner__in",tag:"div"}],onClick:e.onClick,class:o,tabindex:"0",role:"button",tag:"div"}},uc=n("lmbN"),dc=function(){function e(e){var t=window.lang;this.store=window.Stories.getStore(),this.viewers=this.store.viewers[e]||[],this.viewersState=this.store.viewersState[e]||[],this.questions=this.store.questions[e]||[],this.replies=this.store.replies[e]||[],this.poll=this.store.polls[e],this.extendedStats=this.store.extendedStats[e];var n=this.viewersState,i=n.count,a=n.repliesCountText,o=n.authorCountText,r=n.hiddenReason,s=n.privacyHint;this.raw_id=e,this.count=i,this.countText=Object(ae.J)(this.count,t.mobile_stories_views_title),this.hiddenReason=r,this.repliesCountText=a,this.repliesAuthorCountText=o,this.privacyHint=s||{},this.questions.length||this.privacyHint.showEmptyStatsPrivacyHint||this.extendedStats?this.title=t.mobile_stories_views_title_interactions:this.count&&this.replies.length?this.title=t.mobile_stories_views_title_replies_and_views:this.count?this.title=this.countText:this.replies.length&&(this.title=t.mobile_stories_views_title_replies)}var t=e.prototype;return t.render=function(){var e=this,t=window,n=t.winToUtf,i=t.lang,a=this.store.questions[this.raw_id]||[],o=this.needShowOnlyHiddenViewersInfo(),r=this.viewersState.privacyHint||{};return _.a.html({class:u.a.class("Views",{short:!(this.viewers.length||!this.replies.length||this.hiddenReason)},"_"),inner:[{class:"Views__overlay",onclick:"Stories.hideViews();"},{class:"Views__header",inner:[{class:"Views__table",inner:[{class:"Views__cell",inner:{class:"Views__title",inner:this.title}}]},{class:"Views__close",onclick:"Stories.hideViews();"}]},{class:"Views__body ScrollView"+(o?" Views__body--centerAlign":""),onscroll:'Stories.onScrollViews(this, "'+this.raw_id+'")',ontouchmove:"event.stopPropagation();",inner:[this.extendedStats?this.renderExtendedStatsBanner():null,r.showEmptyStatsPrivacyHint?{class:"ViewsEmptyStatsBlock",inner:[{class:"ViewsEmptyStatsBlock__icon",inner:Object(xi.Mb)()},{class:"ViewsEmptyStatsBlock__text",inner:i.mobile_stories_feedback_empty_stats_hint},{class:"ViewsEmptyStatsBlock__link",inner:{tag:"a",class:"link",inner:i.mobile_stories_go_to_privacy_settings,href:"/settings?act=privacy&privacy_edit=stories",onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]}}]}:null,r.showPrivacyHint?{class:"ViewsPrivacyHint",inner:lc({subheader:i.mobile_stories_feedback_privacy_hint,asideMode:"dismiss",before:Object(xi.nb)(),actions:{tag:"a",class:"link",inner:i.mobile_stories_go_to_settings,href:"/settings?act=privacy&privacy_edit=stories",onclick:["Stories.goToSettingsFromPrivacyHint",this.raw_id,"this","event"]},onDismiss:["Stories.hidePrivacyHint",this.raw_id]})}:null,this.replies.length?{class:"Views__replies StoryViewsSeparator",inner:[{class:"Views__table Views__repliesHeader",inner:[{class:"Views__cell Views__repliesCount",inner:this.repliesCountText},this.repliesAuthorCountText?{class:"Views__cell Views__repliesAuthorCount",inner:this.repliesAuthorCountText}:null]},{class:"Views__repliesBody",onscroll:'Stories.onRepliesScroll(event, "'+this.raw_id+'")',inner:{class:"Views__repliesScroll",inner:this.replies.map((function(t){return{class:"Views__reply "+(t.has_new?"Views__reply_new":""),onclick:'Stories.openReplies("'+t.owner_id+"/"+t.list+'", "'+e.raw_id+'");',inner:[{class:"Views__replyAvatarWrap",inner:{class:"Views__replyAvatar",src:t.photo_owners_data[0].owner_photo_url,tag:"img"}},{class:"Views__replyName",inner:t.name?n(t.name):i.mobile_stories_reply_you}]}}))}}]}:null,this.poll?{class:"Views__poll StoryViewsSeparator",inner:[{class:"Views__pollHeader",inner:i.mobile_wall_poll_head_title},{class:"Views__pollBody",inner:{class:"StoryFeedbackPoll"+("default"===this.poll.background.type?" StoryFeedbackPoll--default":""),inner:[this.getBackgroundElementForPoll(this.poll),{class:"StoryFeedbackPoll__question",inner:this.poll.question},{class:"StoryFeedbackPoll__countVoters",inner:this.poll.votersCountText},{class:"StoryFeedbackPoll__showResult",onclick:"Stories.openPoll("+this.poll.ownerId+", "+this.poll.pollId+", "+this.raw_id+")",inner:i.mobile_voting_show_result}]}}]}:null,a.length?{class:"Views__questions StoryViewsSeparator",inner:[{class:"Views__table Views__questionsHeader",inner:[{class:"Views__cell Views__questionsTitle",inner:i.mobile_stories_question_title},{class:"Views__cell Views__questionsLink",inner:i.mobile_stories_question_show_all,onclick:'Stories.showQuestions("'+this.raw_id+'")'}]},{class:"Views__questionsBody",inner:{class:"Views__questionsScroll",inner:a.slice(0,10).map((function(e){return{class:"Question","data-id":e.id,inner:[{class:"Question__content",inner:[{href:e.author.link,class:"Question__author",inner:e.isAnonymous?i.mobile_stories_question_anonymous:e.author.name,onClick:"Stories.sendAnalyticsEvent('question_go_to_author', { questionId: "+e.id+" });"},{class:u.a.class("Question__text",{small:e.text.length>40},"_"),inner:e.text}]},{class:u.a.class("Question__actions",{published:e.isPublished},"_"),inner:i.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",e.id]}]}}))}}]}:null,{class:"Views__viewers",inner:[this.count&&(a.length||this.replies.length||this.extendedStats)?{class:"Views__viewersHeader",inner:this.countText}:null,{class:"Views__viewersBody",inner:[this.viewers.map((function(e){return{class:"Views__viewer",href:e.href,inner:{class:"Views__table",inner:[{class:"Views__cell Views__cell_avatar",inner:{class:"Views__avatar",inner:[{class:"Views__avatarPhoto",src:e.photo,tag:"img"},e.isLiked?_.a.wrap(Object(Qa.b)({mix:"Views__avatarBadgeIcon",icon:"notify_mini_like"})):null]}},{class:"Views__cell Views__cell_name",inner:{class:"Views__name",inner:e.name}}]}}})),this.hiddenReason?{class:"Views__viewersHiddenReason",inner:[{class:"Views__viewersHiddenReasonIcon",inner:Object(xi.Mb)()},{class:"Views__viewersHiddenReasonText",inner:this.hiddenReason}]}:null]}]},this.viewersState.nextFrom?{class:"Views__viewersLoader",onclick:'Stories.loadViews("'+this.raw_id+'")'}:null]}]})},t.renderExtendedStatsBanner=function(){var e=window.lang;return{inner:[{inner:[Object(W.a)({icon:Object(uc.a)()})],class:"ViewsExtendedStatsBanner__before",tag:"div"},{inner:[{inner:[e.mobile_stories_feedback_extended_stats],class:"ViewsExtendedStatsBanner__title",tag:"div"},{inner:[this.extendedStats.preview],class:"ViewsExtendedStatsBanner__subtitle",tag:"div"}],class:"ViewsExtendedStatsBanner__content",tag:"div"},{inner:[Object(xi.f)()],class:"ViewsExtendedStatsBanner__after",tag:"div"}],class:"ViewsExtendedStatsBanner StoryViewsSeparator",onClick:["Stories.showExtendedStats",this.raw_id],tag:"button"}},t.needShowOnlyHiddenViewersInfo=function(){var e=this.store.questions[this.raw_id]||[];return this.count&&this.hiddenReason&&!this.viewers.length&&!this.replies.length&&!e.length},t.getBackgroundElementForPoll=function(e){var t=e.background,n=null,i="";if("photo"===t.type)n={class:"StoryFeedbackPoll__photo",style:"background-image: url("+t.photoUrl+")"},i="background: #"+t.backgroundColor;else if("gradient"===t.type){i="background: linear-gradient("+(t.angle-90)+"deg, "+t.points.map((function(e){return"#"+e.color+" "+Math.round(100*e.position)+"%"})).join(", ")+")"}return{class:"StoryFeedbackPoll__background",style:i,inner:n}},e}(),_c=function(){function e(e){this.store=window.Stories.getStore(),this.questions=this.store.questions[e]||[]}return e.prototype.render=function(){var e=window.lang;return _.a.elem({class:u.a.class("Questions"),inner:[{class:"Questions__header",inner:[{class:"Questions__table",inner:[{class:"Questions__cell",inner:{class:"Questions__title",inner:e.mobile_stories_question_title}}]},{class:"Questions__close",onclick:"Stories.hideQuestions();"}]},{class:"Questions__body",inner:[{class:"Questions__inner",ontouchmove:"event.stopPropagation();",inner:this.questions.map((function(t){return{class:"Question","data-id":t.id,inner:[{class:"Question__content",inner:[{href:t.author.link,class:"Question__author",inner:t.isAnonymous?e.mobile_stories_question_anonymous:t.author.name},{class:u.a.class("Question__text",{small:t.text.length>40},"_"),inner:t.text}]},{class:u.a.class("Question__actions",{published:t.isPublished},"_"),inner:e.mobile_stories_question_actions,onclick:["Stories.openQuestionActions",t.id]}]}}))}]}]})},e}(),pc=n("9b/I"),hc=n("mP7y"),fc=function(){function e(e){this.store=window.Stories.getStore(),this.extendedStats=this.store.extendedStats[e]}var t=e.prototype;return t.render=function(){var e=this,t=window.lang;return _.a.elem({inner:[{inner:[{inner:[{inner:[{inner:[t.mobile_stories_extended_stats_title],class:"StoryExtendedStats__title",tag:"div"}],class:"StoryExtendedStats__cell",tag:"div"}],class:"StoryExtendedStats__table",tag:"div"},{inner:[Object(W.a)({icon:Object(pc.a)()})],class:"StoryExtendedStats__back Btn Btn_theme_none",onClick:"Stories.hideExtendedStats();",tag:"button"}],class:"StoryExtendedStats__header",tag:"div"},{inner:[{inner:[this.extendedStats.achievement?{inner:[{inner:[Object(W.a)({icon:Object(hc.a)()})],class:"StoryExtendedStatsAchievement__before",tag:"div"},{inner:[{inner:[this.extendedStats.achievement],class:"StoryExtendedStatsAchievement__label",tag:"div"},{inner:[this.extendedStats.achievementSubtitle],class:"StoryExtendedStatsAchievement__subtitle",tag:"div"}],class:"StoryExtendedStatsAchievement__content",tag:"div"}],class:"StoryExtendedStatsAchievement StoryViewsSeparator",tag:"div"}:null,this.extendedStats.categories.map((function(t){return e.renderCategory(t)}))],class:"StoryExtendedStats__inner",onTouchMove:"event.stopPropagation();",tag:"div"}],class:"StoryExtendedStats__body",tag:"div"}],class:"StoryExtendedStats",tag:"div"})},t.renderCategory=function(e){var t=this;return{inner:[{inner:[e.title],class:"StoryExtendedStatsCategory__title",tag:"div"},{inner:[e.lines.map((function(e){return t.renderCategoryLine(e)}))],class:"StoryExtendedStatsCategory__lines",tag:"div"}],class:"StoryExtendedStatsCategory StoryViewsSeparator",tag:"div"}},t.renderCategoryLine=function(e){return{inner:[{inner:[e.name],class:"StoryExtendedStatsCategoryLine__name",tag:"div"},{inner:[e.counter],class:"StoryExtendedStatsCategoryLine__counter",tag:"div"}],class:"StoryExtendedStatsCategoryLine",tag:"div"}},e}();function mc(){var e=navigator.connection;if(!e)return"";var t=e.effectiveType,n=e.downlink;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return n>8?"wi-fi":"LTE"}return""}var vc=[];var gc=[];var bc;!function(e){e.Add="add",e.Delete="delete"}(bc||(bc={}));var Ac,wc,yc,Oc,kc=n("xU72"),jc=n("vk58"),Sc=!1;function Cc(e){var t,n=this;this.pauseStory(),this._hideTooltips();var i=function(){Kt.a.setLoading(Object(z.a)("#AddToNarrativeFromStoryViewSaveBtn"),!1),Sc=!1,Un.a.close(wc),n.hideMenu(),n.playStory()},a=Object(jc.a)({inner:[Object(Kt.a)({inner:Object(ae.t)("mobile_narratives_create_popup_save_button_text"),disabled:!0,attrs:{id:"AddToNarrativeFromStoryViewSaveBtn"},onClick:function(){Sc||(Kt.a.setLoading(Object(z.a)("#AddToNarrativeFromStoryViewSaveBtn"),!0),Sc=!0,window.ajax.post("narratives",{act:"publish",owner_id:e.ownerId,hash:e.publishNarrativeHash,cover_story_id:e.storyId,story_ids:e.storyId,title:t},{onDone:function(e){q.g({type:q.e,avatar:e.coverUrl,text:Object(ae.v)(Object(ae.t)("mobile_narratives_success_added_to_narrative"),{narrative_title:e.title})}),Object(Be.c)(Be.a.publishNarrative,e.ownerId,e.id,Be.b.storyViewer),i()},onFail:function(e){return q.g({text:e||Object(ae.t)("global_error"),type:q.d}),i(),!0}}))}}),Object(Kt.a)({theme:"secondary",inner:Object(ae.t)("mobile_narratives_create_popup_cancel_button_text"),onClick:function(){return i()}})]}),o=_.a.preactElem(Un.a,{on_overlay_click_native:function(){return i()},scrollable:!0,header:{title:Object(ae.t)("mobile_narratives_create_popup_title")},footer:a,inner:[{inner:Object(ae.t)("mobile_narratives_create_popup_description"),style:"margin-bottom: 10px"},Object(va.a)({placeholder:Object(ae.t)("mobile_narratives_create_popup_title"),maxlength:e.narrativeTitleMaxLength,on_change:function(e){t=e.currentTarget.value.trim(),Kt.a.setDisabled(Object(z.a)("#AddToNarrativeFromStoryViewSaveBtn"),!t.length)}})]});wc=Un.a.open(o,!0,{withoutCloning:!0})}function Ec(){var e,t=this;this.pauseStory(),this._hideTooltips();var i=function(){Kt.a.setLoading(Object(z.a)(".NarrativesListActions__action--save"),!1),Sc=!1,Un.a.close(Ac),t.hideMenu(),t.playStory()},a=[],r=this.getCurrentStory(),s=null===(e=null==r?void 0:r.raw_id)||void 0===e?void 0:e.split("_").map(Number),c=s[0],l=s[1],u=function(){var e=null,n=_.a.preactElem(kc.a,{contentId:"StoriesArchiveNarrativeSelector",title:Object(ae.t)("mobile_narratives_selector_page_title"),onLeftActionClick:function(){return i()}});_.a.mountPreactComponent(Oc,{ownerId:c,selectedStoryId:l,isCreateBtnVisible:!0,disablePreview:!0,forceActionsVisible:!0,customOnScrollForAutoScroller:function(t){return e=t},onNarrativeCheckChanged:function(e,t){var n,i=null===(n=e.stories)||void 0===n?void 0:n.some((function(e){return e.id===l}));a=a.filter((function(t){return t.narrative_id!==e.id})),t?i||a.push({op:bc.Add,story_id:l,narrative_id:e.id,narrative_title:e.title,narrative_cover_url:e.coverUrl}):i&&a.push({op:bc.Delete,story_id:l,narrative_id:e.id,narrative_title:e.title,narrative_cover_url:e.coverUrl}),Kt.a.setDisabled(Object(z.a)(".NarrativesListActions__action--save"),Boolean(!a.length))},onCreateBtnClick:function(){return Un.a.close(Ac),Object(Be.c)(Be.a.createNarrative,c,0,Be.b.storyViewer),Cc.call(t,{storyId:l,ownerId:c,publishNarrativeHash:yc.publishNarrativeHash,narrativeTitleMaxLength:yc.narrativeTitleMaxLength})},isSelectActionAvailable:!0,isSaveActionAvailable:!0,forceFirstLoading:!0,onSaveClick:function(){if(!Sc){Kt.a.setLoading(Object(z.a)(".NarrativesListActions__action--save"),!0),Sc=!1;var e=a.map((function(e){return{op:e.op,story_id:e.story_id,narrative_id:e.narrative_id}}));window.ajax.post("narratives.php",{act:"batch_edit",owner_id:c,operations:JSON.stringify(e),hash:yc.editNarrativeHash},{onDone:function(){var e=[],t=[];a.forEach((function(n){switch(n.op){case bc.Add:e.push(n);break;case bc.Delete:t.push(n)}}));var n=e.length,o=t.length,r="",s=null;if(n)if(1===n){var l=e[0];s=l.narrative_cover_url,r=Object(ae.v)(Object(ae.t)("mobile_narratives_success_added_to_narrative"),{narrative_title:l.narrative_title})}else r=Object(ae.u)(n,Object(ae.t)("mobile_narratives_story_added_to_narratives","raw"));else o&&(r=Object(ae.u)(o,Object(ae.t)("mobile_narratives_story_removed_from_narratives","raw")));r&&q.g({type:q.e,avatar:s,text:r}),Object(Be.c)(Be.a.addStoryToNarrative,c,0,Be.b.storyViewer),i()},onFail:function(e){return q.g({text:e||Object(ae.t)("global_error"),type:q.d}),i(),!0}})}}},Object(z.a)("#StoriesArchiveNarrativeSelector",n)),Ac=Un.a.open(n,!0,{withoutCloning:!0});var r=Object(z.a)(".ModalPage__content",n);null==r||r.addEventListener("scroll",(function(t){null==e||e(Object(o.db)(t.currentTarget)+t.currentTarget.scrollTop)}))};(function(e){return new Promise((function(t,n){yc?t(yc):window.ajax.post("narratives.php",{act:"choose_box_data",owner_id:e},{onDone:function(e){t(yc=e)},onFail:function(e){return n(e),!0}})}))})(c).then((function(e){var t;return Promise.all([Promise.all([n.e("vendor"),n.e("vendor~draggable"),n.e("narratives_list")]).then(n.bind(null,"MM3i")).catch((function(e){return Object(o.oc)("mvk_narratives_event",null,"chunk_error",e.name)})),Object(h.a)((t={},t[e.narrativesCssPath]=null,t))]).then((function(e){var t=e[0];Oc=t&&(null==t?void 0:t.NarrativesList),u()}))})).catch(console.error)}var Tc=n("zouF"),Ic=!1;function Mc(){var e,t=this,n=this.getCurrentAuthorIndex(),i=this.getCurrentStoryIndex(),a=(null===(e=this.store.authors[n])||void 0===e?void 0:e.items)||[],o=this.getCurrentStory().id,r=this.getCurrentNarrative(),s=null;if(r&&!Ic){this.pauseStory();var c=function(e){void 0===e&&(e=!0),s&&Un.a.close(s),t.hideMenu(),e&&t.playStory(),Ic=!1};s=Object(Tc.a)(Object(ae.t)("mobile_stories_remove_only_from_narrative_warning"),(function(){var e,n,l,u,d,_;if(!Ic){Kt.a.setLoading(Object(z.a)(".Popup__buttons .Popup__button:first-child",s),!0),Kt.a.setDisabled(Object(z.a)(".Popup__buttons .Popup__button:last-child",s),!0),Ic=!0;var p=null===(e=r.stories)||void 0===e?void 0:e.filter((function(e){return e.id!==o})),h=null==p?void 0:p.map((function(e){return e.id})),f=r.customCover?null:h.includes(r.coverStoryId)?r.coverStoryId:h[0]||o;window.ajax.post("narratives",{act:"update",owner_id:r.ownerId,hash:r.editHash,cover_story_id:f,custom_cover_photo_id:null===(n=r.customCover)||void 0===n?void 0:n.photoId,story_ids:h.join(","),title:r.title,narrative_raw_id:r.rawId,crop_x:null===(l=r.coverCrop)||void 0===l?void 0:l.x,crop_y:null===(u=r.coverCrop)||void 0===u?void 0:u.y,crop_width:null===(d=r.coverCrop)||void 0===d?void 0:d.width,crop_height:null===(_=r.coverCrop)||void 0===_?void 0:_.height},{onDone:function(e){var n,o;window.Stories.sendAnalyticsEvent("delete_from_narrative"),q.g({type:q.e,avatar:e.coverUrl,text:Object(ae.v)(Object(ae.t)("mobile_narratives_success_updated"),{narrative_title:e.title})}),null===(o=null===(n=window.Narratives)||void 0===n?void 0:n.onNarrativeChangedFromStoryView)||void 0===o||o.call(n,e),c(!1),a.splice(i,1),window.Stories.setCurrentNarrative(e),a.length?(t.setCurrentStory(i-1),t.nextStory()):(t.close(),location.reload())},onFail:function(){return c(),!0}})}}),c,{yes_label:Object(ae.t)("mobile_stories_remove_only_from_narrative_submit_label")})}}var Pc,xc=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},Lc=0,Rc=1,Bc=3,Nc={opened:!1,init:function(e,t){var n=this;void 0===t&&(t={}),this.params=Object(o.K)({replace:!1,reply:!1,replyTo:!1,restore:!1,forceAuthorIndex:!0},t);var i=this._parseList(e).split("/"),a=i[0],r=i[1],s=i[2],c=a.split("_")[0];t&&t.id?c=t.id:t&&t.narrativeId&&(c=t.narrativeId),this.initRaw=e,this.storyOwner=c,this.storyRaw=a,this.storyExtra=s,this.storyList=r,this.extra=this.parseExtra(this.storyExtra),this.needAudioRestore=window.audio.playing(),this.Views={},this.popoutOpen=!1,this.slideTimer=null,this.createLayer(),this._initStore(),this.detectAutoplay().then((function(){n.isRestored?n._init():n._checkPreloadedList()?(n._initPreloadedList(),n._init()):n._requestList().then((function(e){var t=e.items,i=e.list;t&&(n.store.authors=t,n.store.listLoaded=!0,n.store.list=i,n.store.inited=!0,n._init())}),(function(){}))}))},parseExtra:function(e){var t={},n=String(e).split(";");return n.forEach((function(e,i){if(n.hasOwnProperty(i)){var a=n[i].split(":"),o=a[0],r=a[1];o&&r&&(t[o]=r)}})),t},_checkPreloadedList:function(){return!!(window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList])},_initPreloadedList:function(){var e=window.store.storiesLists[this.storyList];e&&(this.store.authors=e,this.store.listLoaded=!0,this.store.list=this.storyList,this.store.inited=!0)},pushPreloadedList:function(e){var t=Object(o.Pb)(e);window.store||(window.store={}),window.store.storiesLists||(window.store.storiesLists={}),Object(o.K)(window.store.storiesLists,t),window.store.stories||(window.store.stories={}),Object.keys(t).forEach((function(e){window.store&&window.store.storiesLayers&&window.store.storiesLayers.includes(e)||delete window.store.stories[e]}))},_init:function(){var e=this;this.createAuthors();var t=this.getFirstStoryIndex();this.setCurrentStory(t);var n=this.getCurrentStory();this.params.restore||this.setHistory(n.raw_id,{nav_init:!0,replace:this.params.replace}),this.sliderEl=Object(o.M)("StoriesSlider"),this.slider=Dn(this.sliderEl,{speed:300,startSlide:this.getCurrentAuthorIndex(),onSlideChange:function(t){t=e.slider&&Object(o.mb)(e.slider.getCurrentPos());var n=e.getCurrentAuthorIndex(),i=e.getCurrentAuthor().data;clearTimeout(e.slideTimer),void 0!==t&&t!==n&&(e.markSeenAllOwners(),!1===e.isTap&&(t>n?e.sendAnalyticsEvent("go_to_next_author"):e.sendAnalyticsEvent("go_to_previous_author"),i.is_groups||i.is_apps||e.markSeenStory(!0)),e.setCurrentAuthor(t),e.slideTimer=setTimeout((function(){e.renderStory()}),300)),delete e.isTap},onSetup:function(){Object(o.a)(e.layer,"Stories_inited"),e.renderStory()}}),this.Authors&&1===this.Authors.length&&(Object(o.a)(this.layer,"Stories_inited"),this.renderStory()),this.store.showViews&&this.showViews(n.raw_id,!0),this._initViewerSource(),this._sendOpeningEvents()},_initStore:function(){window.store||(window.store={stories:{},storiesLayers:[]}),window.store.stories||(window.store.stories={}),window.store.storiesLayers||(window.store.storiesLayers=[]),window.store.stories[this.storyList]&&window.store.stories[this.storyList].inited?(this.store=window.store.stories[this.storyList],this.isRestored=!0):(this.store={authors:[],listLoaded:!1,readedStories:{},_requests:[],viewers:{},questions:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:this.storyList,initRaw:this.initRaw,storyIndex:0,authorIndex:0,isReply:this.params.reply,replyTo:this.params.replyTo,inited:!1},window.store.stories[this.storyList]=this.store,this.isRestored=!1),this.params.restore||window.store.storiesLayers.push(this.store.storyList)},_initViewerSource:function(){var e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.module;break;default:this.viewerSource=e}},_sendOpeningEvents:function(){var e=this._getSource();if(e){var t;switch(e){case"narrative_story":t="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":t="narrative_open";break;case"narrative_recommendations":t="narrative_other"}if(t&&this._sendNavigationStatEvents(t),"narrative_fave"===e){var n=this.getCurrentNarrative();if(!(null==n?void 0:n.ownerId)||!(null==n?void 0:n.id))return;Object(o.oc)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:Object(o.mb)(null==n?void 0:n.ownerId),item_id:Object(o.mb)(null==n?void 0:n.id),time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3)})}}},_abortRequests:function(){Object(ae.A)(this.store._requests)&&Object(o.D)(this.store._requests,(function(e,t){t.abort()})),this.store._requests=[]},_saveRequest:function(e){this.store._requests.push(e)},getStore:function(){return this.store},setAllAuthorStoriesReaded:function(e){var t=this;this.store.authors[e].items.forEach((function(e){if(e.unread){var n=e.raw_id;e.track_code&&(n+="_"+e.track_code),t.store.readedStories[n]=!0}}))},markSeenAllOwners:function(){var e=this.getCurrentAuthor().data;if(e.is_groups||e.is_apps){var t=window.store.stories[e.is_groups?"groups":"apps"];if(t){t.authors.forEach((function(e){return e.items.forEach((function(e){return e.unread=!1}))}));var n=t.authors.map((function(e){return e.author.id}));window.ajax.post("stories.php",{_ajax:1,act:"mark_owners_seen",hash:this.store.authors[0].read_hash,owners_ids:n.join(",")}),this._needFeedUpdate=!0}}},createAuthors:function(){var e,t=this,n="";this.Authors=[];var i=this.getCurrentAuthorIndex();this.isRestored&&!this.params.forceAuthorIndex||(i=this.getFirstAuthorIndex());var a=this.store.authors[i],r=!(null===(e=this.params)||void 0===e?void 0:e.narrativeId)&&a.items[a.items.length-1].unread;if(this.extra)switch(this.extra.context){case"new":r=!0;break;case"all":r=!1}Object(o.D)(this.store.authors,(function(e,i){var a=i.items;if(!e||!r||a[a.length-1].unread){var o=new rc(e,i);t.Authors.push(o),n+=o.renderEmpty()}})),Object(o.zc)(Object(o.O)("Stories__authors",this.layer),n),this.authors=Array.from(Object(o.N)("StoryAuthor",this.layer)),Object(o.D)(this.Authors,(function(e,t){t.updateHeader()})),this.setCurrentAuthor(i)},getFirstStoryIndex:function(){var e=this,t=this.store.authors[this.getCurrentAuthorIndex()];if(this._hasContext("all"))return 0;if(!this._hasContext("new")){var n=t.items.findIndex((function(t){return t.raw_id===e.storyRaw}));return-1!==n?n:0}return this.getCurrentStoryIndex()},getFirstAuthorIndex:function(){var e=this,t=this.store.authors.findIndex((function(t){var n=t.author.id;return t.id&&(n=t.id),t.is_narrative&&(n=t.narrative.id),String(n)===String(e.storyOwner)}));return-1!==t?t:0},getCurrentAuthorIndex:function(){return this.store.authorIndex},getCurrentStoryIndex:function(){return this.store.authors[this.getCurrentAuthorIndex()].index},getCurrentStory:function(){return this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()]},getCurrentNarrative:function(){return this.store.authors[this.getCurrentAuthorIndex()].narrative},setCurrentNarrative:function(e){var t=this.store.authors;if(t){var n=t[this.getCurrentAuthorIndex()];n&&(n.narrative=e)}},setCurrentAuthor:function(e){this.store.authorPrevIndex=this.store.authorIndex,this.store.authorIndex=e,this.updateCurrentAuthor()},setCurrentStory:function(e){this.store.authors[this.getCurrentAuthorIndex()].index=e},drawSiblingPreview:function(){for(var e=this.getCurrentAuthorIndex(),t=-2;t<=2;t++){var n=e+t;this.authors[n]&&n!==e&&this.drawPreview(this.authors[n])}},drawPreview:function(e){Object(o.jc)(e,"background-image","url("+Object(o.g)(e,"data-src")+")")},updateCurrentAuthor:function(){var e=this.authors[this.store.authorIndex];Object(o.D)(this.authors,(function(e,t){Object(o.Yb)(t,"StoryAuthor_current")})),Object(o.a)(e,"StoryAuthor_current")},getSizes:function(){var e,t,n=window.innerHeight,i=window.innerWidth;return i<540?(e=i,t=n,window.zlayer.open(),window.zlayer.onResize=this.onResize.bind(this)):(e=Math.floor(Math.min(540,Math.max(320,.563*n))),t=Math.floor(1.78*e),Object(o.a)(document.body,"vk__story_open")),[e,t]},createLayer:function(){window.innerWidth<540?(window.zlayer.open(),window.zlayer.onResize=this.onResize.bind(this)):Object(o.a)(document.body,"vk__story_open"),Nc.opened=!0;var e=this.getSizes(),t=e[0],n=e[1];this.storyW=t;var i=_.a.html({id:"StoriesView",class:"Stories__layer _preventMenuOpen",style:"max-width: "+t+"px; max-height: "+n+"px",inner:[{class:"Stories__loading",inner:{class:"Stories__loadingInner"}},{id:"StoriesSlider",class:"Stories__authors peppermint peppermint-inactive",ontouchmove:"Stories.onTouchMove(event);",inner:""},{class:"Stories__layerClose",inner:{class:"Story__icon Story__icon_close"},onclick:"return Stories.clickClose();"},{class:"Stories__popout"},{class:"Stories__flash",onclick:"Stories.hideFlashPopup()",inner:{class:"Stories__flashText"}},{class:"Stories__swipeText Stories__swipeText_top"}]});this.layer=Object(o.f)(Object(o.k)("div",{className:"Stories",innerHTML:i}),document.body),Object(o.g)(this.layer,"ontouchmove","event.preventDefault();"),this.loader=Object(o.O)("Stories__loading",this.layer),this.popout=Object(o.O)("Stories__popout",this.layer),this.swipeTextTop=Object(o.O)("Stories__swipeText_top",this.layer)},onResize:function(){var e=Object(o.M)("StoriesView"),t=this.getSizes(),n=t[0],i=t[1];Object(o.g)(e,"style","max-width: "+n+"px; max-height: "+i+"px"),this.storyW=n,this.authors.forEach((function(e){Object(o.jc)(e,"width",n+"px")})),this.Authors&&this.Authors.length>1&&this.slider&&this.slider.recalcWidth()},getWidth:function(){return this.storyW},renderStory:function(){var e=this.store.authorPrevIndex,t=this.getCurrentAuthorIndex(),n=this.authors[t],i=this.Authors[t];if(i.update(),!isNaN(e)&&e!==t){var a=this.Authors[e],r=this.authors[e];a.update();var s=a.renderEmpty(),c=Object(o.l)(s);Object(o.ac)(c,r)}var l=Object(o.l)(i.render());Object(o.ac)(l,n),this.authors=Array.from(Object(o.N)("StoryAuthor",this.layer)),this.updateCurrentAuthor(),i.updateHeader(),this.onRender(),this.drawSiblingPreview(),"open"===this.extra.replies&&this.showViews(this.getCurrentStory().raw_id)},getCurrentAuthor:function(){var e=this.getCurrentAuthorIndex();return(this.Authors||[])[e]},getCurrentAuthorEl:function(){return this.getCurrentAuthor().authorElem},getAuthorElems:function(){return this.authors},prevStory:function(){var e=this;this.stopStory(),this.store.isStopped=!1,requestAnimationFrame((function(){var t=e.getCurrentStoryIndex(),n=e.getCurrentAuthorIndex();if(t-1<0)if(n-1<0)e.setCurrentStory(0),e.renderStory();else{e.slider.slideTo(n-1);var i=e.store.authors[n-1].items.length-1;e.setCurrentStory(i)}else e.setCurrentStory(t-1),e.renderStory()}))},nextStory:function(e){var t=this;this.stopStory(),this.markSeenAllOwners(),this.store.isStopped=!1,this.markSeenStoryIfNeeded(),requestAnimationFrame((function(){var n=t.store.authors[t.getCurrentAuthorIndex()],i=t.getCurrentStoryIndex(),a=t.getCurrentAuthorIndex(),o=n.items.length;if(t.Authors){var r=t.Authors.length;o-1<=i?r-1<=a?requestAnimationFrame((function(){e&&t.sendAnalyticsEvent("close_auto_by_time"),t.close()})):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.slider.slideTo(a+1),t.setCurrentStory(0)):(e&&t.sendAnalyticsEvent("go_to_next_story_auto_by_time"),t.setCurrentStory(i+1),t.renderStory())}}))},stopStory:function(){this.store.isStopped=!0,this.pauseStory()},pauseStory:function(e){var t=this.getCurrentAuthor();if(t){var n=t.getCountDown();e&&Object(o.a)(this.layer,"Stories_paused"),n&&n.pause()}},playStory:function(){this.store.isStopped=!1;var e=this.getCurrentAuthor();if(e){var t=e.getCountDown();Object(o.Yb)(this.layer,"Stories_paused"),t&&t.start()}},pauseAudio:function(){var e=window.audio;this.getCurrentStory().noSound||e&&e.pause()},restoreAudio:function(){var e=window.audio;this.needAudioRestore&&e&&e.play()},showMenu:function(){this.store.showMenu=!0,this._hideTooltips(),this.stopStory(),Object(o.a)(this.layer,"Stories_menuOpened")},hideMenu:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(o.Yb)(this.layer,"Stories_menuOpened"),e&&this.playStory()},showLoading:function(){var e=this;this.loader&&(clearTimeout(this.loaderTimer),this.loaderTimer=setTimeout((function(){Object(o.lc)(e.loader)}),100))},hideLoading:function(){this.loader&&(clearTimeout(this.loaderTimer),Object(o.hb)(this.loader))},onRepliesScroll:function(e,t){this.Views[t]&&(this.store.viewersState[t].repliesScrollLeft=e.target.scrollLeft)},goToSettingsFromPrivacyHint:function(e,t,n){var i=this.store.viewersState[e]||[];return this.sendAnalyticsEvent("go_to_settings",{nav_screen:i.count?"feedback":"feedback_without_viewers"}),nav.go(t,n)},showEmptyStats:function(e){this.sendAnalyticsEvent("open_empty_feedback"),this.showViews(e)},showViews:function(e,t){var n=this;if(void 0===t&&(t=!1),this.hideMenu(),this.store.showViews=!0,this.stopStory(),this._hideTooltips(),this.Views[e]){var i=this.Views[e].render();this.popoutOpen=!0,Object(o.zc)(this.popout,i);var a=Object(o.O)("Views__repliesBody",this.popout);a&&(a.scrollLeft=0),t||this.sendAnalyticsEvent("open_replies_list")}else{var r=this.store.viewersState[e],s=this.store.viewers[e];if(r&&s)return void this.createViews(e,t);this.showLoading(),this._requestFeedback(e).then((function(){n.markQuestionsAsViewed(),n.createViews(e,t),n.hideLoading()}))}},showExtendedStats:function(e){var t=new fc(e).render();this.popout.appendChild(t),this.sendAnalyticsEvent("open_advanced_statistic")},hideExtendedStats:function(){Object(o.Vb)(Object(o.O)("StoryExtendedStats",this.popout))},markQuestionsAsViewed:function(){(this.getCurrentStory()||{}).isNewQuestions=!1,Object(o.Yb)(Object(o.O)("Story__stats"),"Story__stats_new_questions")},createViews:function(e,t){void 0===t&&(t=!1);var n=this.store.viewersState[e],i=new dc(e),a=i.render();this.popoutOpen=!0,Object(o.zc)(this.popout,a),this.Views[e]=i;var r=Object(o.O)("Views__repliesBody",this.popout);r&&(r.scrollLeft=n.repliesScrollLeft),t||this.sendAnalyticsEvent("open_replies_list")},hideViews:function(e){void 0===e&&(e=!0),e&&this.playStory(),this.store.showViews=!1,this.popoutOpen=!1,Object(o.zc)(this.popout,"")},loadViews:function(e){var t=this,n=this.store.viewersState[e],i=n.loading,a=n.nextFrom;!i&&a&&(n.loading=!0,this.showLoading(),this._requestFeedback(e,a).then((function(){var i=new dc(e),a=i.render();t.popoutOpen=!0;var r=Object(o.O)("Views__body",t.layer).scrollTop;Object(o.zc)(t.popout,a),Object(o.O)("Views__body",t.layer).scrollTop=r,t.Views[e]=i,t.hideLoading(),n.loading=!1})))},showComment:function(){var e=this,t=this.authors[this.store.authorIndex],n=Object(o.O)("Story__commentTextarea",t);this.store.showComment=!0,this.stopStory(),Object(o.a)(this.layer,"Stories_commentOpened"),this._hideTooltips(),requestAnimationFrame((function(){e.sendAnalyticsEvent("comment_tap"),n&&n.focus()}))},hideComment:function(e){void 0===e&&(e=!0),this.store.showMenu=!1,Object(o.Yb)(this.layer,"Stories_commentOpened"),e&&this.playStory()},onInputComment:function(e){var t=this.authors[this.store.authorIndex],n=Object(o.O)("Story__commentSend",t),i=String(Object(o.zc)(e)).trim();Object(o.vc)("Story__commentSend_active",n,!!i)},sendComment:function(){var e=this.authors[this.store.authorIndex],t=Object(o.O)("Story__commentTextarea",e),n=Object(o.O)("Story__commentSend",e),i=Object(o.zc)(t);if(Object(o.gb)("Story__commentSend_active",n)){Object(o.zc)(t,""),Object(o.Yb)(n,"Story__commentSend_active");var a=this.getCurrentAuthorIndex(),r=this.getCurrentNarrative(),s=this.getCurrentStory().raw_id,c=this.store.authors[a],l=c.send_hash,u=c.author.id,d=void 0;d=r?"narrative"+r.ownerId+"_"+r.id:"story"+s,this._sendMessage(l,d,i,u),this.hideComment()}},manageStoryInNarratives:function(e){void 0===e&&(e=!1);var t=this.getCurrentStory().owner_id,n=this.getCurrentNarrative();return Object(qs.b)(qs.a.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP)&&this.hideStoriesNarrativesFeatureHint(),Object(Be.c)(e?Be.a.addToNarrativeFromActionSheet:Be.a.clickToAddToNarrative,t,(null==n?void 0:n.id)||0,Be.b.storyViewer),Ec.call(this)},hideStoriesNarrativesFeatureHint:function(){Object(qs.e)(qs.a.ACCOUNT_HINT_NARRATIVES_ADD_TOOLTIP)},showFlashPopup:function(e,t){var n=this;void 0===t&&(t=!0);this.stopStory();var i=Object(o.O)("Stories__flash",this.layer);Object(o.zc)(Object(o.O)("Stories__flashText",i),e),setTimeout((function(){Object(o.a)(i,"Stories__flash_show")})),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer),this.flashTimer=setTimeout((function(){Object(o.Yb)(i,"Stories__flash_show"),n.flashHideTimer=setTimeout((function(){n.hideFlashPopup(t)}),1500)}),1500)},hideFlashPopup:function(e){e&&this.playStory(),clearTimeout(this.flashTimer),clearTimeout(this.flashHideTimer);var t=Object(o.O)("Stories__flash",this.layer);Object(o.Yb)(t,"Stories__flash_show")},removeCurrentStory:function(){var e=this,t=this.getCurrentAuthor(),n=this.getCurrentNarrative();if(t){var i=t.getCurrentStory(),a=i.isNarrative?Object(ae.t)("mobile_stories_delete_narrative"):Object(ae.t)("mobile_stories_delete_story"),o=null,r=function(){o&&Un.a.close(o),e.hideMenu(),e.playStory()};o=Object(Tc.a)(a.replace(/(<([^>]+)>)/gi,"\n"),(function(){Kt.a.setLoading(Object(z.a)(".Popup__buttons .Popup__button:first-child",o),!0),Kt.a.setDisabled(Object(z.a)(".Popup__buttons .Popup__button:last-child",o),!0);var a=t.data.remove_hash,s=i.can_remove,c=i.raw_id;if(s){e.pauseStory();var l=function(){e._requestFeedBlock(),0===e.getCurrentStoryIndex()?(e.close({closeAll:!1}),location.reload()):(e.store.authors[e.getCurrentAuthorIndex()].items.splice(e.getCurrentStoryIndex(),1),e.hideMenu(),e.prevStory())};n?e._requestRemoveNarrative(n.rawId,a).then((function(){var e,t;r(),l(),null===(t=null===(e=window.Narratives)||void 0===e?void 0:e.onNarrativeRemovedFromStoryView)||void 0===t||t.call(e,n.id)})).catch(console.error):e._requestRemoveStory(c,a).then((function(){r(),e.sendAnalyticsEvent("delete"),l()})).catch(console.error)}else r()}),r,{yes_label:Object(ae.t)("mobile_stories_delete_submit_label")})}},removeCurrentStoryFromNarrative:function(){return Mc.call(this)},editCurrentNarrative:function(e){var t=this.getCurrentNarrative(),n=Object(ae.O)("narratives",{act:"edit",owner_id:null==t?void 0:t.ownerId,narrative_id:null==t?void 0:t.id,from:window.nav.cur});return Object(Be.c)(Be.a.clickToEditNarrative,null==t?void 0:t.ownerId,null==t?void 0:t.id,Be.b.storyViewer),window.nav.go(n,e,{replace:!0})},onScrollViews:function(e,t){var n=this.store.viewersState[t],i=n.loading,a=n.nextFrom;if(!i&&a){e.scrollHeight-e.offsetHeight-400<=e.scrollTop&&this.loadViews(t)}},unMute:function(e,t){var n=this.getCurrentAuthor().story.getVideo();Object(o.j)(t),n&&n.muted&&(n.muted=!1,Object(o.Yb)(Object(o.eb)(nc,e),nc))},onTouchStart:function(e){var t=this,n=this.getCurrentAuthor().story;if(n&&"video"===n.getType()){var i=n.getVideo();if(i&&i.paused)return void(this.preventedTap=!0)}this.isTap=!0,clearTimeout(this.isTapTimer),n.isOneTime||(this.pauseStory(!0),"touchstart"===e.type?(this.tapStartX=e.changedTouches[0].clientX,this.tapStartY=e.changedTouches[0].clientY):(this.tapStartX=e.clientX,this.tapStartY=e.clientY),this.isYmove=null,Object(o.Yb)(this.layer,"Stories_touchMove"),this.isTapTimer=setTimeout((function(){t.isTap=!1,t.sendAnalyticsEvent("pause_long_tap")}),200))},onTouchMove:function(e){var t=0,n=0;"touchmove"===e.type&&(t=this.tapStartX-e.changedTouches[0].clientX,n=this.tapStartY-e.changedTouches[0].clientY),null===this.isYmove&&(this.isYmove=Math.abs(t)<Math.abs(n),this.isYmove&&Object(o.a)(this.layer,"Stories_touchMove")),this.isYmove?this.onVerticalSwipe(-n/1.5):this.onVerticalSwipe(0)},onTouchEnd:function(e,t){clearTimeout(this.isTapTimer);var n=this.getCurrentAuthor();if(n){var i=n.story;this.isTap||this.sendAnalyticsEvent("resume_release");var a,r;"touchend"===e.type?(a=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY):(a=e.clientX,r=e.clientY),(Math.abs(this.tapStartX-a)>20||Math.abs(this.tapStartY-r)>20)&&(this.isTap=!1),Object(o.Yb)(this.layer,"Stories_touchMove"),Object(o.jc)(this.sliderEl,"opacity",1),o.jc.transform(this.sliderEl,1,[0,0]),o.jc.transform(Object(o.O)("Story__moreLink"),1,[0,0]);var s=e.target&&e.target.classList.contains("Story__sticker"),c=Object(o.v)(e.target,"id"),l=Number(Object(o.v)(e.target,"type"));if(s&&this.sendAnalyticsEvent("click_on_clickable_sticker",{clickable_sticker:{id:c,type:oc[l]}}),this.needGoToLink){var u=this.getCurrentAuthor().story;if(this.needGoToLink=!1,u&&u.hasLink())return void this.openCustomButton(e)}if(this.needClose)return this.sendAnalyticsEvent("close_swipe_down"),void this.close();if(this.tooltip)this._hideTooltips();else{if(this.isTap){var d=this.getCurrentAuthor();if(!d)return;var _=d.getCurrentStory();if(s){var p=Object(o.v)(e.target,"app-id"),h=Object(o.v)(e.target,"pollId"),f=Object(o.v)(e.target,"pollOwnerId"),m=Object(o.v)(e.target,"situational-app-id"),v=Object(o.v)(e.target,"situational-theme-id");if(Object(o.Yb)(this.layer,"Stories_paused"),Object(o.v)(e.target,"question"))this.askQuestionBox(e);else if(p)Nc.clickToApp();else if(h&&f)Nc.openPoll(f,h,i.raw_id);else if(m&&v)Nc.openSituationalApp(m,v);else{var g=i._createStickerLink(e.target,{id:c,type:l});this.tooltip?this._hideTooltips():this._showTooltip(e,g)}return}if(t){if(_.isOneTime)return;this.sendAnalyticsEvent("go_to_previous_story"),this.prevStory()}else{if(this.sendAnalyticsEvent("go_to_next_story_tap"),_.isOneTime)return this.close(),void Object(o.j)(e);this.nextStory()}}this._hideTooltips(!0),this.hideMenu()}}},openCustomButton:function(e){e.preventDefault(),e.stopPropagation();var t=this.getCurrentAuthor().story,n=t.getLinkUrl(),i=n.match(/\/narrative(-?\d+)_(\d+)/);if(i){var a={ownerId:i[1],narrativeId:i[2]},o=a.ownerId,r=a.narrativeId;if(!o||!r)return!1;this.openNarrative(o+"/narrative"+o+"_"+r,{source:"narrative_story"})}else if(this.stopStory(),this.showLoading(),this.sendAnalyticsEvent("link_click"),t.stats&&t.stats.url_view){var s=t.stats.url_view,c=s.event_type,l=s.rhash;this._requestClickStat(t.raw_id,c,l,t.track_code,(function(){nav.go(n)}))}else nav.go(n);return!1},onVerticalSwipe:function(e){if(this.needClose=!1,this.needGoToLink=!1,e){var t=e>0,n=this.sliderEl.offsetHeight,i=n/3.5,a=Math.abs(e)>i;if(t){var r=a?window.lang.mobile_zphoto_release_to_close:window.lang.mobile_zphoto_move_to_close,s=a?"":t?"zpv_close_move_down":"zpv_close_move_up",c=Math.max(1-.75*e/n,.6);Object(o.zc)(this.swipeTextTop,'<div class="zpv_close_msg '+s+'">'+r+"</div>"),Object(o.jc)(this.sliderEl,"opacity",c),o.jc.transform(this.sliderEl,1,[0,e/1.5]),Object(o.jc)(this.swipeTextTop,"opacity",Math.abs(c-1-.6)),o.jc.transform(this.swipeTextTop,1,[0,e/1.5*.85]),this.needClose=a}else{var l=Math.min(1-.5*e/n,1.1);Object(o.jc)(this.sliderEl,"opacity",1),o.jc.transform(this.sliderEl,1,[0,0]),o.jc.transform(Object(o.O)("Story__moreLink"),l,[0,Math.max(e/(1.5*1.6),-90)]),this.needGoToLink=a}}else Object(o.jc)(this.sliderEl,"opacity",1),o.jc.transform(this.sliderEl,1,[0,0]),o.jc.transform(Object(o.O)("Story__moreLink"),1,[0,0]),this.needClose=!1,this.needGoToLink=!1},preventScroll:function(){return this.popoutOpen},_requestRemoveStory:function(e,t){return new Promise((function(n,i){window.ajax.post("stories.php",{_ajax:1,act:"remove_story",hash:t,story_raw:e},{onDone:function(){n()},onFail:function(){i()}})}))},_requestRemoveNarrative:function(e,t){return new Promise((function(n,i){window.ajax.post("stories.php",{_ajax:1,act:"remove_narrative",hash:t,narrative_raw:e},{onDone:function(){n()},onFail:function(){i()}})}))},_requestList:function(){var e=this;return new Promise((function(t,n){var i={storyOwner:e.storyOwner,list:e.storyList,storyRaw:e.storyRaw,extra:e.storyExtra};if(!e.storyRaw)return n();var a=window.ajax.post("stories.php",{_ajax:1,act:"get_list",list:i.list,story_raw:i.storyRaw,extra:i.extra},{onDone:function(e){i.items=e,t(i)},onFail:function(){n()}});e._saveRequest(a)}))},_removeList:function(){window.store&&window.store.storiesLists&&window.store.storiesLists[this.storyList]&&delete window.store.storiesLists[this.storyList],window.store&&window.store.stories[this.storyList]&&delete window.store.stories[this.storyList]},_forceSetStore:function(e,t,n){return{authors:n,listLoaded:!0,list:t,readedStories:{},_requests:[],questions:{},viewers:{},viewersState:{},extendedStats:{},replies:{},polls:{},showMenu:!1,storyList:t,initRaw:e,storyIndex:0,authorIndex:0,isReply:!1,replyTo:!1,inited:!0}},_requestFeedback:function(e,t){var n=this;void 0===t&&(t=0);var i=this.store;return new Promise((function(a,r){var s=window.ajax.post("stories.php",{_ajax:1,act:"feedback",offset:t,story_raw:e},{onDone:function(t,n,r,s,c,l,u,d,_,p,h){s&&s.length&&(i.replies[e]=s),i.viewers[e]=xc(xc([],i.viewers[e]||[]),t).filter((function(e,t,n){return t===n.findIndex((function(t){return t.viewerId===e.viewerId}))})),i.viewersState[e]?Object(o.K)(i.viewersState[e],{count:n,nextFrom:r}):i.viewersState[e]={count:n,nextFrom:r,repliesCountText:c,authorCountText:l,repliesScrollLeft:0,hiddenReason:d},u.length&&(i.questions[e]=u),c&&(i.viewersState[e].repliesCountText=c),l&&(i.viewersState[e].authorCountText=l),_&&(i.polls[e]=_),p&&(i.extendedStats[e]=p),i.viewersState[e].privacyHint=h,a({viewers:t,count:n,nextFrom:r,repliesCountText:c,authorCountText:l,questions:u})},onFail:function(){r()}});n._saveRequest(s)}))},markSeenStoryIfNeeded:function(e){var t=this.getCurrentAuthor();t&&(t.getCurrentStory().isOneTime&&this.markSeenStory(e))},markSeenStory:function(e){var t,n,i=this.getCurrentAuthor(),a=this._getSource(),r=i.getCountDown(),s=i.getCurrentStory(),c=0;!r||this.store.readedStories[s.raw_id]&&!e||(s.isOneTime&&(c=s.progress?s.progress:Math.max(Math.round(s.getProgressPercentByLeftTime(r.left)),1)),window.ajax.post("stories.php",{_ajax:1,act:"read_stories",hash:this.store.authors[0].read_hash,story_id:s.raw_id,track_code:s.track_code?s.track_code:"",all:Object(o.mb)(e),source:a,progress:c,navigation_stats:(n=vc.map((function(e){return[e.ownerId,e.storyId,e.source,e.action].join(",")})).join(";"),vc=[],n),loading_stats:(t=gc.map((function(e){return[e.ownerId,e.storyId,e.source,e.time].join(",")})).join(";"),gc=[],t),connection_type:mc()}),this.store.readedStories[s.raw_id]=!0,e?this.setAllAuthorStoriesReaded(this.getCurrentAuthorIndex()):this.store.authors[this.getCurrentAuthorIndex()].items[this.getCurrentStoryIndex()].unread=!1)},_requestUpdateFeedBlock:function(){var e=this.store,t=Object.keys(e.readedStories),n=this._getSource();(t.length||this._needFeedUpdate)&&"feed"===n&&(this._needFeedUpdate=!1,setTimeout((function(){Nc._requestFeedBlock()})))},_getSource:function(){if(this.params&&this.params.source)return this.params.source;var e=this.store&&this.store.list||"",t="";return e.includes("feed")?t="feed":e.includes("replies")&&(t="reply"),t},_sendNavigationStatEvents:function(e){var t=this.getCurrentStory(),n=t&&t.raw_id;n&&function(e){var t=e.storyRawId,n=e.source,i=e.action,a=t.split("_");"reply"===n&&(n="replies_list");var o={ownerId:a[0],storyId:a[1],source:n,action:i};vc.push(o)}({storyRawId:n,source:this._getSource(),action:e})},_sendViewerStartTime:function(e,t){!function(e){var t=e.storyRawId,n=e.source,i=e.time,a=t.split("_"),o={ownerId:a[0],storyId:a[1],source:n,time:i};gc.push(o)}({storyRawId:e,source:this.viewerSource,time:t})},_requestFeedBlock:function(){var e=nav.getQuery();window.store.storiesLayers.length||window.ajax.post("stories.php",{_ajax:1,act:"feed_block",q:e.q},{onDone:function(e,t){var n=Object(o.M)("StoriesFeedBlock");n&&Object(o.ac)(Object(o.l)(e),n),Nc.pushPreloadedList(t)}})},_requestClickStat:function(e,t,n,i,a){window.ajax.post("stories.php",{_ajax:1,act:"stat",source_story:e,event_type:t,rhash:n,track_code:i},{onDone:function(){a&&a()}})},_requestStickerStat:function(e,t){var n=this.getCurrentStory(),i=n.raw_id,a=n.clickable_stickers;i&&a&&window.ajax.post("stories.php",Object(o.K)({act:"stickers_stat",story_raw_id:i,action:e,hash:a.hash},t))},_sendMessage:function(e,t,n,i){var a=window.ajax.post("mail.php",{_ajax:1,act:"send",entrypoint:"stories_comment",hash:e,media:t,message:n,to:i},{onDone:function(){Nc.showFlashPopup(window.lang.mobile_stories_comment_success),Nc.sendAnalyticsEvent("comment_send")}});this._saveRequest(a)},_requestFave:function(e,t,n,i){window.ajax.post("bookmarks.php",{_ajax:1,act:e,item_type:31,item_oid:t,item_id:n,hash:i,ref:window.cur.module},{onDone:function(){"bookmark_add"===e&&Object(Be.c)(Be.a.addToBookmarks,t,n,Be.b.storyViewer)}})},_parseList:function(e){var t=(e=decodeURIComponent(e)).match(/^story(-?\d+)_(\d+)(\/([a-z0-9\_\-]+))?(\/([a-z0-9\_\:\;\-]+))?$/i);if(t){var n=t[1],i=t[2],a=t[4],o=t[6],r=n+"_"+i;return e.match(/from_feed\=1/)?a="feed":e.match(/profile\=1/)?a="profile":a||(a=r),r+"/"+a+"/"+o}return e},setHistory:function(e,t){void 0===t&&(t={nav_init:!1,replace:!0});var n=window.nav,i=this.getHistoryURL(e),a=n.getQuery(),r=i.match(/narrative(s)?(-?\d+)(?:_(\d+))?(?:_(\d+))?/);if(r){var s=Boolean(r[1]),c=this.getCurrentStory().raw_id,l=this.getCurrentNarrative(),u=c.split("_")[1];i="narrative"+(s?"s":"")+(null==l?void 0:l.rawId)+"_"+u}a.z=i;var d=n.path+Object(o.Ib)(a)+n.hash,_={push_only:!0,replace:t.replace,nav_init:!t.no_open,nav_incr:!0};n.go(d,null,_)},getFrom:function(e){void 0===e&&(e=!0);var t=window.nav,n=this.store.list,i=t.getQuery(),a="z="+i.z,o="";return"/write"===t.path.substr(0,6)?o="write"+t.path.substr(0,6)+"?"+a:"/mail"===t.path?o="write"+i.peer+"?"+a:"/feed"===t.path?o=i.section&&"notifications"===i.section?"feed?section=notifications&"+a:"feed?"+a:n.startsWith("archive")?o=t.path+"?act=stories":i.from&&(o=i.from),e?encodeURIComponent(o):o},getHistoryURL:function(e){var t=this.store.list;return"story"+e+(t?"/"+t:"")},getParams:function(){return this.params||{}},toggleBookmark:function(e,t){void 0===t&&(t=!1);var n=this.getCurrentAuthor(),i=this.getCurrentNarrative();if(i){var a=n.getCurrentStory(),r=Boolean(null==i?void 0:i.isBookmarked),s=null==i?void 0:i.bookmarkHash;Object.keys(window.store.stories).forEach((function(e){var t=window.store.stories[e];if(t.authors){var n=!1;t.authors.forEach((function(e){n||(n=e.items.find((function(e){return i.bookmarkHash===s&&e.raw_id===a.raw_id})))})),i.isBookmarked=!r}})),Object(o.zc)(e,r?window.lang.mobile_stories_menu_bookmark_title:window.lang.mobile_stories_menu_bookmarked_title);var c=r?"bookmark_remove":"bookmark_add",l=i.ownerId,u=i.rawId,d=i.id;t||this._requestFave(c,l,d,s),window.Share.setBookmarkState(u,!r)}},share:function(e,t){var n=this,i=this.getCurrentAuthor(),a=this.getCurrentNarrative();if(i){var o=null==a?void 0:a.isOwnerClosedGroup,r=null==a?void 0:a.isGroupEditor;this.stopStory(),this.getFrom();var s=t?"narrative":"story";this.stopStory(),window.Share(e,{mail_hash:this.getCurrentStory().share_hash,object:s+e,is_bookmarked:null==a?void 0:a.isBookmarked,bookmark_hash:null==a?void 0:a.bookmarkHash,bookmark_type:31,can_bookmark:t,can_to_own:t&&!o,can_to_club:t&&(!o||r)}),window.cur.share.onClose((function(){n.playStory()}))}},_requestMarkNotInterested:function(e,t){var n=this;window.ajax.post("stories.php",{act:"mark_not_interested",story_raw_id:e.raw_id,track_code:e.track_code,hash:e.canMarkNotInterestedHash},{onDone:function(){n.sendAnalyticsEvent("mark_not_interested"),"function"==typeof t&&t()}})},markCurrentStoryNotInterested:function(e){var t=this.getCurrentStory();t?e&&Object(C.b)("ads_new_reports_mvk_histories")?this._requestMarkNotInterested(t,(function(){return nav.go(e)})):(q.g({text:Object(ae.t)("mobile_stories_thanks_feedback"),type:q.e}),this.hideMenu(),this._requestMarkNotInterested(t)):Object(A.b)(new Error("Fail: markNotInterested"),{environment:"mobile_stories"})},openReplies:function(e,t){void 0===t&&(t=!1),this.playStory(),t||this.sendAnalyticsEvent("open_parent_story"),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,{reply:!0,replyTo:t});else this.close()},hidePrivacyHint:function(e){var t=this.store.viewersState[e];if(t&&t.privacyHint){var n=t.privacyHint.privacyHintHash;t.privacyHint=null,n&&window.ajax.post("stories.php",{act:"hide_privacy_hint",privacy_hint_hash:n})}var i=Object(z.a)(".ViewsPrivacyHint");i&&i.remove(),this.sendAnalyticsEvent("hide_privacy_block")},openNarrative:function(e,t){this.playStory(),this.destroy();var n=e.split("/")[1];if(n)if(~window.store.storiesLayers.indexOf(n)){var i=this.store.list,a=n;this.restore(i,a)}else this.init(e,t);else this.close()},clickClose:function(){var e=this;requestAnimationFrame((function(){e.sendAnalyticsEvent("close_tap"),e.close()}))},close:function(e){var t;if(void 0===e&&(e={}),Object(o.K)({isPopState:!1,storyRaw:!1,closeAll:!1},e),this.store&&this.store.list&&this._getSource().indexOf("narrative")>-1&&this._sendNavigationStatEvents("narrative_close"),!e.isPopState){var n=window.nav,i=n.getQuery();if(window.store.storiesLayers[window.store.storiesLayers.length-1-1]){var a=window.store.storiesLayers[window.store.storiesLayers.length-1-1],r=window.store.stories[a],s=r.authorIndex,c=r.authors[s].index,l=r.authors[s].items[c];i.z=this.getHistoryURL(l.raw_id)}else delete i.z;var u=n.path+Object(o.Ib)(i)+(n.hash||"");n.go(u,null,{push_only:!0,replace:null===(t=this.params)||void 0===t?void 0:t.isReplaceNavAfterClose})}if(this.destroy(),e.isPopState&&e.storyRaw){var d=this._parseList(e.storyRaw).split("/")[1];this.store?this.restore(this.store.storyList,d,e.storyRaw,e):this.init(e.storyRaw,{replace:!0})}else this.store&&this.store.storyList&&this.restore(this.store.storyList,!1,!1,e)},hideAllViews:function(){window.store&&(window.store.storiesLayers=[],window.store.stories&&Object.keys(window.store.stories).forEach((function(e){window.store.stories[e].showViews=!1,window.store.stories[e].isStopped=!1})))},restore:function(e,t,n,i){if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===i&&(i={}),window.store.storiesLayers){var a=window.store.storiesLayers.indexOf(e);window.store.storiesLayers.splice(a,1)}if(window.store.storiesLayers.length||t||n){t=t||window.store.storiesLayers[window.store.storiesLayers.length-1];var r=window.store.stories[e],s=window.store.stories[t];if(r&&s){var c=Object.keys(r.readedStories);Object(o.D)(c,(function(e,t){var n=t.split("_")[0],i=s.replies[r.replyTo];if(i){var a=i.filter((function(e){return e.owner_id==n}))[0];a&&(a.has_new=!1)}})),this.init(s.initRaw,{restore:!0,forceAuthorIndex:!1,reply:!0})}else n&&this.init(n,{restore:!0,forceAuthorIndex:!1,reply:!0})}else this.hideAllViews();i.closeAll&&window.store.storiesLayers.length&&this.close(i)},clearStore:function(){this.store=this._initStore()},destroy:function(){var e=this;if(this.restoreAudio(),this.store){this.slider=null,this.hideMenu(!1),this.markSeenStoryIfNeeded(),this._abortRequests(),Object(o.Yb)(this.layer,"Stories_inited");var t=this.getCurrentAuthorIndex(),n=this.getCurrentAuthor(),i=n&&n.getCurrentStory();if(i&&i.isOneTime&&this._removeList(),void 0!==t&&this.Authors)this.Authors[t].destroy();this.onRender.off(),Object(o.Xb)(this.layer),this._requestUpdateFeedBlock(),Object.keys(this).forEach((function(t){"store"!==t&&"supportAutoplay"!==t&&"function"!=typeof e[t]&&(e[t]=null,delete e[t])})),window.zlayer.close(),Object(o.a)(Object(o.M)("StoriesFeedBlock"),"StoriesFeedBlock_been-open"),Object(o.Yb)(document.body,"vk__story_open"),Nc.opened=!1;var a=Object(o.O)("Question__popup"),r=Object(o.O)("Popup__overlay",a);r&&ie.g.close(r)}},isAutoplaySupport:function(){return this.supportAutoplay},isGoodBrowser:function(){return U.a.ios&&U.a.safari_mobile&&parseInt(U.a.version,10)>=10},detectAutoplay:function(){var e=this;return new Promise((function(t){if(e.supportAutoplay)t();else{if(e.isGoodBrowser())return e.supportAutoplay=!0,void t();e.supportAutoplay=!1;var n=Object(o.k)("video"),i=Object(o.k)("source");i.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==";var a=Object(o.k)("source");a.src="data:video/webm;base64,GkXfo49CgoR3ZWJtQoeBAUKFgQEYU4BnAQAAAAAAF60RTZt0vE27jFOrhBVJqWZTrIIQA027jFOrhBZUrmtTrIIQbE27jFOrhBFNm3RTrIIXmU27jFOrhBxTu2tTrIIWs+xPvwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFUmpZuQq17GDD0JATYCjbGliZWJtbCB2MC43LjcgKyBsaWJtYXRyb3NrYSB2MC44LjFXQY9BVlNNYXRyb3NrYUZpbGVEiYRFnEAARGGIBc2Lz1QNtgBzpJCy3XZ0KNuKNZS4+fDpFxzUFlSua9iu1teBAXPFhL4G+bmDgQG5gQGIgQFVqoEAnIEAbeeBASMxT4Q/gAAAVe6BAIaFVl9WUDiqgQEj44OEE95DVSK1nIN1bmTgkbCBULqBPJqBAFSwgVBUuoE87EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB9DtnVB4eeBAKC4obaBAAAAkAMAnQEqUAA8AABHCIWFiIWEiAICAAamYnoOC6cfJa8f5Zvda4D+/7YOf//nNefQYACgnKGWgQFNANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQKbANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQPoANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQU1ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQaDANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQfQANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQkdANEBAAEQEBRgAGFgv9AAIiGAAPuC/rOgnKGWgQprANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQu4ANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ0FANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgQ5TANEBAAEQEAAYABhYL/QACIhgAPuC/rKgnKGWgQ+gANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRDtANEBAAEQEAAYABhYL/QACIhgAPuC/rOgnKGWgRI7ANEBAAEQEAAYABhYL/QACIhgAPuC/rIcU7trQOC7jLOBALeH94EB8YIUzLuNs4IBTbeH94EB8YIUzLuNs4ICm7eH94EB8YIUzLuNs4ID6LeH94EB8YIUzLuNs4IFNbeH94EB8YIUzLuNs4IGg7eH94EB8YIUzLuNs4IH0LeH94EB8YIUzLuNs4IJHbeH94EB8YIUzLuNs4IKa7eH94EB8YIUzLuNs4ILuLeH94EB8YIUzLuNs4INBbeH94EB8YIUzLuNs4IOU7eH94EB8YIUzLuNs4IPoLeH94EB8YIUzLuNs4IQ7beH94EB8YIUzLuNs4ISO7eH94EB8YIUzBFNm3SPTbuMU6uEH0O2dVOsghTM",Object(o.f)(a,n),Object(o.f)(i,n),n.style.position="fixed",n.style.left="5000px",Object(o.g)(n,"id","base64testvideo"),Object(o.g)(n,"playsinline","playsinline"),Object(o.g)(n,"webkit-playsinline","webkit-playsinline"),Object(o.g)(n,"muted","muted"),n.muted=!0,Object(o.g)(n,"autoplay","autoplay"),Object(o.g)(n,"loop","loop"),Object(o.f)(n,document.body);var r=Object(o.M)("base64testvideo");if(U.a.android&&U.a.chrome)return e.supportAutoplay=!0,Object(o.Xb)(n),t(),void clearTimeout(e.autoDetectTimeout);if(U.a.mobile&&U.a.ios&&U.a.ios<10)return e.supportAutoplay=!1,Object(o.Xb)(n),t(),void clearTimeout(e.autoDetectTimeout);if(!U.a.safari_mobile||U.a.safari_mobile&&parseInt(U.a.version,10)>=10){var s=n.play();void 0!==s&&s.then((function(){e.supportAutoplay=!0,Object(o.Xb)(n),t(),clearTimeout(e.autoDetectTimeout)})).catch(console.error)}r.onplay=function(){e.supportAutoplay=!0,Object(o.Xb)(n),t(),clearTimeout(e.autoDetectTimeout)},e.autoDetectTimeout=setTimeout((function(){r.paused||(e.supportAutoplay=!0),Object(o.Xb)(n),t()}),250)}}))},narrativeReply:function(){this.setCurrentStory(0),this.renderStory(),this._sendNavigationStatEvents("narrative_replay")},narrativeGoToStories:function(){this.nextStory(),this._sendNavigationStatEvents("narrative_go_to_stories")},_showTooltip:function(e,t){if(this.hideMenu(!1),this.hideFlashPopup(!1),e&&t)if(this.tooltip)this._hideTooltips();else{var n=this.getCurrentAuthorEl();this.tooltip=Object(o.k)("div",{className:"StoriesTooltip"},{top:0,left:0}),this.tooltipArrow=Object(o.k)("span",{className:"StoriesTooltip__arrow"}),this.tooltip.appendChild(t),this.tooltip.appendChild(this.tooltipArrow),n.appendChild(this.tooltip);var i=0,a=0;"touchend"===e.type?(i=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY):(i=e.clientX,a=e.clientY);var r=n.getBoundingClientRect(),s=r.top,c=r.left,l=r.width,u=Object(o.Y)(this.tooltip),d=u[0],_=a-(s+u[1]+10),p=i-(c+d/2);Object(o.jc)(this.tooltip,{top:Math.max(_,2),left:Math.min(Math.max(p,2),l-d-2)}),Object(o.jc)(this.tooltipArrow,{left:Math.max(Math.min(i-c-Math.min(Math.max(p,0),l-d),d-15),15)}),this.pauseStory()}else this.playStory()},_hideTooltips:function(e){this.tooltip&&(e||this.playStory(),Object(o.Xb)(this.tooltip),delete this.tooltip)},_hasContext:function(e){return!(!this.extra||!this.extra.context||this.extra.context!==e)},sendAnalyticsEvent:function(e,t){void 0===t&&(t={});var n=Nc.getCurrentStory(),i=Nc.getCurrentNarrative(),a=Nc.getCurrentAuthor(),r=Nc.getCurrentStoryIndex(),s=Nc._getSource();if(n){var c=n.is_groups_meta_story,l=n.raw_id.split("_"),u=l[0],d=l[1],_=0;c&&(u=0,d=0),"groups"===this.storyList&&(_=1);var p={event_type:e,story_owner_id:u,story_id:d,time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),view_entry_point:s,nav_screen:window.cur.module,story_type:c?"group_feed":"",is_grouped:_,track_code:n.track_code,narrative_id:"view_story"===e&&i?i.id:void 0};if(a){var h=a.data,f=a.getCountDown();f&&h&&Object(o.K)(p,{stories_author_before:r,stories_author_after:h.items.length-r,view_event_timeline_position:f.initialTime-f.left})}Object.assign(p,t),Object(C.b)("web_stats_transport_story_view")?Object(Ws.g)(p):Object(o.oc)("story_product_analytics",p)}},clickAuthor:function(){this.sendAnalyticsEvent("go_to_author")},askQuestionBox:function(e){Object(o.j)(e);var t=this.getCurrentStory().can_ask;if(this.hideFlashPopup(!1),this._hideTooltips(),!t)return Nc.showFlashPopup(window.lang.mobile_stories_ask_question_forbidden),!1;this.stopStory(),Object(o.a)(this.layer,"Stories_questionOpened");var n=this.authors[this.store.authorIndex],i=Object(o.O)("Story__questionTextarea",n);requestAnimationFrame((function(){i&&i.focus()}))},changeAskAnonymous:function(e){e.preventDefault();var t=document.querySelector(".Story__questionSelect");if(t){var n=+Object(o.v)(t,"selected"),i=this.getCurrentStory();if(i){var a=[Object(ie.b)({inner:window.lang.mobile_stories_ask_question_author_only,onclick:["Stories.changeQuestionMode","this",Rc],class:n===Rc?"selected":""}),Object(ie.b)({inner:window.lang.mobile_stories_ask_question_public,onclick:["Stories.changeQuestionMode","this",Lc],class:n===Lc?"selected":""})];i.can_ask_anonymous&&a.splice(1,0,Object(ie.b)({inner:window.lang.mobile_stories_ask_question_anonymous,onclick:["Stories.changeQuestionMode","this",Bc],class:n===Bc?"selected":""}));var r=Object(ie.g)({class:"Story__questionSelectModal",close:!0,closeText:window.lang.mobile_stories_ask_question_cancel,items:a});Un.a.open(_.a.elem(r),!0)}}},changeQuestionMode:function(e,t){var n=document.querySelector(".Story__questionSelect");switch(t){case Lc:Object(o.zc)(n,window.lang.mobile_stories_ask_question_public),Object(o.v)(n,"selected",Lc);break;case Rc:Object(o.zc)(n,window.lang.mobile_stories_ask_question_author_only),Object(o.v)(n,"selected",Rc);break;case Bc:Object(o.zc)(n,window.lang.mobile_stories_ask_question_anonymous),Object(o.v)(n,"selected",Bc)}ie.g.close(e)},hideAskQuestion:function(e){void 0===e&&(e=!0),Nc.store.showMenu=!1,Object(o.Yb)(Nc.layer,"Stories_questionOpened"),e&&Nc.playStory()},onInputQuestion:function(e){Object(z.a)(".Story__questionSend").disabled=!Object(o.wc)(Object(o.zc)(e))},sendQuestion:function(){var e=Nc.getCurrentAuthorEl();if(e){var t=Object(o.O)("Story__questionTextarea",e),n=Object(o.O)("Story__questionSend",e),i=Nc.getCurrentStory(),a=i.raw_id,r=i.askQuestionHash,s=a.split("_"),c=s[0],l=s[1],u=Object(o.wc)(Object(o.zc)(t)),d=document.querySelector(".Story__questionSelect"),_=+Object(o.v)(d,"selected"),p=!1,h=!1;_===Lc?p=!0:_===Bc&&(h=!0),Object(o.zc)(t,""),n.disabled=!0;var f=window.ajax.post("stories.php",{_ajax:1,act:"ask_question",story_owner_id:c,story_id:l,question_text:u,is_anonymous:+h,with_mention:+p,hash:r},{onDone:function(e){if(!e)return Nc.showFlashPopup(window.lang.mobile_stories_question_error),!1;var t=Nc.getCurrentAuthor().data.author;switch(Nc.showFlashPopup(window.lang.mobile_stories_question_sent.replace("{name}",t.first_name_ins)),_){case Lc:Nc.sendAnalyticsEvent("question_reply_publish");break;case Rc:Nc.sendAnalyticsEvent("question_reply");break;case Bc:Nc.sendAnalyticsEvent("question_reply_anonymous")}}});Nc._saveRequest(f),Nc.hideAskQuestion()}},getQuestionById:function(e){var t=this.getCurrentStory();return this.store.questions[t.raw_id].find((function(t){return t.id===e}))},openQuestionActions:function(e){var t=this.getQuestionById(e);if(t){var n=t.canAnswer,i=t.isOwnerBlocked,a=t.canBlocked,o=[Object(ie.b)({inner:window.lang.mobile_stories_question_delete,onclick:["Stories.removeQuestion","this",t.id]})];a&&(o.push(Object(ie.b)({inner:i?window.lang.mobile_stories_question_unban:window.lang.mobile_stories_question_ban,onclick:["Stories.banQuestion","this",t.id]})),o.push(Object(ie.b)({inner:window.lang.mobile_stories_question_report,onclick:["Stories.reportQuestion","this",t.id]}))),n&&o.unshift(Object(ie.b)({inner:window.lang.mobile_stories_question_reply,onclick:["Stories.replyQuestionBox","this",t.id]}));var r=Object(ie.g)({class:"Question__popup",items:o});Un.a.open(_.a.elem(r),!0)}},removeQuestion:function(e,t){var n=this,i=this.getQuestionById(t),a=i.storyOwnerId,r=i.storyId,s=i.id,c=i.removeHash;window.ajax.post("stories.php",{_ajax:1,act:"remove_question",story_owner_id:a,story_id:r,question_id:s,remove_hash:c},{onDone:function(i){var c=a+"_"+r;if(ie.g.close(e),!i)return requestAnimationFrame((function(){return n.showFlashPopup(window.lang.mobile_stories_question_error)})),!1;Object(z.b)('.Question[data-id="'+t+'"]').forEach((function(e){return Object(o.Vb)(e)})),n.store.questions[c]=n.store.questions[c].filter((function(e){return e.id!==t})),Object(z.b)(".Question").length<1&&Object(o.Vb)(Object(o.O)("Views__questions")),Nc.sendAnalyticsEvent("question_delete",{questionId:s})}})},replyQuestionBox:function(e,t){var n=this.getCurrentStory(),i=this.getQuestionById(t),a=i.author,o=i.text,r=window.lang.mobile_stories_question_reply_title.replace("{name}",a.nameGen),s=_.a.elem({class:"QuestionReplyPopup",inner:[{class:"QuestionReplyPopup__inner",inner:[{class:"QuestionReplyPopup__header",inner:[{class:"QuestionReplyPopup__preview",style:"background-image: url("+n.small_preview+")"},{class:"QuestionReplyPopup__top",inner:[{class:"QuestionReplyPopup__title",inner:r},{class:"QuestionReplyPopup__question",inner:o}]}]},{class:"QuestionReplyPopup__content",inner:[{class:"QuestionReplyPopup__textarea",tag:"textarea",placeholder:window.lang.mobile_stories_comment_textarea,oninput:"Stories.onInputReplyQuestion(this);"}]},{class:"QuestionReplyPopup__footer",inner:[Object(Kt.a)({class:"QuestionReplyPopup__send",theme:"regular",inner:window.lang.mobile_stories_question_reply_to_message,on_click:["Stories.sendReplyQuestion",t],disabled:!0}),Object(Kt.a)({class:"QuestionReplyPopup__cancel",theme:"link",inner:window.lang.mobile_stories_comment_cancel,on_click:["Stories.hideReplyQuestion"]})]}]}]});this.popout.appendChild(s),ie.g.close(e)},hideReplyQuestion:function(){Object(o.Vb)(Object(o.O)("QuestionReplyPopup",Nc.popout))},onInputReplyQuestion:function(e){Object(z.a)(".QuestionReplyPopup__send").disabled=!Object(o.wc)(Object(o.zc)(e))},sendReplyQuestion:function(e){var t=Object(o.wc)(Object(o.zc)(Object(o.O)("QuestionReplyPopup__textarea"))),n=Nc.getQuestionById(e),i=n.id,a=n.ownerId,r=n.storyOwnerId,s=n.storyId,c=n.sendHash,l="story"+r+"_"+s,u=t+"\n\n🗣 "+n.text,d=window.ajax.post("mail.php",{_ajax:1,act:"send",hash:c,media:l,message:u,to:a},{onDone:function(e){var t=e&&e.error?e.message:window.lang.mobile_stories_comment_success;Nc.showFlashPopup(t,!1),Nc.sendAnalyticsEvent("question_send_message",{questionId:i})}});Nc._saveRequest(d),Nc.hideReplyQuestion()},showQuestions:function(e){var t=new _c(e).render();this.popout.appendChild(t),Nc.sendAnalyticsEvent("question_show_all")},hideQuestions:function(){Object(o.Vb)(Object(o.O)("Questions",this.popout))},banQuestion:function(e,t){var n=this.getQuestionById(t),i=n.storyOwnerId,a=n.storyId,o=n.banHash,r=n.isOwnerBlocked;window.ajax.post("stories.php",{_ajax:1,act:"ban_question",story_raw:i+"_"+a,question_id:t,ban_hash:o,is_blocked:+r},{onDone:function(i){if(!i)return ie.g.close(e),void Nc.showFlashPopup(window.lang.mobile_stories_question_error,!1);if(!r){var a="question_ban_author";n.isAnonymous&&(a="question_ban_anonymous_author"),Nc.sendAnalyticsEvent(a,{questionId:t})}ie.g.close(e),n.isOwnerBlocked=!r,Nc.showFlashPopup(r?window.lang.mobile_stories_question_author_unblocked:window.lang.mobile_stories_question_author_blocked,!1)}})},reportQuestion:function(e,t){var n=this.getQuestionById(t),i=this.getFrom();ie.g.close(e),window.nav.go(Object(Ys.b)({storyOwnerId:n.storyOwnerId,questionId:n.id,refrom:i}))},toggleQuestionTooltip:function(e,t){var n=this.getCurrentAuthor().getCurrentStory(),i=Object(z.a)(".QuestionSupport"),a=Object(z.a)(".Story__questionSelect"),r=+Object(o.v)(a,"selected");if(Object(o.j)(e),i){var s=n.firstName;n.authorId<0&&(s=window.lang.mobile_stories_ask_question_group_owner);var c="";switch(r){case Lc:c=window.lang.mobile_stories_ask_question_public_tooltip;break;case Rc:c=window.lang.mobile_stories_ask_question_author_only_tooltip;break;case Bc:c=window.lang.mobile_stories_ask_question_anonymous_tooltip}Object(z.a)(".QuestionSupport__tooltip").innerText=c.replace("{name}",s),t?Object(o.Yb)(i,"QuestionSupport--active"):Object(o.vc)(i,"QuestionSupport--active")}},openMusicStickerActions:function(e,t){var n=Object(o.M)("audio"+e),i=Object(o.gb)("ai_added",n),a=Object(ie.g)({close:!0,items:[Object(ie.b)({class:"ai_add",inner:i?window.lang.global_delete_audio:window.lang.global_add_to_audio,onclick:'Stories.addMusic(this, "'+e+'", '+i+");"}),Object(ie.b)({class:"ai_add",inner:window.lang.mobile_stories_music_next,onclick:"Stories.nextMusic(this, "+t+");"})]}),r=_.a.elem(a);r.setAttribute("id","ai_menu_"+e),Un.a.open(r,!0)},addMusic:function(e,t,n){window.audioplayer.add(t),ie.g.close(e),Nc._hideTooltips(!0),Nc.showFlashPopup(n?window.lang.mobile_stories_music_deleted:window.lang.mobile_stories_music_added)},nextMusic:function(e,t){var n=window.audio,i=window.audioplayer,a=si(t);if(n.getCurrentId()){var o=n.playlist().map((function(e){return e.id})).indexOf(n.getCurrentId())+1;n.addToPlaylist([a],o)}else i.playPause(!1,a.fullId,!0),n.pause();ie.g.close(e),Nc._hideTooltips()},toggleLikeForCurrentStory:function(e){var t=this,n=Nc.getCurrentStory(),i=Nc.getCurrentAuthor().story,a=n.raw_id,r=n.isLiked,s=n.likeHash,c={act:r?"delete_like":"like",hash:s,story_raw_id:a};i.isLiked=!r,n.isLiked=!r,e.innerHTML=r?_.a.html(Object(W.a)(Object(Js.a)())):_.a.html(Object(W.a)(Object($s.a)())),Object(o.vc)("Story__like--set",e,n.isLiked),window.ajax.post("stories.php",c,{onDone:function(a){a?(i.isLiked=r,n.isLiked=r,e.innerHTML=r?_.a.html(Object(W.a)(Object($s.a)())):_.a.html(Object(W.a)(Object(Js.a)())),Object(o.vc)("Story__like--set",e,n.isLiked)):t.sendAnalyticsEvent(r?"click_to_unlike":"click_to_like")}})},clickToApp:function(){var e=Nc.getCurrentStory(),t=e.raw_id,n=void 0===t?"":t,i=e.clickable_stickers,a=i&&i.stickers.find((function(e){return e.type===ac.app}));if(a&&a.appId){var o=n.split("_"),r=o[0],s=o[1];a.hasNewInteractions&&window.ajax.post("stories.php",{act:"mark_app_notifications_seen",owner_id:r,story_id:s,sticker_id:a.id,hash:a.hash},{onDone:function(){a.hasNewInteractions=!1;var e=document.querySelector(".Story__app");e&&e.classList.contains("has_new")&&e.classList.remove("has_new")}}),this.pauseStory(),this.showLoading(),nav.go("/app"+a.appId+"?ref="+a.appRef+"&hash="+a.appHash)}},openPoll:function(e,t,n){var i="/poll"+e+"_"+t+"?from=story"+n+"&story_raw="+n;nav.go(i),Nc.showLoading()},openSituationalApp:function(e,t){this.pauseStory(),Nc.showLoading();var n="/app"+e+"#"+t;window.location.href=n},onRender:Object(d.a)()};window.page&&window.page.onChange((function(){window.store.storiesLayers=[],window.store.stories={}})),window.Stories=Nc,window.showNarrative=function(e,t,n,i,a){void 0===n&&(n=0),void 0===i&&(i=""),void 0===a&&(a={});var o=""+e+(n=n?"_"+n:"")+"/"+(i=i||"narrative"+e+"_"+t);Object.assign(a,{narrativeId:t}),Nc.init(o,a)},function(e){e.IMAGE="image",e.VIDEO="video"}(Pc||(Pc={}));var Dc=function(e){var t="width: "+e.artboardWidth+"px; height: "+e.artboardHeight+"px",n=e.background_type===Pc.IMAGE?{class:"StoryPublisher__canvasLayer",width:"1080",height:"1920",style:t,tag:"canvas"}:{inner:[{src:e.src,tag:"source"}],class:"StoryPublisher__video",preload:"metadata",controls:!0,controlsList:"nodownload",onContextMenu:"cancelEvent(); return false;",tag:"video"},i=_.a.wrap(Object(ae.t)("mobile_apps_story_publisher_description").replace("{service_name}",e.miniAppName));return{inner:[{inner:[Object(Kt.a)({inner:[Object(xi.cb)()],theme:"header",class:"StoryPublisher__headerButton",onClick:"StoryPublisher.closePopup()",use_native_onclick:!0,is_icon:!0})],class:"StoryPublisher__header",tag:"div"},{inner:[_.a.wrap(Object(Ga.a)({mix:"al_loading StoryPublisher__spinner",type:"pageLoader",isFixed:!0})),{inner:[n],class:"StoryPublisher__canvas",style:t,tag:"div"},{inner:[i],class:"StoryPublisher__description",tag:"div"},Object(Kt.a)({inner:[_.a.wrap(Object(ae.t)("mobile_apps_story_publisher_publish_btn_text"))],onClick:"StoryPublisher.save(this)",use_native_onclick:!0})],class:"StoryPublisher__content",tag:"div"}],class:"Popup StoryPublisher",tag:"div"}};var Hc=n("PU8N"),Uc=n("bKAG");Object.assign(Dc,{init:function(e,t,n){var i=this;void 0===t&&(t=Hc.l),void 0===n&&(n=Hc.l),this.successHandler=this.successHandler.bind(this),this.errorHandler=this.errorHandler.bind(this),e.artboardHeight=e.artboardHeight||(window.innerHeight<357?window.innerHeight-100:357),e.artboardWidth=e.artboardWidth||e.artboardHeight/1.78,this.props=e,this.props.src=e.src||e.url||e.blob,this.onClickSave=t,this.cb=n,this.popup=Un.a.open(_.a.elem(Dc(this.props)),!0);var a=function(){return Ga.a.hide(document.querySelector(".StoryPublisher__spinner"))};switch(this.props.background_type){case Pc.IMAGE:Object(Hc.i)(this.props.src).then((function(e){a(),i.drawImage(e)})).catch((function(){return i.errorHandler(new Error("Can't upload image"))}));break;case Pc.VIDEO:this.validateVideo(this.props).then(a).catch(this.errorHandler)}return this},drawImage:function(e){if(this.canvas=document.querySelector(".StoryPublisher__canvasLayer"),!this.canvas)return this.errorHandler();var t=this.canvas.getContext("2d");if(!t)return this.errorHandler();var n,i,a=+(e.height/e.width).toFixed(2);if(a>1.77?(i=this.canvas.height,n=this.canvas.height/a):(n=this.canvas.width,i=this.canvas.width*a),t.save(),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.filter="blur(135px)",t.drawImage(e,0,0,this.canvas.width,this.canvas.height),t.restore(),"none"!==t.filter){var o=Object(Hc.a)(t);t.fillStyle="rgb("+o.r+", "+o.g+", "+o.b+")",t.fillRect(0,0,this.canvas.width,this.canvas.height)}t.drawImage(e,this.canvas.width/2-n/2,this.canvas.height/2-i/2,n,i)},closePopup:function(e){void 0===e&&(e=!0),e&&this.cb(),Un.a.close(this.popup),this.popup=null},successHandler:function(e){this.cb(!0,e),this.isLoading=!1,this.closePopup(!1)},errorHandler:function(e){void 0===e&&(e={}),this.props.closeAfterError&&this.closePopup(!1),this.cb(!1,{error:e}),this.isLoading=!1,Kt.a.setLoading(this.shareButton,!1),q.g({type:q.d,text:e.message||Object(ae.t)("mobile_apps_story_publisher_unexpected_error")})},save:function(e){var t=this;if(!this.isLoading){this.onClickSave(),Kt.a.setLoading(e,!0),this.shareButton=e,this.isLoading=!0;var n=this.props,i=n.background_type,a=n.miniAppId,o=n.entrypoint,r=n.storyUploadUrlHash,s=n.storySaveHash;Promise.all([this.getBlob(),Object(Uc.e)({mini_app_id:a,story_type:i===Pc.IMAGE?Uc.d.PHOTO:Uc.d.VIDEO,hash:r,entry_point:o,ref:window.cur.module})]).then((function(e){var n=e[0],i=e[1];return t.uploadStoryBlobToServer(n,i)})).then((function(e){var t=e.response;return Object(Uc.f)(t&&t.upload_result,s)})).then(this.successHandler).catch(this.errorHandler)}},uploadStoryBlobToServer:function(e,t){return new Promise((function(n,i){var a=Object(Hc.b)(e),r=9e5*Math.random(),s=new FormData,c=encodeURIComponent("story_"+r+"."+a);s.append("file0",e,c);var l=Object(o.yc)(t,s,{onComplete:function(){var e=Object(o.Pb)(l.response);e&&e.response&&e.response.upload_result||i(),n(e)},onError:i})}))},getBlob:function(){var e=this;return this.props.background_type===Pc.IMAGE?new Promise((function(t,n){try{e.canvas.toBlob(t,"image/jpeg")}catch(e){n()}})):Object(Hc.d)(this.props.src)},validateVideo:function(e){return new Promise((function(t,n){Object(Hc.f)(e.src).then((function(i){if(e.maxVideoDuration&&i>e.maxVideoDuration)return n(new Error("The duration of the video file must not exceed 15 seconds"));t(i)})).catch((function(){return n(new Error("Can't upload video"))}))}))}}),window.StoryPublisher=Dc;var Vc=function(){this.onNarrativeChangedFromStoryView=Object(d.a)(),this.onNarrativeRemovedFromStoryView=Object(d.a)()};window.Narratives=new Vc;var Fc={rollback:{onDone:function(e){var t=e.html,n=e.post;e.hash;cur.restored=0;var i=Object(o.M)(n+"__message-archived");if(t){var a=n+"__message-rollback",r=Object(o.k)("div",{className:["post_message_item",i.className].join(" "),innerHTML:t,id:a});Object(o.hb)(i),Object(o.M)(r)||Object(o.c)(r,i)}else{var s=Object(o.M)(n+"__message-rollback");Object(o.lc)(i),Object(o.Xb)(s)}}},set:{onStart:function(){var e=this.link;e.classList.contains("wia_item")&&Object(o.a)(e,"wia_item--loading")},onDone:function(e){var t=e.html,n=e.post,i=e.restored,a=e.rollback_hash,r=this.link;cur.restored||(cur.restored=0),i&&"profile"===cur.module&&cur.restored++,Object(o.Yb)(r,"wia_item--loading");var s=Object(o.M)(n),c=Object(o.M)(n+"_replies");if(t){if(cur.restored>3){var l=s.id+"?act=rollback_archive&hash="+a;t+=Wd.html({class:"service_msg_row",inner:{tag:"a",href:l,onclick:"return ajax.click(this, Archive.rollback)",inner:Object(ae.t)("mobile_archive_restore_bulk")}})}var u=s.id+"__message-archived",d=Object(o.k)("div",{className:["post_message_item",s.className].join(" "),innerHTML:t,id:u});Object(o.hb)(s),Object(o.hb)(c),Object(o.M)(u)||Object(o.c)(d,s)}else if(n){var _=Object(o.M)(n+"__message-archived"),p=Object(o.M)(n+"_replies");Object(o.lc)(n),Object(o.lc)(p),Object(o.Xb)(_)}}}};window.Archive=Fc;var Wc=function(e,t){Object(o.j)(e);var n=t.getAttribute("href"),i=Object(ae.t)("mobile_wall_prometheus_edit_warn");Object(Tc.a)(i,'Popup.close(this); nav.go("'+n+'");',"",{title:Object(ae.t)("mobile_prometheus_edit_warn_popup_title")})};window.PrometheusEditConfirm=Wc,window.CopyrightPopup={open:function(e,t,n,i){var a=Object(Rn.a)({class:"CopyrightPopup",header:{title:Object(ae.t)("mobile_wall_post_copyright_source")},content:{inner:[t,{class:"Popup__buttons",inner:[Object(Kt.a)({class:"Popup__button",inner:Object(ae.t)("mobile_wall_post_copyright_go"),theme:"regular",use_native_onclick:!0,on_click:"CopyrightPopup.go(this, '"+n+"', "+(i?1:0)+")"})]}]}});Rn.a.open(Wd.elem(a),!0)},go:function(e,t,n){var i;if(Rn.a.close(e),t.startsWith("/story"))window.Stories.init(t.substr(1),{source:"view_source"});else if(i=/^\/?narrative(-?\d+)_(\d+)(?:_(\d+))?(\/?([a-z0-9_-]+))?$/i.exec(t)){var a=i,o=a[0],r=a[1],s=a[2];window.showNarrative(o,r,s,{source:"view_source"})}else{if(/^@-?[\d\w._]+-[\d\w.-]+/.test(t.substr(1))&&(t+="?from="+nav.cur),!n)return nav.go(t,null);window.open(t,"post_copyright")}}};var qc=n("UvyM");function zc(){var e=window.lang,t=Object(z.a)(".pcont .service_msg_box");if(t){var n=Object(z.a)(".service_msg",t).innerHTML;Object(o.Xb)(t);var i=Object(Rn.a)({class:"CopyrightPopup",content:[{inner:_.a.wrap(n)},{class:"Popup__buttons",inner:[Object(qc.a)({class:"Popup__button",inner:e.mobile_zphoto_close,theme:"regular",on_click:"Popup.close(this)",use_native_onclick:!0})]}]});Rn.a.open(_.a.elem(i),!0)}}window.ZeroVKPopup={open:zc,init:function(){window.onDOMReady((function(){zc()}))}};n("B9v3");window.initSharePage=function(e,t){var n=Object(o.M)("SharePageInput__to"),i="";n&&(i=n.value);var a={};if("mail"===e&&""!==n.value&&(a=i.split(",").reduce((function(e,t){return e[t]=!0,e}),{})),"club"===e){var r=Object(z.a)(".SharePage .qsearch_wrap"),s=Object(z.a)(".hp_block",r);Object(o.lc)(r),Object(o.lc)(s)}var c=Object(z.a)(".SharePage .SharePanel.MessagePanel"),l=Object(z.a)(".SharePage .SharePanel.ActionsPanel");Object(o.K)(cur,{publishTo:e,refreshSelected:function(e,t,i){var a;void 0===i&&(i=!0),Object(o.vb)(e)||(cur.publishSelected=e),t=cur.publishTo,e=cur.publishSelected,"group"===t?a=Object(o.M)("club"+e):"mail"===t&&(a=Object(o.M)("peer"+e));var r=!!cur.selectedMap[e];a&&(a.classList.toggle("inline_item_selected",i?!r:r),cur.like_search.toggleAttach(e,!r),i&&(cur.selectedMap[e]=!r),n.value=Object.keys(cur.selectedMap).filter((function(e){return cur.selectedMap[e]})).join(","));var s=Object.keys(cur.selectedMap).length>0&&Object.keys(cur.selectedMap).some((function(e){return!!cur.selectedMap[e]}));return c.classList.toggle("SharePanel--active",s),l.classList.toggle("SharePanel--active",!s),!1},selectedMap:a,selectPeer:function(e,t){return cur.refreshSelected(t,"mail"),!1}}),Object.keys(a).forEach((function(t){cur.refreshSelected(t,e,!1)}))};var Yc=function(e,t,n,i,a,o,r,s){n?Object(Tc.a)(t,"ReportConfirm.submit('"+a+"', false, "+i+", '"+o+"', "+JSON.stringify(r)+")","",{title:e,id:"confirm-"+i}):Gc(a,!0,i,o,JSON.stringify(r),s)};function Gc(e,t,n,i,a,r){"string"==typeof a&&(a=JSON.parse(a));var s=Object(z.a)("#mcont");Object(o.jc)(s,{"pointer-events":"none"}),window.ajax.post(e,Object(F.a)({_ajax:1,reason:n,onDone:function(){Object(o.xb)()&&history.back()}},a)),"story"===a.type&&window.Stories.sendAnalyticsEvent("claim"),window.Snackbar.init({text:r||Object(ae.t)("mobile_msg_reported")}),Object(z.b)(".Confirm").forEach((function(e){return Rn.a.close(e)}))}Object(o.K)(Yc,{submit:Gc}),window.ReportConfirm=Yc;var Qc=n("5s+S");var Kc=function(e){var t="animation-duration: "+e.duration+"s;";return{inner:[{inner:[Object(xi.e)()],class:"CancelTimer__cross",tag:"div"},{inner:[{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"},{inner:[{class:"CancelTimer__line",style:t,tag:"span"}],class:"CancelTimer__hand",tag:"div"}],class:"CancelTimer__timer",tag:"div"}],class:"CancelTimer",tag:"div"}},Xc=n("JlTo");window.Replies={init:function(e,t){void 0===t&&(t=0);!function(e){e&&function(){var e=Object(o.O)("wall_replies"),t=Object(o.z)(e);if(!t||!Object(o.gb)("RepliesThreadNext",t))return;var n=Object(o.O)("RepliesThreadNext__link",t);Object(o.h)((function(){if(Object(o.B)(t)&&!Object(o.gb)("RepliesThreadNext_loading",t))return n}),window.RepliesNext,{no_cache:!0})}();(function(){var e=Object(o.M)("reply_field");if(!e||Object(o.gb)("RepliesField_static",e))return;var t=window.onBodyScroll,n=!1;t(Object(o.sc)((function(t){var i=t+Object(o.S)(),a=Object(o.U)(e),r=i<Object(o.db)(e)+a;r&&!n?(Object(o.jc)(e,{height:a}),Object(o.a)("RepliesField_fixed",e)):!r&&n&&(Object(o.Yb)("RepliesField_fixed",e),Object(o.jc)(e,{height:null})),n=r}),10)),Object(o.Lb)()})(),function(e){var t=Object(o.M)("replies_to_last"),n=Object(o.O)("RepliesWrap"),i=Object(o.O)("RepliesField_wrap");if(!t||!n)return;var a=Object(o.M)("reply_field"),r=Object(o.gb)("RepliesField_static",a),s=Object(o.db)(n),c=window.onBodyScroll,l=!1;Zc(),c(Object(o.sc)((function(e){var c=e+Object(o.S)(),u=a&&!r?Object(o.db)(a)-50:s+Object(o.U)(n)-Object(o.U)(i),d=s<e&&c<u;d!==l&&(Object(o.vc)("Replies_last_shown",t,d),t.setAttribute("tabindex",d?0:-1),l=d)}),10))}()}(e);var n=Object(o.M)("reply_field"),i=Object(o.M)("reply_field_text");window.mediaUpload&&n&&(window.mediaUpload.onStart(el),window.mediaUpload.onRemove((function(){el(),i.focus()})));if(Ot.a.checkStickers(),n){var a=window.cur;a.onStickersToggleCallbacks=a.onStickersToggleCallbacks||[],a.onStickersToggleCallbacks.push((function(e){if(Object(o.Lb)(),Jc(),e){var t=Object(o.R)("a","stickers_panel");t&&t.focus()}else i.focus()})),function(e){var t=Object(ae.y)("mention_items_"+e);t&&window.Mention.init({appendTo:Object(z.a)(".MentionContainer"),items:t})}(t),$c()}window.post.stickersInit()},replyTo:function(e,t,n,i,a){void 0===a&&(a="wall_reply");if(Object(o.n)(e))return!0;if(window.cur.replyTo!==n&&sl)return fl(),!0;n=n||0,Object(o.N)("ReplyItem_active").forEach((function(e){Object(o.Yb)("ReplyItem_active",e)}));var r,s=Object(o.M)("reply_field"),c=Object(o.M)("reply_field_text"),l=Object(o.gb)("RepliesField_static",s),u=!!window.post&&window.post.replyNamesRE(),d=Object(o.zc)(c),_="";if(n){if(r=Object(o.M)(a+t+"_"+n))if(l||Object(o.a)("ReplyItem_active",r),!Object(o.gb)("ReplyItem_deleted",r)&&i){var p=window.cur.replyNames[i]||{},h=p[0]||"";_=p[1]||"",d=d?u?d.replace(u,h):d:h,window.post&&window.post.onReplyClick(!0,h)}else d=u?d.replace(u,""):d}else d=u?d.replace(u,""):d;Object(o.zc)(c,Object(o.cc)(d));var f=Object(o.M)("reply_field_to"),m=Object(o.O)("RepliesField__infoName",f);Object(o.zc)(m,Object(o.ib)(_)),Object(o.vc)("RepliesField__infoItem_shown",f,n&&_),Object(o.vc)("RepliesField__infoItem_shown","reply_field_to_empty",n&&!_);var v=Object(o.M)("reply_field_info"),g=Object(o.M)("reply_field_from");if(Object(o.vc)("RepliesField__info_shown",v,n||g),Object(o.vc)("RepliesField__info_single",v,n&&!g||!n&&g),Object(o.zc)("field_reply_to",n),Object(o.zc)("field_reply_to_name",n&&_?"1":""),window.cur.replyTo=n,Object(o.zc)("field_timestamp",dl()),l)if(r)Ka.a.changePosition(Ka.a.getByName("attaches"),!0,!1),Object(o.x)(s,r);else{Ka.a.changePosition(Ka.a.getByName("attaches"),!0,!0);var b=Object(o.O)("wall_replies");Object(o.y)(s,b)}return Jc(),$c(),Object(o.F)(c),Object(o.j)(e)},showMoreActions:function(e,t){var n=Object(o.M)("reply_more_"+e);if(!n)return;var i=Object(o.N)("ReplyItem__action",n),a=[];i.forEach((function(e){a.push(Object(ie.b)({inner:Object(o.zc)(e),onclick:"Replies.onClickMoreAction('"+e.id+"', event)"}))}));var r=Object(ie.g)({close:!0,items:a}),s=Object(o.l)(_.a.html(r));s=Un.a.open(s,!0,{oncloseCallback:function(){var t=Object(o.M)("reply_more"+e);t&&t.focus()}});var c=Object(o.O)("ModalMenu__btn",s);c&&c.focus();return Object(o.j)(t)},onClickMoreAction:function(e,t){t&&Un.a.close(t.target);var n=Object(o.M)(e);if(!n)return;n.click()},onFieldInput:$c,toggleStickers:function(e,t){if(sl)return Object(o.j)(t);return window.post.stickersToggle(e),Object(o.j)(t)},replyAsShow:function(e,t,n){void 0===n&&(n=!1);var i,a=!!window.cur.replyAs;pl("editing"),a?i=il(window.cur.replyAs):(i=_.a.wrap(Object(me.a)({large:!0})),function(e,t){void 0===t&&(t=!1);if(window.cur.replyAsLoading)return;var n=window.ajax;window.cur.replyAsLoading=!0,n.post("/wall.php",{act:"get_reply_clubs_list",only_this_group:t?1:0,post_oid:e,modal:1},{onDone:function(e){window.cur.replyAs=e;var t=Object(o.M)("reply_as_users_list");if(t){var n=il(e);Object(o.zc)(t,_.a.html(n));var i=Object(o.O)("ModalMenuUserList__item",t);i&&i.focus()}delete window.cur.replyAsLoading},onFail:function(){delete window.cur.replyAsLoading}})}(t,n));var r=Object(ie.g)({title:Object(o.W)("mobile_wall_reply_as_title"),close:!0,items:[{id:"reply_as_users_list",inner:i}]}),s=Object(o.l)(_.a.html(r));if(Un.a.open(s,!0),a){var c=Object(o.O)("ModalMenuUserList__item",Object(o.M)("reply_as_users_list"));c&&c.focus()}return Object(o.j)(e)},replyAsChange:function(e,t,n,i){var a=Object(o.M)("reply_field_from"),r=Object(o.O)("RepliesField__infoName",a);return Object(o.zc)(r,Object(o.ib)(i)),Object(o.zc)("field_from_oid",n),ie.g.close(t),Object(o["M"])("reply_field_text").focus(),Object(o.j)(e)},checkSendButton:function(e){if(!nl())return Object(o.j)(e);window.cur.needTrackMyTracker&&Object(Xc.a)("comment_in_sport_broadcast")},onClickLastReplies:function(e,t){var n=Object(o.O)("wall_replies"),i=Object(o.z)(n),a=i&&Object(o.gb)("RepliesThreadNext",i);if(a){var r=Object(o.O)("Loading",i);r||(r=Object(o.l)(Object(me.a)({})),Object(o.f)(r,i)),Object(o.a)("RepliesThreadNext_loading",i)}if(Object(o.Yb)("RepliesWrap_last_shown",e),window.scrollTo(0,document.body.scrollHeight),a)return i.focus(),window.ajax.click(e,window.RepliesLast);i&&(Object(o.gb)("RepliesThread",i)&&(i=Object(o.C)(i)),Object(o.gb)("ReplyItem",i)&&Object(o.O)("ReplyItem__name",i).focus());return Object(o.j)(t)},onSubmitForm:function(e,t){if(dl())fl();else{if(e.preventDefault(),cl)return;var n=Object(z.a)('textarea[name="message"]',t),i=n?n.value:"";if(!i)return _l(-1),void fl();cl=!0;var a=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),r=a[1],s=a[2];window.ajax.post("/wall.php",{act:"check_comment",oid:r,post_oid:s,text:i},{onDone:function(e){if(cl=!1,_l(e.timestamp),e.delay){var t,n=1e3*e.delay,i=Object(z.a)("#reply_field");Object(o.gb)("RepliesField_fixed",i)?t=Object(o.U)(i)+5:Object(o.gb)("RepliesField_static",i)||(t=Object(o.U)(Object(z.a)("body"))-Object(o.db)(i)+5),rl=window.Snackbar.init({type:q.c,text:e.description,bottom:t,duration:n}),ol=setTimeout((function(){hl(),fl()}),n),function(e){var t=Object(z.a)("#nc_submit"),n=Object(z.a)(".RepliesField__field"),i=_.a.elem({class:"RepliesField__action RepliesField__action_cancel",inner:Kc({duration:e/1e3}),onclick:["Replies.abortTimer","button"]});sl=!0;var a=Object(z.a)(".RepliesField__action_attach"),r=Object(z.a)(".RepliesField__action_smile");a&&a.classList.add("RepliesField__action_disabled"),r&&r.classList.add("RepliesField__action_disabled"),n.appendChild(i),Object(o.hb)(t)}(n)}else fl()},onFail:function(){cl=!1,fl()}})}},abortTimer:pl,setCurrentTimestamp:_l,getCurrentTimestamp:dl};function $c(){var e=Object(o.M)("reply_field_text"),t=Object(o.M)("reply_field_text_fake");if(e&&t){var n=e.value;t.innerText=n,"\n"===Object(o.Ab)(n)&&(t.innerHTML+="&nbsp;");var i=Object(o.U)(t);Object(o.U)(e)!==i&&(Object(o.jc)(e,{height:i}),Jc()),tl(),pl("editing")}}function Jc(){var e=Object(o.M)("reply_field");Object(o.gb)("RepliesField_static",e)||Object(o.gb)("RepliesField_fixed",e)&&(Object(o.jc)(e,{height:Object(o.U)(Object(o.O)("RepliesField_wrap",e))}),Zc(),Object(o.Lb)())}function Zc(){var e=Object(o.M)("replies_to_last"),t=Object(o.M)("reply_field");if(e&&t&&!Object(o.gb)("RepliesField_static",t)){var n=Object(o.v)(e,"bottom");n||(n=parseInt(Object(o.Z)(e,"bottom"))||20,Object(o.v)(e,"bottom",n)),Object(o.jc)(e,"bottom",Object(o.U)(t)+parseInt(n))}}function el(){tl(),Jc();var e=(window.mediaUpload?window.mediaUpload.getAttachesCount():0)<2;["photo_device","photo","video","audio","doc"].forEach((function(t){Ka.a.toggleItemEnabled(Ka.a.getByName("attaches"),t,e)}))}function tl(){var e=Object(o.M)("nc_submit");e&&Object(o.vc)("RepliesField__action_send_active",e,nl())}function nl(){var e=(Object(o.M)("reply_field_text")||{}).value;return Object(o.wc)(e)||window.mediaUpload&&window.mediaUpload.getAttachesCount()}function il(e){var t=[];return e.forEach((function(e){t.push(Object(Qc.a)({href:e[2],image:e[1],name:e[3],id:e[0],onclick:"return Replies.replyAsChange(event, this, "+parseInt(e[0])+", '"+e[4]+"')"}))})),Object(Qc.b)({users:t})}var ol,rl,sl=!1,cl=!1,ll={};function ul(){sl=!1,clearTimeout(ol),window.Snackbar.close(rl),hl()}function dl(){return ll[""+window.cur.replyTo]}function _l(e){ll[""+window.cur.replyTo]=e,Object(o.zc)("field_timestamp",e)}function pl(e){if(sl){var t=location.pathname.match(/^\/wall(-?[0-9]+)_([0-9]+)$/),n=t[1],i=t[2],a=dl();window.ajax.post("/wall.php",{act:"cancel_check_comment",oid:n,post_oid:i,reason:e,timestamp:a})}ul()}function hl(){var e=Object(z.a)("#nc_submit"),t=Object(z.a)(".RepliesField__action_cancel"),n=Object(z.a)(".RepliesField__action_attach"),i=Object(z.a)(".RepliesField__action_smile");n&&n.classList.remove("RepliesField__action_disabled"),i&&i.classList.remove("RepliesField__action_disabled"),Object(o.Xb)(t),Object(o.lc)(e)}function fl(){var e=Object(z.a)("#nc_submit");_l(dl()),nav.go(e,window.event),_l(0)}nav.onBeforeGo((function(e,t){var n=location.pathname.substr(1,4);Object(o.ub)(e)&&e.substr(1,4)!==n&&"wall"===n&&(ll={})})),window.page&&window.page.onChange((function(e,t){ul()}));function ml(){Object(z.b)(".WallSearchBtn__wrapper").forEach((function(e){var t=e.querySelector(".Slider__scroll"),n=null==t?void 0:t.getBoundingClientRect(),i=e.querySelector(".Slider__line"),a=null==i?void 0:i.getBoundingClientRect(),o=e.querySelector(".WallSearchBtn");(null==n?void 0:n.width)<(null==a?void 0:a.width)?null==o||o.classList.add("WallSearchBtn--divided"):(null==o?void 0:o.classList.contains("WallSearchBtn--divided"))&&(null==o||o.classList.remove("WallSearchBtn--divided"))}))}function vl(e){void 0===e&&(e={});var t="",n="",i=null;return e.isOwner?(t=Object(ae.t)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_owner_title":"mobile_post_privacy_modal_friends_owner_title"),n=Object(ae.t)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_owner_description":"mobile_post_privacy_modal_friends_owner_description"),e.isOnlyForBestFriends&&0===e.bestFriendsCount&&(t=Object(ae.t)("mobile_post_privacy_modal_no_one_will_see_title"),n=Object(ae.t)("mobile_post_privacy_modal_no_one_will_see_description"),i=e.onChooseBestFriendsClick&&{text:Object(ae.t)("mobile_post_privacy_modal_choose_best_friends_button_title"),theme:"link",onClick:e.onChooseBestFriendsClick})):(t=Object(o.zb)(e.ownerSex,Object(ae.t)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_title":"mobile_post_privacy_modal_friends_title","raw")).replace("{user_first_name}",e.ownerFirstName),n=Object(ae.t)(e.isOnlyForBestFriends?"mobile_post_privacy_modal_best_friends_description":"mobile_post_privacy_modal_friends_description"),i=e.onCreatePostClick&&{text:Object(ae.t)("mobile_post_privacy_modal_create_post_button_title"),theme:"link",onClick:e.onCreatePostClick}),function(e){void 0===e&&(e={});var t=window.lang,n=e.icon,i=e.actions||[],a=i.length||e.needCloseButton;e.inner&&1===e.inner.length&&null===e.inner[0]&&(e.inner=null);var o=i.map((function(e){return Object(Kt.a)({inner:[e.text],theme:e.theme,onClick:e.onClick,use_native_onclick:!0})}));e.needCloseButton&&o.push(Object(Kt.a)({inner:[t.mobile_close],stretch:!0,onClick:"ModalMenu.close(this)",use_native_onclick:!0,theme:"secondary"}));var r={inner:[e.needCloseIcon?Object(ne.c)({onClose:e.onClose}):null,n?{inner:[n],class:"ModalCard__icon",tag:"div"}:null,{inner:[e.title],class:"ModalCard__title",tag:"h2"},e.subhead?{inner:[e.subhead],class:"ModalCard__subhead",tag:"div"}:null,e.inner?{inner:[e.inner],class:"ModalCard__content",tag:"div"}:null,a?Object(jc.a)({btns:o,mode:e.actionsLayout||"horizontal",stretch:!0}):null],class:"ModalCard__in",tag:"div"};return Object(ne.f)({class:"ModalCard",body:r})}({title:t,icon:Object(xi.Ob)(),needCloseIcon:!0,subhead:n,actions:i?[i]:null})}window.PostDraftReminder={openContextMenu:function(e,t,n){var i=window.lang;e.preventDefault(),e.stopPropagation();var a=Wd.html([Object(ve.b)({title:i.mobile_wall_draft_delete,href:n.remove_url,ref:"wall_draft_reminder"})]),o=Wd.elem(Object(ve.a)({list:a}));o.parentNode.id="post_draft_reminder_container",ve.a.open(o,"#post_draft_reminder_container",{appendToBody:!0})}},window.onDOMReady((function(){ml(),Object(o.Jb)(ml)})),window.page.onChange(ml),window.WallSearch={onSearch:function(e,t){e.preventDefault(),Object(D.a)("mvk_wall_search_button"),nav.go(t)},checkOverflow:ml};var gl=new(function(){function e(){}return e.prototype.openPostPrivacyModal=function(e){var t=vl(e);window.ModalMenu.open(_.a.elem(t),!0)},e}());window.PostPrivacy=gl,window.TextliveFeedBanner={close:function(e){return function(){var e=window.lang;if(!Object(qs.b)(qs.a.ACCOUNT_HINT_TEXTLIVE_HIDE))return;var t=Object(z.a)(".BottomMenu__cell:nth-child(4) .BottomMenu__icon"),n=Wd.elem(Object(qs.c)({pos:"top_right",theme:"accent",inner:e.mobile_textlive_notifications_tooltip,onboarding:!0,"tooltip-id":qs.a.ACCOUNT_HINT_TEXTLIVE_HIDE}));t.appendChild(n)}(),ajax.click(e,window.Comment)},restore:function(e){return ajax.click(e,window.Comment)},onTextliveOpen:function(){Object(o.oc)("textlive_banner_action",null,"open")}};n("ionu");var bl=n("VzJG");window.MainMenu={showMenuItems:bl.c},p.a.getRouter().addRoute(/^\/menu([\?#].*)?$/,bl.a),window.PostAttachVideoLink={},PostAttachVideoLink._onInit=Sl,PostAttachVideoLink._onPlayClick=El,PostAttachVideoLink._onReplayClick=El,PostAttachVideoLink._onSoundClick=Cl,PostAttachVideoLink._onVideoClick=Tl,PostAttachVideoLink._onVideoPlay=function(e){return Il(e.target,"play")},PostAttachVideoLink._onVideoPause=function(e){return Il(e.target,"pause")},PostAttachVideoLink._onVideoEnded=function(e){return Il(e.target,"end")};var Al="PostAttachVideoLink_muted",wl=function(e){return"PostAttachVideoLink_state_"+e},yl=".PostAttachVideoLink",Ol=".PostAttachVideoLink__video",kl=window.MutationObserver,jl=null;function Sl(){kl&&!jl&&(jl=new kl(Ml)).observe(document.body,{childList:!0,subtree:!0})}function Cl(e){var t=e.closest(yl),n=Object(z.a)(Ol,t);n.muted=!n.muted,t.classList.toggle(Al,n.muted)}function El(e){var t=e.closest(yl);Object(z.a)(Ol,t).play()}function Tl(e){e.paused||e.pause()}function Il(e,t){var n=e.closest(yl);n.classList.remove(wl("play")),n.classList.remove(wl("pause")),n.classList.remove(wl("end")),n.classList.add(wl(t))}function Ml(e){e.forEach((function(e){e.removedNodes.forEach((function(e){e.nodeType===HTMLElement.ELEMENT_NODE&&Object(z.b)(Ol,e).forEach((function(e){e.src="",e.load()}))}))})),Object(z.a)(Ol)||(jl.disconnect(),jl=null)}n("bRFj");var Pl,xl,Ll,Rl,Bl,Nl=function(){function e(e,t,n,i,a,o){var r="/club"+t+obj2qs({act:e,hash:n,id:t,from:i});ajax.post(r,{_ajax:1},{onDone:a,onFail:o})}return{enter:function(t,n,i,a,o){void 0===a&&(a=null),void 0===o&&(o=null),e("enter",t,n,i,a,o)},leave:function(t,n,i,a,o){void 0===a&&(a=null),void 0===o&&(o=null),e("leave",t,n,i,a,o)},init:function(e,t){var n,i,a;void 0===t&&(t={}),t&&t.hasOwnProperty("add_recent_hash")&&(n=e,i=t.add_recent_hash,a={act:"add_recent",group_id:n,hash:i},V.a.post("/groups",a))}}}();window.Groups=Nl,window.FeedAssistanceStats=((Pl={register:Au,forceRegister:function(e,t){e[Dl]=yu(e),e[Ul]=t,iu.push(e)},onScroll:throttle(ku,50),onStartViewElement:Object(d.a)("element"),onEndViewElement:Object(d.a)("element"),onStopTrackElement:Object(d.a)("element"),onViewedElement:Object(d.a)("element"),onBeforePageChange:Eu,onPageChanged:Tu,getElementType:yu,registerElements:gu,registerTrackingCls:function(e){fu.push(e)},unregisterTrackingCls:vu}).unregisterTrackingCls=vu,Pl.setParenViewableX=function(e,t){e._feedAssistanceStatsParentViewableX=t},Pl.forceProcessTrack=wu,Pl.dispatchElementEvent=function(e,t){var n=function(e){return Zl[e]}(Zu(t[Dl]||yu(t),e));Pu({type:e,data:n(t)})},Pl.dispatchEvent=function(e){Pu(e)},Pl.serializeEventData=Ou,Pl.clearElemsCache=function(){iu.forEach((function(e){e[ql]=!1,e[zl]=!1}))},Pl._debug=function(){return{started:au,tracking:iu,events:hu,blindTop:ru,blindBottom:su}},Pl.getFromRef=cd,Pl.getRoot=ld,Pl.BLOCKS={},Pl.EVENTS={},Pl);var Dl="_feedAssistanceStatsType",Hl="_feedAssistanceStatsIdled",Ul="_feedAssistanceStatsModule",Vl="_feedAssistanceStatsStarted",Fl="_feedAssistanceStatsProcessed",Wl="_feedAssistanceStatsEventTs",ql="_feedAssistanceStatsCachedY",zl="_feedAssistanceStatsCachedX",Yl="_feedAssistanceStatsLeft",Gl="_feedAssistanceStatsHeight",Ql="_feedAssistanceStatsWidth",Kl="_feedAssistanceStatsTop",Xl="_feedAssistanceStatsBottom",$l=((xl={}).BLOCK_TYPE_RECOMMENDED_SLIDER="view_block",xl.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER="view_block",xl.BLOCK_TYPE_PROMO_BUTTON="view_block",xl.BLOCK_TYPE_EXPLORE_BAIT="explore_bait",xl.BLOCK_TYPE_PROFILE_PHOTO="feed_assistance",xl.BLOCK_TYPE_IMPORT_CONTACTS="feed_assistance",xl.BLOCK_TYPE_PUSH_SWITCH="feed_assistance",xl),Jl=((Ll={}).BLOCK_TYPE_RECOMMENDED_SLIDER=500,Ll.BLOCK_TYPE_EXPLORE_BAIT=500,Ll.BLOCK_TYPE_PROFILE_PHOTO=500,Ll.BLOCK_TYPE_IMPORT_CONTACTS=500,Ll.BLOCK_TYPE_PUSH_SWITCH=500,Ll),Zl=((Rl={})[Zu("BLOCK_TYPE_RECOMMENDED_SLIDER","view_block")]=function(e){var t=geByClass1("Slider__scroll",e),n=domData(t,"code");return Ou("view_block","",e,domData(t,"ref"),n)},Rl[Zu("BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER","view_block")]=function(e){var t=e.querySelector(".Slider__scroll");return Ou("view_block","",e,"",domData(t,"code"))},Rl[Zu("BLOCK_TYPE_PROMO_BUTTON","view_block")]=function(e){return Ou("view_block",geByClass1("feedAssistancePromoButtonInstallApp__button",e)?"promo_install_app":"promo_button",e)},Rl[Zu("BLOCK_TYPE_EXPLORE_BAIT","explore_bait")]=function(){return Ou("SUB_EXPLORE_BAIT","view")},Rl[Zu("BLOCK_TYPE_PROFILE_PHOTO","feed_assistance")]=function(e){return Ou("feed_assistance",e,"m_ph","seen")},Rl[Zu("BLOCK_TYPE_IMPORT_CONTACTS","feed_assistance")]=function(e){return Ou("feed_assistance",e,"m_mp","seen")},Rl[Zu("BLOCK_TYPE_PUSH_SWITCH","feed_assistance")]=function(e){return Ou("feed_assistance",e,"m_push_switch","seen")},Rl),eu=((Bl={}).view_block=function(e,t,n,i){return n=n||cd(t),[e,domChildIndex(t),ud(t),n,i].join("|")},Bl.SUB_EXPLORE_BAIT=function(e){return e},Bl.feed_assistance=function(e,t,n){return[t,n,cd(e)].join("|")},Bl.hide=function(e,t){return[e,ud(t),domChildIndex(t),cd(t)].join("|")},Bl.SUB_PROMO_BUTTON=function(e,t,n){return[domChildIndex(e),t,n||""].join("|")},Bl),tu="feedAssistanceStat.events",nu="feedAssistanceStat.idled",iu=[],au=[],ou=Date.now(),ru=0,su=0,cu=!1,lu=null,uu=null,du=null,_u=null,pu=null,hu=[],fu=[],mu=!1;function vu(e){id(fu,e)}function gu(){var e=[];each(fu,(function(){e=e.concat(geByClass(this))})),each(e,(function(){Au(this,"feed")}))}function bu(){gu();var e=Ku();e.length&&(zu(e),Xu()),wu(),Du()}function Au(e,t){!e[Dl]&&function(e){return!~iu.indexOf(e)}(e)&&(e[Dl]=yu(e),e[Ul]=t,iu.push(e))}function wu(){Iu(scrollGetY(),getCh())}function yu(e){return e[Dl]?e[Dl]:hasClass("feedAssistance_recommendedFriends",e)?"BLOCK_TYPE_RECOMMENDED_SLIDER":e.classList.contains("feedAssistance_recommendedGroups")?"BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER":hasClass("post_exploreBait",e)?"BLOCK_TYPE_EXPLORE_BAIT":hasClass("feedAssistance_profilePhoto",e)?"BLOCK_TYPE_PROFILE_PHOTO":hasClass("feedAssistance_promoButton",e)?"BLOCK_TYPE_PROMO_BUTTON":hasClass("feedAssistance_importContacts",e)?"BLOCK_TYPE_IMPORT_CONTACTS":hasClass("feedAssistance_pushNotificationsSwitch",e)?"BLOCK_TYPE_PUSH_SWITCH":"BLOCK_TYPE_DEFAULT"}function Ou(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return eu[e].apply(eu,n)}function ku(e,t){var n,i=ku;Iu(e||scrollGetY(),t||getCh()),cu||mu?(clearTimeout(i.timer),i.timer=setTimeout(ju,150),mu=!1):(cu=!0,Nu(),n=ge("vk_head"),ru=n&&n.offsetHeight,su=0)}function ju(){Nu(),Bu(),cu=!1}function Su(){Nu(),sd(au),zu(hu.concat(Ju(au))),od(au),hu=[],au=[],Hu()}function Cu(){au.forEach((function(e){e[Vl]=Date.now()})),Yu(null),Gu(null),Bu(),Hu(),Du()}function Eu(){Nu(),sd(au),hu=hu.concat(Ju(au)),od(au),au=[],mu=!0,Bu()}function Tu(){gu(),wu()}function Iu(e,t){var n=[];iu.forEach((function(i){nd(i)?n.push(i):!function(e,t,n){return!e[Vl]&&Lu(e,.5,t,n)&&Ru(e,.5)}(i,e,t)?!function(e,t,n){return e[Vl]&&(!Lu(e,.25,t,n)||!Ru(e,.25))}(i,e,t)?xu(i)&&(Mu(i),FeedAssistanceStats.onViewedElement(i)):(i[Hl]?delete i[Hl]:(Mu(i),FeedAssistanceStats.onEndViewElement(i)),delete i[Vl]):(i[Vl]=Date.now(),au.push(i),FeedAssistanceStats.onStartViewElement(i))})),n.forEach((function(e){id(iu,e),FeedAssistanceStats.onStopTrackElement(e)}))}function Mu(e){id(au,e),rd(e),Pu(td(e)),ad(e)}function Pu(e){e&&hu.push(e)}function xu(e){return!!e[Vl]&&Math.min(3e5,Date.now()-e[Vl])>function(e){var t=yu(e);return Jl[t]||500}(e)}function Lu(e,t,n,i){if(!e)return!1;e[ql]||(e[ql]=!0,e[Gl]=e.offsetHeight,e[Kl]=n+e.getBoundingClientRect().top,e[Xl]=e[Kl]+e[Gl]);var a=i-ru-su,o=n+ru,r=n+i-su,s=e[Gl],c=e[Kl],l=e[Xl];return(l>o&&c<r?Math.min(r,l)-Math.max(o,c):0)>=Math.min(a*t,s*t)}function Ru(e,t){var n=e._feedAssistanceStatsParentViewableX;n&&!n[zl]&&~iu.indexOf(n)&&(n[zl]=!0,n[Ql]=n.clientWidth,n[Yl]=n.getBoundingClientRect().left+n.clientLeft),e[zl]||(e[zl]=!0,e[Ql]=e.offsetWidth);var i=n?n[Ql]||n.clientWidth:getCw(),a=n?n[Yl]||n.getBoundingClientRect().left+0:0,o=i+a,r=e[Ql],s=e.getBoundingClientRect().left,c=r+s,l=r*t,u=r*Math.max(0,1-t);return s+l>=a&&c-u<=o}function Bu(){lu=setTimeout(Uu,2500),uu=setTimeout(Vu,1e4),du=setTimeout(Fu,6e3),_u=setTimeout(Wu,2e4)}function Nu(){clearTimeout(lu),clearTimeout(uu),clearTimeout(du),clearTimeout(_u)}function Du(){pu=setInterval(qu,3e4)}function Hu(){clearInterval(pu)}function Uu(){hu.length&&Yu(hu)}function Vu(){zu(hu),hu=[],Yu(null)}function Fu(){au.length&&(Gu(Ju(au)),du=setTimeout(Fu,5e3))}function Wu(){clearTimeout(du),sd(au),zu(Ju(au)),od(au),au.forEach((function(e){e[Hl]=!0})),au=[],Gu(null)}function qu(){hu.length>=100&&Vu()}function zu(e){if(e&&e.length){var t={act:"assistance_stats"};t=extend(t,(n={},each(e,(function(){n[this.type]?n[this.type].push(this.data):n[this.type]=[this.data]})),n)),ajax.post("/feed",t)}var n}function Yu(e){Qu(tu,e)}function Gu(e){Qu(nu,e)}function Qu(e,t){var n=lsGet(e)||{};t?n[ou]=t:delete n[ou],lsSet(e,n)}function Ku(){var e=Ku,t=[],n=lsGet(tu)||{},i=lsGet(nu)||{};return e.iterator||(e.iterator=function(e){return function(n){$u(n)&&(t=t.concat(e[n]))}}),Object.keys(n).forEach(e.iterator(n)),Object.keys(i).forEach(e.iterator(i)),t}function Xu(){var e=Xu,t=lsGet(tu)||{},n=lsGet(nu)||{};e.iterator||(e.iterator=function(e){return function(t){$u(t)&&delete e[t]}}),Object.keys(t).forEach(e.iterator(t)),Object.keys(n).forEach(e.iterator(n)),lsSet(tu,t),lsSet(nu,n)}function $u(e){var t=Number(e);return t!==ou&&Date.now()-t>=36e4}function Ju(e){var t=[];return e.forEach((function(e){var n=td(e);n&&t.push(n)})),t}function Zu(e,t){return e+"_"+t}function ed(e,t){return(0,Zl[Zu(e[Dl],t)])(e)}function td(e){if(nd(e))return null;if(!xu(e))return null;var t=function(e){return $l[e[Dl]]}(e);return{type:t,data:ed(e,t)}}function nd(e){return e[Fl]||!document.body.contains(e)}function id(e,t){var n=e.indexOf(t);n>=0&&e.splice(n,1)}function ad(e){nd(e)||xu(e)&&(e[Fl]=!0)}function od(e){each(e,(function(){ad(this)}))}function rd(e){e[Wl]=Date.now()}function sd(e){e.forEach(rd)}function cd(e){return(e=ld(e))&&domData(e,"from-ref")||"feed_other"}function ld(e){return hasClass(e,"feedAssistance")||(e=domCA(e,".feedAssistance")),e}function ud(e){var t=(new Date).getTime();return e&&(e[Wl]||e[Vl])||t}FeedAssistanceStats.BLOCKS={BLOCK_TYPE_RECOMMENDED_SLIDER:"BLOCK_TYPE_RECOMMENDED_SLIDER",BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER:"BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER",BLOCK_TYPE_EXPLORE_BAIT:"BLOCK_TYPE_EXPLORE_BAIT",BLOCK_TYPE_PROFILE_PHOTO:"BLOCK_TYPE_PROFILE_PHOTO",BLOCK_TYPE_PROMO_BUTTON:"BLOCK_TYPE_PROMO_BUTTON",BLOCK_TYPE_IMPORT_CONTACTS:"BLOCK_TYPE_IMPORT_CONTACTS"},FeedAssistanceStats.EVENTS={EVENT_EXPLORE_BAIT:"explore_bait",EVENT_EXPLORE_BAIT_SUB:"SUB_EXPLORE_BAIT",EVENT_FEED_ASSISTANCE:"feed_assistance",SUB_EVENT_EXPLORE_BAIT_VIEW:"view",SUB_EVENT_EXPLORE_BAIT_OPENED:"opened",SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE:"subscribe",SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:"unsubscribe",SUB_EVENT_EXPLORE_BAIT_OPEN_USER:"open_user",SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP:"open_group",SUB_EVENT_EXPLORE_BAIT_HIDE:"hide",SUB_EVENT_EXPLORE_BAIT_REPORT:"report",SUB_EVENT_SEEN:"seen",SUB_EVENT_FILLED:"filled",EVENT_HIDE_BLOCK:"hide",SUB_EVENT_ENABLE_PUSH:"enable_push",SUB_EVENT_DECLINE_PUSH:"decline_push",EVENT_PROMO_BUTTON:"promo_button",EVENT_PROMO_BUTTON_SUB:"SUB_PROMO_BUTTON",SUB_EVENT_PROMO_BUTTON_CLICK:"clicked"},addEvent(window,"blur",Su),addEvent(window,"focus",Cu),onDOMReady((function(){setTimeout(bu,500)})),addEvent(window,"scroll",(function(){ku(scrollGetY(),getCh())}),{passive:!0}),nav.onBeforeGo((function(){return Eu()})),page.onChange((function(){return Tu()}));n("yuVR");function dd(e){return Object.keys(e).map((function(t){return t+":"+e[t]+";"})).join("")}function _d(e){return e+"-"+Date.now()+"-"+Math.round(999999*Math.random())}var pd=[];function hd(e){pd.push(e),fd()}var fd=Object(o.t)((function(){var e=pd.map((function(e){return Object(z.a)("#"+e)})).filter((function(e){return e})).map((function(e){var t=Math.round(e.getBoundingClientRect().left),n="skeleton-gradient-slide-"+t;return function(e,t){if(vd[e])return;var n=function(e,t){return["@"+md()+"keyframes "+e+" {",t.map((function(e,n){return["\t"+n/(t.length-1)*100+"% {",Object.keys(e).map((function(t){return"\t\t"+t+": "+e[t]+";"})).join("\n"),"\t}"].join("\n")})).join("\n"),"}"].join("\n")}(e,t);vd[e]=n,gd.appendChild(document.createTextNode(n))}(n,[{"background-position-x":-600-t+"px"},{"background-position-x":window.innerWidth-t+"px"}]),{el:e,prop:n+" 1.2s infinite cubic-bezier(0.4, 0.0, 0.2, 1)"}}));requestAnimationFrame((function(){e.forEach((function(e){var t=e.el,n=e.prop;t.style[md()+"animation"]=n})),pd=[]}))}),100);function md(){var e="";document&&(e=null!=(document.documentElement||document.createElement("div")).style.animation?"":"-webkit-");return e}var vd={},gd=document.createElement("style");function bd(e){void 0===e&&(e={});var t=_d("skeleton-circle"),n=dd({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=["SkeletonComponent__item",u.a.class("SkeletonCircle",{header:e.header}),e.class].filter((function(e){return e})).join(" ");return hd(t),{id:t,class:i,style:n,tag:"div"}}document.head.appendChild(gd);function Ad(e){void 0===e&&(e={});var t=_d("skeleton-line"),n=dd({})+(e.style||""),i=["SkeletonComponent__item",u.a.class("SkeletonLine",{small:e.small,header:e.header}),e.class].filter((function(e){return e})).join(" ");return hd(t),{id:t,class:i,style:n,tag:"div"}}function wd(e){void 0===e&&(e={});var t=[u.a.class("SkeletonRow",{justifyContent:e.justify,alignItems:e.align}),e.class].filter((function(e){return e}));return{inner:[e.inner],class:t.join(" "),tag:"div"}}function yd(e){void 0===e&&(e={});var t=[u.a.class("SkeletonCol",{auto:e.auto,grow:e.grow,flexColumn:e.flexColumn}),e.class].filter((function(e){return e})).join(" ");return{inner:[e.inner],class:t,tag:"div"}}function Od(e){void 0===e&&(e={});var t=[u.a.class("SkeletonOffset",{small:e.small}),e.class].filter((function(e){return e}));return{inner:[e.inner],class:t.join(" "),tag:"div"}}function kd(e){void 0===e&&(e={});var t,n,i=dd({opacity:e.opacity});return{inner:[wd({inner:[yd({inner:[bd({size:(t={s:32,modern:40,l:48},n=null,Object(o.T)()<=270&&null!=t.xs&&(n=t.xs),Object(o.T)()<=319&&null!=t.s&&(n=t.s),Object(o.T)()>=320&&null!=t.modern&&(n=t.modern),Object(o.T)()>=400&&null!=t.l&&(n=t.l),Object(o.T)()>=480&&null!=t.xl&&(n=t.xl),Object(o.T)()<=881&&null!=t.mobile&&(n=t.mobile),Object(o.T)()>=882&&null!=t.xxl&&(n=t.xxl),Object(o.T)()>=882&&null!=t.desktop&&(n=t.desktop),n),style:i})],auto:!0}),yd({inner:[wd({inner:[yd({inner:[Ad({style:i})],grow:3}),yd({grow:4})]}),wd({inner:[yd({inner:[Ad({small:!0,style:i})]}),yd({grow:3})]})],flexColumn:!0})]}),Od(),wd({inner:[yd({inner:[Ad({style:i})],grow:4}),yd({inner:[Ad({style:i})],grow:3})]}),Od(),wd({inner:[yd({inner:[Ad({style:i})],grow:4}),yd({grow:1})]}),Od(),wd({inner:[yd({inner:[Ad({style:i})],grow:4}),yd({grow:3})]}),Od(),Od(),wd({inner:[yd({inner:[bd({size:24,style:i})],auto:!0}),Od(),yd({inner:[bd({size:24,style:i})],auto:!0}),Od(),yd({inner:[bd({size:24,style:i})],auto:!0}),yd({grow:1}),yd({inner:[bd({size:24,style:i})],auto:!0})]})],class:"SkeletonWallBlock Post__rowPadding",tag:"div"}}function jd(e){void 0===e&&(e={});var t=_d("skeleton-search"),n=dd({})+(e.style||""),i=["SkeletonComponent__item",u.a.class("SkeletonSearch",{small:e.small,header:e.header}),e.class].filter((function(e){return e})).join(" ");return hd(t),{id:t,class:i,style:n,tag:"div"}}function Sd(e){return{inner:[wd({inner:[yd({inner:[wd({inner:[yd({inner:[jd({header:!0})]}),Od({small:!0}),yd({inner:[bd({class:"SkeletonSearchHeader__icon",header:!0,size:28})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonSearchHeader",tag:"div"}}var Cd=n("g3t9");function Ed(e){for(var t=Math.ceil((window.innerHeight-56)/210),n=[],i=0;i<t;i++)n.push(kd());return{inner:[Sd(),Object(Cd.a)(),n],class:"SkeletonComponent__page SkeletonRecommended Skeleton",tag:"div"}}function Td(e){void 0===e&&(e={});var t=dd({opacity:e.opacity});return{inner:[wd({inner:[yd({inner:[bd({size:50,style:t})],auto:!0}),yd({inner:[wd({inner:[yd({inner:[Ad({style:t})],grow:3}),yd({grow:4}),yd({inner:[Ad({style:t})]})],justify:"center"}),wd({inner:[yd({inner:[Ad({style:t})]}),yd({inner:[Ad({style:t})],grow:5}),yd({grow:3,style:t})]})],flexColumn:!0})]})],class:"SkeletonChatBlock Post__rowPadding",tag:"div"}}function Id(e){void 0===e&&(e={});var t={};e.hideIcon&&(t.visibility="hidden");var n=dd(t);return{inner:[wd({inner:[yd({inner:[wd({inner:[yd({inner:[Ad({header:!0})],grow:5}),yd({grow:5}),yd({inner:[bd({class:"SkeletonHeader__icon",header:!0,size:28,style:n})],auto:!0})]})],flexColumn:!0})]})],class:"SkeletonHeader Post__rowPadding",tag:"div"}}function Md(e){return{inner:[jd()],class:"SkeletonSearchBlock Post__rowPadding",tag:"div"}}function Pd(e){for(var t=Math.ceil((window.innerHeight-56)/70),n=[],i=0;i<t;i++)n.push(Td());return{inner:[Id(),Md(),n],class:"SkeletonComponent__page SkeletonMessages Skeleton",tag:"div"}}function xd(e){void 0===e&&(e={});var t=dd({opacity:e.opacity});return{inner:[bd({class:"SkeletonStory__avatar",size:56,style:t}),wd({inner:[Od({small:!0}),yd({inner:[Ad({small:!0,style:t})]}),Od({small:!0})]})],class:"SkeletonStory",tag:"div"}}function Ld(e){void 0===e&&(e={});for(var t=Math.ceil(window.innerWidth/76),n=[],i=0;i<t;i++)n.push(yd({inner:[xd()],auto:!0}));return{inner:[wd({inner:[n]})],class:"SkeletonStoriesBlock Post__rowPadding",tag:"div"}}function Rd(e){return{inner:[wd({inner:[yd({inner:[bd({size:40})],auto:!0}),yd({inner:[jd()]})],justify:"center"})],class:"SkeletonNewPostBlock Post__rowPadding",tag:"div"}}function Bd(e){for(var t=Math.ceil((window.innerHeight-56-180)/210),n=[],i=0;i<t;i++)n.push(kd());return{inner:[Id({hideIcon:!0}),Rd(),Ld(),n],class:"SkeletonComponent__page SkeletonFeed Skeleton",tag:"div"}}function Nd(e){void 0===e&&(e={});var t=_d("skeleton-line"),n=dd({width:e.size+"px",height:e.size+"px"})+(e.style||""),i=["SkeletonComponent__item",u.a.class("SkeletonSquare"),e.class].filter((function(e){return e})).join(" ");return hd(t),{id:t,class:i,style:n,tag:"div"}}function Dd(e){return{inner:[wd({inner:[yd({inner:[bd({size:48}),bd({size:20,class:"SkeletonNotificationBlock__badge"})],auto:!0,class:"SkeletonNotificationBlock__avatar"}),yd({inner:[Od({small:!0}),wd({inner:[yd({inner:[Ad()]})]}),wd({inner:[yd({inner:[Ad()],grow:2}),yd()]}),wd({inner:[yd({inner:[Ad({small:!0})]}),yd({grow:5})]})],grow:6}),yd(),yd({inner:[Nd({size:48})],auto:!0})],align:"flex-start"}),Od(),Od(),wd({inner:[yd({inner:[bd({size:48})],auto:!0}),yd({inner:[Od({small:!0}),wd({inner:[yd({inner:[Ad()]})]}),wd({inner:[yd({inner:[Ad({small:!0})]}),yd({grow:5})]}),Od()],grow:4}),yd({inner:[Od()]})],align:"flex-start"})],class:"SkeletonNotificationBlock Post__rowPadding",tag:"div"}}function Hd(e){for(var t=Math.ceil((window.innerHeight-56)/170),n=[],i=0;i<t;i++)n.push(Dd());return{inner:[Id({hideIcon:!0}),Object(Cd.a)(),{inner:[wd({inner:[yd({inner:[Ad()],grow:3}),yd({grow:2}),yd({inner:[Ad()],grow:2})]})],class:"SkeletonNotifications__info Post__rowPadding",tag:"div"},n],class:"SkeletonComponent__page SkeletonNotifications Skeleton",tag:"div"}}var Ud=n("UY6c"),Vd=function(){var e,t=Math.max(window.innerHeight,window.innerWidth),n=["feed","recommend","messages","notification","menu"],i="",a={},o=((e={}).feed=0,e.recommend=0,e.messages=0,e.notification=0,e.menu=0,e);function s(e){var t=geBySel1('[data-tabbar="'+e+'"]');return attr(t,"data-default")}function c(e){each(geBySel("[data-tabbar]"),(function(t,n){var i=geByClass1("_BottomMenu__icon_js",n),a=geByClass1("BottomMenu__counter",i),o=attr(n,"data-counter"),r=attr(n,"data-tabbar");e({i:t,tabId:r,counter:o,$link:n,$icon:i,$counter:a})}))}function l(){c((function(e){var t=e.$counter,n=e.$icon,i=(e.$link,e.tabId),a=o[i],r=n.outerHTML.includes("Tooltip");if(a&&0!==a||r)if(t&&!r)val(t,a);else{var s,c=ceFromString(n.outerHTML),l=ce("div",{className:"BottomMenu__counter",innerHTML:a});if(r)val(n,null==(s=$(".Tooltip",c))?void 0:s.outerHTML);a&&append(l,n)}else val(n,"")}))}function u(e){setTimeout((function(){d()}),0);var t=Wd.html({class:"pcont bl_cont",inner:{id:"al_loading",class:"BottomMenu__preloader"}});val(geByClass1("mcont",e),t)}function d(){var e=$(".BottomMenu__updateButton");remove(e)}return{setCurrentId:function(e){i=e},setHistory:function(e){a=extend({},e)},setCounter:function(e,t){o[e]=t?parseInt(t,10):0,l()},getCurrentId:function(){return i},getDefaultURL:s,getTabCounter:function(e){return o[e]?o[e]:0},drawUI:function(){c((function(e){var t=e.$icon,n=e.$link,o=e.tabId,r=a[o];if(r){var c=r.filter((function(e){return!0===e.current}))||[];c.length&&"messages"!==o&&attr(n,"href",c[0].a);var l=attr(n,"href");o!==i||!c.length||c[0].a!==l&&c[0].d!==l||attr(n,"href",s(o))}toggleClass("BottomMenu__icon_active",t,o===i)})),l()},drawUICounters:l,drawLoader:u,drawSkeletonLoader:function(e,t){if(hasClass(document.querySelector(".vk"),"vk_flex_yes"))switch(setTimeout((function(){d()}),0),t){case"feed":$(".mcont",e).innerHTML=Wd.html(Bd());break;case"messages":$(".mcont",e).innerHTML=Wd.html(Pd());break;case"notification":$(".mcont",e).innerHTML=Wd.html(Hd());break;case"recommend":$(".mcont",e).innerHTML=Wd.html(Ed());break;case"menu":default:u(e)}else u(e)},showUpdateButton:function(e){var t=window.lang,n=Wd.html({class:"BottomMenu__updateButton",inner:{class:"BottomMenu__updateButton_container",inner:{class:"BottomMenu__updateButton_wrap",onclick:["nav.updateCurrentPage"],inner:[{class:"BottomMenu__updateButton_icon",inner:Object(W.a)(Object(Ud.a)())},{class:"BottomMenu__updateButton_text",inner:t.mobile_menu_refresh_button}]}}}),i=hasClass("vk_custom_scroll",geByTag1("body")),a=e.$(i?".basis":".upanel");a.$(".BottomMenu__updateButton")||a.insertBefore(ceFromString(n),a.firstChild)},removeUpdateButton:d,onFocusIn:function(e){var t=geBySel1(".BottomMenu"),n=e&&e.target;if(n&&t&&browser.android){var i=!1;"textarea"===n.tagName.toLowerCase()&&(i=!0),"input"!==n.tagName.toLowerCase()||["checkbox","radio"].includes(n.type)||(i=!0),"select"===n.tagName.toLowerCase()&&(i=!0),i&&t.classList.add("vk_tabbar_hidden")}},onFocusOut:function(){var e=geBySel1(".BottomMenu");e&&e.classList.remove("vk_tabbar_hidden")},onResize:function(){var e=window.bodyNode;$(".Skeleton")&&($(".mcont").innerHTML='<div class="pcont bl_cont"><div id="al_loading"></div></div>',Object(r.a)()),e&&e.classList.contains("vk_tabbar_bottom")&&0===Math.abs(window.orientation)&&t-180>window.innerHeight?e.classList.add("vk_tabbar_hidden"):e&&e.classList.remove("vk_tabbar_hidden")},setDefaultCounters:function(){c((function(e){var t=e.tabId,n=e.counter;o[t]=n?parseInt(n,10):0})),l()},TAB_ID_FEED:"feed",TAB_ID_RECOMMEND:"recommend",TAB_ID_MESSAGES:"messages",TAB_ID_NOTIFICATION:"notification",TAB_ID_MENU:"menu",TAB_IDS:n}}();window.Tabbar=Vd;var Fd=Vd;window.page&&page.onRestore(Vd.drawUI),window.page&&page.onChange(Vd.drawUI),onDOMReady((function(){var e;Vd.setDefaultCounters(),addEvent(window,"resize",(function(){Vd.onResize(),clearTimeout(e),e=setTimeout((function(){Vd.onResize()}),300)}))}));var qd=!1;page.onChange(Qd),photoview.onHide(Qd),photoview.onShow(Kd),s.d.onInit((function(){qd||Gd()})),s.d.subscribe((function(){qd||Gd()}));var zd,Yd=Object(z.a)('meta[name="theme-color"]');function Gd(){s.d.isDarkScheme()?Xd("#050505"):Xd("#ffffff")}function Qd(){qd=!1,Gd()}function Kd(){qd=!0,Xd("#050505")}function Xd(e){zd||(zd=Object(z.a)("#theme_color_shim")),Yd&&Yd.setAttribute("content",e),zd&&(zd.style.backgroundColor=e)}n("U34x");var $d,Jd,Zd,e_,t_,n_=[".basis__header_unauthorized"],i_=!1;function a_(){i_||($d={vk:geByClass1("vk"),basis:geByClass1("basis"),header:geByClass1("basis__header"),headerTitle:geByClass1("mh_header",geByClass1("basis__header")),headerFirstIcon:geByClass1("GroupCoverIcons__icon--back_outline_28",geByClass1("basis__header")),headerSecondIcon:geByClass1("GroupCoverIcons__icon--back_outline_white_28",geByClass1("basis__header")),cover:geByClass1("groupCover"),coverImage:geByClass1("groupCover__image"),coverDimmer:geByClass1("groupCover__dimmer")}).cover&&(i_=!0,addClass($d.vk,"groupCover-vk_animationYes"),Jd=!U.a.chrome||Number(U.a.version.split(".")[0])>50,Zd="fixed"===getStyle($d.header,"position"),e_=getH($d.header),t_=getH($d.cover),onBodyScroll(r_),onBodyResize(s_),r_(),window.cur.destroy=window.cur.destroy.filter((function(e){return e!==o_})),window.cur.destroy.push(o_))}function o_(){(!0||menu.opened())&&(removeClass($d.vk,"groupCover-vk_animationStep"),removeClass($d.vk,"groupCover-vk_animationYes")),onBodyScroll("__clear",r_),onBodyResize("__clear",s_),i_=!1}function r_(){var e=scrollTop();if(Zd)if(e<0)setStyle($d.header,"top",-e),l_(),setStyle($d.coverDimmer,"opacity",0),setStyle($d.coverImage,"top",0);else{var t=document.body,n=Math.min(1,e/(t_-e_)),i=t&&t.classList.contains("vk_tabbar_top")&&!$d.header.classList.contains("basis__header_noBottomMenu")?48:0;setStyle($d.header,"top",i),setStyle($d.headerTitle,"display","block"),setStyle($d.headerFirstIcon,"display","block"),setStyle($d.headerSecondIcon,"display","block"),n<=.9?(l_(),Jd&&setStyle($d.coverImage,"top",.5*e),setStyle($d.coverDimmer,"opacity",n/.9),setStyle($d.headerTitle,"opacity",0),setStyle($d.headerFirstIcon,"opacity",0),setStyle($d.headerSecondIcon,"opacity",1)):(setStyle($d.headerTitle,"opacity",1),setStyle($d.headerFirstIcon,"opacity",1),setStyle($d.headerSecondIcon,"opacity",0),c_())}else Math.min(1,e/t_)<1?(l_(),setStyle($d.coverDimmer,"opacity",0),Jd&&setStyle($d.coverImage,"top",.5*e),setStyle($d.headerTitle,"display","none"),setStyle($d.headerFirstIcon,"display","none"),setStyle($d.headerSecondIcon,"display","block")):c_()}function s_(){o_(),a_()}function c_(){n_.map((function(e){return $(e)})).some((function(e){return e}))||removeClass($d.vk,"groupCover-vk_animationStep")}function l_(){n_.map((function(e){return $(e)})).some((function(e){return e}))||addClass($d.vk,"groupCover-vk_animationStep")}onDOMReady((function(){(U.a.chrome||U.a.safari&&U.a.ios>=9)&&(a_(),page.onChange(a_),zlayer.onClose((function(){setTimeout(a_,0)})))}));n("l51W"),n("BLcx"),n("nXjO");var u_,d_,__=function(){return Object(o.O)("tabs_block")},p_=function(){return Object(o.O)("tab_item_top")},h_=!0,f_=0;function m_(){d_&&d_(),u_&&u_()}function v_(e){Object(o.pc)(e),Object(o.Tb)(e),f_=300,h_&&(Object(o.vc)("TopMenu__switcher_on",Object(o.O)("TopMenu__switcher")),"touchstart"===e.type&&setTimeout((function(){nav.go(p_(),null)}),130))}function g_(e){Object(o.eb)("tabs_block",e.target)||Object(o.eb)("mhb_back",e.target)||(Object(o.pc)(e),Object(o.Tb)(e),Object(o.Yb)("TopMenu_open",__()),b_(),m_())}function b_(){m_(),Object(o.Zb)(window,"touchstart mousedown click",g_)}window.TopMenu={onHeaderClick:function(e){if(!h_)return;var t=__();Object(o.pc)(e),Object(o.Tb)(e);var n=Object(o.O)("mhb_back");if(Object(o.gb)("TopMenu_open",t))Object(o.Yb)("TopMenu_open",t),m_();else{var i=p_();Object(o.a)("TopMenu_open",t),Object(o.O)("_hfixed")&&Object(o.jc)(t,"max-height",window.innerHeight-70),Object(o.f)(t,n),Object(o.b)(window,"touchstart mousedown click",g_),Object(o.b)(i,"touchstart mousedown",v_),Object(o.b)(i,"click",(function(e){Object(o.pc)(e),Object(o.Tb)(e)})),d_=Object(c.a)(Object(o.O)("al_back")),(u_=Object(c.e)(t))&&(u_.exitIntent=function(){Object(o.Yb)("TopMenu_open",t),m_()}),cur.destroy.push(b_),cur.destroy.push((function(){return Object(o.Zb)(i,"touchstart mousedown",v_)}))}}},nav.onBeforeGo((function(){h_=!1,setTimeout((function(){f_=0,h_=!0,m_()}),f_)}));var A_=function(){var e,t,n,i=!1;function a(e){for(var t=!1;e;){var n=getStyle(e,"overflow-y");if(("scroll"===n||"auto"===n)&&e.offsetHeight<e.scrollHeight){e===document.documentElement||e===document.body?e=null:t=!0;break}e=e.parentElement}return{cursor:e,isOverflowYContainer:t}}function o(e){for(var t=!1;e;){var n=getStyle(e,"overflow-x"),i=hasClass(e,"Slider__scroll");if("scroll"===n||"auto"===n||i){t=!0;break}e=e.parentElement}return{cursor:e,isOverflowXContainer:t}}function r(){if(e&&t){var n=geByClass1("i_pointer",e);if(document.body.contains(n))a(n).isOverflowYContainer?setStyle(t,"top",n.getBoundingClientRect().top):setStyle(t,"top",getY(n)),o(n).isOverflowXContainer?setStyle(t,"left",function(e){return e.getBoundingClientRect().left}(n)-getW(t)):setStyle(t,"left",getX(n)-getW(t))}}function s(e){e&&"A"===e.target.tagName&&requestAnimationFrame((function(){r()}))}function l(l){!function(n){e=gpeByClass("ai_menu_wrap",n),t=geByClass1("ai_menu",e)}(l),addClass("ai_menu_opened",e),append(t,document.body),(n=Object(c.d)(t))&&(n.exitIntent=function(){u()}),i=u,tooltip.addHandler(i),tooltip.show(e,t),addEvent(window,"resize",r),addEvent(t,"click",s);var d=geByClass1("i_pointer",e),_=a(d);_.isOverflowYContainer&&addEvent(_.cursor,"scroll",r);var p=o(d);p.isOverflowXContainer&&addEvent(p.cursor,"scroll",r),r()}function u(){removeClass("ai_menu_opened",e),append(t,e),tooltip.removeHandler(i),tooltip.hide(),n&&(n(),n=null),removeEvent(window,"resize",r),removeEvent(t,"click",r);var s=geByClass1("i_pointer",e),c=a(s);c.isOverflowYContainer&&removeEvent(c.cursor,"scroll",r);var l=o(s);l.isOverflowXContainer&&removeEvent(l.cursor,"scroll",r)}return{closeMenu:u,toggleMenu:function(t,n){cancelEvent(t),hasClass("ai_menu_opened",e)?u():l(n)},update:function(){!function(){if(t){var e=geByClass("wia_item",t);e&&each(e,(function(e,t){var n=clone(t);before(n,t),remove(t),addClass("unhover",n),setTimeout((function(){removeClass("unhover",n)}),100)}))}}(),r()}}}();window.ActionMenu=A_;n("zHNa"),n("wCFN");var w_=function(){var e=38,t=40,n=13,i=27,a={},o={},r=!1;function s(){a={ignoredTerm:null,curValue:"",curTerm:"",curPos:"",input:{}},o={container:null,scroll:null,index:{},cache:{},shown:[],lastQ:null,text:null,requestTimer:null,opts:{}}}s();var c=!0;function l(){c=!1}function u(){var e=val(a.input),t=Math.max(e.lastIndexOf("@"),e.lastIndexOf("*")),n=!1;if(t>-1){var i=function(e){if(void 0!==e.selectionStart)return e.selectionStart!==e.selectionEnd?e.selectionEnd:e.selectionStart;if(void 0!==window.getSelection){var t=window.getSelection();if(!t||!t.rangeCount)return 0;var n=t.getRangeAt(0),i=n.cloneRange(),a=ce("div");return i.selectNodeContents(e),i.setEnd(n.startContainer,n.startOffset),a.appendChild(i.cloneContents()),val(a).replace(/\n$/,"").length}return 0}(a.input),r=e.substr(0,i);t=Math.max(r.lastIndexOf("@"),r.lastIndexOf("*"));var s=r.match(/(^|[\s.,:\'\"\u00BB\u00AB;>\)\(]|\#[\w_\.\u0400-\u04FF]+)[@\*]([^,@\*\(\)\?\!\s\n\r \u00A0]*)$/);s&&"."!==s[2].substr(-1)&&(n=s[2])}!1===n&&delete a.ignoredTerm,void 0!==a.ignoredTerm&&n==a.ignoredTerm&&(n=!1),a.curValue=e,a.curTerm=n,a.curPos=t,o.text=n,!1===a.curTerm?h():(w(!1,a.curTerm),p(),function(){var e=ge("mhead").offsetHeight,t=o.container.getBoundingClientRect(),n=a.input.offsetHeight,i=parseInt(getStyle(o.scroll,"maxHeight"),10),r=!1;r=hasClass("Mention_openToBottom",o.container)?t.top-n-i<e:t.bottom-i<e,getXY(a.input)[1]>=e+i&&(r=!1),toggleClass("Mention_openToBottom",o.container,r),toggleClass("Mention_openToBottom",o.opts.appendTo,r)}())}function _(e){a.input=e}function p(){C(),document.addEventListener("click",f,!0),addClass("MentionContainer_opened",o.opts.appendTo),show(o.container),function(){if(!r){var e=browser.ipad?"touchend":"click";r=!0,addEvent(window,e,h),addEvent(window,"touchmove",l),nav.onBeforeGo(h)}}()}function h(e){!browser.ipad||c?e&&e.target&&gpeByClass("Mention_inited",e.target)&&!gpeByClass("uMailWrite__button",e.target)&&!hasClass("uMailWrite__button",e.target)||hasClass("MentionContainer_opened",o.opts.appendTo)&&(removeClass("MentionContainer_opened",o.opts.appendTo),hide(o.container),function(){if(r){var e=browser.ipad?"touchend":"click";removeEvent(window,e,h),removeEvent(window,"touchmove",l),nav.onBeforeGo.off(h),r=!1}}()):c=!0}function f(e){var t=e.target;t&&!gpeByClass("Mention_inited",t)&&(e.preventDefault(),e.stopImmediatePropagation(),h()),document.removeEventListener("click",f,!0)}function m(e){void 0===e&&(e={}),o.opts=extend(o.opts,e),v(),w(!0)}function v(){var e,t,n=o.opts.defaultItems,i=o.opts.items,a=[];for(e=0,t=n.length;e<t;++e)a.push(e);for(o.cache[""]=a,e=0,t=i.length;e<t;++e)g(e,i[e])}function g(e,t){var n,i,a,r="",s=o.opts.searchKeys,c={};for(n=0,a=s.length;n<a;++n)r+=" "+(t[s[n]]||"").replace(o.opts.delimeter," ").replace(/<[^>]*>/g,"");for(r+=(parseLat(r)||"")+(parseCyr(r)||""),r=trim(r.toLowerCase()).split(/\s+/),n=0;n<r.length;n++)for(i=1;i<=o.opts.wholeIndex;i++){var l=r[n].substr(0,i);c[l]||(o.index[l]||(o.index[l]=[]),o.index[l].push(e),c[l]=1)}}function b(){var e=trim(o.text);e&&ajax.post(o.opts.url,extend({str:e,mobile:1},o.opts.params||{}),{onDone:function(t){o.cache[e]=A(e).concat(t),y(o.cache[e],!0)}})}function A(e){if(!(e=trim(e.toLowerCase().replace(o.opts.delimeter," "))))return o.cache[""];var t=o.opts.wholeIndex;if(e.length<=t&&-1===e.indexOf(" "))return o.index[e]||[];var n,i,a=0,r="";for(n=0,i=(e=e.split(" ")).length;n<i;++n){var s=e[n].substr(0,t),c=o.index[s];if((!r||!c||c.length<a)&&(a=c?c.length:0,r=s),!a)return[]}var l=[],u=o.opts.searchKeys,d=u.length,_=e.length;for(n=0,i=o.index[r].length;n<i;++n){for(var p=o.index[r][n],h=o.opts.items[p],f=!1,m="",v=0;v<d;++v)m+=" "+(h[u[v]]||"").replace(o.opts.delimeter," ").replace(/<[^>]*>/g,"");m=(m+=(parseLat(m)||"")+(parseCyr(m)||"")).toLowerCase();for(var g=0;g<_;++g)if(-1===m.indexOf(" "+e[g])){f=!0;break}f||l.push(p)}return l}function w(e,t){if(o.cache[""])if(t=void 0!==t?t:trim(o.text),o.lastQ!==t||e){o.lastQ=t,clearTimeout(o.requestTimer);var n=o.cache[t];n?y(n,!0):(y(n=A(t),!o.opts.url),o.opts.url&&(o.requestTimer=setTimeout(b,o.opts.requestWait)))}else p()}function y(e,t){var n=[];o.shown=[];for(var i=e.slice(0,o.opts.maxItems),a=0,r=i.length;a<r;++a){var s=i[a];isArray(s)||(s=o.opts.items[s]),o.shown[s[0]]||(o.shown[s[0]]=s,n.push(O(s)))}o.container&&o.opts.appendTo.contains(o.container)||(o.container=ce("div"),addClass("Mention",o.container),o.scroll=ce("div"),addClass("ScrollView Mention__scroll",o.scroll),Object(vt.e)(o.scroll,{topBanner:!1}),o.opts.appendTo.appendChild(o.container),o.container.appendChild(o.scroll),addEvent(o.scroll,"touchmove",(function(e){hasClass("Mention_noScroll",o.scroll)&&preventEvent(e)}))),toggleClass("Mention_empty",o.container,!n.length),val(o.scroll,n.join("")),o.scroll.scrollTop=0,j(),setTimeout((function(){toggleClass("Mention_noScroll",o.scroll,!function(){if(!browser.ios&&!browser.ipad)return!0;if(o.scroll.scrollHeight>o.scroll.offsetHeight)return!0;return!1}())}),0)}function O(e){var t=e[0],n=e[1],i=e[2],a=e[3],o=e[10];return'<div class="MentionItem" onclick="Mention.onSelect(\''+t+'\');" onmouseover="Mention.onItemHover(this);">\n              <div class="MentionItem__cell">\n                '+(o||'<img src="'+a+'" class="MentionItem__img"/>')+'\n              </div>\n              <div class="MentionItem__cell MentionItem__cell_name">\n                <div class="MentionItem__name">'+n+'</div>\n                <div class="MentionItem__tag">'+i+"</div>\n              </div>\n            </div>"}function k(){var e=geByClass1("MentionItem_active",o.container),t=e.offsetTop;o.scroll.scrollTop=t-e.offsetHeight-parseInt(getStyle(o.scroll,"paddingTop"),10)}function j(e){void 0===e&&(e=null);var t=geByClass("MentionItem",o.container);if(t.length){var n=t.find((function(e){return hasClass("MentionItem_active",e)}));e?(removeClass("MentionItem_active",n),addClass("MentionItem_active",e)):n||addClass("MentionItem_active",t[0])}}function S(e,t){setTimeout((function(){_(t),u()}),0)}var C=Object(d.a)();return{onKeyUp:function(n,i){n.keyCode!==e&&n.keyCode!==t&&(w(!0),_(i),u())},onKeyDown:function(a,r){var s;hasClass("MentionContainer_opened",o.opts.appendTo)&&(a.keyCode===e?(!function(){var e=geByClass1("MentionItem_active",o.container);if(e){var t=domPS(e);t&&(j(t),k())}else j(),k()}(),a.preventDefault()):a.keyCode===t?(!function(){var e=geByClass1("MentionItem_active",o.container);if(e){var t=domNS(e);t&&(j(t),k())}else j(),k()}(),a.preventDefault()):a.keyCode===n?(s=geByClass1("MentionItem_active",o.container))&&(s.click(),1)&&a.preventDefault():a.keyCode===i&&(h(),a.preventDefault()))},onFocus:S,onClick:S,onSelect:function(e){var t=o.shown[e];t&&function(e){if(!e)return!1;var t,n=e[2].replace("@",""),i=a.curValue.substr(0,a.curPos),r=a.curValue.substr(a.curPos),s=!!i.match(/\#[\w_\.\u0400-\u04FF]+$/i);o.opts.preferDomain&&e[9]&&(s=!0);s||(t=replaceEntities(e[8]||e[1]));var c=new RegExp("^(@|\\*)"+escapeRE(a.curTerm)+"(?:\\s+\\((?:(.*?)\\))?\\s*)?","");r=r.replace(c,(function(e,i,a){var o=i+n+" ";return s||(o+="("+t.replace(/[\(\)\]\[]/g,"")+") "),o})),s||!i||i.match(/[\.\(\)\?\!\s\n\r\'\"\u00BB\u00AB \u00A0]$/)||(r=" "+r);h(),val(a.input,i+r),elfocus(a.input),o.opts.afterInsert&&o.opts.afterInsert(a.input)}(t),h()},onItemHover:function(e){j(e)},onOpen:C,init:function(e){void 0===e&&(e={}),s(),o.opts=extend({appendTo:document.body,url:"hints",params:{act:"a_json_friends",from:"composer"},delimeter:/[\s\(\)\.,\-]+/g,requestWait:300,wholeIndex:2,maxItems:51,searchKeys:[1,4],preferDomain:!1,defaultItems:[],items:[],afterInsert:function(){}},e),addClass("Mention_inited",o.opts.appendTo),o.scroll&&removeClass("Mention_noScroll",o.scroll),v()},update:m,addItems:function(e){if(o.opts.defaultItems){e=o.opts.defaultItems.concat(e);var t={};e.filter((function(e){return!t[e[0]]&&(t[e[0]]=!0,!0)})),m({defaultItems:e,items:e})}}}}();window.Mention=w_;n("OGWK"),n("ciqL");var y_={cachedProgress:{}},O_={init:function(e,t){return void 0===e&&(e=Object(o.mc)()),void 0===t&&(t=20),this.radius=t,{component:this._getLoader(e,y_.cachedProgress[e]),id:e}},update:function(e,t){var n=$('[data-loader-id="'+e+'"] circle');if(n){var i=this.radius,a=Math.PI*(2*i);y_.cachedProgress[e]=t;var o=(100-Math.max(5,t))/100*a;n.setAttribute("stroke-dashoffset",o)}},ready:function(e){var t=$('[data-loader-id="'+e+'"]');re(t)},_getLoader:function(e,t){void 0===t&&(t=0);var n=this.radius,i=Math.PI*(2*n);return{class:"Loader",inner:[{class:"Loader__progress","data-loader-id":e,inner:{tag:"svg",viewPort:"0 0 100 100",inner:{tag:"circle",r:n,cx:"30",cy:"30","stroke-dashoffset":(100-Math.max(5,t))/100*i,"stroke-dasharray":i}}}]}}},k_=(n("tqja"),n("aiw/")),j_=function(){function e(){window.isCustomScroll&&(document.body.classList.contains("vk__page_mail")||vt.d())}return{init:function(){if(window.isCustomScroll&&!document.body.classList.contains("vk__page_mail")){var t=ge("mcont");t&&t.classList.contains("ScrollView")?vt.b():e(),k_.b()}},restore:e}}();onDOMReady((function(){j_.init(),page.onChange((function(){j_.init()}))})),window.ContentScrollView=j_;var S_,C_,E_,T_,I_,M_=!1,P_=Object(o.gc)(),x_=56,L_=!1,R_=!1,B_=[];function N_(e){void 0===e&&(e=V_());var t=document.body;t&&"fixed"===Object(o.Z)(t,"position")||e.classList.remove("basis__header_hidden")}function D_(){var e=Object(o.gc)();if(S_){U_(S_,e);var t,n=Object(o.M)("mcont");if(n){var i=$(".BottomMenu__updateButton"),a=Math.max(n.scrollHeight,parseInt(Object(o.Z)(n,"height"),10));if(R_&&e)return;if(Math.abs(P_-e)<=x_)return;S_.classList.contains("basis__header_nohide")||(e>P_+20&&e>x_?(void 0===(t=S_)&&(t=V_()),t.classList.add("basis__header_hidden"),i&&i.classList.add("BottomMenu__updateButton_offset"),R_=!0,setTimeout((function(){R_=!1}),200)):e+window.innerHeight<a&&(N_(S_),i&&i.classList.remove("BottomMenu__updateButton_offset")))}var r=document.body;r&&"fixed"!==Object(o.Z)(r,"position")&&(P_=e)}}function H_(){if(M_&&(clearInterval(I_),Object(o.Kb)("__clear",C_),removeEvent(window,"touchend",E_),B_.forEach((function(e){removeEvent(e,"blur",E_)})),M_=!1),!M_){S_=V_(),x_=parseInt(Object(o.Z)(S_,"height"),10),P_=Object(o.gc)();var e=$(".BottomMenu__updateButton");S_&&(S_.classList.add("basis__header_noTransition"),N_(S_),e&&e.classList.remove("BottomMenu__updateButton_offset")),U_(S_,Object(o.gc)()),C_=function(){L_=!0},E_=function(){clearInterval(T_),T_=setTimeout((function(){var t=Object(o.M)("mcont");if(t){var n=Math.max(t.scrollHeight,parseInt(Object(o.Z)(t,"height"),10));window.innerHeight>n&&n&&(N_(S_),e&&e.classList.remove("BottomMenu__updateButton_offset"))}}),100)},setTimeout((function(){L_=!1}),0),setTimeout((function(){S_&&S_.classList.remove("basis__header_noTransition")}),200),M_||(I_=setInterval((function(){L_&&(D_(),L_=!1)}),250),Object(o.Kb)(C_),addEvent(window,"touchend",E_,{passive:!0}),(B_=Array.from($$("input, textarea")||[])).forEach((function(e){addEvent(e,"blur",E_)})),M_=!0)}}function U_(e,t){e&&e.classList.contains("basis__header_nohide")||(t<=5&&e&&e.classList.contains("basis__header_noshadow")?e.classList.add("basis__header_noshadowAnim"):e&&e.classList.remove("basis__header_noshadowAnim"))}function V_(){return $(".basis__header")}function F_(){(S_=V_())&&(N_(S_),U_(S_,Object(o.gc)()))}onDOMReady((function(){H_(),window.page.onChange(H_),onBodyResize(F_),addEvent(window,"orientationchange",F_),addEvent(window,"blur",F_)}));var W_={URL:"special-event",ACT:"getPopup",start:function(e,t){var n=this;if(t.stopPropagation(),t.preventDefault(),this.id=window.domData(e,"id"),this.id&&(this.sendStats("click"),!this.timeoutHandle)){var i=Number(window.domData(e,"v"))||0;this.duration||(this.duration=Number(window.domData(e,"duration"))||0),this.animationUrl||(this.animationUrl=String(atob(window.domData(e,"animation-url")))||0),this.hasPopup=Boolean(window.domData(e,"popup")),this.duration&&this.animationUrl?!this.animationData||!this.animationData.v||"number"==typeof this.v&&this.v!==i?(this.v=i,Promise.all([this._getAnimation(),this._loadAnimator()]).then((function(e){var t=e[0],i=e[1];n.animationData=JSON.parse(t),n.animator=i,n._play()}))):this._play():this.hasPopup&&this._loadPopupData((function(){return n._showPopup()}))}},_getAnimation:function(){var e=this;return new Promise((function(t){var n=new XMLHttpRequest;n.open("GET",e.animationUrl,!0),n.send(),n.onreadystatechange=function(){4===n.readyState&&t(n.responseText)}}))},_showPopup:function(){window.ImageStatus&&window.ImageStatus.open&&window.ImageStatus.open({user_id:vk.id,special_id:this.id})},_loadPopupData:function(e){},_play:function(){var e=this;if(this.animator){this.frame||(this.frame=document.createElement("div"),this.frame.className="special_event_frame",document.body.appendChild(this.frame)),this.frame.style.display="block";var t=this.animator.loadAnimation({container:this.frame,renderer:"svg",loop:!1,autoplay:!0,animationData:this.animationData});this._loadPopupData(),this.timeoutHandle=setTimeout((function(){t.stop(),t.destroy(),e.frame.style.display="none",e.timeoutHandle=null,e.sendStats("showed"),e._showPopup()}),this.duration)}},init:function(e){var t=e.platform,n=e.animatorLoader;this.platform=t,this._loadAnimator=n},popupAction:function(){this.sendStats("popup_action");var e=curBox();e&&setTimeout((function(){e.hide()}),0)},sendStats:function(e){e&&Object(x.d)({name:"special_event",value:e,keys:[this.platform,this.id]})}};W_.init({platform:"mvk",animatorLoader:function(){return Promise.all([n.e("vendor~lottie"),n.e("mvk-lottie")]).then(n.bind(null,"P3dz")).then((function(e){return e.default}))}}),window.SpecialEvent=W_;var q_={onIframeReady:Object(d.a)("{ is_api, check_transfer_url, on_success_url }"),onPostMessage:Object(d.a)(),onAcceptCookieClick:Object(d.a)()};function z_(e){var t;if(e.origin.match(/^https?:\/\/([a-zA-Z0-9\-\.]+\.)?money\.mail\.ru$/)){try{t=JSON.parse(e.data)}catch(e){t={}}"billing"===t.type&&q_.onPostMessage(t.action,t.action_params)}}q_.onIframeReady((function(){addEvent(window,"message",z_),window.cur.destroy.push((function(){removeEvent(window,"message",z_)}))})),window.BasisMoneyTransfer=q_;var Y_=q_;Y_.onPostMessage((function(e){"waiterStart"!==e&&"3dsPage"!==e||document.activeElement&&document.activeElement.blur()}));Y_.onPostMessage((function(e,t){"resizeFrame"===e&&setStyle(geByClass1("pageMoneyTransfer__iframe"),"height",t.height+40)}));var G_=["touchstart","touchend","touchmove","touchcancel"];Y_.onIframeReady((function(e){e.is_api&&registeredEvents.forEach((function(e){var t=e[0],n=e[1],i=e[2];G_.indexOf(n)>=0&&removeEvent(t,n,i)}))})),Y_.onPostMessage((function(e){"resizeFrame"!==e&&"pageLoad"!==e||window.scrollTop(0)}));var Q_,K_,X_,$_="pageMoneyTransfer_error";Y_.onIframeReady((function(e){Z_(),K_={checkUrl:e.check_transfer_url,onSuccessUrl:e.on_success_url},tp(),window.cur.destroy.push(np)})),Y_.onPostMessage((function(e,t){if("paySuccess"===e)addClass("pageMoneyTransfer_success",geByClass1("pageMoneyTransfer"));else if("payError"===e)np(),addClass($_,geByClass1("pageMoneyTransfer")),val(geByClass1("pageMoneyTransfer__errorText"),t.descr);else if("session_fail"===e){if(J_)return void ep();np(),addClass($_,geByClass1("pageMoneyTransfer")),addClass("pageMoneyTransfer_errorCookie",geByClass1("pageMoneyTransfer"))}else if("putPixel"===e&&"page_load"===t.alias){var n=null;Object(o.xb)()&&(Object(o.sb)()?n="iphone":isAndroidWebView()&&(n="android")),n||(n=""),Object(o.oc)("money_transfers",0,"iframe_loaded",n)}}));var J_=0;function Z_(){var e=geByClass1("pageMoneyTransfer__iframe");if(e){var t=e.contentWindow.document;t.open("text/html","replace"),t.write(attr(e,"data-html")),t.close()}else setTimeout(Z_,2e3)}function ep(){var e=geByClass1("pageMoneyTransfer__iframe");if(e){var t=ce("div",{innerHTML:attr(e,"data-html")});hide(e),geByClass1("pageMoneyTransfer").appendChild(t),ge("payment_form").submit()}else setTimeout(ep,2e3)}function tp(){var e=K_,t=e.checkUrl,n=e.onSuccessUrl;Q_=setInterval((function(){X_=ajax.post(t,{},{onDone:function(e,t,i){if(1===e||3===e){if(np(),i)return void nav.go(i,null,{replace:!0});"/"===n[0]?nav.go(n,null,{replace:!0}):location.href=n}else 2===e&&(np(),addClass($_,geByClass1("pageMoneyTransfer")),val(geByClass1("pageMoneyTransfer__errorText"),t))}})}),2e3)}function np(){Q_&&(clearInterval(Q_),Q_=null),X_&&(X_.abort(),X_=null)}Y_.onAcceptCookieClick((function(){var e=window.open("https://top-fwz1.mail.ru/counter2?id=1;","","width=300; height=300");setTimeout((function(){e.close();var t=geByClass1("pageMoneyTransfer__iframe"),n=clone(t);removeClass($_,geByClass1("pageMoneyTransfer")),replace(n,t);var i=n.contentWindow.document;i.open("text/html","replace"),i.write(attr(t,"data-html")),i.close(),tp()}),500),J_++}));var ip={_onMouseDown:Object(d.a)(),_onCancelClick:Object(d.a)()};window.MoneyTransferButton=ip;var ap=ip;ap._onMouseDown((function(e){for(var t=e;!(!(t=gpeByClass("msg_item",t))||t&&attr(t,"data-id")););t&&(setStyle(t,"-webkit-tap-highlight-color","transparent"),setTimeout((function(){return function(e){setStyle(e,"-webkit-tap-highlight-color","initial")}(t)}),400))}));var op,rp,sp=!1,cp=null;function lp(){cp&&Btn.setLoading(cp,!1),op&&(clearInterval(op),op=null),rp&&(rp.abort(),rp=null)}ap._onCancelClick((function(e,t){var n,i;t?(sp=!1,preventEvent(e),cancelEvent(e),lockButton(t)):(sp=!0,t=e.$btn,e=null,cp=t,Btn.setLoading(t,!0)),n={cancelUrl:attr(t,"href")},i=n.cancelUrl,op=setInterval((function(){rp=ajax.post(i,{_ajax:1},{onDone:function(e){if(1===e){if(sp){var t=arguments[1];return cp.closest(".BtnStack").outerHTML='\n            <div class="notification__tempText">'+t+"</div>\n          ",void lp()}var n=window.scrollTop();nav.go(location.pathname+location.search,null,{replace:!0}),cur.destroy.push((function(){window.scrollTop(n)})),lp()}}})}),1500),window.cur.destroy.push(lp)}));need("attr"),need("geByClass1");var up=need("preventEvent"),dp=need("Popup");window.SendMoneyForm={},SendMoneyForm._onAmountChange=Tp,SendMoneyForm._onSubmit=Lp,SendMoneyForm._onRecommAmountChange=Ip,SendMoneyForm._onAutoAcceptToggle=Rp,SendMoneyForm._onNoAmountToggle=Bp,SendMoneyForm._onChooseCardClick=Ep,SendMoneyForm._onChooseCardCancelClick=Cp,SendMoneyForm._onChooseCardContinueClick=jp,SendMoneyForm._onCardSelect=Sp;var _p="sendMoneyForm_error_min",pp="sendMoneyForm_error_max",hp="sendMoneyForm_addCardVisible",fp="sendMoneyForm_requestedVisible",mp="sendMoneyForm_recommErrorMin",vp="sendMoneyForm_recommErrorMax",gp="sendMoneyForm_noAmount",bp="sendMoneyForm_autoAccept",Ap=".sendMoneyForm",wp=".sendMoneyForm__cardsPopup",yp=".sendMoneyForm__input_amount",Op=".sendMoneyForm__recommAmountInput input",kp=".sendMoneyForm__amountNote_requestAmount";function jp(){var e=Object(z.a)('.Control__native[name="card"]:checked').value,t=Object(z.a)('.Control__native[name="card"]:checked ~ .Control__label').innerText;Object(z.a)('input[name="accept_card"]').value=e,Object(z.a)('input[name="accept_card"]').setAttribute("data-value",e),Object(z.a)(".sendMoneyForm__chooseCard").innerText=t,dp.close()}function Sp(e){var t="-1"===e.value;Object(z.a)(Ap).classList.toggle(hp,t)}function Cp(){dp.close()}function Ep(){var e=Object(z.a)(wp);dp.open(e)}function Tp(e){e||(e=Object(z.a)('input[name="amount"]')),Pp(e),xp(e,6);var t=e.closest(Ap),n="1"===t.getAttribute("data-is-chat-request"),i=Number(e.value),a=Number(t.getAttribute("data-max-amount"));if(t.classList.remove(_p),t.classList.remove(pp),n||i>a&&t.classList.add(pp),n){var o=Mp(),r=Number(t.getAttribute("data-min-amount"))*(o?2:1),s=function(e,t){var n=Object(z.a)('input[name="amount"]').closest(Ap),i=Number(n.getAttribute("data-min-amount")),a=Number(n.getAttribute("data-max-amount")),o=Number(n.getAttribute("data-chat-members-count")),r=Math.ceil(e/(o-(t?0:1)));return Math.min(a,Math.max(i,r))}(i,o);if(Object(z.a)(Op).value=s,t.classList.remove(vp),t.classList.remove(mp),!r||i>=r){var c=o?i-s:i;Object(z.a)(kp).innerText=c,t.classList.add(fp)}else t.classList.remove(fp)}}function Ip(e){Pp(e),xp(e,6);var t=e.closest(Ap),n=Number(e.value),i=t.getAttribute("data-max-amount");t.classList.remove(vp),t.classList.remove(mp),n>i&&t.classList.add(vp)}function Mp(){var e=Object(z.a)('input[name="participiate"]');return e&&e.checked}function Pp(e){e.value=parseInt(e.value,10)||""}function xp(e,t){e.value=e.value.slice(0,t)}function Lp(e,t){var n=t.$(yp).value,i=Number(n),a=Number(t.getAttribute("data-min-amount")),o=Number(t.getAttribute("data-max-amount")),r="1"===t.getAttribute("data-is-chat-request"),s=!1;(t.classList.remove(_p),t.classList.remove(pp),r&&(t.classList.remove(vp),t.classList.remove(mp)),Object(z.a)(Ap).classList.contains(gp))||(i<a*(!!r&&Mp()?2:1)||!n||n!==i.toString()?(t.classList.add(_p),s=!0):i>o&&!r&&(t.classList.add(pp),s=!0));if(r){var c=t.$(Op).value,l=Number(c);l<a||!c||c!==l.toString()?(t.classList.add(mp),s=!0):l>o&&(t.classList.add(vp),s=!0)}if(s)up(e),stopEvent(e);else{up(e),stopEvent(e),t.insertAdjacentHTML("beforeend",'<input id="submit" type="submit" style="display: none" />');var u=Object(z.a)("#submit");ajax.click(u)}}function Rp(e){Object(z.a)(Ap).classList.toggle(bp,e.checked),e.checked?Object(z.a)('input[name="accept_card"]').value=Object(z.a)('input[name="accept_card"]').getAttribute("data-value"):Object(z.a)('input[name="accept_card"]').value=""}function Bp(e){Object(z.a)(Ap).classList.toggle(gp,e.checked)}window.MoneyLink={copy:function(e){var t=e.$btn,n=t.nextElementSibling,i=geByClass1("TextInput__native",gpeByClass("Pad__content",t));copyToClipboard(i)&&(MoneyLink.lastCopyLabel&&hide(MoneyLink.lastCopyLabel),MoneyLink.lastCopyLabel=n,show(n))},genQRCode:function(e,t){var n=arguments,i=this;if(!MoneyLink.qrcode){var a,o,r=s.d.isDarkScheme();t?(a=geByClass1("snippet__icon",geByClass1(t)),o=r?128:80):(a=ge("money_link_qr"),o=200);var c={isShowLogo:!0};r&&(c.isShowBackground=!0,c.backgroundColor="#fff"),val(a,aa.a.createQR(e,o,"qr-code",c));var l=s.d.subscribe((function(){l(),i.genQRCode.apply(i,n)}))}}};var Np=need("Voting"),Dp=function(){var e,t,n=[],i=!1,a=!1,o={};function r(e){return function(){if(!i)return e.apply(this,arguments)}}function s(e){return"A"===e.tagName}function c(){a=n.length>0,toggleClass("vk_messages_actions_visible",document.body,a)}function l(){a&&(o={},each(n,(function(e,t){removeClass("mi_selected",geByClass1("_msg"+t))})),i=!1,n=[],c())}function u(){return!!window.getSelection&&window.getSelection().toString().length>0}function d(e,t,a,o){void 0===o&&(o=!1),i=!0,lockButton(e),im.off(),ajax.click("/mail",{},{url_params:{act:o?"spam":"delete",peer:t,hash:a,ids:n.join(","),community:Hp()}})}function _(){return Boolean(e)}function p(){ge("dialogs")&&_()?addClass("vk_dialogs_forwarding",document.body):e="",l()}return page.onChange(p),mail.onShowDialogsPageFromCache(p),mail.onShowDialogFromCache(p),mail.onShowDialogsPageFromCache(N_),mail.onShowDialogFromCache(N_),mail.onMessagesRepainted((function(){each(n,(function(e,t){addClass("mi_selected",geByClass1("_msg"+t))}))})),{onMessageClick:r((function(e){var t=e.target,i=e.currentTarget,a=s(t)||s(t.parentNode);t.closest("."+Np.cls)?e.stopPropagation():(a&&l(),browser.uc_mini||u()||a||setTimeout((function(){var e,t,a;u()||(e=i,t=attr(e,"data-id"),(a=n.indexOf(t))>=0?(n.splice(a,1),removeClass("mi_selected",e),delete o[t]):(n.push(t),addClass("mi_selected",e),o[t]=hasClass("msg_item_important",e)),c(),function(){var e=window.lang,t=Math.max(n.length,1);val(geByClass1("messagesActions__row_counter"),langNumeric(t,e.mobile_mail_messages_selected).replace("{count}",t))}())}),40))})),remove:r(d),reply:r((function(e,t,a){i=!0,lockButton(e),ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+t,hash:a,object:"mail"+n.join(";"),community:Hp()}})})),forward:r((function(a,o){i=!0,lockButton(a),e="mail"+n.join(";"),t=o;var r=Hp(),s=r?"?community="+r:"";nav.go(location.pathname+s,null,{ignore_cur_process:!0})})),spam:r((function(e,t,n){d(e,t,n,!0)})),close:r(l),toggleImportant:r((function(e){var t,i=n.length,a=0;for(t=0;t<i;t++)if(!o[n[t]]){a=1;break}for(t=0;t<i;t++)toggleClass("msg_item_important",geByClass1("_msg"+n[t]),1===a);ajax.post("/mail",{_ajax:1,act:"mark_important",ids:n,val:a,hash:e}),l()})),hasFwdMessages:_,attachFwdMessages:function(n){ajax.click("/attachments",{},{url_params:{act:"add",target:"mail"+n,hash:t,object:e,community:Hp()}}),e=""}}}();function Hp(){return nav.getQuery("community")}window.MessagesActions=Dp;var Up=n("TxR4"),Vp=n("S6+Z"),Fp=Object.entries(Vp.a).map((function(e){var t=e[0],n=e[1],i=(n[0],n[1]);return[new RegExp("(\\s|^)("+Object(Ii.d)(i)+(i.endsWith(")")||i.endsWith("(")?"+":"")+")([\\s\\.,]|$)","gi"),t]})),Wp={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з","[":"х","]":"ъ",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",";":"ж","'":"э",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",",":"б",".":"ю","/":"."};browser.mac?Wp["\\"]="ё":Wp["`"]="ё";var qp=new RegExp("["+Object(Ii.d)(Object.keys(Wp).join(""))+"]","gi"),zp=function(e){return e.replace(qp,(function(e){return Wp[e]}))},Yp=Object.entries(Wp).reduce((function(e,t){var n=t[0];return e[t[1]]=n,e})),Gp=new RegExp("["+Object(Ii.d)(Object.keys(Yp).join(""))+"]","gi"),Qp=function(e){return e.replace(Gp,(function(e){return Yp[e]}))},Kp=function(){function e(e){this.config={mvk:!1,peerId:null,maxInputLength:256},this.setConfig(e)}var t=e.prototype;return t.setConfig=function(e){Object.assign(this.config,e)},t.getQueries=function(e){if(!e||e.length>this.config.maxInputLength)return[""];var t=window.Wall&&window.Wall.replyNamesRE||window.post&&window.post.replyNamesRE;if(t){var n=t();n&&(e=e.replace(n,""))}e=e.toLowerCase(),e=(e=Fp.reduce((function(e,t){var n=t[0],i=t[1];return e.replace(n,(function(e,t,n,a){return(t||"")+Object(Up.a)(i)+(a||"")}))}),e)).replace(/^[\s\uFEFF\xA0]+|\n+$/g,"");for(var i=[e=Object(Up.b)(e)],a=0,o=[].concat(i);a<o.length;a++){var r=o[a];i.push(zp(r)),i.push(Qp(r))}for(var s=0,c=[].concat(i);s<c.length;s++){var l=c[s];i.push(l.replace(/ё/g,"е")),i.push(l.replace(/е/g,"ё"))}for(var u=0,d=[].concat(i);u<d.length;u++){var _=d[u];i.push(_.replace(/[.!?]+$/,""))}return Object.keys(i.reduce((function(e,t){return e[t]=1,e}),{}))},t.isBotLinkEnabled=function(){return Object(C.b)("stickers_bot_link")&&-184940019!==this.config.peerId},t.getBotLinkUrl=function(){return this.config.mvk?"/mail?act=show&peer=-184940019":"/im?sel=-184940019"},t.getBotLinkImageUrl=function(e,t){return void 0===t&&(t="light"),"/images/stickers_suggestions_bot_"+t+"_"+e+".png"},t.getBotLinkClickStatName=function(){return"stickers_suggestions_bot_link"},t.getBotLinkClickStatKeys=function(){return[]},t.isMoneyTransferEnabled=function(){return Object(C.b)("stickers_money_transfer_suggestions")&&(this.isMoneySendEnabled()||this.isMoneyRequestEnabled())},t.isMoneySendEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.send)},t.isMoneyRequestEnabled=function(){return Boolean(this.config.moneyTransfer&&this.config.moneyTransfer.request)},e}();window.StickersHints=function(){var e,t,n,i,a,r,c=!0,l=0,u=new Kp({mvk:!0});Vp.a;function d(e){var o=window.cur;if(n=geByTag1("textarea",gpeByTag("form",geByClass1("cp_sticker_btn"))),u.setConfig(e),n&&!n.initialized){var r=function(e){var t=n.value.length;t-l>1,l=t,_(),c&&(!function(){g()&&vkNow()-b()>864e5*(2+Math.random())&&p();e=function(e){e*=1e3,g()&&e>b()&&p()},ajax.post("/attachments",{_ajax:1,act:"stickers_hints_change_date"},{onDone:e});var e}(),c=!1)};n.initialized=!0,a=geByClass1("stickersHints"),i=geByClass1("stickersHints__content"),addEvent(n,"focus",_),addEvent(n,"input",r),addEvent(document,"click",h),onBodyResize(f),onBodyResize(w),o.destroy.push((function(){a=null,i=null,n=null,removeEvent(n,"focus",_),removeEvent(n,"input",r),removeEvent(document,"click",h),onBodyResize("__clear",f),onBodyResize("__clear",w),t&&t.destroy(),l=0})),document.activeElement===n&&_()}}function _(){var o;n&&(e&&clearTimeout(e),o=function(o){var r=u.getQueries(n.value).find((function(e){return o.hasOwnProperty(e)})),c=r&&o[r];c?e=setTimeout((function(){var e,n,o=c.userStickers||[],l=c.promotedStickers||[];if(o.length>0||l.length>0){var d=[];each(o,(function(e,t){d.push(m({stickerId:t,query:r,isPromoted:!1}))})),each(l,(function(e,t){d.push(m({stickerId:t,query:r,isPromoted:!0}))})),u.isBotLinkEnabled()&&d.push((e=Object(O.f)(),n="light",s.d.isDarkScheme()&&(n="dark"),Wd.html({inner:[{inner:[{class:"th_img",src:u.getBotLinkImageUrl(e,n),tag:"img"}],class:"sticker_thumb",href:u.getBotLinkUrl(),onclick:"StickersHints.onSuggestionsBotLinkClick();",target:"_blank",tag:"a"}],class:"sticker_item",tag:"div"}))),i.innerHTML=d.join(""),show(a),f(),w(),(t=new Scroller(a)).init()}}),300):(t&&t.destroy(),hide(a))},r?o(r):g()?(r=lsGet("stickers_keywords").keywords,o(r)):v((function(e){r=e,A(e),o(e)})))}function p(){v((function(e){r=e,A(e),_()}))}function h(t){var i=t.target;i===n||gpeByClass(i,"stickersHints")||(hide(a),e&&clearTimeout(e))}function f(){attr(i,"style","")}function m(e){var t=e.isPromoted,n=t?"":"onclick=\"return StickersHints.onStickerThumbClick(event, this, {{stickerId}}, '{{stickerReferrer}}');\"",i=t?'href="/attachments?'+["act=stickers_store","target="+attr(a,"data-target"),"sticker_id={{stickerId}}","from=inline","sticker_referrer={{stickerReferrer}}"].join("&")+'"':"",o=Stickers.getStickerUrl(e.stickerId,Object(O.f)());return('<div class="sticker_item sticker{{stickerId}} {{promotedClass}}">        <a class="sticker_thumb thumb_item" '+i+" "+n+'>          <img class="th_img" src="{{stickerUrl}}" />        </a>      </div>').replace(/{{stickerId}}/g,e.stickerId).replace(/{{stickerUrl}}/g,o).replace("{{promotedClass}}",t?"sticker_item_promoted":"").replace("{{stickerReferrer}}","suggestion_"+e.query)}function v(e){ajax.post("/attachments",{_ajax:1,act:"stickers_hints_keywords"},{onDone:function(t){e(function(e){var t={};return each(e,(function(e,n){var i=n.user_stickers,a=n.promoted_stickers;each(n.words,(function(e,n){t[n]={userStickers:i,promotedStickers:a}}))})),t}(t))}})}function g(){return Boolean(lsGet("stickers_keywords"))}function b(){return lsGet("stickers_keywords").time}function A(e){!e||isEmpty(e)?lsSet("stickers_keywords"):lsSet("stickers_keywords",{keywords:e,time:vkNow()})}function w(){var e=geByClass1("stickersHints__callout");if(e){var t=e.offsetWidth-4,n=t/64,i=n%1;i<.3?n=Math.floor(n)-.5:i>.7&&(n=Math.ceil(n)-.5);var a=Math.round(t/n-8);each(geByClass("sticker_item",e),(function(e,t){var n=geByClass1("sticker_thumb",t),i=geByClass1("th_img",t);setStyle(t,"width",a),setStyle(t,"height",a),setStyle(n,"width",a),setStyle(n,"height",a),setStyle(i,"height",a)}))}}return onDOMReady((function(){lsCheck()&&!geByClass1("vk_stickers_hints_support_no")&&(post.onStickersInit((function(){d()})),geByClass1("stickersHints")&&d())})),ajax.onRedirect((function(e){qs2obj(e.split("?")[1]).invalidate_stickers_hints&&p()})),post.onReplyClick((function(e){var t=window.cur;e,setTimeout(_,10),t.destroy.push((function(){;""}))})),{actualizeVisibility:_,init:d,onStickerThumbClick:function(t,i,o,r){window.isNewMail&&preventEvent(t);var s=gpeByClass("sticker_item",i),c=geByClass1("th_img",s);return attr(s,"style",""),attr(i,"style",""),attr(c,"style",""),hide(a),n.value="",e&&clearTimeout(e),post.sendSticker(i,o,!0,r)},onCheckboxLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_hints_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,p)}),0)},onCheckboxAutoAnimationLabelClick:function(e,t){setTimeout((function(){!function(e,t,n){var i={_ajax:1,act:"stickers_auto_animation_enabled",value:e,hash:t};ajax.post("/attachments",i,{onDone:n})}(val(geByTag1("input",e.parentElement))?1:0,t,p)}),0)},onSuggestionsBotLinkClick:function(){o.oc.apply(void 0,[u.getBotLinkClickStatName(),0].concat(u.getBotLinkClickStatKeys()))},showNewConvoHints:function(){var n=StickersCache.getStickers()[-3];if(n&&n.stickers.length){e&&clearTimeout(e);var o=n.stickers.reduce((function(e,t,n){var i=t[0];return e.push(m({stickerId:i,query:"hi",isPromoted:!1})),e}),[]);i.innerHTML=o.join(""),show(a),f(),w(),(t=new Scroller(a)).init()}}}}();var Xp=need("nav");window.PinnedMsg={onHideClick:befall(),getByMsgId:function(e){return Object(z.a)($p(e))}};var $p=function(e){return'.pinnedMsg[data-msg-id="'+e+'"]'};function Jp(e,t){var n=t.parentNode.getAttribute("data-msg-id");window.isNewMail&&n?(e.preventDefault(),uMessenger.goToMsg(Number(n))):Xp.go(t,e)}PinnedMsg._onClick=Jp,PinnedMsg._onHideClick=PinnedMsg.onHideClick;n("98L6");window.SettingsRow_select={},SettingsRow_select._onChange=th;var Zp=".settingsRow",eh=".settingsRow__description";function th(e,t){!function(e){var t=e.$select,n=e.label;t.closest(Zp).$(eh).textContent=n}(t),_.a.handle(e,t)}n("MzAf"),n("Dh0N"),n("fYoA");var nh=n("PovR");function ih(e){pushNotifier.canBeEnabled().then((function(t){var n=!!e.$control&&geByTag1("input",e.$control);n&&(t?pushNotifier.setupSubscription().then((function(){!function(e){var t=ce("input",{type:"submit"},{display:"none"});e.$control.form.appendChild(t),ajax.click(t),e.$control.form.removeChild(t)}(e)})).catch((function(e){PushNotifier.PUSH_NOTIFIER_BLOCKED_BY_BROWSER_SETTINGS===e?(n.checked=!1,addClass("Popup_open",geByClass1("pageAllowPushPopup"))):n.checked=!1})):n.checked=!1)}))}window.SettingsNotifyPush={},SettingsNotifyPush._onSwitch=ih;var ah=function(){function e(e,t){isObject(t)||(t={items:t}),this.opts=extend({slideClassName:"",onStartChange:!1,onChange:!1,pointsWrap:!1,slideContFn:!1,shownSlidesNum:1},t),this.wrap=ge(e),this.parseItems(t.items),this.init()}var t=e.prototype;return t.parseItems=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];"string"==typeof i&&(i={className:i}),i=extend({html:"",className:"",pos:t.length},i),t.push(i)}this.items=t},t.init=function(){if(addClass("landings_slider_wrap",this.wrap),addEvent(this.wrap,"touchstart mousedown",this.touchStart.bind(this)),this.opts.pointsWrap){var e="";for(var t in this.items)e+='<div class="landings_slider_point"></div>';addClass("landings_slider_points",this.opts.pointsWrap),val(this.opts.pointsWrap,e)}this.changeSlide(0)},t.getTouchX=function(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].pageX:e.pageX},t.getTouchY=function(e){return e.targetTouches&&e.targetTouches.length>0?e.touches[0].pageY:e.pageY},t.touchStart=function(e){var t=this.getTouchX(e),n=this.getTouchY(e),i=this,a=!1,o=!1,r=vkNow(),s=0,c=this.getTouchX(e),l=getW(this.wrap);function u(e){if(!o)if(!a&&Math.abs(i.getTouchY(e)-n)>20)o=!0;else{i.lock&&(a=!0,t=i.getTouchX(e),r=vkNow(),i.changeSlide(i.newPos),cancelEvent(e),i.lock=0,clearTimeout(i.changeTimeout));var u=i.getTouchX(e),d=t-u;(Math.abs(d)>20||a)&&(cancelEvent(e),a||(t=i.getTouchX(e),d=0,a=!0),s=d,c=u,d=-(100+d/l*100),d-=100*i.opts.shownSlidesNum-100,setStyle(i.helper,"transform","translateX("+d+"%)"))}}function d(e){if(removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),!i.lock)if(i.lock=1,Math.abs(s)>50){var n=s<0?"prev":"next",a=Math.abs(c-t)/(r/vkNow());a+=.2*a;var o=100*i.opts.shownSlidesNum;o="next"==n?100+o:o-100,setStyle(i.helper,{transition:"transform "+a+"ms",transform:"translateX(-"+o+"%)"});var l=i.items.length-1,_="prev"==n?i.pos-1:i.pos+1;_<0?_=l:_>l&&(_=0),i.opts.onStartChange&&i.opts.onStartChange(_,n),i.newPos=_,i.changeTimeout=setTimeout((function(){i.lock=0,i.changeSlide(_)}),a)}else setStyle(i.helper,{transition:"transform 200ms",transform:"translateX(-"+100*i.opts.shownSlidesNum+"%)"}),setTimeout((function(){i.lock=0}),200)}removeEvent(bodyNode,"mousemove touchmove",u),removeEvent(bodyNode,"mouseup touchend touchcancel",d),addEvent(bodyNode,"mousemove touchmove",u),addEvent(bodyNode,"mouseup touchend touchcancel",d)},t.makeItem=function(e){var t=this.pos==e.pos?"_active_slide ":"",n=this.opts.slideContFn?this.opts.slideContFn(e):e.html;return'<div class="landings_slider_item '+t+e.className+" "+this.opts.slideClassName+'">'+n+"</div>"},t.getSlidesHtml=function(e){for(var t=this.opts.shownSlidesNum,n=this.items.length-1,i="",a=e,o=0;o<t;o++)--a<0&&(a=n),i=this.makeItem(this.items[a])+i;i+=this.makeItem(this.items[e]),a=e;for(var r=0;r<t;r++)++a>n&&(a=0),i+=this.makeItem(this.items[a]);return i},t.changeSlide=function(e){if(this.pos=Math.max(0,Math.min(e,this.items.length-1)),this.replaceHtml(this.getSlidesHtml(this.pos)),this.opts.onChange&&this.opts.onChange(this.pos),this.opts.pointsWrap){var t=ge(this.opts.pointsWrap);removeClass("selected",geByClass1("selected",t)),addClass("selected",t.children[this.pos])}},t.replaceHtml=function(e){val(this.wrap,'<div class="landings_slider_helper">'+e+"</div>"),this.helper=geByClass1("landings_slider_helper",this.wrap),setStyle(this.helper,"transform","translateX(-"+100*this.opts.shownSlidesNum+"%)")},t.toSlide=function(e,t){this.lock=1;var n=this.makeItem(this.items[this.pos]),i=this.makeItem(this.items[e]);e>this.pos?n+=i:n=i+n,this.replaceHtml(n),t||(t=e>this.pos?"next":"prev");var a="next"==t?0:-100;setStyle(this.helper,"transform","translateX("+a+"%)"),this.opts.onStartChange&&this.opts.onStartChange(e,t);var o=this;clearTimeout(this.toSlideTimer),this.toSlideTimer=setTimeout((function(){a="next"==t?-100:0,setStyle(o.helper,{transition:"transform 200ms",transform:"translateX("+a+"%)"}),o.toSlideTimer=setTimeout((function(){o.lock=0,o.changeSlide(e)}),200)}),10)},e}();window.landingsSlider=ah;n("03kU"),n("4qiT"),n("Tjn9");window.FriendsRecommendedSlider={init:function(){window.cur&&(uh($("."+rh)),cur.destroy.push((function(){sh=null,ch=null,lh=null})))},hideRecommended:function(e,t,n,i){var a=gpeByClass("prettyCard",e);if(!a)return i&&Object(o.j)(i);var r=ph(a),s=domData(a,"code")||domData(r,"code"),c=domData(r,"ref");!function(e){var t=ph(e);remove(e),lh=null,ch=null,dh().length||_h(t)}(a);var l="/friends"+obj2qs({act:"hide_possible",hash:n,id:t,track_code:s,ref:c});return ajax.post(l,{_ajax:1}),i&&Object(o.j)(i)},hideBlock:_h,acceptFriend:function(e,t,n,i){if(hasClass("prettyCard__button_accepted",e)||hasClass(e))return i&&Object(o.j)(i);var a=gpeByClass("prettyCard",e),r=e.querySelector(".prettyCard__buttonText"),s=ph(e),c=domData(a,"code")||domData(s,"code"),l=domData(s,"ref");return addClass(oh,e),Friends.accept(t,n,"user_rec",0,l,c,(function(t,n){var i=t||getLang("mobile_friends_feed_recom_got_notification");removeClass(oh,e),addClass("prettyCard__button_accepted",e),r.innerHTML=i,function(e){var t=function(e){var t=domCA(e,".prettyCard");if(!t)return;return geByClass1("prettyCard__closeButton",t)}(e);addClass("prettyCard__closeButton_hidden",t)}(e);var a=Object(o.tb)(null==n?void 0:n.friend_request_add_sent_message_nudge)?n.friend_request_add_sent_message_nudge:void 0;if(a){var s=a.url,c=a.text;Object(q.g)({text:i,type:q.e,vertical:!0,action:{text:c,url:s,callback:function(e,t){var n=t.id;Object(q.f)(n),Object(o.j)(e),window.nav.go(s)}}})}}),(function(t,n){2===t&&nav.hard_go(n),removeClass(oh,e)})),i&&Object(o.j)(i)},onOpenUser:function(e){var t=gpeByClass("prettyCard",e);if(!t)return;var n=ph(t),i=domData(t,"uid")||"",a=domData(t,"code")||domData(n,"code"),o=domData(n,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_OPEN_USER,{uid:i,ref:o,trackCode:a})},onScroll:throttle(uh,50)};var oh="prettyCard__button_loading",rh="friendsRecommendedSliderWrap",sh=null,ch=null,lh=null;function uh(e){if(!sh&&e&&(sh=ph(e)),sh&&(sh._lastScroll=sh.scrollLeft,!e.ajaxIsRunning)){var t=sh.scrollLeft,n=function(){if(ch)return ch;if(!sh)return{};var e=getSize(sh)[0],t=getX(sh),n=dh(),i=getX(n[0])-t,a=getSize(n[0])[0],o=getX(n[1])-t-i-a,r=Math.floor(a/3);return ch={width:e,itemWidth:a+o,leftMargin:i,part:r,scrollWidth:sh.scrollWidth}}(),i=Math.max(0,Math.floor((t-n.leftMargin)/n.itemWidth)),a=Math.max(0,Math.floor((t+n.width-n.leftMargin)/n.itemWidth));i*n.itemWidth+n.itemWidth-n.part<t&&i++,a*n.itemWidth+n.part>t+n.width&&a--;var o=dh();i=Math.max(0,i),a=Math.min(o.length,a);for(var r=domData(sh,"ref"),s=domData(sh,"code"),c=i;c<=a;c++){var l=o[c];if(l&&!l.viewed){l.viewed=!0;var u=domData(l,"uid")||"",d=domData(l,"code")||s;FriendsStats.log(FriendsStats.EVENTS.EVENT_VIEW_USER,{uid:u,pos:c,ref:r,trackCode:d})}}!e.allLoaded&&t+n.width>=n.scrollWidth/2&&function(e){(e=ph(e)).currentPage=e.currentPage||1;var t=domData(e,"next")||"";if(e.allLoaded||!t||e.currentPage++>=3)return void(e.allLoaded=!0);var n=domData(e,"code")||"",i=domData(e,"ref")||"",a=intval(domData(e,"friend-id")),o="/friends"+obj2qs({act:"recommended_carousel",next:t,ref:i,friendId:a,track_code:n});e.ajaxIsRunning=!0,ajax.post(o,{_ajax:1},{onDone:function(t,n){if(t){var i=geByClass1("Slider__line",e),a=cdf(t);append(a,i),ch=null,lh=null}domData(e,"next",n||null),e.allLoaded=!n,e.ajaxIsRunning=!1},onFail:function(){setTimeout((function(){return e.ajaxIsRunning=!1}),500)}})}(e)}}function dh(){return lh||(sh&&(lh=geByClass("prettyCard",sh)),lh||[])}function _h(e,t){var n=gpeByClass(rh,e);if(!n)return t&&Object(o.j)(t);var i=sh;if(!i&&e&&(i=ph(n)),i){var a=domData(i,"code"),r=domData(i,"ref");FriendsStats.log(FriendsStats.EVENTS.EVENT_HIDE_BLOCK,{ref:r,trackCode:a})}if(remove(n)){var s=nav.getQuery();delete s.recs,nav.go(location.pathname+obj2qs(s),!1,{replace:!0,push_only:!0})}return t&&Object(o.j)(t)}function ph(e){var t;return hasClass(e,"Slider__scroll")?t=e:(t=geByClass1("Slider__scroll",e))||(t=gpeByClass("Slider__scroll",e)),t}n("w1QQ"),n("DVnk"),n("cLcH"),n("uo4j"),n("Fhlr");window.groupInvitationClick=function(e,t){var n=t.$btn,i=n.getAttribute("href");(n.nextElementSibling||n.previousElementSibling).remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n    <div class="notification__tempText">'+e+"</div>\n  "},window.apiCallAction=function(e,t,n,i,a,o,r){var s=r.$btn,c=s.getAttribute("href"),l=s.nextElementSibling||s.previousElementSibling,u=t?'<span class="notification__tempIcon '+t+'Icon"></span>':"";i&&!confirm(i)||(Kt.a.setLoading(s,!0),ajax.post(c,{_ajax:1},{onDone:function(){Kt.a.setLoading(s,!1),l&&l.remove(),s.closest(".BtnStack").outerHTML='<div class="notification__tempText">'+u+e+"</div>"}}))},window.NotifierPage={notifyMarkAsViewed:function(e){ajax.post("feed.php",{_ajax:1,section:"notifications",hash:e,action:"mark_as_viewed"})}},window.NotifyItem={_onPhotoTagAcceptClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onPhotoTagDeclineClick:function(e,t,n){var i=n.$btn,a=i.getAttribute("href");i.nextElementSibling||i.previousElementSibling;ajax.post(a,{_ajax:1},{onDone:function(){}}),i.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+t+"</div>\n    "},_onHideClick:function(e,t,n,i){e.preventDefault();var a=e.target.getAttribute("href"),o=a+"&action=hide",r=a+"&action=restore",s=!n||confirm(n);ContextMenu.close(),s&&ajax.post(o,{_ajax:1},{onDone:function(){var e="nid"+i,n=document.getElementById(e),a=n.closest(".notificationList__items")||n.closest(".notificationList"),o=a.closest(".notificationList");if(hide(n),NotifyItem._onBodyScroll(),o.classList.contains("notificationList_type_unread")){var s=o.$(".Pad__title"),c=parseInt(s.innerText,10)-1;s.innerText=langNumeric(c,lang.mobile_notifications_new)}var l=!0;each(geByClass("notification",a),(function(e,t){isVisible(t)&&(l=!1)})),l&&o.classList.add("Pad_empty");var u=window.Snackbar;u&&u.init&&u.init({text:t,action:{url:r,text:lang.mobile_notifications_restore,callback:["NotifyItem._onRestoreClick","event",e]}})}})},_onRestoreClick:function(e,t,n){var i=n.id,a=n.url;e.preventDefault();var o=ge(t);ajax.post(a,{_ajax:1},{onDone:function(){ge(t).style.display="",Snackbar.close(i);var e=o.closest(".notificationList__items")||o.closest(".notificationList"),n=e.closest(".notificationList");if(n.classList.contains("notificationList_type_unread")){var a=n.$(".Pad__title"),r=parseInt(a.innerText,10)+1;a.innerText=langNumeric(r,lang.mobile_notifications_new)}var s=!0;each(geByClass("notification",e),(function(e,t){isVisible(t)&&(s=!1)})),s||n.classList.remove("Pad_empty")}})},_onBodyScroll:function(){$$(".notification_actionsOpen").forEach((function(e){e.classList.remove("notification_actionsOpen")})),window.removeEventListener("scroll",NotifyItem._onBodyScroll)},_onActionTriggerClick:function(e){window.addEventListener("scroll",NotifyItem._onBodyScroll);var t=e.closest(".notification");t.classList.remove("notification_reverse"),t.classList.toggle("notification_actionsOpen"),$$(".notification_actionsOpen").forEach((function(e){e!==t&&e.classList.remove("notification_actionsOpen")})),t.$(".notification__actionsBubble").getBoundingClientRect().y<50&&t.classList.add("notification_reverse")}},window.FriendRequest={_onAcceptClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "},_onDeclineClick:function(e,t){var n=t.$btn,i=n.getAttribute("href"),a=n.nextElementSibling||n.previousElementSibling;a&&a.remove(),ajax.post(i,{_ajax:1},{onDone:function(){}}),n.closest(".BtnStack").outerHTML='\n      <div class="notification__tempText">'+e+"</div>\n    "}},window.GroupNotify={deleteSource:function(e,t){return ajax.post("feed.php",{gid:e,hash:t,act:"group_notify_delete_source"},{onDone:function(){}}),!1},addSource:function(e,t,n){this.processQuery("group_notify_add_source",e,t,n)},editSource:function(e,t){this.processQuery("group_notify_edit_source",e,t)},processQuery:function(e,t,n,i){var a=$(".group_notify_general .Control_type_switcher input.Control__native").checked?1:0,o={};$$(".group_notify_params .Control_type_switcher input.Control__native").forEach((function(e){o["setting_"+e.name]=e.checked?1:0})),ajax.post("feed.php",Object(F.a)({gid:t,hash:n,unmuted:a,from:i},o,{act:e}),{onDone:function(){}})},gn_grProcess:function(e,t,n,i){ajax.post("club"+e,{act:"user_action",mid:t,hash:n,from:"top_notifier",action:i},{onDone:function(){}})}};var hh=n("H5mD");function fh(e,t,n){if(hh.m){attr(t,"onclick",""),attr(t,"href","vk://vk.com/write"+(2e9+e));var i=new Event("click");return t.dispatchEvent(i),void setTimeout((function(){attr(t,"href","/mail?act=show&chat="+e),t.textContent=n}))}U.a.android?location.href="https://vk.com/write"+(2e9+e):hh.f?(attr(t,"onclick",""),attr(t,"href","/mail?act=show&chat="+e),t.textContent=n,location.href="vk://vk.com/write"+(2e9+e)):location.href="/mail?act=show&chat="+e}window.ChatPreview={join:function(e,t,n){return ajax.post(e,{_ajax:1},{onDone:function(e){fh(e,t,n)}}),!1},open:function(e,t,n){return setTimeout((function(){fh(e,t,n)})),!1}};n("wkhI"),n("DOEQ");var mh=10,vh={setMaxAttach:function(e){mh=e},checkAttaches:function(){vh.toggleEnableAttaches(mediaUpload.getAttachesCount()<mh)},toggleEnableAttaches:function(e){if(void 0===e&&(e=!0),Object(z.a)("#feed_add_form")){Object(z.b)(".cp_attach_btn",Object(z.a)("#feed_add_form")).forEach((function(t){t.classList.toggle("cp_disabled_btn",!e)})),["photo","video","audio","doc","poll"].forEach((function(t){Unfold.toggleItemEnabled(Unfold.getByName("attaches"),t,e)})),["photo","audio"].forEach((function(t){var n=Object(z.a)(".CreatePostButtons__item--"+t);n&&n.classList.toggle("CreatePostButtons__item--disabled",!e)}));var t=Object(z.a)(".CreatePostButtons__item--photo .inline_upload");Object(o.g)(t,"disabled",!e)}}};window.CreatePost=vh;var gh=n("Ogzf");!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var bh="doc",Ah="photo",wh="video",yh="album",Oh="market_album",kh=window.isMVK?200:120,jh=window.isMVK?604:537,Sh=window.isMVK?360:343;function Ch(e,t,n,i){var a=function(e){var t=0;return each(e,(function(e,n){t+=n})),t},o=function(e,t,n){return(t-(e.length-1)*n)/a(e)},r=(i=Rh(i)?i:{}).wide,s=[],c=0,l=[],u=[];each(n,(function(e,t){xh(t.type)&&(l[l.length]=t[t.type]),t.type===wh&&s.push(c),c++}));var d="",_=[],p=l.length;each(l,(function(n,i){var a=Mh(i,e,t);d+=a>1.2?"w":a<.8?"v":"q",_[_.length]=a}));var h,f,m=_.length>0?a(_)/_.length:1,v=5;window.isMVK&&(v=window.innerWidth>=480?6:3);var g=v;i.force?(h=e,f=t):(r?(h=jh,f=Sh):e>=381?(h=381,f=1==p?361:237):(h=337,f=1==p?320:214),e<h&&(h=e,f=t),window.isMVK&&(h=Math.min(jh,window.innerWidth),f=Math.min(Sh,h)));var b=h/f,A=0,w=0;if(1==p){var y={lastColumn:1,lastRow:1,single:1};l[0].thumb?(A=279,w=185):_[0]>=1*b?(A=h,w=Math.min(A/_[0],f)):(w=f,A=Math.min(w*_[0],h));var O=Eh(l[0],A,w,y);!O.unsized&&(O.image.width<A&&O.image.height<=f||O.image.height<w&&O.image.width<=h)&&(A=O.image.width,w=O.image.height,O=Eh(l[0],A,w,y)),u[0]=O}else if(2==p){var k,j;switch(d){case"ww":if(m>1.4*b&&_[1]-_[0]<.2){j=h,k=Math.min(j/_[0],j/_[1],(f-g)/2),u[0]=Eh(l[0],j,k,{lastColumn:1}),u[1]=Eh(l[1],j,k,{lastColumn:1,lastRow:1}),A=h,w=2*k+g;break}case"vv":case"qv":case"vq":case"qq":j=(h-v)/2,k=Math.min(j/_[0],j/_[1],f),u[0]=Eh(l[0],j,k,{lastRow:1}),u[1]=Eh(l[1],j,k,{lastRow:1,lastColumn:1}),A=h,w=k;break;default:var S=intval((h-v)/_[1]/(1/_[0]+1/_[1])),C=h-S-v;k=Math.min(f,S/_[0],C/_[1]),u[0]=Eh(l[0],S,k,{lastRow:1}),u[1]=Eh(l[1],C,k,{lastColumn:1,lastRow:1}),A=h,w=k}}else if(3==p)if((_[0]>1.2*b||m>1.5*b)&&"www"==d){var E,T=h,I=Math.min(T/_[0],.66*(f-g));if(u[0]=Eh(l[0],T,I,{lastColumn:1}),"www"==d){var M=intval(h-v)/2;E=Math.min(f-I-g,M/_[1],M/_[2]),u[1]=Eh(l[1],M,E,{lastRow:1}),u[2]=Eh(l[2],h-M-v,E,{lastColumn:1,lastRow:1})}else{var P=intval((h-v)/_[2]/(1/_[1]+1/_[2])),x=h-P-v;E=Math.min(f-I-g,P/_[2],x/_[1]),u[1]=Eh(l[1],P,E,{lastRow:1}),u[2]=Eh(l[2],P,E,{lastRow:1,lastColumn:1})}A=h,w=I+E+g}else{var L=f,R=intval(Math.min(L*_[0],.75*(h-v)));u[0]=Eh(l[0],R,L,{lastRow:1});var B=_[1]*(f-g)/(_[2]+_[1]),N=f-B-g,D=Math.min(h-R-v,intval(B*_[2]),intval(N*_[1]));u[1]=Eh(l[1],D,N,{lastColumn:1}),u[2]=Eh(l[2],D,B,{lastColumn:1,lastRow:1}),A=R+D+v,w=f}else if(4==p)if((_[0]>1.2*b||m>1.5*b)&&"wwww"==d){var H=h,U=Math.min(H/_[0],.66*(f-g));u[0]=Eh(l[0],H,U,{lastColumn:1});var V=(h-2*v)/(_[1]+_[2]+_[3]),F=intval(V*_[1]),W=intval(V*_[2]),q=H-F-W-2*v;V=Math.min(f-U-g,V),u[1]=Eh(l[1],F,V,{lastRow:1}),u[2]=Eh(l[2],W,V,{lastRow:1}),u[3]=Eh(l[3],q,V,{lastColumn:1,lastRow:1}),A=h,w=U+V+g}else{var z=f,Y=Math.min(z*_[0],.66*(h-v)),G=(f-2*g)/(1/_[1]+1/_[2]+1/_[3]),Q=intval(G/_[1]),K=intval(G/_[2]),X=z-Q-K-2*g;Y+(G=Math.min(h-Y-v,G))+v<h&&z*_[0]>Y&&(Y=Math.min(z*_[0],h-v-G)),u[0]=Eh(l[0],Y,z,{lastRow:1}),u[1]=Eh(l[1],G,Q,{lastColumn:1}),u[2]=Eh(l[2],G,K,{lastColumn:1}),u[3]=Eh(l[3],G,X,{lastColumn:1,lastRow:1}),A=Y+G+v,w=f}else{var $=[],J=0;m>(s.length?1.3:1.1)?each(_,(function(e,t){$[$.length]=Math.max(1,t)})):each(_,(function(e,t){~s.indexOf(J)?$[$.length]=t:$[$.length]=Math.min(1,t),J++}));var Z,ee,te={};for(te[p+""]=[o($,h,v)],Z=1;Z<=p-1;Z++)te[Z+","+(ee=p-Z)]=[o($.slice(0,Z),h,v),o($.slice(Z),h,v)];for(Z=1;Z<=p-2;Z++)for(ee=1;ee<=p-Z-1;ee++)te[Z+","+ee+","+(p-Z-ee)]=[o($.slice(0,Z),h,v),o($.slice(Z,Z+ee),h,v),o($.slice(Z+ee),h,v)];var ne,ie=null,ae=0;for(var oe in te)if(te.hasOwnProperty(oe)){var re=te[oe],se=a(re)+g*(re.length-1),ce=Math.abs(se-f);if(~oe.indexOf(",")){for(var le=oe.split(","),ue=0;ue<le.length;ue++)le[ue]=intval(le[ue]);(le[0]>le[1]||le[2]&&le[1]>le[2])&&(ce+=50,ce*=1.5)}(null===ie||ce<ae)&&(ie=oe,ae=ce,ne=se)}for(var de=Lh(l),_e=Lh($),pe=ie.split(","),he=te[ie],fe=pe.length-1,me=0;me<pe.length;me++){var ve=parseInt(pe[me]),ge=de.splice(0,ve),be=he.shift(),Ae=ge.length-1,we={};fe==me&&(we.lastRow=!0);for(var ye=h,Oe=0;Oe<ge.length;Oe++){var ke=ge[Oe],je=_e.shift(),Se=we,Ce=void 0;Ae==Oe?(Ce=Math.ceil(ye),Se.lastColumn=!0):ye-=(Ce=intval(je*be))+v,u[u.length]=Eh(ke,Ce,be,Se)}}A=h,w=ne}return{width:intval(A),height:intval(w),thumbs:u}}function Eh(e,t,n,i){var a={id:e.id,width:intval(t),height:intval(n),lastColumn:i.lastColumn,lastRow:i.lastRow,single:i.single,image:Th(e,t,n,i.single),unsized:e.unsized,type:e.type,orig:e};return e.title&&void 0!==e.size?extend(a,{title:e.title,size:e.size}):e.title&&void 0!==e.msize?extend(a,{title:e.title,msize:e.msize}):e.type===wh&&e.name&&void 0!==e.name&&extend(a,{name:e.namem}),"number"==typeof e.duration&&(e.duration=formatTime(e.duration)),a.unsized?a.ratio=1:a.ratio=a.image.width/a.image.height,a}function Th(e,t,n,i){if(!e)return{};t=intval(t),n=intval(n);var a,o=window.devicePixelRatio||1;if(e.type===wh||e.type===bh){(e.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach((function(i){e.sizes[i]&&(!a||t*o<=e.sizes[i][1]&&n*o<=e.sizes[i][2])&&(a=e.sizes[i])}))}else{var r=e.thumb?e.thumb.sizes:e.sizes,s=r.x||r[r.length-1],c=s?(s[1]||1)/(s[2]||1):1,l=0;c>t/n?(l=n,c>1&&(l*=c)):(l=t,c<1&&(l/=c)),n*=o,t*=o;var u=!i&&r.o,d="";d=r.temp?"temp":l<75?"s":l<130?"m":u&&r.o&&r.o[1]>=t&&r.o[2]>=n?"o":u&&r.p&&r.p[1]>=t&&r.p[2]>=n?"p":u&&r.q&&r.q[1]>=t&&r.q[2]>=n?"q":u&&r.r&&r.r[1]>=t&&r.r[2]>=n?"r":"x",a=r[d]||[]}return a[1]=intval(a[1]),a[2]=intval(a[2]),a[1]&&a[2]||(e.unsized=!0),{src:a[0],width:a[1],height:a[2]}}function Ih(e,t,n){var i=t,a=n,o=0,r=0;if(!e.vid&&e.image.width&&e.image.height){var s=e.image.width/e.image.height;s<t/n?(e.single&&e.image.width<t&&(t=e.image.width,n=Math.min(n,e.image.height)),(a=(i=t)/s)>n&&(r=-intval((a-n)/2))):(e.single&&e.image.height<n&&(n=e.image.height,t=Math.min(t,e.image.width)),(i=(a=n)*s)>t&&(o=-intval((i-t)/2)))}return{width:i,height:a,marginLeft:o,marginTop:e.orig&&(e.type===Oh||e.type===yh)&&e.single?0:r}}function Mh(e,t,n){var i;switch(e.type){case bh:i=e.ratio;break;case wh:i=e.ratio||1.777;break;case yh:case Oh:i=1.5;break;default:if(e.sizes&&e.sizes.x){var a=e.sizes.x,o=a[1],r=a[2];o&&r&&(i=o/r)}if(e.sizes&&e.sizes.temp){var s=e.sizes.temp,c=s[1],l=s[2];c&&l&&(i=c/l)}}return i||1}function Ph(e,t,n,i){var a=t.split("_"),o=a[0],r=a[1],s=Object(F.a)({owner_id:o,ownerId:o,itemId:r,type:e,remove:n.remove,click:n.click,temp:"temp"in n.sizes},i);switch(e){case bh:s.data={sizes:n.sizes,ratio:n.ratio,label:n.label,href:n.href},s.doc=s.data;break;case Ah:s.data={pid:r,sizes:n.sizes,restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},s.photo=s.data;break;case wh:s.data={vid:r,duration:n.duration,platform:n.platform,play_icon:n.play_icon,preview:n.preview,active_live:n.active_live,restriction:n.restriction,ratio:n.ratio,sizes:n.sizes,name:n.name},s.video=s.data;break;case yh:s.data={aid:r,title:n.title,size:n.size,thumb:{sizes:n.sizes},restrictionBlur:n.restrictionBlur,restrictionGeo:n.restrictionGeo,photoId:n.photoId},s.album=s.data;break;case Oh:s.data={type:Oh,aid:r,title:n.title,msize:n.msize,thumb:{sizes:n.sizes}},s.market_album=s.data}return s.data.type=e,s.data.id=s.temp?e+"temp_"+o:""+e+s.ownerId+"_"+s.itemId,s}function xh(e){return!!~[bh,Ah,wh,yh,Oh].indexOf(e.toString())}function Lh(e,t){var n=Rh(e)||void 0===e.length?{}:[];for(var i in e)(!/webkit/i.test(_ua)||"layerX"!=i&&"layerY"!=i&&"webkitMovementX"!=i&&"webkitMovementY"!=i)&&(t&&"object"==typeof e[i]&&"prototype"!==i&&null!==e[i]?n[i]=Lh(e[i]):n[i]=e[i]);return n}var Rh=function(e){return"[object Object]"===Object.prototype.toString.call(e)};var Bh=n("0DYw"),Nh=n("eLSo"),Dh=n("4/mX"),Hh=n("HbQ2"),Uh=n("Z6iq"),Vh=n("a3n7"),Fh=n("l1SD"),Wh=n("AQO8"),qh=n("QDiA"),zh=n("R3X3"),Yh=n("L3c9"),Gh=function(e){var t;switch(e.iconFilename+(e.canPreview?"":"_grey")+"_44"){case"delete_outline_44":t=Object(Bh.a)();break;case"delete_outline_grey_44":t=Object(Nh.a)();break;case"do_not_disturb_outline_44":t=Object(Dh.a)();break;case"do_not_disturb_outline_grey_44":t=Object(Hh.a)();break;case"hide_outline_44":t=Object(Uh.a)();break;case"info_outline_44":t=Object(Vh.a)();break;case"info_outline_grey_44":t=Object(Fh.a)();break;case"lock_outline_44":t=Object(Wh.a)();break;case"lock_outline_grey_44":t=Object(qh.a)();break;case"recent_outline_44":t=Object(zh.a)();break;case"recent_outline_grey_44":t=Object(Yh.a)()}var n=[{class:"VideoRestriction__boxWrap",inner:[{class:"VideoRestriction__box",inner:[Object(W.a)(t),{class:"VideoRestriction__title",inner:e.title},{class:"VideoRestriction__text",inner:e.text}]}]}];e.thumb&&n.push({class:"VideoRestriction__thumb",style:"background-image: url("+e.thumb+"); height: 100%; width: 100%;"});e.canPlay&&e.button&&n[0].inner[0].inner.push({class:"VideoRestriction__button",inner:e.button.text,onclick:["VideoRestriction.hideDisclaimerAndPlay"]});return n};var Qh={drag:{curEl:null},cachedPhoto:{}};window.ThumbsEdit={initialized:!1,_init:function(){onDOMReady((function(){window.ThumbsEdit.init(!1),page.onChange((function(){window.ThumbsEdit.init(!1,"/wall")}))}))},init:function(e,t){var n=this;if(void 0===t&&(t=nav.path),e||(e=$("#feed_add_form .cp_attached_wrap")),!e||0!==t.indexOf("/wall")&&0!==t.indexOf("/board"))return this.initialized=!1,removeClass(document.body,"te_i"),void(Qh.destroyLongpress&&Qh.destroyLongpress());if(addClass(document.body,"te_i"),!geByClass1("ThumbsEdit",e)){var i=Object(o.l)(_.a.html({class:"ThumbsEdit",style:"width: 100%; height: 100%",id:"ThumbsEdit"})),a=Object(o.l)(_.a.html({class:["ThumbsEdit-wrap"," _preventMenuOpen"],inner:i}));a.appendChild(i),e.insertBefore(a,e.firstChild),Qh=Object(F.a)({},Qh,{previews:[],loaders:{},attachEl:i});var r=this.parsePreviews(Object(o.X)());this.initialized=!0,r.length&&(Qh.previews=r,this.draw(),Object(o.Jb)((function(){return n.draw()})))}},parsePreviews:function(e){return e.map((function(e){return Ph.apply(void 0,e)})).filter((function(e){return xh(e.type)}))},draw:function(){var e=this,t=Qh,n=t.previews,i=t.attachEl,a=n[0]?Mh(n[0]):1.5,o={width:i.parentNode.offsetWidth,height:Math.min(Math.round(i.parentNode.offsetWidth/a),360),wide:!0},r=Ch(o.width,o.height,n,o),s=r.thumbs,c=r.height,l=r.width;Qh=Object(F.a)({},Qh,{thumbs:s,height:c,options:o});var u=document.createDocumentFragment();s.forEach((function(t,n){u.appendChild(e.createThumbEl(t,n))})),this.updateIds();var d=ce("div");d.id="ThumbsEdit-splitter",val(i,""),i.style.width=l+"px",i.parentNode.style.height=c+"px",i.appendChild(u),ge("ThumbsEdit-splitter")||i.parentNode.appendChild(d),mediaUpload.refreshUploadState(),this.updatePhotos()},update:function(e,t){var n=this;if(e=ge(e)){var i=e.id,a=ge(i),r=Qh.thumbs,s=Qh.height,c=Qh,l=c.options,u=c.drag,d=t[0]?Mh(t[0]):1.5,p=l.width,h=l.height;p&&h||(p=e.parentNode.offsetWidth,h=Math.min(Math.round(p/d),360)),l.width=p,l.height=h,l.wide=!0;var f=Ch(p,h,t,l),m=f.thumbs,v=f.height,g=f.width,b=Object(o.l)(_.a.html({class:"ThumbsEdit",style:"width: "+g+"px; height: "+v+"px; position: fixed; left: "+u.wpos[0]+"px; top: "+u.wpos[1]+"px; visibility: hidden"}));m.forEach((function(e,t){b.appendChild(n.createThumbEl(e,t,!0))})),document.body.appendChild(b);var A=this.getCoords(b,u.wpos);re(b),A.forEach((function(e,t){var n=Qh.drag.coords.find((function(t){return t.id===e.id}));if(n){var i=geByClass1("Thumb",n.node),a=$("img",i),s=r[n.index],c=m.find((function(e){return e.id===s.id}));Qh.drag.toIndex!==t&&o.jc.transform(i,1,[0,0]),n.height===e.height&&e.x===n.x&&e.y===n.y&&n.index!==Qh.drag.i||setTimeout((function(){o.jc.animate(i,"margin-left, margin-top, height, width, opacity, transform",{duration:kh+"ms"}),Object(o.jc)(i,{"margin-left":0,"margin-top":0,height:e.height,width:e.width,opacity:1}),o.jc.transform(i,1,[e.x-n.x,e.y-n.y]),o.jc.animate(i.parentNode,"background",{duration:kh+"ms"}),Object(o.jc)(i.parentNode,{func:"ease-in",background:"transparent"});var t=Ih(c,e.width,e.height);a&&(o.jc.animate(a,Object.keys(t).join(),kh+"ms"),Object(o.jc)(a,t))}))}})),s!==v&&setTimeout((function(){[a,a.parentNode].forEach((function(e){o.jc.animate(e,"height",{duration:kh+"ms"}),Object(o.jc)(e,{height:v})}))})),g>=p&&(o.jc.animate(a,"width",{duration:kh+"ms"}),Object(o.jc)(a,{width:g})),setTimeout((function(){Object(o.jc)(a,{width:g}),Qh.thumbs=m,Qh.previews=t,Qh.height=v;var e=document.createDocumentFragment();m.forEach((function(t,i){e.appendChild(n.createThumbEl(t,i))})),a.innerHTML="",a.appendChild(e),Qh.drag.updating=!1,n.updatePhotos()}),kh)}else console.error("empty el to update")},createThumbEl:function(e,t){var n=e.image,i=e.width,a=e.height,r=e.type,s=Ih(e,i,a),c=["Thumb-wrap","Thumb-wrap--"+r],l=0===e.id.indexOf("phototemp_"),u=l||i<=30||a<=60,d=e.orig.restriction;l&&c.push("Thumb-wrap--temp"),e.lastColumn&&c.push("last_column"),e.lastRow&&c.push("last_row");var p=Qh.previews[t],h=null;p.label&&(h=_.a.wrap(p.label));var f=this.getCached(e.id,n.src);this.cachePhoto(e.id,n.src);var m=[{class:d?"VideoRestriction__thumb":"",inner:[{tag:"img",src:(f?f.src:n.src)||"/images/blank.gif",width:""+Math.round(s.width),height:""+Math.round(s.height),style:"margin-left: "+s.marginLeft+"px; margin-top: "+s.marginTop+"px;"}]},{class:"Thumb__overlay",inner:[!u&&{class:"Thumb__overlay-closeBtn",onclick:"ThumbsEdit.remove(null, "+t+")"},h]},{tag:"input",type:"hidden",name:"attach"+(t+1)+"_type",value:r},{tag:"input",type:"hidden",name:"attach"+(t+1),value:e.id.slice(r.length,e.id.length)}];if(l){var v,g=Math.min(Math.min((s.width-24)/2,30),Math.min((s.height-24)/2,30));Qh.loaders[e.id]&&(v=Qh.loaders[e.id]);var b=O_.init(v,g),A=b.component,w=b.id;Qh.loaders[e.id]=w,m.push(A)}var y=["Thumb"];d&&(y.push("VideoRestriction"),y.push("VideoRestriction--onlyIcon"),e.orig.restriction.canPreview&&y.push("VideoRestriction--canPreview"),e.orig.restriction.needBlur&&y.push("VideoRestriction--blur"));var O=Object(o.l)(_.a.html({class:y.join(" "),style:"width: "+Math.round(i)+"px; height: "+Math.round(a)+"px",inner:m})),k=Object(o.l)(_.a.html({class:c.join(" "),style:"width: "+Math.round(i)+"px; height: "+Math.round(a)+"px","data-media":e.id,"data-index":t,"data-upload":p.upload}));if(Qh.destroyLongpress=Object(gh.a)(O,350,this.startDrag.bind(this,O)),addEvent(k,"click",this.showPopup.bind(this)),d){var j=_.a.html(Gh({canPreview:e.orig.restriction.canPreview,iconFilename:e.orig.restriction.icon,title:e.orig.restriction.title}));O.appendChild(Object(o.l)(j))}return k.appendChild(O),k},addTempPreview:function(e){var t;if(Qh.attachEl){var n=this.parsePreviews([e]);(t=Qh.previews).push.apply(t,n),this.draw()}},replaceTemp:function(e,t,n,i){void 0===i&&(i={});var a=Qh.previews.findIndex((function(t){return t.ownerId===e})),o=Qh.previews[a],r=t.split("_").ownerId,s=t.split("_").itemId;o.ownerId=r,o.owner_id=r,o.itemId=s,o.temp=!1,o.upload=e,o.list=n,o.photo.sizes=i,o.photo.id="photo"+t,o.photo.pid=s,o.data=o.photo,O_.ready(Qh.loaders["phototemp_"+e]),this.draw()},onUploadProgress:function(e,t){O_.update(Qh.loaders["phototemp_"+e],t)},preventScroll:function(e){preventEvent(e)},startDrag:function(e,t){if(addEvent(window,"touchmove",this.preventScroll),e.classList.contains("Thumb")&&!e.classList.contains("Thumb--moving")){window.navigator.vibrate&&navigator.vibrate(50),Object(o.jc)(document.body,"overflow","hidden"),Object(o.jc)(document.body,"max-height","100%"),Object(o.jc)(document.body,"user-select","none");var n=this.onDrag.bind(this),i=this.onDrop.bind(this);addEvent(window,"mousemove touchmove",n),addEvent(window,"mouseup touchend touchcancel",i),statlogsValueEvent("mvk_thumb_edit_interaction",""),Qh.drag=Object(F.a)({},Qh.drag,{curEl:e,curIndex:e.parentNode.dataset.index,dragListener:n,dropListener:i});var a=e.offsetWidth>=40&&e.offsetHeight>=80,r=e.parentNode.parentNode,s=$("img",e),c=intval(e.parentNode.getAttribute("data-index")),l=Qh.thumbs[c],u=getXY(r),d=getXY(e.parentNode),_=this.getCoords(r,u);Qh.drag.id=r.id,Qh.drag.i=c,Qh.drag.toIndex=c,Qh.drag.x=(t.pageX||t.detail.pageX)-d[0],Qh.drag.y=(t.pageY||t.detail.pageY)-d[1],Qh.drag.t=l,Qh.drag.w=l.width,Qh.drag.h=l.height,Qh.drag.pos=d,Qh.drag.wpos=u,Qh.drag.crop=Ih(l,l.width,l.height),Qh.drag.coords=_,Qh.drag.needScale=a;var p=a?function(e,t,n,i){n=intval(n),i=intval(i)||n;var a=e,o=t;return e>=t&&e>n?(a=intval(n),o=intval(t/(e/n))):e<t&&t>i&&(o=intval(i),a=intval(e/(t/i))),[a,o]}(l.width,l.height,.9*e.offsetWidth,.9*e.offsetHeight):[l.width,l.height],h=p[0],f=p[1],m=intval((l.width-h)*(browser.android?.5:Qh.drag.x/l.width)),v=intval((l.height-f)*(browser.android?.5:Qh.drag.y/l.height));addClass(e,"Thumb--moving"),Object(o.jc)(e,{zIndex:100}),Object(o.jc)(e.parentNode,{zIndex:100});var g=Ih(l,h,f);Object(o.jc)(e,{opacity:.75,width:h,height:f,marginLeft:m,marginTop:v}),s&&Object(o.jc)(s,g),Qh.drag.state=!0}},onDrag:function(e){var t=Qh.drag.curEl;if(e.touches&&e.touches.length>1)return this.drop();var n=this._getClickCoord(e),i=n.x,a=n.y,r=Qh.drag,s=i-(r.pos[0]+r.x),c=a-(r.pos[1]+r.y);o.jc.transform(t,1,[s,c]);var l=r.wpos;s=r.pos[0]+intval(t.style.marginLeft)+s-l[0],c=r.pos[1]+intval(t.style.marginTop)+c-l[1];var u=s,d=c,_=(t.offsetWidth,t.offsetHeight,r.i),p=!1,h=r.i,f=-1,m=window.innerWidth>=480?6:3,v={};if(r.coords.forEach((function(e,t){if(t!==r.i&&t!==f){e.offsetX=e.node.offsetWidth+m,e.offsetY=e.node.offsetHeight+m;var n=r.coords[t-1],i=r.coords[t+1],a=u+r.x,s=d+r.y,c=e.x+e.offsetX/2,l=e.y+e.offsetY/2,g=e.x+e.offsetX,b=e.y+e.offsetY,A=(n&&n.x===e.x&&n.y!=e.y&&0!=e.y||i&&i.x===e.x&&i.y!=e.y)&&0!=e.x,w=a>=c&&(i&&(a<=i.x+i.offsetX/2&&(i.offsetY===e.offsetY||a<g)||i.y!=e.y)||!i&&u<=g)&&s>e.y&&s<b,y=a<c&&a>=e.x&&(!n||n.y!=e.y&&!(n.x===e.x&&!i))&&s>e.y&&s<b,O=A&&s>=l&&s<b&&a>e.x&&a<g,k=A&&s<l&&s>=e.y&&a>e.x&&a<g;w=w&&!A,y=y&&!A&&!w,(w||y||O||k)&&(p=!0,h=e.index<r.i&&(w||O)?e.index+1:_<e.index&&(k||y)?e.index-1:e.index),h!==r.i?(o.jc.transform(e.node,1,[w?-5:y?5:0,O?-5:k?5:0]),w?(v.side="right",v.toIndex=e.index):y&&(v.side="left"),O?(v.side="down",v.toIndex=e.index):k&&(v.side="up")):o.jc.transform(e.node,1,[0,0]),w&&i&&i.y===e.y&&i.x>e.x&&_>e.index&&(o.jc.transform(e.node,1,[0,0]),o.jc.transform(e.node,1,[0,0]),o.jc.transform(i.node,1,[5,0]),f=t+1,v.side="left",v.toIndex=h),O&&i&&i.x===e.x&&i.y>e.y&&s<=l&&(o.jc.transform(i.node,1,[0,0]),f=t+1),k&&n&&n.x===e.x&&n.y<e.y&&s<=l&&(o.jc.transform(n.node,1,[0,-5]),o.jc.transform(e.node,1,[0,0]),v.side="down",v.toIndex=n.index),h===t&&"number"!=typeof v.toIndex&&(v.toIndex=e.index)}})),v&&(!r.split||r.split.toIndex!==v.toIndex||r.split.side!==v.side)){var g=ge("ThumbsEdit-splitter");if(Object(o.jc)(g,{opacity:0}),r.split=v,"number"==typeof v.toIndex){var b=r.coords[v.toIndex].node,A=3===m;"left"===r.split.side&&Object(o.jc)(g,{left:Math.max(0,b.offsetLeft-(A?0:1)),top:b.offsetTop+8,height:b.offsetHeight-16,width:"2px",opacity:1}),"right"===r.split.side&&Object(o.jc)(g,{left:Math.min(b.offsetLeft+b.offsetWidth-(A?2:1),Qh.options.width-2),top:b.offsetTop+8,height:b.offsetHeight-16,width:"2px",opacity:1}),"up"===r.split.side&&Object(o.jc)(g,{left:b.offsetLeft+8,top:b.offsetTop,height:"2px",width:b.offsetWidth-16,opacity:1}),"down"===r.split.side&&Object(o.jc)(g,{left:b.offsetLeft+8,top:b.offsetTop+b.offsetHeight-1,height:"2px",width:b.offsetWidth-16,opacity:1})}}return r.toIndex=p?h:r.i,cancelEvent(e)},onDrop:function(e){var t=Qh.drag;t.state=!1,t.updating=!0;var n=t.curEl,i=$("img",n),a="touchcancel".split(" ").includes(e.type);if(removeEvent(window,"mousemove touchmove",t.dragListener),removeEvent(window,"mouseup touchend touchcancel",t.dropListener),removeEvent(window,"touchmove",this.preventScroll),document.body.contains(t.curEl)){if(Object(o.jc)(document.body,"overflow",null),Object(o.jc)(document.body,"max-height",null),Object(o.jc)(document.body,"user-select",null),o.jc.transform(n.parentNode,1,[0,0]),t.split)delete t.split,ge("ThumbsEdit-splitter").removeAttribute("style");if(!hasClass(n,"Thumb--moving"))return t.updating=!1,cancelEvent(e);if(a){var r=t.coords[t.toIndex].node;o.jc.transform(r,1,[0,0])}if(t.toIndex===t.i||a){var s=t.crop;o.jc.animate(n,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"},(function(){removeClass(n,"Thumb--moving")})),o.jc.animate(i,"transform, margin-top, margin-left, width, height, opacity",{duration:"100ms"});var c=Qh.thumbs[t.i];o.jc.transform(n,1,[0,0]),Object(o.jc)(n,{"margin-top":0,"margin-left":0,width:c.width,height:c.height,opacity:1,zIndex:null}),Object(o.jc)(n.parentNode,{zIndex:null}),i&&Object(o.jc)(i,s)}else{var l=Qh.previews;l=function(e,t,n){if(n>=e.length)for(var i=n-e.length;1+i--;)e.push(void 0);return e.splice(n,0,e.splice(t,1)[0]),e}(l,t.i,t.toIndex),this.update(t.id,l)}return cancelEvent(e)}},getCoords:function(e,t){var n=[];t=t||getXY(e);var i=Array.from(e.childNodes||[]);return[].concat(i).forEach((function(e,i){var a=getXY(e);n[i]={id:e.getAttribute("data-media"),x:intval(a[0]-t[0]),y:intval(a[1]-t[1]),width:intval(e.offsetWidth),height:intval(e.offsetHeight),index:intval(e.getAttribute("data-index")),node:e}})),n},remove:function(e,t){var n=Qh.previews[t];e&&Un.a.close(e.target),mediaUpload.reset(null,null,n.remove,(function(){Qh.previews=Qh.previews.filter((function(e,n){return n!==t})),ThumbsEdit.draw()}))},showPopup:function(e){var t=e.target;if(!Qh.drag.state&&!t.classList.contains("Thumb--moving")&&!t.classList.contains("Thumb__overlay-closeBtn")){e.cancelable&&cancelEvent(e);var n=t.closest(".Thumb-wrap").getAttribute("data-index"),i=Object(o.l)(_.a.html(this.getPopup(n)));ie.g.open(i,!0)}},getPopup:function(e){var t=Qh.previews[e],n=null;switch(t.type){case"doc":t.is_gif&&(n='\n            Gif.openPopup(null, null, {\n              raw: "'+t.doc.id.slice(3,t.doc.id.length)+'",\n              hasVideo: '+Gif.isMp4Supports()+"\n            });\n            Popup.close(this);\n          ");break;case"photo":n='\n          photo.zopen(null, null, "'+t.data.id.slice(5,t.data.id.length)+'", "'+t.list+'", {\n            hideOverlay: true,\n            single: true,\n          });\n          Popup.close(this);\n        '}var i=Object(ie.b)({inner:getLang("mobile_delete"),onclick:"ThumbsEdit.remove(event, "+e+")"}),a=null;return n&&!t.temp&&(a=Object(ie.b)({inner:getLang("mobile_open"),onclick:""+n})),Object(ie.g)({class:"ThumbsEdit__modal",close:!0,items:[a,i]})},_getClickCoord:function(e){return{x:e.touches?e.touches[0].pageX:e.pageX,y:e.touches?e.touches[0].pageY:e.pageY}},cachePhoto:function(e,t,n){var i=ce("img");if(i.src=t,Qh.cachedPhoto[e]){var a=Qh.cachedPhoto[e].find((function(e){return e.src===t}));a?n&&n(a.src):i.onload=function(){Qh.cachedPhoto[e].push({width:i.width,height:i.height,src:t}),Qh.cachedPhoto[e].sort((function(e,t){return e.width>t.width?-1:e.width<t.width?1:0})),n&&n(t)}}else Qh.cachedPhoto[e]=[]},updatePhotos:function(){var e=this;Qh.thumbs.forEach((function(t){var n=$("[data-media="+t.id+"] img");n.src!==t.image.src&&e.cachePhoto(t.id,t.image.src,(function(e){n.src=e}))}))},getCached:function(e,t){var n=ce("img");return n.src=t,n.complete?t:Qh.cachedPhoto[e]&&0!==Qh.cachedPhoto[e].length?Qh.cachedPhoto[e].find((function(e){var t=e.src,n=ce("img");return n.src=t,n.complete})):null},getThumbsCount:function(){return(Qh.thumbs||[]).length},updateIds:function(){var e=$$(".mr_x_wrap"),t=this.getThumbsCount()+1;e.forEach((function(e,n){var i=$$("input",e),a=t+n;i[0].name="attach"+a+"_type",i[1].name="attach"+a}))}};n("WCKs"),n("XLP4");onDOMReady(Kh),window.page&&page.onChange(Kh);function Kh(){window.pushNotifier&&pushNotifier.canBeEnabled().then((function(e){return e&&PushNotifier.getPermission()===nh.b})).then((function(e){if(e){FeedNotifications.addWebActionAcceptHandler("enable_browser_notifications",Xh),FeedNotifications.addWebActionDeclineHandler("enable_browser_notifications",$h);var t=geByClass1("feedAssistance_pushNotificationsSwitch");if(!t)return;FeedAssistanceStats.registerTrackingCls("feedAssistance_pushNotificationsSwitch"),FeedAssistanceStats.register(t,"feed")}}))}function Xh(e){return pushNotifier.requestPermission().then((function(t){var n,i=!0;return unlockButton(e),t===nh.b?i=!1:(n=t===nh.c?FeedAssistanceStats.EVENTS.SUB_EVENT_ENABLE_PUSH:FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH,Zh(e,n),Jh(),i)}),(function(){return $h(e)}))}function $h(e){return unlockButton(e),Zh(e,FeedAssistanceStats.EVENTS.SUB_EVENT_DECLINE_PUSH),Jh(),!0}function Jh(){var e=geByClass1("feedAssistance_pushNotificationsSwitch");remove(e)}function Zh(e,t){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,e,"m_push_switch",t)})}window.closePostSuggest=function(e,t){return suggestionEvent(e,t,!1),stopEvent(t)},window.suggestionEvent=function(e,t,n){void 0===n&&(n=!1);var i=Object(o.O)("post_suggest");return ajax.post("wall.php",{_ajax:1,act:"suggestion_event",event_type:e,suggest_id:i.getAttribute("data-suggest-id"),not_hide_by_click:intval(n)}),n||Object(o.Vb)(i),stopEvent(t)};n("zRDV");var ef=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},tf=function(){function e(e,t){this.sendLogsTimeout=null,this.sendLogsProcess=!1,this.localStorageKey="recommended_groups",this.logsDataDelimiter="|",this.location=e,this.act=t}return e.prototype.sendLogs=function(){this.sendLogsTimeout&&clearTimeout(this.sendLogsTimeout),this.sendLogsTimeout=setTimeout(this.sendLogsAccept.bind(this),1e4)},e.prototype.sendLogsAccept=function(){var e=this;if(!this.sendLogsProcess){var t=this.getLogs(!0);t.length&&(this.sendLogsProcess=!0,this.clearLogs(),window.ajax.post(this.location,{act:this.act,logs:t},{onDone:function(){e.sendLogsProcess=!1},onFail:function(){return e.restoreLogs(t),e.sendLogsProcess=!1,!0}}))}},e.prototype.restoreLogs=function(e){var t=this,n=this.getLogs(),i=e.map((function(e){return e.split(t.logsDataDelimiter)})),a=ef(ef([],i),n);ui.a.set(this.localStorageKey,a)},e.prototype.getLogs=function(e){var t=this,n=ui.a.get(this.localStorageKey)||[];return e&&(n=n.map((function(e){return e.join(t.logsDataDelimiter)}))),n},e.prototype.addLog=function(e){var t=this.getLogs(),n=e.eventType,i=e.trackCode,a=e.groupId,o=a?[n,i,a]:[n,i];t.push(o),ui.a.set(this.localStorageKey,t),this.sendLogs()},e.prototype.clearLogs=function(){ui.a.remove(this.localStorageKey)},e}(),nf=function(){function e(){this.onScroll=Object(o.sc)(this.onScroll,50)}return e.prototype.init=function(){this.gallery=document.querySelector(".groupsRecommendedSlider"),this.sliderSizes=null,this.allLoaded=!1,this.ajaxIsRunning=!1,this.gallery&&(this.block=document.querySelector(".GroupsRecommendedSlider"),this.sliderScrollNode=this.gallery.querySelector(".Slider__scroll"),this.sliderLineNode=this.gallery.querySelector(".Slider__line"),this.eventLog=new tf("/groups","stats"))},e.prototype.subscribe=function(e,t,n){var i=e.closest(".prettyCard").dataset,a=i.groupId,r=i.trackCode;if(a&&r&&!e.classList.contains("prettyCard__button_accepted"))return this.eventLog.addLog({eventType:"group_subscribed",groupId:a,trackCode:r}),window.ajax.post("/groups",{act:"subscribe_from_recomm_groups",hash:t,oid:-a,track_code:r},{onDone:function(t){e.classList.add("prettyCard__button_accepted"),e.innerHTML=t,e.onclick=null},onFail:function(){return!1},showProgress:function(){Object(o.Cb)(e),e.classList.add("prettyCard__button_loading")},hideProgress:function(){Object(o.xc)(e),e.classList.remove("prettyCard__button_loading")}}),n&&Object(o.j)(n);Object(o.j)(n)},e.prototype.closeGroup=function(e,t,n){var i=e.closest(".prettyCard"),a=i.dataset,r=a.groupId,s=a.trackCode;if(r&&s)return this.eventLog.addLog({eventType:"group_hidden",groupId:r,trackCode:s}),Object(o.Xb)(i),this.slides=null,window.ajax.post("/groups",{act:"hide_recomm_groups_block_group",hash:t,track_code:s,group_id:r}),n&&Object(o.j)(n)},e.prototype.hideBlock=function(){var e=Object(o.v)(this.sliderScrollNode,"code")||"";this.eventLog.addLog({eventType:"block_hidden",trackCode:e}),Object(o.Xb)(this.block)},e.prototype.clickOnGroup=function(e){var t=e.dataset,n=t.groupId,i=t.trackCode;n&&i&&this.eventLog.addLog({trackCode:i,groupId:n,eventType:"group_opened"})},e.prototype.clickOnViewAll=function(){var e=Object(o.v)(this.sliderScrollNode,"code")||"";e&&this.eventLog.addLog({trackCode:e,eventType:"block_expanded"})},e.prototype.viewBlock=function(e){this.eventLog.addLog({trackCode:e,eventType:"block_seen"})},e.prototype.onScroll=function(){if(this.gallery&&this.sliderScrollNode){var e=this.getScrollSizeValues();if(!this.ajaxIsRunning&&e){var t=this.sliderScrollNode.scrollLeft,n=Math.max(0,Math.floor((t-e.leftMargin)/e.itemWidth)),i=Math.max(0,Math.floor((t+e.width-e.leftMargin)/e.itemWidth));n*e.itemWidth+e.itemWidth-e.part<t&&n++,i*e.itemWidth+e.part>t+e.width&&i--;var a=this.getSlides();if(a){n=Math.max(0,n),i=Math.min(a.length,i);for(var r=n;r<=i;r++){var s=a[r];if(s&&!s.viewed){s.viewed=!0;var c=s.dataset,l=c.groupId;(d=c.trackCode)&&l&&this.eventLog.addLog({trackCode:d,groupId:l,eventType:"group_seen"})}}if(!this.allLoaded&&t+e.width>=e.scrollWidth/2){var u=Object(o.v)(this.sliderScrollNode,"next")||"",d=Object(o.v)(this.sliderScrollNode,"code")||"";if(!u)return void(this.allLoaded=!0);this.ajaxIsRunning=!0;var _=this;window.ajax.post("/groups",{act:"recommended_carousel",next:u,track_code:d},{onDone:function(e,t){if(e){var n=window.cdf(e);Object(o.f)(n,_.sliderLineNode),_.sliderSizes=null,_.slides=null}Object(o.v)(_.sliderScrollNode,"next",t||null),_.allLoaded=!t,_.ajaxIsRunning=!1},onFail:function(){return setTimeout((function(){return _.ajaxIsRunning=!1}),500),!1}})}}}}},e.prototype.getScrollSizeValues=function(){var e;if(this.sliderSizes)return this.sliderSizes;var t=this.getSlides(),n=Object(o.Y)(this.sliderScrollNode)[0],i=Object(o.bb)(this.sliderScrollNode),a=Object(o.bb)(t[0])-i,r=Object(o.Y)(t[0])[0],s={width:n,itemWidth:r+(Object(o.bb)(t[1])-i-a-r),leftMargin:a,part:Math.floor(r/3),scrollWidth:null===(e=this.sliderScrollNode)||void 0===e?void 0:e.scrollWidth};return this.sliderSizes=s,this.sliderSizes},e.prototype.getSlides=function(){var e;return this.slides||(this.slides=null===(e=this.gallery)||void 0===e?void 0:e.querySelectorAll(".prettyCard")),this.slides},e}();window.RecommendedGroupsSlider=new nf;n("mPGc"),n("STl5");function af(e,t){return void 0===e&&(e=""),void 0===t&&(t=[]),!!t.find((function(t){return"*"===t[t.length-1]?e.startsWith(t.slice(0,t.length-1)):e===t}))}var of,rf=["/restore","/login","/authorize*","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/page*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function sf(){of&&of.classList.remove($a.class.open)}function cf(){of&&of.classList.add($a.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),Object(o.sb)()||Object(o.nb)()||Object(o.xb)()||(n||(of=Object(o.O)($a.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:nav.path,!/^\/photo/.test(t)&&sf(),af(t,rf)||nav.getQuery("z")?(sf(),setTimeout(sf)):cf())}(null,!1)}));var lf={_onCloseClick:function(e){$a._onCloseClick(e),Object(Wn.b)("remixregbtn",0,0)},show:cf,hide:sf};window.uRegisterFloatBtn=lf;var uf,df=["/restore","/login","/join*","/","/settings","/album*","/terms","/privacy","/payments*","/attachments*","/pages*","/blog*","/about","/privacy","/jobs","/dev","/legal","/data_protection","/safety","/activation*","/licence","/agelimits"];function _f(){uf&&uf.classList.remove($a.class.open)}function pf(){uf&&uf.classList.add($a.class.open)}onDOMReady((function(){!function e(t,n){void 0===n&&(n=!0),n||(uf=Object(o.O)($a.class.btn),window.page.onChange(e.bind(this))),t=t?t.split("?")[0]:fe.a.path,!/^\/photo/.test(t)&&_f(),af(t,df)||fe.a.getQuery("z")?_f():pf()}(null,!1)}));var hf={_onCloseClick:function(e){$a._onCloseClick(e)},show:pf,hide:_f,processOpenInNativeApp:function(e,t,n,i,a){void 0===a&&(a={}),a=a||{},fe.a.onMenuItemClick(n),fe.a.openInNativeApp(i,t,e),Object(o.oc)("utm_open_in_native_app_button","clicked",a.utm_source,a.utm_param,a.utm_medium,a.utm_time)}};window.uOpenInNativeAppFloatBtn=hf;var ff=n("6Ysw");var mf=function(e){return void 0===e&&(e={}),{inner:[{inner:[Object(xi.A)()],class:"Covid19Banner__close",role:"button","aria-label":e.aria_label_close,onClick:["Covid19Banner.close","event","this"],tag:"div"},{inner:[{inner:[Object(W.a)({icon:Object(ff.a)()})],class:"Covid19Banner__icon",tag:"div"},{inner:[{inner:[e.title],class:"Covid19Banner__title",tag:"h4"},{inner:[e.text,{inner:[e.more],class:"Covid19Banner__link",href:e.url,onClick:"event.preventDefault()",tag:"a"}],class:"Covid19Banner__text",tag:"p"}],class:"Covid19Banner__content",tag:"div"}],class:"Covid19Banner__wrapper",tag:"div"}],class:"Covid19Banner",role:"complementary",onClick:["Covid19Banner.open","event",e.url,e.statlogsEventOpen],tag:"div"}};function vf(){Object(o.sc)(gf,66)()}function gf(){var e=Object(z.a)(".Covid19Banner__offset");if(e){var t=Object(z.a)(".Covid19Banner").clientHeight;e.style.height=t+"px"}}onDOMReady((function(){!function(){var e=Object(z.a)(".Covid19Banner");if(e){var t=Object(z.a)(".layout"),n=e.clientHeight,i=(a=n,(o=document.createElement("div")).classList.add("Covid19Banner__offset"),o.style.height=a+"px",o);t.appendChild(i)}var a,o}(),window.addEventListener("resize",vf)}));window.Covid19Banner=mf,Object(o.K)(mf,{open:function(e,t,n){e.preventDefault(),e.stopPropagation(),Object(o.oc)(n),nav.hard_go(t)},close:function(e,t){var n;e.preventDefault(),e.stopPropagation(),V.a.post("/stats?act=covid_19_banner_close"),t.parentElement.remove(),n=Object(z.a)(".Covid19Banner__offset"),window.removeEventListener("resize",vf),n.remove()}});window.ProfileImageModal={open:function(e){void 0===e&&(e={});var t=e,n=t.profilePhotosUrl,i=t.uploadUrl,a=t.baseUrl,r=t.staticUrl,s=t.inputAccept,l=t.ownerId,u=t.ownerName,d=t.newAvatarStoryData,p=Object(C.b)("mvk_new_avatar_crop"),h=Object(ne.f)({id:"profile-photo-modal",close:!0,on_overlay_click:"ProfileImageModal.closeModal(this);",items:[Object(ie.b)({"aria-label":Object(ae.t)("mobile_profile_photo_modal_album"),inner:Object(ae.t)("mobile_profile_photo_modal_album"),onclick:"ProfileImageModal.openAlbum(this, '"+decodeURIComponent(n)+"');"}),Object(ie.b)({"aria-label":Object(ae.t)("mobile_profile_photo_modal_change"),class:"ModalMenu__btn_overflow",inner:[{tag:"input",type:"file",class:"inline_upload","data-upload-url":decodeURIComponent(i)||null,"data-static-url":decodeURIComponent(r)||null,"data-base-url":decodeURIComponent(a)||null,"data-owner-id":l,"data-owner-name":u,"data-new-avatar-story-data":JSON.stringify(d),onclick:p?null:"ownerPhotoUpload.prepareInput(this);",onchange:p?"return OwnerPhotoUpload2.onUploadInputChange(this, event);":"return ownerPhotoUpload.start(this, event);",accept:decodeURIComponent(s)},Object(ae.t)("mobile_profile_photo_modal_change")],onclick:"ProfileImageModal.selectImage(this);"})]});ne.f.open(_.a.elem(h),!0),Object(o.oc)("mvk_profile_image_modal","open");var f=Object(z.a)(".profile_photo_modal_expand");Object(c.a)(f).exitIntent=function(){Object(o.oc)("mvk_profile_image_modal","close"),ne.f.close()}},openAlbum:function(e,t){Object(o.oc)("mvk_profile_image_modal","album"),ne.f.close(e),nav.go(t)},selectImage:function(e){Object(o.oc)("mvk_profile_image_modal","upload"),ne.f.close(e),Object(z.a)(".inline_upload",e).click()},closeModal:function(e){Object(o.oc)("mvk_profile_image_modal","close"),ne.f.close(e)}};var bf=Object(o.Hb)("page"),Af=Object(o.Hb)("audio"),wf=Object(o.Hb)("onDOMReady"),yf=Object(o.Hb)("audioplayer"),Of=Object(o.Hb)("AudioSpecialForYou");function kf(){Sf(),Af.subscribe([Af.events.INIT,Af.events.SELECT,Af.events.PAUSE],Sf),bf.onChange(Sf)}function jf(e){var t=e.$btn;Ef()?yf.playPause():yf.playFirst(null,t),yf.onPlay(Sf),yf.onPause(Sf)}function Sf(){Of.setPlaying(Af.playing()&&Ef())}window.uAudioBlock={},wf(kf),window.uAudioBlock._onSpecialPlayAllClick=jf;var Cf=null;function Ef(){var e=Af.getCurrentPlaylistId();if(!Cf){var t=document.querySelector(window.AudioSpecialForYou.selector);t&&(Cf=t.querySelector(".AudioPlaylistRoot").dataset.playlistId)}return!!Cf&&e===Cf}var Tf=n("9jiJ"),If={_onMorePopupClose:function(e){return this.expand&&this.expand(),ne.f.close(e)},morePopup:function(e,t){var n=parseInt(Object(o.g)(t,"data-owner_id"),10),i=parseInt(Object(o.g)(t,"data-playlist_id"),10),a=Object(o.g)(t,"data-publish_href"),r="1"===Object(o.g)(t,"data-is_followed"),s=Object(o.g)(t,"data-follow_hash"),l=Object(o.g)(t,"data-can_share"),u=s?"/audio?act=follow_playlist&playlist_owner_id="+n+"&playlist_id="+i+"&hash="+s:"";ne.f.open(_.a.elem(Object(ne.f)({id:"more-"+n+"-"+i,on_overlay_click:["return AudioPlaylist._onMorePopupClose","this"],close:!0,onClose:["return AudioPlaylist._onMorePopupClose","this"],items:[s&&n!==window.vk.id&&Object(ne.b)({url:u,class:r?" audioPlaylist__add_added":"",inner:[{inner:r?Object(ae.t)("mobile_playlist_unfollow"):Object(ae.t)("mobile_playlist_follow"),tag:"span",class:"audioPlaylistSnippet__buttonText"}],attrs:{"data-playlist_owner_id":n,"data-playlist_id":i,"data-hash":s,"data-follow_text":Object(ae.t)("mobile_playlist_follow"),"data-unfollow_text":Object(ae.t)("mobile_playlist_unfollow")},onclick:"return AudioPlaylist.followPlaylist(event, this);"}),l&&Object(ne.b)({url:a,inner:Object(ae.t)("mobile_like_publish_title"),onclick:'return AudioPlaylist._onMorePopupClose(this) || nav.go("'+a+'");'})]})),!0),this.expand=Object(c.a)(e.target)},playPause:function(e,t){Object(o.Tb)(e);var n=Object(o.eb)("_audioSnippet",t),i=Object(o.O)("audio_item",n);window.audioplayer.playPause(e,Object(o.g)(i,"data-id")),Object(o.vc)("audioSnippet__playpause_paused",t)},followPlaylist:function(e,t){Object(o.Tb)(e);var n=Object(o.g)(t,"data-playlist_owner_id"),i=Object(o.g)(t,"data-playlist_id"),a=Object(o.g)(t,"data-hash"),r=Object(o.O)("_audioPlaylistsPage__item"+n+"_"+i),s=t.querySelector(".audioPlaylistSnippet__buttonText"),c=Object(o.gb)("audioPlaylist__add_added",t);s&&(s.innerText=c?Object(o.g)(t,"data-follow_text"):Object(o.g)(t,"data-unfollow_text")),Object(o.vc)("audioPlaylistsPage__item_removed",r,c),Object(o.vc)("audioPlaylist__add_added",t),function(e){V.a.post("/audio",{_ajax:1,act:"follow_playlist",playlist_owner_id:Object(o.g)(e,"data-playlist_owner_id"),playlist_id:Object(o.g)(e,"data-playlist_id"),hash:Object(o.g)(e,"data-hash")},{redirectToLoginPage:!0})}(t);for(var l=document.querySelectorAll('button[data-owner_id="'+n+'"][data-playlist_id="'+i+'"][data-follow_hash="'+a+'"]'),u=0;u<l.length;u++)Object(o.g)(l[u],"data-is_followed",c?"false":"true")},tplSearchBlockItem:function(e){return'<div class="audioPlaylists__item">\n              <a href="'+e.href+'" class="audioPlaylists__itemLink al_playlist">'+e.title+'</a>\n              <span class="audioPlaylists__itemCover" style="'+e.thumb_style+'">'+e.grid_covers+'</span>\n              <span class="audioPlaylists__itemTitle">'+e.title+'</span>\n              <span class="audioPlaylists__itemAuthor">'+e.author_name+'</span>\n              <span class="audioPlaylists__itemStats">'+e.short_stats+"</span>\n            </div>"},tplSearchBlock:function(e,t,n,i){return e?'<div class="audioPlaylists">\n                <div class="audioPlaylists__header">\n                  <div class="audioPlaylists__cell">\n                    <div class="audioPlaylists__title">'+n+'</div>\n                  </div>\n                  <div class="audioPlaylists__cell">'+i+'</div>\n                </div>\n                <div class="audioPlaylists__body _preventMenuOpen">\n                  <div class="audioPlaylists__items">\n                    '+e+"\n                  </div>\n                </div>\n              </div>":""},tplSearchListItem:function(e,t){void 0===t&&(t=!1);var n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                  <button class="ai_menu_toggle_button" onclick="AudioPlaylist.morePopup(event, this);" data-owner_id="'+e.owner_id+'" data-playlist_id="'+e.id+'" data-publish_href="'+e.publish_href+'" data-is_followed="'+e.is_followed+'" data-follow_hash="'+e.follow_hash+'" aria-label="'+Object(ae.t)("mobile_more")+'" aria-haspopup="true" aria-expanded="false" aria-controls="more-'+e.owner_id+"-"+e.id+'"></button>\n                </div>\n             </div>\n             '+e.actions;t&&(n='<div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_actions">\n                   <div class="audioPlaylistsPage__menu ai_menu_wrap">\n                     <button class="ai_menu_toggle_button"></button>\n                   </div>\n                 </div>');var i=e.grid_covers;return i||e.thumb_style||(i=_.a.html({class:"audioPlaylistsPage__coverPlaceholder",inner:Object(W.a)(Object(Tf.a)())})),'<div class="audioPlaylistsPage__item _audioPlaylistsPage__item'+e.owner_id+"_"+e.id+'">\n              <div class="audioPlaylistsPage__cell audioPlaylistsPage__cell_link">\n                <a href="'+e.href+'" class="audioPlaylistsPage__itemLink">'+e.title+'</a>\n                <span class="audioPlaylistsPage__container">\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_cover">\n                    <span class="audioPlaylistsPage__cover" style="'+e.thumb_style+'">'+i+'</span>\n                  </span>\n                  <span class="audioPlaylistsPage__cell audioPlaylistsPage__cell_desc">\n                    <span class="audioPlaylistsPage__title">'+e.title+'</span>\n                    <span class="audioPlaylistsPage__author">'+e.author_name+'</span>\n                    <span class="audioPlaylistsPage__stats">'+e.short_stats+"</span>\n                  </span>\n                </span>\n              </div>\n              "+n+"\n            </div>"},tplSearchListNull:function(e){return'<div class="audioPlaylistsPage__notFound">\n              '+e+"\n            </div>"},tplPlaylistsPage:function(e,t){return void 0===t&&(t=""),'<div class="PageBlock">\n              <div class="audioPlaylistsPage">\n                <div class="audioPage__search">\n                  '+t+'\n                </div>\n                <div class="audioPlaylistsPage__list _si_container" id="au_search_playlist_items">\n                  '+e+"\n                </div>\n              </div>\n            </div>"},tplPlayerSearch:function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),Object(o.G)(e),Object(ae.t)("mobile_audio_search_btn");var n=function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),'<div class="audioPage__search">\n              <div class="hp_block">\n                '+e+'\n                <div class="qsearch">\n                  <table class="row_table">\n                    <tr>\n                      <td class="row_table_main_column">\n                        <div class="qs_field_wrap">\n                          <div class="iwrap">\n                            <input id="au_search_field" type="text" class="textfield qs_textfield" name="q" placeholder="'+Object(ae.t)("mobile_audio_search_placeholder_simple")+'">\n                          </div>\n                        </div>\n                      </td>\n                      <td class="row_table_last_column">\n                        '+t+"\n                      </td>\n                    </tr>\n                  </table>\n                </div>\n              </div>\n            </div>"};return t?n():function(e,t,n){return'<form action="/audio" class="qsearch" onsubmit="return cur.au_search.go(event);">'+e(t,n)+"</form>"}(n)},copyValue:function(e,t){var n=Object(o.zc)(e),i=Object(o.M)(t+"_field");Object(o.zc)(i,n),cur&&cur[t]&&cur[t].go();var a=Object(o.P)(".audioPage__tabs .tab_item_cur");a&&Object(o.vc)("tab_item_cur_noactive",a,n)}};window.AudioPlaylist=If;n("eJy5");var Mf=function(e){var t=e.tag,n=t.id===e.current_id?"control_radio_checked":"control_radio";return{href:t.href,class:"Bookmarks__tagsSelectItem",inner:[{class:"Bookmarks__tagsSelectItemTitle",inner:_.a.wrap(t.name)},_.a.wrap(Object(Qa.b)({icon:n}))]}};var Pf=Mf;window.BookmarksFilterListItem=Mf;var xf=function(e){var t=!(!e.tags||!e.tags.length)&&e.tags;return{class:"Owner__tags",inner:t?[{class:"Owner__tags_icon Icon Icon_tagLabel"},t.map((function(e){return{class:"Owner__tag",inner:_.a.wrap(e.name)}}))]:null}};var Lf=xf;window.BookmarksPageItem=xf;var Rf=window.Popup,Bf=window.ActionMenu,Nf=window.attr,Df=window.val,Hf=window.ajax,Uf=window.replace,Vf=window.scrollTop,Ff=window.ceFromString,Wf=window.Btn;window.Bookmarks={hideTagsList:um,showTagsList:function(e,t){void 0===t&&(t=!1);e&&e.stopPropagation();var n=sm(qf),i=mm();if(n.classList.remove("BookmarksPopup__hideCorner"),t){var a=t.closest(Zf),r=vm(Nf(a,"id"));i=i.filter((function(e){return r.includes(e.id)})),n.classList.add("BookmarksPopup__hideCorner")}var s=Object(o.Ub)(nav.params),c=Object.keys(i).reduce((function(e,t){var n=i[t];return e.push(Pf({tag:n,current_id:parseInt(s.tag)})),e}),[]),l=_.a.html(c);Df(n.$(".Popup__scrollContent"),l);var u=Object(z.b)(Xf,n);u&&u.forEach((function(e){Object(o.b)(e,"click",um)}));return!1},hideDeletePopup:dm,showDeletePopup:function(e){var t=sm(zf),n=Nf(e,"data-id"),i=Nf(e,"data-hash"),a=Nf(e,"data-name");return bm(t,{id:n,hash:i}),Df(t.$("["+em+"]"),Object(o.ib)(a)),!1},submitDeleteTag:function(){var e=Am(Array.from(Object(z.b)(zf)).pop()),t=e.id,n=e.hash;Hf.post("/bookmarks",{_ajax:1,act:"tag_delete",id:t,hash:n},{onDone:function(e){rm(e),dm()}})},hideCreatePopup:_m,showCreatePopup:function(e){var t=sm(Yf),n=Nf(e,"data-hash");bm(t,{hash:n});var i=Object(z.a)("[name="+tm+"]",t),a=Object(z.a)(Jf,t),o=Df(i).trim();return Wf.setDisabled(a,!o),!1},submitCreateTag:function(){var e=Array.from(Object(z.b)(Yf)).pop(),t=Array.from(Object(z.b)(Kf)).pop(),n=Am(e).hash,i=Df(e.$("[name="+tm+"]")),a=+!!Object(z.a)(Kf);Hf.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:i,hash:n,id:0,from_settings:a},{onDone:function(e,n){if(a){var i=[];Array.from(t.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){i.push(e.value)})),Df(t,e),i.forEach((function(e){var n=t.$('[name="tag"][type="checkbox"][value="'+e+'"]');n&&(n.checked=!0)}))}else rm(e);!function(e){var t=fm(),n=e[0],i=e[1];t&&t.tags&&t.tags.push({id:n,name:i,order:0})}(n),_m()}})},hideEditPopup:pm,showEditPopup:function(e){var t=sm(Gf),n=Nf(e,"data-id"),i=Nf(e,"data-hash"),a=Nf(e,"data-name")||"",o=t.$("[name="+nm+"]");Df(o,a),bm(t,{id:n,hash:i,name:a});var r=Array.from(Object(z.b)(Jf,t)).pop(),s=Df(o).trim();return Wf.setDisabled(r,!s),!1},submitEditTag:function(){var e=Array.from(Object(z.b)(Gf)).pop(),t=Am(e),n=t.id,i=t.hash,a=Df(e.$("[name="+nm+"]"));Hf.post("/bookmarks",{_ajax:1,act:"tag_edit",tag:a,hash:i,id:n},{onDone:function(e){rm(e),pm()}})},hideSettingsPopup:hm,showSettingsPopup:function(e,t){void 0===t&&(t={});var n,i,a,o=Nf(e,"data-item_id"),r=Nf(e,"data-item_oid"),s=Nf(e,"data-item_type"),c=Nf(e,"data-hash"),l=Nf(e,"data-raw");t.wrap||(n=sm(Qf),i=n.$(Kf),a=vm(l),Df(i,_.a.html({class:"Bookmarks__tagsSettingsLoading"})),bm(n,{id:o,oid:r,type:s,hash:c,itemRaw:l}));return Hf.post("/bookmarks",{_ajax:1,act:"tag_settings",hash:c,item_id:o,item_oid:r,item_type:s,wrap:t.wrap?1:0},{onDone:function(e){if(t.wrap){var u=Ff(e);bm(u=sm(u),{id:o,oid:r,type:s,hash:c,itemRaw:l,needRemove:!0,is_from_snackbar:t.is_from_snackbar})}else Df(i,e),a.forEach((function(e){var t=n.$('[name="tag"][type="checkbox"][value="'+e+'"]');t&&(t.checked=!0)}))}}),!1},submitSettingsTags:function(){var e=Array.from(Object(z.b)(Qf)).pop(),t=Am(e),n=t.id,i=t.oid,a=t.type,o=t.hash,r=t.itemRaw,s=t.is_from_snackbar,c=[];Array.from(e.$$('[name="tag"][type="checkbox"]:checked')||[]).forEach((function(e){c.push(e.value)}));var l=c.join(",");Hf.post("/bookmarks",{_ajax:1,act:"tag_set",hash:o,item_id:n,item_oid:i,item_type:a,tag_ids:l,is_from_snackbar:s},{onDone:function(e){hm();var t=Object(z.a)("#"+r);if(t){var n=Object(z.a)(".BookmarkListItem__tags, .BookmarksItem__tag",t);if(n)Df(n,e);else if(n=Object(z.a)(".Owner__tags",t)){var i=mm(),a=c.map((function(e){return parseInt(e,10)})),o=i.filter((function(e){return a.includes(e.id)})),s=_.a.html(Lf({tags:o}));Df(n.parentNode,s)}Om(r,c,""),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}})},closeAll:function(){um(),dm(),_m(),pm(),hm()},initStore:gm,pushItemsToStore:function(e){var t=fm();t&&(t.items=Object(F.a)({},t.items,{},e))},pushItemToStore:Om,removeFromBookmarkLink:function(e){var t=Nf(e,"data-item_id"),n=Nf(e,"data-item_oid"),i=Nf(e,"data-item_type"),a=Nf(e,"data-hash"),r=Nf(e,"data-raw"),s=Nf(e,"data-link_url"),c=Nf(e,"data-link_title"),l=Nf(e,"data-link_img"),u=Object(z.a)("#"+r);return Bf.closeMenu(),Object(o.a)(u,am),Hf.post("/bookmarks",{_ajax:1,act:"bookmark_remove",hash:a,item_id:t,item_oid:n,item_type:i,link_url:s,link_title:c,link_img:l},{onDone:function(e){ym(r,[am]),Share.setBookmarkState(r,!1),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},addToBookmarkLink:function(e){var t=Nf(e,"data-item_id"),n=Nf(e,"data-item_oid"),i=Nf(e,"data-item_type"),a=Nf(e,"data-hash"),r=Nf(e,"data-raw"),s=Nf(e,"data-link_url"),c=Nf(e,"data-link_title"),l=Nf(e,"data-link_img"),u=Object(z.a)("#"+r);return Bf.closeMenu(),Object(o.Yb)(u,am),Hf.post("/bookmarks",{_ajax:1,act:"bookmark_add",hash:a,item_id:t,item_oid:n,item_type:i,link_url:s,link_title:c,link_img:l},{onDone:function(){var e=wm(r),t=e.indexOf(am);-1!==t&&e.splice(t,1),ym(r,e),Share.setBookmarkState(r,!0),cur&&cur.search_bookmarks&&cur.search_bookmarks.redraw()}}),!1},showSuccessSnack:function(e){var t,n=window.lang,i=Object(o.O)("RepliesField_fixed");i&&(t=Object(o.U)(i)+5);Snackbar.init({type:q.b,text:n.mobile_bookmarks_snackbar_added,bottom:t,action:{url:"/bookmarks",text:n.mobile_bookmarks_snackbar_edit_tags,onclick:"return Bookmarks.showSettingsPopup(this, { wrap: true, is_from_snackbar: 1 });",attrs:Object.keys(e).reduce((function(t,n){return t["data-"+n]=e[n],t}),{})}})},keyupCreateInput:function(e,t){var n=Object(o.eb)("BookmarksPopup",t),i=Object(z.a)(Jf,n),a=Df(t).trim();Wf.setDisabled(i,!a)},openSavedTab:function(e,t){var n=Object(z.a)(".mm_counter",t),i=Object(Wn.a)(om);i&&!n&&(e&&e.preventDefault(),nav.go("/bookmarks?type="+i))},openLikesFeed:function(e){var t=Object(z.a)(".mm_new",e);Object(o.Xb)(t)},getStoreItemDataById:km,getTagsByItemId:jm,renderSearchItem:function(e,t,n,i,a){var r="";if(!i||Object(o.pb)(i))r=n;else{var s=jm(e),c=wm(e);i=JSON.parse(i),s&&(t=s.reduce((function(e,t){return[].concat(e,[t.id])}),[]),i.subtitle=Lf({tags:s})),c&&(i.mix=[].concat(c).join(" ")),i.title=_.a.wrap(a.highlight(i.title)),r=_.a.html(Object(nr.a)(i))}return Om(e,t,n),r}};var qf=".BookmarksPopup__filter",zf=".BookmarksPopup__delete",Yf=".BookmarksPopup__create",Gf=".BookmarksPopup__edit",Qf=".BookmarksPopup__settings",Kf=".Bookmarks__tagsSettings",Xf=".Bookmarks__tagsSelectItem",$f=".basisDefault",Jf=".BookmarksPopup__buttonSubmit",Zf=".BookmarksItem",em="data-deletetagname",tm="createtagname",nm="edittagname",am="BookmarksItem_removed",om="remixblt";function rm(e){var t=Vf(),n=Object(z.a)($f),i=Ff(e);Uf(i,n),Vf(t)}function sm(e){var t;Bf.closeMenu(),t="string"==typeof e?Object(z.a)(e):e,t=Rf.open(t,!0);var n="popup"+Date.now();return Nf(t,"data-popupid",n),t}function cm(e){return Nf(e,"data-popupid")}function lm(e){var t;if(t=!("string"==typeof e)?e:Array.from(Object(z.b)(e)).pop()){Rf.close(t);var n=Am(t),i=n&&n.needRemove;!function(e){var t=cm(e);delete fm().popup[t]}(t),i&&Object(o.Xb)(t)}return!1}function um(){var e=Array.from(Object(z.b)(qf)).pop(),t=Object(z.b)(Xf,e);return t&&t.forEach((function(e){Object(o.Zb)(e,"click",um)})),lm(e)}function dm(){return lm(zf)}function _m(){var e=Array.from(Object(z.b)(Yf)).pop();if(e){var t=e.$("[name="+tm+"]");Df(t,"")}return lm(Yf)}function pm(){var e=Array.from(Object(z.b)(Gf)).pop();if(e){var t=e.$("[name="+nm+"]");Df(t,"")}return lm(Gf)}function hm(){return lm(Qf)}function fm(){return window.store.bookmarks||gm(),window.store.bookmarks}function mm(){var e=fm();return e.tags?e.tags:{}}function vm(e){var t=fm();return t.items[e]?t.items[e][3]:[]}function gm(e){void 0===e&&(e={}),window.store.bookmarks=Object(F.a)({},e,{popup:{}})}function bm(e,t){var n=cm(e);fm().popup[n]=t}function Am(e){var t=cm(e);return fm().popup[t]}function wm(e){var t=fm();return t&&t.items&&t.items[e]&&t.items[e][5]}function ym(e,t){var n=fm();n&&n.items&&n.items[e]&&(n.items[e][5]?n.items[e][5]=[].concat(n.items[e][5],t):n.items[e][5]=[].concat(t))}function Om(e,t,n,i){var a=fm();a&&a.items&&(t=t.map((function(e){return parseInt(e,10)})),a.items[e]?(a.items[e][3]=t,a.items[e][4]=i):a.items[e]=["",n,e,t,i])}function km(e){var t=fm();return t&&t.items&&t.items[e]}function jm(e){var t=km(e),n=mm();if(t&&n){var i=t[3]||[];return n.filter((function(e){return i.includes(e.id)}))}return!1}window.uCloseProfileSwitcher={},window.uCloseProfileSwitcher._onConfirmClick=Cm;var Sm=null;function Cm(e,t){var n=t.checked;fe.a.clear();var i={is_closed:n?"1":"0",_ajax:1};V.a.post(e,i,{onDone:function(){fe.a.reload();var e=window.cur;Sm=Object(o.gc)(),e.destroy.push(Em)}})}function Em(){Object(o.gc)(Sm),requestAnimationFrame((function(){Object(o.gc)(Sm),requestAnimationFrame((function(){Object(o.gc)(Sm)}))}))}var Tm,Im=function(e,t){void 0===t&&(t={});return{inner:[_.a.wrap(e)],class:"CoronaStatus__tooltip CoronaStatus__tooltip--type"+t.id,onclick:["CoronaStatus.open",t],tag:"span"}};window.page.onChange((function(){Tm&&ie.g.close(Tm)}));window.CoronaStatus=Im,Object(ae.m)(Im,{open:function(e){void 0===e&&(e={}),Object(o.j)(),Object(o.oc)("corona_status_stat","show_tooltip");var t=_.a.elem(Object(ie.g)({class:"CoronaStatus",items:[Object(ie.d)(),Object(ie.e)({inner:{class:"CoronaStatus__icon CoronaStatus__icon--type"+e.id}}),Object(ie.f)({inner:_.a.wrap(e.title)}),Object(ie.a)({inner:_.a.wrap(e.text)}),Object(ie.b)({url:"/covid19#utm_source=vk&utm_medium=cpc&utm_campaign=status_tooltip_mvk",theme:"regular",size:"large",isBtn:!0,inner:Object(ae.t)("mobile_special_covid_status_modal_go_button"),onclick:"window.CoronaStatus.sendStat()"})]}));Tm=ie.g.open(t,!0)},sendStat:function(){Object(o.oc)("corona_status_stat","open_app")}});function Mm(e){void 0===e&&(e={});var t=e,n=t.url,i=t.type,a=t.url_x2;if(!n)return"";var o="";return a&&(o=a+" 2x"),{inner:[{inner:[{src:n,srcSet:o,class:"ImageStatus__image ImageStatus__image--"+i,tag:"img"}],class:"ImageStatus__imageFrame",tag:"div"}],class:"ImageStatus__imageWrapper",tag:"div"}}function Pm(e){var t=e.backgrounds,n=void 0===t?{}:t,i=e.themeKey,a="";return n[i]&&n[i]&&(a=n[i]),a?{class:"ImageStatus__background",style:'background-image: url("'+a+'")',tag:"div"}:""}var xm;window.page.onChange((function(){xm&&ie.g.close(xm)})),window.ImageStatus={open:function(e){void 0===e&&(e={}),Object(o.j)();var t=e,n=t.user_id,i=t.special_id,a=_.a.elem(Object(ie.g)({class:"ImageStatus",items:[{class:"ImageStatus__preload",inner:_.a.wrap(Object(Ga.a)())}]}));xm=ie.g.open(a,!0,"image_status");var r=Object(z.a)(".Popup__content",xm);window.ajax.post("/special_event",{act:i?"special_event":"image_status",user_id:n},{onDone:function(e){var t,n=e.status_id,a=e.color,o=void 0===a?{}:a,c=e.backgrounds,l=void 0===c?{}:c;t=s.d.isDarkScheme()?"dark":"light";var u=[Object(ie.d)(),Pm({backgrounds:l,themeKey:t}),Mm(e.image),Object(ie.f)({inner:_.a.wrap(e.title)})];e.description&&u.push(Object(ie.a)({inner:_.a.wrap(e.description)})),e.participants&&u.push(function(e){void 0===e&&(e={});var t=e,n=t.images,i=t.text,a=t.addition;return{inner:[{inner:[n.map((function(e){return{inner:[{src:e,class:"ImageStatus__participantImage",tag:"img"}],class:"ImageStatus__participantWrapper",tag:"div"}})),a?{inner:[{inner:["+"+a],class:"ImageStatus__participantAddition",tag:"div"}],class:"ImageStatus__participantWrapper",tag:"div"}:""],class:"ImageStatus__participantsWrapper",tag:"div"},{inner:[i],class:"ImageStatus__participantsText",tag:"div"}],class:"ImageStatus__participants",tag:"div"}}(e.participants)),(e.buttons||[]).forEach((function(e){u.push(Object(ie.b)({url:e.url,theme:e.type,size:"large",isBtn:!0,inner:e.title,onclick:e.onclick||(i?"window.SpecialEvent && window.SpecialEvent.sendStats('popup_action');":"ImageStatus.sendStat("+n+");"),attrs:{target:e.target||"_blank"}}))})),u.push(function(e){void 0===e&&(e={});var t=e.terms;return t?{inner:[_.a.wrap(t)],class:"ImageStatus__terms",tag:"div"}:""}(e)),Array.from(r.childNodes).forEach((function(e){r.removeChild(e)})),o[t]&&(r.style.backgroundColor="#"+o[t]),r.append(_.a.elem({class:"ImageStatus__inner",inner:u})),i&&window.SpecialEvent?window.SpecialEvent.sendStats("popup_showed"):Object(x.d)({name:"image_status",value:n,keys:["show_popup"]})},onFail:function(){ie.g.close(xm)}})},sendStat:function(e){e&&Object(x.d)({name:"image_status",value:e,keys:["popup_action"]})},removeStatus:function(e,t){return e.preventDefault(),V.a.post("/special_event?act=image_status_remove"),Kt.a.setLoading(t,!0),!1}};var Lm=n("Ubt6"),Rm=n("mIGa"),Bm=function(e){var t=Object(ae.t)("mobile_promo_vkconnect_agreement");return t=(t=t.replace("{link1}",'<a href="'+e.terms_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link1}","</a>")).replace("{link2}",'<a href="'+e.privacy_url+'" target="_blank" class="PromoVKConnect__agreementLink">').replace("{/link2}","</a>"),t=_.a.wrap(t),{inner:[{inner:[Object(W.a)({icon:Object(Rm.a)()}),{inner:[Object(xi.lb)()],href:e.learn_more_url,target:"_blank",class:"PromoVKConnect__help",tag:"a"}],class:"PromoVKConnect__header",tag:"div"},{inner:[Object(ae.t)("mobile_promo_vkconnect_title")],class:"PromoVKConnect__title",tag:"h1"},{inner:[{inner:[{inner:[Object(xi.ob)()],class:"PromoVKConnect__listIcon",tag:"div"},Object(ae.t)("mobile_promo_vkconnect_list1")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[Object(xi.yb)()],class:"PromoVKConnect__listIcon",tag:"div"},Object(ae.t)("mobile_promo_vkconnect_list2")],class:"PromoVKConnect__listItem",tag:"li"},{inner:[{inner:[Object(xi.db)()],class:"PromoVKConnect__listIcon",tag:"div"},Object(ae.t)("mobile_promo_vkconnect_list3")],class:"PromoVKConnect__listItem",tag:"li"}],class:"PromoVKConnect__list",tag:"ul"},{inner:[Object(Kt.a)({inner:[Object(ae.t)("mobile_promo_vkconnect_button")],size:"large",class:"PromoVKConnect__button",onClick:["PromoVKConnect.accept","event","this",e.hash],use_native_onclick:!0}),{inner:[t],class:"PromoVKConnect__agreement",tag:"div"}],class:"PromoVKConnect__footer",tag:"div"}],class:"PromoVKConnect ScrollView",tag:"div"}};var Nm={init:function(e){var t=this;window.onDOMReady((function(){return t.open(e)}))},open:function(e){var t=Object(ne.f)({on_overlay_click:[],class:"PromoVKConnectModal",attached:!0,body:Bm(e)});ne.f.open(Wd.elem(t),!0,"",{swipeDown:!1})},accept:function(e,t,n){var i=this;e.preventDefault(),Kt.a.setLoading(t,!0,"white"),V.a.post("/",{act:"vkconnect_accept",hash:n},{onDone:function(){i.showTooltip(),ne.f.close()},onFail:function(){i.showTooltip(),ne.f.close()}})},showTooltip:function(){var e=Object(z.a)(".BottomMenu__cell:nth-child(5) .BottomMenu__icon"),t=Wd.elem(Object(Lm.a)({pos:"top_right",theme:"accent",inner:Object(ae.t)("mobile_promo_vkconnect_tooltip")}));e.appendChild(t)}};window.PromoVKConnect=Nm;n("jcaV");var Dm={close:function(e,t,n){e.preventDefault();var i=t.closest(".IPadBanner");i&&(i.remove(),V.a.post("/promo",{act:"ipad_close",hash:n,_ajax:1}))},open:function(e){V.a.post("/promo",{act:"ipad_open",hash:e,_ajax:1})}};window.IPadBanner=Dm;var Hm=function(e){void 0===e&&(e={});var t=e.storiesCount?"window.showNarrative("+e.ownerId+", "+e.id+", 0, 'narratives"+e.ownerId+"'); return false;":null;return{inner:[{inner:[{class:"NarrativesBlockItem__coverImage",style:"background-image: url('"+e.coverUrl+"')",tag:"div"}],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[e.title],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem",onClick:t,tag:"div"}};var Um=function(e){void 0===e&&(e={});var t=u.a.class("NarrativesBlock",{empty:e.isEmpty,collapsed:e.isCollapsed}),n=Object(ae.x)(e.hiddenNarrativesCount),i=Object(ae.O)("narratives",{owner_id:e.ownerId}),a=Object(ae.O)("narratives",{act:"create",owner_id:e.ownerId});return e.isEmpty?{inner:[{inner:[{inner:[{inner:[Object(ae.t)("mobile_narratives_block_title")],class:"slim_header_label",tag:"span"},{inner:[Object(xi.F)()],class:"slim_header_rl",tag:"span"}],class:"slim_header slim_header_black",tag:"div"}],class:"NarrativesBlock__header link_header",onClick:["NarrativesBlock.onToggle","event"],tag:"div"},{inner:[Object(Kt.a)({inner:[Object(ae.t)("mobile_narratives_block_create_narrative_label")],theme:"none",url:a,onClick:"return NarrativesBlock.onCreateNarrativeClick("+e.ownerId+", this, event);",use_native_onclick:!0,class:"NarrativesBlock__createBtn",icon:Object(xi.N)()}),{inner:[Object(ae.t)("mobile_narratives_block_empty_description")],class:"NarrativesBlock__emptyPlaceholder",tag:"p"}],class:"NarrativesBlock__content",tag:"div"}],class:t,tag:"div"}:{inner:[{inner:[{inner:[{inner:[Object(ae.t)("mobile_narratives_block_title")],class:"slim_header_label",tag:"span"},{inner:[e.narrativesTotalCount],class:"slim_header_cnt",tag:"span"},{inner:[Object(xi.F)()],class:"slim_header_rl",tag:"span"}],class:"slim_header slim_header_black",tag:"div"}],class:"NarrativesBlock__header link_header",href:i,onClick:"return NarrativesBlock.onHeaderClick("+e.ownerId+", this, event);",rel:"noopener",tag:"a"},Object(ko.a)({inner:[e.isCreateBlockVisible?{inner:[{inner:[Object(xi.x)()],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[Object(ae.t)("mobile_narratives_block_create_narrative_label")],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem NarrativesBlockItem--create",href:a,onClick:"return NarrativesBlock.onCreateNarrativeClick("+e.ownerId+", this, event);",tag:"a"}:null,e.narratives.map((function(e){return Hm(e)})),e.isMoreBlockVisible?{inner:[{inner:["+",n],class:"NarrativesBlockItem__cover",tag:"div"},{inner:[Object(ae.t)("mobile_narratives_block_more_narratives_label")],class:"NarrativesBlockItem__title",tag:"div"}],class:"NarrativesBlockItem NarrativesBlockItem--more",href:i,onClick:"return NarrativesBlock.onShowMoreClick("+e.ownerId+", this, event);",tag:"a"}:null],mix:"NarrativesBlock__content"})],class:t,tag:"div"}};Object.assign(Um,{onToggle:function(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.closest(".NarrativesBlock");if(!n)return n;n.classList.toggle("NarrativesBlock--collapsed")},onCreateNarrativeClick:function(e,t,n){return Object(Be.c)(Be.a.createNarrative,e,0,e>0?Be.b.profile:Be.b.club),window.nav.go(t,n)},onHeaderClick:function(e,t,n){return Object(Be.c)(Be.a.openNarrativeList,e,0,e>0?Be.b.profile:Be.b.club),window.nav.go(t,n)},onShowMoreClick:function(e,t,n){return Object(Be.c)(Be.a.seeMore,e,0,e>0?Be.b.profile:Be.b.club),window.nav.go(t,n)}}),window.NarrativesBlock=Um;var Vm=n("vy0q");window.GroupsMenu={},window.GroupsMenu._onClick=function(e,t,n,i,a){return Object(o.oc)("groups_menu_item_click",e,t,n,i,a),!0};var Fm=function(e){void 0===e&&(e={});var t=null;e.ok_button&&(t=Object(ne.b)({url:e.proceed_url,class:"WarningModal__button",theme:"secondary",size:"large",inner:e.ok_button,onclick:["WarningModal.close","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id,"data-need-reload":e.need_reload_on_accept?1:0}}));return Object(ne.f)({on_overlay_click:"return false;",class:"Popup_open",body:{class:"WarningModal",inner:[{class:"WarningModal__icon",inner:Object(xi.Mb)()},{class:"WarningModal__title",inner:e.title},{class:"WarningModal__text",inner:e.text}]},items:[Object(ne.b)({url:"/groups",class:"WarningModal__button",theme:"regular",size:"large",inner:e.back_button,onclick:["WarningModal.leave","this","event"],attrs:{"data-id":e.id,"data-hash":e.hash,"data-gid":e.gid,"data-uid":e.user_id}}),t]})};window.WarningModal=Fm,Object(o.K)(Fm,{close:function(e,t){t&&t.preventDefault(),ie.g.close(e);var n=V.a.post("/groups",{_ajax:1,act:"hide_warning_notification",notification_id:e.dataset.id,group_id:e.dataset.gid,hash:e.dataset.hash});Number(e.dataset.needReload)&&n.promise.then((function(){return nav.reload()}))},leave:function(e,t){t&&t.preventDefault(),ie.g.close(e);var n=Object(z.a)("#m .header__back");n?n.click():window.history?window.history.back():window.location="/"}}),window.Donut={help:function(e,t){var n=window.lang,i=Object(o.O)("Tooltip",e);if(i)return;return i=_.a.elem(Object(Lm.a)({pos:"left",inner:n.mobile_donut_info_text})),e.appendChild(i),Object(o.j)(t)}};n("hG3N");var Wm=n("z1UI");n("5sv7");var qm=n("svF/");function zm(e){void 0===e&&(e={});var t={inner:[e.icon],class:"SplashScreen__icon",tag:"div"};return Object(Wm.a)({icon_raw:t,title:e.title,text:e.description,action_text:e.action_text,action_url:e.action_url,before:Ym(e),class:"DonutPaymentInfo"})}function Ym(e){return void 0===e&&(e={}),{inner:["form"===e.layout?[{inner:[{inner:[Object(W.a)(Object(qm.a)())],class:"DonutPayment__avatarIcon",tag:"div"}],class:"DonutPayment__avatar",style:"background-image: url("+e.avatar+")",tag:"div"},{inner:[e.title],class:"DonutPayment__title",tag:"h2"},e.description?{inner:[e.description],class:"DonutPayment__description",tag:"span"}:null]:null],class:"DonutPayment__header",tag:"div"}}var Gm=n("4pfz"),Qm=n("pRml"),Km=n("WWoJ"),Xm=n("asMm"),$m={},Jm=Object(Xm.e)();function Zm(e){void 0===e&&(e={});var t=Object(z.a)('[data-section-ref="donut_payment_content"]');if(t){var n=e.type;try{t.innerHTML=_.a.html(zm({icon:e.icon,layout:"info",type:n,title:e.title||Object(o.W)("mobile_donut_payment_info_error"),description:e.description||"",action_text:("success"===n||"error"===n)&&Object(o.W)("mobile_donut_payment_button"),action_url:e.continueButtonURL||window.nav.path}))}catch(e){console.error(e)}}}var ev=function(){Zm({title:Object(o.W)("mobile_donut_payment_info_waiting"),description:Object(o.W)("mobile_donut_payment_info_waiting_text"),type:"loading",icon:{inner:[Object(W.a)({icon:Object(Lt.a)()})],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"}})};function tv(e){var t=e.message,n=Object(Km.b)({inner:[Object(Qm.a)({inner:[t],theme:"error"})],style:{small_paddings:!0}}),i=Object(z.a)('[data-section-ref="donut_payment_form_error"]');i&&(i.innerHTML=_.a.html(n))}var nv=function(){return Zm({title:Object(o.W)("mobile_donut_payment_info_error"),description:Object(o.W)("mobile_donut_payment_info_canceled_text")})};function iv(e){Zm({description:e.description,title:Object(o.W)("mobile_donut_payment_change_amount_changed_title"),continueButtonURL:$m.backURL}),rv(a.RESULT_CHANGE_SUCCESS_OK)}function av(e){void 0===e&&(e=!1),Object(o.vc)("DonutPayment__customAmount--visible",Object(z.a)('[data-section-ref="custom_price_input_container"]'),e)}function ov(e,t,n){b.logEventAction(Object(F.a)({event_type:e,owner_id:$m.ownerId,screen:t||a.UNKNOWN,source:$m.source},n))}function rv(e,t){ov(i.PAYMENT_FORM,e,t)}function sv(){ov(i.PAYMENT_FORM_CLICK_OFFER,a.PAYMENT_START)}var cv={init:function(e){var t=e.backURL,n=e.isCustomPriceVisible,i=e.ownerId,a=e.source,r=e.type,s=e.waitingTimeSec,c=e.successActionUrl;Object(Xm.g)(Jm,cv),$m={backURL:t,ownerId:i,source:a,type:r,waitingTimeSec:s,successActionUrl:c};var l,u=Object(z.a)("#custom_price_input"),d=u&&u.checked;av(n||d),"subscribe"===r&&(l=Object(z.a)('[data-section-ref="donut_payment_external_links"]'))&&Object(o.b)(l,"click",(function(e){Object(o.Gb)(e.target,"a")&&sv()})),Object(Xm.h)(Jm,cv)},onCustomAmountChange:function(e,t){return Object(z.a)("#custom_price_input").checked=!0,va.a.filter("number",e,t)},onLegalExternalLinkClick:sv,onFormSubmit:function(e,t){e.preventDefault();var n=Object(Gm.b)(t),i=Object(Mt.c)(t.action);"subscribe"===$m.type&&function(e,t,n){var i=Jm.id,r=Object(o.rc)(n),s=Object(Xm.f)(Object(o.W)("mobile_donut_payment_info_waiting"));Kt.a.setLoading(r,!0);var c=window.ajax.post(e.requestUri,t);Object(Xm.i)(c),c.promise.then((function(e){var n=e.json;if(!e.skip){if(i!==Jm.id)throw new Error;Kt.a.setLoading(r,!1);var c=n.data[0],l=Object(Mt.b)(window.nav.path,{act:"donut_payment_check",hash:t.hash});Object(Xm.k)(Object(F.a)({sessionIdCurrent:Jm.id,paymentURL:c,paymentWindow:s,getIsSuccess:function(){var e=window.ajax.post(l,{});return Object(Xm.i)(e),e.promise.then((function(e){var t,n=e.json;if(!e.skip){if(i!==Jm.id)throw new Error;if(!n)throw new Error;return!!(null==n||null==(t=n.data)?void 0:t[0].status)&&(Zm({title:Object(o.W)("mobile_donut_payment_info_success"),description:n.data[0].text}),rv(a.RESULT_PAYMENT_SUCCESS_OK),$m.successActionUrl&&(nav.hard_go($m.successActionUrl),$m.successActionUrl=void 0),!0)}}))}},{onLoading:function(){ev()},onResponse:function(){rv(a.RESULT_PAYMENT_SUCCESS_WAITING)},onCancel:function(){nv(),rv(a.RESULT_PAYMENT_CANCEL)},onFailure:function(){nv(),rv(a.RESULT_ERROR)},onTimeout:function(){Zm({title:Object(o.W)("mobile_donut_payment_info_success"),description:Object(o.W)("mobile_donut_payment_info_success_later_text"),type:"success"}),rv(a.RESULT_PAYMENT_SUCCESS_WAITING_TIMEOUT)}}))}})).catch((function(e){console.error(e),Kt.a.setLoading(r,!1),tv({message:Object(o.W)("mobile_unknown_error")}),Object(Xm.a)(s)}))}(i,n,t),"change"===$m.type&&function(e,t,n){var i=Jm.id,r=Object(o.rc)(n);Kt.a.setLoading(r,!0),s=Object(z.a)('[data-section-ref="donut_payment_form_error"]'),s&&(s.innerHTML="");var s;var c=(d=t,-1===Number(d.price)?Number(d.custom_price):Number(d.price)),l=Object(Xm.f)(Object(o.W)("mobile_donut_payment_info_waiting")),u=window.ajax.post(e.requestUri,t);var d;Object(Xm.i)(u),u.promise.then((function(e){var t,n=e.json;if(!e.skip){var s=null==n||null==(t=n.data)?void 0:t[0];if(i!==Jm.id||!s||!Object.keys(s).length)throw new Error;if(Kt.a.setLoading(r,!1),null==s?void 0:s.error)return tv({message:null==s?void 0:s.error}),void Object(Xm.a)(l);s.paymentRequiredToComplete?function(e,t,n){var i=Jm.id,r=Object(Mt.b)(window.nav.path,{act:"donut_payment_change_check",hash:e.check_hash});Object(Xm.k)(Object(F.a)({sessionIdCurrent:Jm.id,paymentURL:e.paymentURL,paymentWindow:n,getIsSuccess:function(){var n=window.ajax.post(r,{});return Object(Xm.i)(n),n.promise.then((function(n){var o,r,s=n.json;if(!n.skip){if(i!==Jm.id)throw new Error;if((null==s||null==(o=s.data)||null==(r=o[0])?void 0:r.amount)===t)return iv({description:e.successDescription}),rv(a.RESULT_CHANGE_SUCCESS_OK),!0;throw new Error}}))}},(s=function(){nv(),rv(a.RESULT_CHANGE_ERROR)},{onFailure:s,onCancel:s,onLoading:function(){ev()},onResponse:function(){rv(a.RESULT_PAYMENT_SUCCESS_WAITING)},onTimeout:function(){Zm({title:Object(o.W)("mobile_donut_payment_change_timeout_error_title"),description:Object(o.W)("mobile_donut_payment_change_timeout_error_description"),continueButtonURL:$m.backURL}),rv(a.RESULT_CHANGE_SUCCESS_WAITING_TIMEOUT)}})));var s}(s,c,l):(iv({description:s.successDescription}),Object(Xm.a)(l))}})).catch((function(e){console.error(e),Kt.a.setLoading(r,!1),tv({message:Object(o.W)("mobile_unknown_error")}),Object(Xm.a)(l)}))}(i,n,t)},onPriceRadioChange:function(e){av(-1===Number(e.value))}};window.DonutPayment=cv;var lv=!1,uv={start:function(e,t,n){if("%page_id%"!==e&&!lv){var i;switch(lv=!0,n&&"%page_path%"!==n?n:fe.a.cur){case"/feed":i=Fd.TAB_ID_FEED;break;case"/feed?section=recommended":i=Fd.TAB_ID_RECOMMEND;break;case"/mail":i=Fd.TAB_ID_MESSAGES;break;case"/feed?section=notifications":i=Fd.TAB_ID_NOTIFICATION}i&&window.innerWidth<882?Fd.drawSkeletonLoader(Object(z.a)(".layout__basis"),i):(Fd.drawLoader(Object(z.a)(".layout__basis")),Object(r.a)()),setTimeout((function(){var i={headers:{"X-AppShell-Start-Id":e,"X-AppShell-Start":t},zProcess:function(){}};window.ajax.onNavDone(uv.onStarted),n&&"%page_path%"!==n?fe.a.go(n,{push_only:!0,replace:!0},i):fe.a.go(fe.a.cur,null,i)}))}},onStarted:function(){window.ajax.onNavDone.off(uv.onStarted),Object(C.a)()}},dv=uv;window.AppShell=dv;var _v={reload:function(e){Kt.a.setDisabled(e,!0),!1===navigator.onLine?setTimeout((function(){Kt.a.setDisabled(e,!1)}),500):fe.a.reload()}};window.OfflinePage=_v;var pv=n("2mXy");var hv=function(e){var t=e.info||{};return{inner:[{inner:[{inner:[Object.keys(t).map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"yes":"no"),function(e,t){return{inner:[{inner:[e],tag:"b"},"\n      :\n      ",{inner:[t],tag:"i"}],tag:"div"}}(e,n)}))],class:"fi_row",tag:"div"},{inner:[{inner:[{inner:[{inner:[{inner:"Audio tag not support",tag:"b"}],src:"//vk.com/mp3/bb1.mp3",tag:"source"}],preload:"none",controls:"controls",style:"width: 100%;",tag:"audio"}],style:"color: #777;",tag:"div"}],class:"fi_row",tag:"div"},{inner:[{inner:[{type:"hidden",id:"device_info_text",name:"device_info",value:e.fallbackText,tag:"input"},{inner:[e.needSendButton&&Object(Kt.a)({inner:[Object(ae.t)("mobile_send_device_info")],submit:!0,stretch:!0,onClick:e.onSendClick})],class:"cp_buttons_block",tag:"div"}],action:"/?device",method:"post",tag:"form"}],class:"fi_row",tag:"div"}],class:"form_item",tag:"div"}],class:"PageBlock DeviceInfo fit_box",style:"color: #777; line-height: 1.7",tag:"div"}},fv=function(e){function t(t){var n;return(n=e.call(this,t)||this).onSendClick=function(e){e.preventDefault();var t=n.state.info,i=Object.keys(t).map((function(e){return e+": "+t[e]})).join("\n");V.a.post("/?device",{_ajax:!0,device_info:i},{onDone:function(e){1===e?(self.setState({needSendButton:!1}),Snackbar.init({text:getLang("mobile_device_info_sent")})):Snackbar.init({text:getLang("mobile_unknown_error")})}})},n.state=Object(F.a)({},t),n}Object(Ei.a)(t,e);var n=t.prototype;return n._testAudio=function(){return!!window.Audio&&(new Audio).canPlayType("audio/mpeg")},n._testPhotoView=function(e){var t=document.createElement("div").style,n=[];return void 0!==t.webkitTransform&&n.push("webkitTransform"),void 0!==t.MozTransform&&n.push("MozTransform"),void 0!==t.msTransform&&n.push("msTransform"),void 0!==t.OTransform&&n.push("OTransform"),e+" ("+n.join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n._testFileAPI=function(e){return e+" ("+[window.XMLHttpRequest?"XMLHttpRequest":"",window.XDomainRequest?"XDomainRequest":"",window.FormData?"FormData":"",window.FileReader?"FileReader":"",window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary?"sendAsBinary":"",window.ArrayBuffer?"ArrayBuffer":"",window.Uint8Array?"Uint8Array":"",window.MozBlobBuilder?"MozBlobBuilder":"",window.WebKitBlobBuilder?"WebKitBlobBuilder":"",window.BlobBuilder?"BlobBuilder":""].join(", ").replace(/^(, )+|(, )+$|(, )(, )+/g,"$3")+")"},n.componentDidMount=function(){var e=this.state.info;e.Audio=this._testAudio(),e["Fullscreen Photoview"]=this._testPhotoView(e["Fullscreen Photoview"]),e.FileAPI=this._testFileAPI(e.FileAPI),this.setState({info:e})},n.render=function(){return _.a.preact(hv,Object(F.a)({},this.state,{onSendClick:this.onSendClick}))},t}(pv.a);function mv(){var e=$("#DeviceInfo");_.a.hydrate(fv,Object(ae.y)("DeviceInfo"),e)}p.a.getRouter().addRoute("/?device",mv),window.initDeviceInfo=mv;var vv=n("scr1");function gv(){var e=Object(ae.y)("StoriesArchive"),t=Object(z.a)("#StoriesArchive");_.a.mountPreactComponent(vv.b,e,t)}function bv(e){return{inner:[{inner:[e.before],class:"MiniInfoCell__before",tag:"div"},{inner:[e.text],class:"MiniInfoCell__content",tag:"div"}],class:"MiniInfoCell",tag:"div"}}function Av(){return{inner:[_.a.wrap(Object(Ga.a)())],class:"VacancyPhone__spinner",tag:"div"}}function wv(){return Object(ne.f)({on_overlay_click:["return VacancyPhone.close","this"],class:"VacancyPhone",onClose:["return VacancyPhone.close","this"],body:{inner:[{inner:[Object(xi.a)()],class:"VacancyPhone__close",onClick:"VacancyPhone.close(this)",tag:"button"},{class:"VacancyPhone__content",tag:"div"}],class:"VacancyPhone__wrap",tag:"div"}})}p.a.getRouter().addRoute((function(){return"/stories_archive"===nav.path}),gv),window.initStoriesArchive=gv;var yv,Ov=n("qdnm"),kv=function(){function e(e){this.clickStatCollector=e}return e.prototype.logEvent=function(e,t){var n,i=((n={type:v.b.TYPE_WORKI_CLICK})[v.b.TYPE_WORKI_CLICK]=e,n);this.clickStatCollector.logEvent(i,t)},e}(),jv=new(function(){function e(e){this.workiClickStatCollector=e}return e.prototype.logEvent=function(e){var t,n=((t={type:v.q.TYPE_WORKI_SNIPPET_ITEM})[v.q.TYPE_WORKI_SNIPPET_ITEM]=e,t.screen=window.cur.module,t),i={type:v.c.WORKI_SNIPPET};this.workiClickStatCollector.logEvent(n,i)},e}())(new kv(Ov.a));!function(e){e.CLICK_CTA="click_cta",e.CLICK_CALL="click_call"}(yv||(yv={}));var Sv={open:function(e,t,n,i,a){var o=a.$btn.closest(i),r=Object(z.a)(Tv,o);if(r){var s=ie.g.open(r,!0,"",{expandable:!0}),c=s.querySelector(Mv);return c&&(c.innerHTML=_.a.html(Av()),Ev=Lv(e,n,t,c),Cv=function(){Rv(s),Ev()},nav.onBeforeGo(Cv),jv.logEvent({event_name:yv.CLICK_CTA,wallitem_id:t})),s}return!1},close:Rv,retry:function(e,t,n,i){var a=i.$btn.closest(Mv);a&&(a.innerHTML=_.a.html(Av()),Ev=Lv(e,t,n,a))},onClickCall:function(e){e&&jv.logEvent({event_name:yv.CLICK_CALL,wallitem_id:e});return!0}},Cv=function(){},Ev=function(){},Tv=".VacancyPhone",Iv=".VacancyPhone.Popup_open",Mv=".VacancyPhone__content";function Pv(e,t,n){var i,a,o,r,s,c,l,u,d;t.wallitemId=n,e.innerHTML=_.a.html((a=(i=t).phone,o=i.name,r=i.profession,s=i.company,c=Object(ae.t)("market_worki_snippet_phone_modal_title"),l=Object(ae.t)("market_worki_snippet_phone_modal_call"),u="tel:"+a,d=11===a.length?"+"+a.substr(0,1)+" "+a.substr(1,3)+" "+a.substr(4,3)+" "+a.substr(7,2)+" "+a.substr(9,2):a,[Object(xi.Sb)(),{inner:[d],class:"VacancyPhone__phone",tag:"div"},{inner:[o],class:"VacancyPhone__name",tag:"div"},{class:"VacancyPhone__separator",tag:"div"},{inner:[c],class:"VacancyPhone__label",tag:"div"},{inner:[bv({before:Object(xi.v)(),text:r}),bv({before:Object(xi.w)(),text:s})],class:"VacancyPhone__info",tag:"div"},Object(Kt.a)({inner:[l],class:"VacancyPhone__call",url:u,role:"link",theme:"large",onClick:'VacancyPhone.onClickCall("'+i.wallitemId+'")',use_native_onclick:!0})]))}function xv(e,t){var n,i;e.innerHTML=_.a.html((i=["VacancyPhone.retry",(n=t).id,n.hash,n.wallitemId],{inner:[{inner:[Object(ae.t)("mobile_market_worki_snippet_phone_modal_error")],class:"VacancyPhone__text",tag:"p"},Object(Kt.a)({inner:[Object(ae.t)("mobile_market_worki_snippet_phone_modal_error_retry")],class:"VacancyPhone__retry",theme:"link",onClick:i})],class:"VacancyPhone__error",tag:"div"}))}function Lv(e,t,n,i){return window.ajax.post("worki.php",{act:"get_vacancy",vacancy_id:e,hash:t},{onDone:function(a){a?Pv(i,a,n):xv(i,{id:e,hash:t,wallitemId:n})},onFail:function(){xv(i,{id:e,hash:t,wallitemId:n})}}).abort}function Rv(e){return e||(e=Object(z.a)(".Popup_open.VacancyPhone")||Object(z.a)(Iv)),e&&(ie.g.close(e),Ev()),nav.onBeforeGo.off(Cv),!1}Object.assign(wv,Sv);var Bv=wv;window.VacancyPhone=Bv;n("7J+R"),n("2hUL"),n("8bHZ"),n("BNie");function Nv(){var e=Object(z.a)(".RedirectScreen__mainButton");return e?e.getAttribute("href").replace(/^vk:\/\//,""):""}function Dv(e){var t=e.action,n=e.onDone,i=e.onError,a=function(e){var t=e.split("?");return Object(o.Ub)(t[1]).entry||""}(Nv());V.a.post("/webview",{act:"redirect_screen_"+t,entry:a,_ajax:1}).promise.then((function(){return n&&n()})).catch((function(){return i&&i()}))}var Hv={onInit:function(){var e=Nv();Object(o.Mb)(e)},onOpenClick:function(){window.event&&window.event.preventDefault();var e=Nv();Dv({action:"open",onDone:function(){return Object(o.Mb)(e,!0)}})},onContinueClick:function(){Dv({action:"continue",onDone:function(){Object(Wn.b)("remixredirect_screen_opened","true",1/1440*5),window.location.reload()}})},onDownloadClick:function(e,t){e.preventDefault(),Dv({action:"download",onDone:function(){return window.location.href=t.href}})}};window.RedirectScreen=Hv;var Uv=n("EnJO"),Vv=n("vOeY"),Fv="touch",Wv=Object(d.a)();function qv(){window.clog("[UserInteraction] init"),Fv="touch","PointerEvent"in window?function(){function e(e){var t="mouse"===e.pointerType?"mouse":"touch";t!==Fv&&(window.clog("[UserInteraction] Last interaction method changed to "+t+" (pointer event)"),Wv(t),Fv=t)}document.addEventListener("pointerdown",e,{passive:!0,capture:!0}),document.addEventListener("pointerover",e,{passive:!0,capture:!0})}():zv()}function zv(){document.addEventListener("mousemove",(function e(){window.clog("[UserInteraction] Last interaction method changed to mouse"),Wv("mouse"),Fv="mouse",document.removeEventListener("mousemove",e,{capture:!0}),document.addEventListener("touchstart",(function e(t){var n;(null===(n=t.sourceCapabilities)||void 0===n?void 0:n.firesTouchEvents)||(window.clog("[UserInteraction] Last interaction method changed to touch"),Wv("touch"),Fv="touch",document.removeEventListener("touchstart",e,{capture:!0}),zv())}),{passive:!0,capture:!0})}),{passive:!0,capture:!0})}window.clog("[UserInteraction] done"),window.jsc=function(e){return"dist/"+e},Object(h.b)(),document.scrollListenerAlreadyInited||(document.scrollListenerAlreadyInited=!0,Object(o.b)(window,"scroll touchmove",(function(){var e,t;(null==(e=window.Speech)||null==(t=e.recorder)?void 0:t.isRecording)||Object(o.Kb)(!0)}),{passive:!0})),window.trackEvent=ee.a;var Yv=window,Gv=Yv.thover,Qv=Yv.ajax;function Kv(){if(Object(o.Eb)("custom_opts"))return Object(o.a)("_copts","vk_wrap");var e=Object(o.k)("div",{innerHTML:'<input id="copts_test_radio" type="radio" checked="checked"><div id="copts_test_label"></div>'});Object(o.f)(e,"vk_utils");var t=Object(o.M)("copts_test_label");t&&Math.abs(t.offsetWidth-5)<1&&(Object(o.a)("_copts","vk_wrap"),Object(o.Fb)("custom_opts",1)),Object(o.Xb)(e)}Object(o.b)(document,"touchmove touchcancel",Gv.cancel,{passive:!0}),Object(o.b)(document,"touchend",Gv.end,{passive:!0}),onDOMReady((function(){qv(document.body.classList.contains("_touch"))})),Wv((function(e){})),Qv.enabled=!0,Qv.enabled&&(onDOMReady((function(){Object(o.Xb)("app_go_frame"),Qv.prepare_click(),menu&&menu.init(),audioplayer&&audioplayer.initAudio(),Object(o.a)("_js","vk_wrap")})),page.clear()),onDOMReady((function(){p.a.getRouter().checkRoutes(),window.page&&page.onReadyOrChanged((function(){return p.a.getRouter().checkRoutes()}));var e=document.getElementById("utils");e||((e=document.createElement("div")).id="utils",document.body.insertAdjacentElement("afterbegin",e)),window.utilsNode=e,Object(C.b)("mvk_mediaview")&&Object(Yt.a)()})),onDOMReady(H.a),Object(o.b)(window,"resize",H.a),Object(o.b)(document,"touchstart",(function(e){var t=Object(o.p)(e.target);Gv.clear(),t&&Gv.start.call(t,e)}),{passive:!0}),document.clickListenerAlreadyInited?setTimeout((function(){var e=Array.from(document.querySelectorAll("script")).map((function(e){return e.src}));Object(D.a)("mvk_click_common_multiple_init",1,"common",e.join("|"),location.href)}),0):(document.clickListenerAlreadyInited=!0,Object(o.b)(document,"click",(function(e){var t,n;if((null==(t=e.target)||null==(n=t.dataset)?void 0:n.donutLogEvent)&&w(e.target.dataset.donutLogEvent,e.target),Object(o.d)()){var i=Object(o.eb)("al_after",e.target);if(i){var a=Object(o.g)(i,"data-target"),r=!!a&&Object(o.O)(a,i);if(r&&!nav.go_after(r,e)||!nav.go_after(i,e))return}var s=Object(o.Gb)(e.target,".mi_text a");if(y.a.isIntegrated&&s)if(!e.target.getAttribute("mention_id"))return void(e.target.target="_blank");var c=Object(o.o)(e.target,{allow_post_away:!0});if(c&&(document.activeElement&&document.activeElement.tagName&&"input"===document.activeElement.tagName.toLowerCase()&&document.activeElement.blur(),nav.go(c,e)||Object(o.j)(e)),"bookmarks"===cur.module){var l=e&&e.target&&(e.target.closest(".BookmarksItem_link")||e.target.closest(".BookmarkSlider__item")||e.target.closest(".OwnerRow"));if(!l)return;var u=l.getAttribute("id").match(/^(link|page)(-?\d+)_(-?\d+)?$/)||[],d=u[0],_=u[1],p=u[2],h=u[3];if(!(d&&_&&p&&h))return;var f=!1;switch(_){case"link":f=e.target.closest('a[target="_blank"]');break;case"page":f=e.target.closest(".OwnerRow__content")||e.target.closest(".OwnerColumn")}if(!f)return;Object(D.a)("bookmarks_product_analytics",{item_type:_,item_owner_id:intval(p),item_id:intval(h),time:vk.ts+Math.floor(((new Date).getTime()-vk.started)/1e3)})}}}))),document.submitListenerAlreadyInited||(document.submitListenerAlreadyInited=!0,Object(o.b)(document,"submit",(function(e){var t=e.target;Object(o.gb)("vk_js_yes",geByTag1("html"))&&!Object(o.gb)("opera_mini_yes",geByTag1("body"))&&Object(o.gb)("qsearch",t)&&Object(o.eb)("audioPage",t)&&(geBySel1('[type="submit"]',t).click(),Object(o.j)(e))}))),document.touchStartListenerAlreadyInited||(document.touchStartListenerAlreadyInited=!0,Object(o.b)(document,U.b?"touchstart":"mousedown",(function(e){tooltip.closeByTap(e)}),{passive:!0})),onDOMReady(Kv),onDOMReady((function(){Object(D.a)("mvk_feature_is_supported",Number(Object(te.d)()),"flexbox"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.h)()),"match_media"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.b)()),"css_variables"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.a)()),"auto_change_scheme"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.k)()),"css_supports"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.e)()),"grids"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.i)()),"svg"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.f)()),"intersection_observer"),Object(D.a)("mvk_feature_is_supported",Number(Object(te.l)()),"webrtc_calls"),Object(D.a)("mvk_dark_theme",Number(Object(te.c)()),"current"),function(){var e={is_schemes_supported:Object(te.b)(),is_auto_schemes_supported:Object(te.a)(),current_scheme:Object(te.c)()?2:Object(te.g)()},t=Object.keys(e).sort().map((function(t){return t+":"+Number(e[t])})).join("/");if(localStorage&&localStorage.getItem){var n=localStorage.getItem("supportedFeatures");null!==n&&t===n||(localStorage.setItem("supportedFeatures",t),Object(D.a)("browser_features",t))}}()})),[!Object(te.i)()].some((function(e){return e}))&&onDOMReady((function(){UnsupportedBrowser.show()})),onDOMReady(C.a),Object(o.kc)(),onDOMReady((function(){var e=window.vk;e&&!e.id&&Object(o.Db)()&&localStorage.clear()})),window.optionsTest=Kv,zlayer.isReady=!0,window.PasswordInput={toggleVisibility:function(e,t,n){void 0===n&&(n=!1),(n?Object(z.b)(".PasswordInput .PasswordInput__button"):t).forEach((function(e){setTimeout((function(){var t="true"===e.getAttribute("aria-expanded"),n=Object(va.b)(e.closest(".TextInput"));e.setAttribute("aria-expanded",t?"false":"true"),n.setAttribute("type",t?"password":"text"),e.innerHTML=Wd.html(Object(W.a)({icon:t?Object(rr.a)():Object(sr.a)()}))}),0)}));var i=t.closest(".TextInput"),a=Object(z.a)(".TextInput__native",i),o=document.activeElement===a||i.classList.contains("TextInput--focused");function r(){!o||Object(c.b)()?(e.preventDefault(),e.stopPropagation(),t.focus()):a.focus()}r(),setTimeout((function(){return r()}))}},onDOMReady((function(){xt(),window.page.onChange((function(){window.page.lastTrackedPage!==nav.cur&&xt()}))})),window.MsgTemplates||(window.MsgTemplates={Carousel:{handleElementAction:Vm.b,moveSlider:Vm.c,onScroll:Vm.d}}),window.isNewMail&&(n("4bPz"),n("s0aB"),n("/Id8"),n("DkIl"),n("CkGd"),n("iS9e"),n("fWqt"),n("QBkA"),n("rKp0"),n("u33z"),n("A6le"),n("SNk7"),n("JCKH"),n("1KAK"),n("eWFs"),n("drfJ"),n("V2dH"),n("PUg3"),n("3pHe")),window.MarketAnalyticsManager=Uv.a,window.Form=Vv.b,onDOMReady((function(){f.b.addStatEvent(f.b.getModule(),f.a.TAB_OPEN)}))},"7cYY":function(e,t,n){"use strict";n.d(t,"b",(function(){return l}));var i=n("+sJP"),a=n("z9sQ"),o=n("EDm3");var r=function(e){void 0===e&&(e={});var t=a.a.class("StoryThumb",{draggable:e.isDraggable}),n=a.a.class("StoryThumb__checkbox",{checked:e.isSelected}),r=e.story||{},s=e.onClick?e.onClick:r.isUnavailable?null:["Stories.init",r.rawId+"/"+r.listId];e.isSelectable&&!r.isUnavailable&&(s=[e.onStoryThumbCheck,"event",e.story]);var c=Object(i.s)(r.time),l=Object(i.t)("months_sm_of","raw")[Object(i.w)(r.time)];return{inner:[e.isDateHidden?null:{inner:[{inner:[c],class:"StoryThumbDate__day",tag:"div"},{inner:[l],class:"StoryThumbDate__month",tag:"div"}],class:"StoryThumbDate",tag:"div"},e.isSelectable?{inner:[{inner:[Object(o.C)()],class:"StoryThumb__checkboxCheckedIcon",tag:"div"},{inner:[Object(o.B)()],class:"StoryThumb__checkboxUncheckedIcon",tag:"div"}],class:n,onClick:[e.onStoryThumbCheck,"event",e.story],tag:"div"}:null,r.isUnavailable?{inner:[{inner:[Object(o.J)()],class:"StoryThumbUnavailable__icon",tag:"div"},{inner:[Object(i.t)("mobile_stories_archive_unavailable_label")],class:"StoryThumbUnavailable__label",tag:"div"}],class:"StoryThumbUnavailable",tag:"div"}:null],class:t,onClick:s,style:r.isUnavailable?null:"background-image: url("+r.preview+")","data-time":r.time,"data-story-id":r.id,tag:"div"}},s=n("UxAg"),c=n("OcsD");function l(e){if(!e)return!1;var t={},n=Object(s.b)(".StoryThumb[data-time]",e);n&&n.length&&n.forEach((function(e,i){var a=Object(c.O)("StoryThumbDate",e);if(a){var o=n[i-1],r=o&&1e3*o.getAttribute("data-time"),s=r&&new Date(r),l=s&&s.toDateString(),u=1e3*e.getAttribute("data-time"),d=new Date(u).toDateString(),_=l===d;t[d]&&t[d]!==u&&_?Object(c.jc)(a,"display","none"):(t[d]=u,Object(c.jc)(a,"display","block"))}}))}t.a=r},"7jDv":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var i={avg:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e},t.get=function(){return this._accum/this._count},t.clear=function(){this._count=0,this._accum=0},e}(),peak:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._max=Math.max(this._max,Math.abs(e))},t.get=function(){return this._max},t.clear=function(){this._max=0},e}(),quad:function(){function e(){this.clear()}var t=e.prototype;return t.push=function(e){this._count++,this._accum+=e,this._accum_q+=e*e},t.get=function(){return 1==this._count?this._accum:Math.sqrt((this._accum_q-this._accum*this._accum/this._count)/this._count)},t.clear=function(){this._count=0,this._accum=0,this._accum_q=0},e}()},a=function(){function e(e){this._normalizeAlgorithm=!1,i[e.normalizeAlgorithm]&&(this._normalizeAlgorithm=new i[e.normalizeAlgorithm]),this._srcSampleRate=parseInt(e.srcSampleRate||0),this._dstSampleRate=parseInt(e.dstSampleRate||0),this._truncateTo=1,void 0!==e.truncateTo&&(this._truncateTo=e.truncateTo),this._dstSampleRate>0?this._sampleRate=this._srcSampleRate/this._dstSampleRate:this._sampleRate=0,i[e.algorithm]||(e.algorithm="peak"),this._algorithm=new i[e.algorithm],this._sampleCount=0,this._data=[]}return e.prototype.push=function(e){if(this._sampleRate<=0)return[];for(var t,n=[],i=0;i<e.length;i++)if(this._truncateTo>0&&(e[i]=Math.min(this._truncateTo,Math.abs(e[i]))),this._sampleCount+=1,this._sampleCount>=this._sampleRate)for(;this._sampleCount>=this._sampleRate;)this._sampleCount-=this._sampleRate,this._sampleCount<=.8&&this._algorithm.push(e[i]),t=this._algorithm.get(),n.push(t),this._normalizeAlgorithm&&this._normalizeAlgorithm.push(t),this._algorithm.clear(),this._sampleCount>.2&&this._algorithm.push(e[i]);else this._algorithm.push(e[i]);if(this._normalizeAlgorithm){var a=this._normalizeAlgorithm.get();if(this._normalizeAlgorithm.clear(),a>0)for(var o=0;o<n.length;o++)n[o]=n[o]/a,this._truncateTo>0&&(n[o]=Math.min(this._truncateTo,Math.abs(n[o])))}return n},e}();function o(e,t,n){return void 0===n&&(n="peak"),new a({srcSampleRate:e.length,dstSampleRate:t,normalizeAlgorithm:n,truncateTo:0}).push(e)}},"8ZMO":function(e,t,n){"use strict";var i=function(e){return{class:["Anchor",e.mix],id:e.id,tag:"div"}};t.a=i},9:function(e,t,n){e.exports=n("75Qd")},"98L6":function(e,t){window.FeedBlocks={hideReason:function e(t,n){if(e.progress)return!1;e.progress=!0;var i="block_"+t,a=ge(i);cur.feedBlocksHTML&&delete cur.feedBlocksHTML[i],ajax.post("feed.php",{act:"block_hide_reason",block_id:t,reason:0|n,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){e.progress=!1,t?val(a,t):hide(a),e.progress=!1},onFail:function(){e.progress=!1}})},restore:function(e){var t="block_"+e,n=ge(t);cur.feedBlocksHTML&&cur.feedBlocksHTML[t]&&val(t,cur.feedBlocksHTML[t]),ajax.post("feed.php",{act:"block_restore",block_id:e,hash:attr(n,"data-hash"),pos:attr(n,"data-pos"),ref:attr(n,"data-ref")})},hide:function e(t,n){if(e.progress)return!1;e.progress=!0,post.wallActionsHide();var i="block_"+t,a=ge(i);return ajax.post("feed.php",{act:"block_hide",block_id:t,hash:attr(a,"data-hash"),pos:attr(a,"data-pos"),ref:attr(a,"data-ref")},{onDone:function(t){post.wallActionsHide(),cur.feedBlocksHTML||(cur.feedBlocksHTML={}),cur.feedBlocksHTML[i]=val(a),val(a,t),e.progress=!1},onFail:function(){e.progress=!1}}),!1}}},"9y81":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("bZ/P"),a=n("Mc5h"),o=function(e){var t,n=e.icon,o=e.class||e.mix;return Object(a.a)({mix:i.a.class(o,"Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t)),url:e.url,attrs:e.attrs})};function r(e){var t,n=e.icon,i={class:[e.class,Bem.class("Icon",(t={},t[n]=!0,t.active=e.active,t.blue=e.blue,t.bluer=e.bluer,t.dark=e.dark,t.selected=e.selected,t.small=e.small,t.white=e.white,t),"_")],href:e.url,attrs:e.attrs,tag:"a"};return i.tag=e.url?"a":"div",i}Object.assign(o,{toggleActive:function(e){e.classList.toggle(s)}});var s="Icon_active";t.b=o;window.Icon=o},A6le:function(e,t,n){"use strict";n.r(t);var i=n("Y6JH"),a=n("z9sQ"),o=n("+sJP"),r=n("EDm3"),s=n("J51G"),c=function(e){var t=e.durationInSeconds,n=e.isDefaultCasperTimerShown,c=t<=60;return{inner:[{inner:[Object(r.d)()],class:a.a.class("CasperTimer__icon",{normal:!0}),"aria-hidden":"true",tag:"span"},{inner:[Object(i.a)({icon:Object(s.a)()})],class:a.a.class("CasperTimer__icon",{warning:!0}),"aria-hidden":"true",tag:"span"},{inner:[Object(o.n)(t)],class:"CasperTimer__timer",role:"timer","aria-live":"polite",tag:"span"}],class:a.a.class("CasperTimer",{active:t>0,hidden:!n,warning:c}),onClick:["CasperTimer.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false",title:Object(o.t)("mobile_casper_timer_title"),"data-left":t,tag:"button"}};var l=n("UxAg"),u=n("qHA9"),d=new(n("Cz26").a)({}),_={init:function(e){var t=this;if(Object(u.j)(e))return!1;var n=Object(l.a)(".msg_id_"+e);if(!n)return!1;var i=Object(l.a)(".CasperTimer",n);if(!i)return!1;var a=this.getTimerElement(i);d.add((function(n){if(i.parentNode){var r=t.getLeftSeconds(i);(r-=n)<=0&&(i.classList.add("CasperTimer--hidden"),a.classList.remove("CasperTimer__timer--opened"),i.classList.remove("CasperTimer--itsGonnaBlow"),setTimeout((function(){i.hasOwnProperty("remove")?i.remove():i&&i.parentNode&&i.parentNode.removeChild(i)}),1e3),d.remove(e),r=0),t.setLeftSeconds(i,r),r>0&&r<=10&&i.classList.add("CasperTimer--itsGonnaBlow"),r>0&&r<=60&&(i.classList.remove("CasperTimer--hidden"),i.classList.add("CasperTimer--warning")),t.isOpened(i)&&(a.innerHTML=Object(o.n)(r))}else d.remove(e)}),{id:e})},getLeftSeconds:function(e){return parseInt(e.getAttribute("data-left"))},setLeftSeconds:function(e,t){e.setAttribute("data-left",t)},getTimerElement:function(e){if(!e)throw new Error("CasperTimer: element is not provided");return Object(l.a)(".CasperTimer__timer",e)},isOpened:function(e){return this.getTimerElement(e).classList.contains("CasperTimer__timer--opened")},clickHandler:function(e,t){var n=this.getTimerElement(e);n.classList.toggle("CasperTimer__timer--opened");var i=this.isOpened(e);e.setAttribute("aria-expanded",i),n.innerHTML=Object(o.n)(this.getLeftSeconds(e)),t.stopPropagation(),clearTimeout(e._autoCloseTimer),i&&(e._autoCloseTimer=setTimeout((function(){n&&n.classList.remove("CasperTimer__timer--opened")}),4e3))}};window.CasperTimer=_;t.default=c},AXyT:function(e,t,n){"use strict";var i=function(e){return Wd.html({inner:["empty"===e.value?" ":e.value],class:[Bem.class("Oval",{type:e.gray?"minor":e.type,hidden:a(e.value)},"_"),e.mix],tag:"div"})};function a(e){return"empty"!==e&&(!e||e<=0)}Object.assign(i,{setValue:function(e,t){if(!e)return;var n=a(t);e.innerText="empty"===t?" ":t,e.classList.toggle(o,n)}});var o="Oval_hidden";t.a=i;Object.assign(window,{Oval:i,Oval_isHidden:a})},AgBx:function(e,t,n){"use strict";var i=n("bZ/P"),a=n("Mc5h"),o=function(e){return Object(a.a)({attrs:e.attrs,mix:i.a.class(e.mix,"ScrollView"),inner:e.inner})};n("QMH7"),t.a=o;window.ScrollView=o},"B+U2":function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n("29dZ"),a=n("Y6JH"),o=n("TYsd"),r=n("z9sQ"),s=n("+sJP"),c=n("GHum"),l=n("EDm3"),u=n("sPQa"),d=n("lhfX"),_=function(e){var t=e.keyboard,n=e.msgId,i=e.pressed||{},a=t.buttons,o=e.subID,r=0;return{class:"BotsKeyboard__main",inner:a.map((function(e){return p(e,t,n,i,o||null,r++)}))}};function p(e,t,n,_,p,h){var f=0;return{class:"BotsKeyboard__row",inner:e.map((function(e){return function(e,t,n,_,p,h,f){var m,v=window.lang,g=e.action.type,b=r.a.class("BotsKeyboard__button",{primary:"primary"===e.color||"vkpay"===g,positive:"positive"===e.color,negative:"negative"===e.color}),A=["window.uMailWrite && uMailWrite._onKeyboardButtonClick","this","event",{action:Object(s.T)(e.action),authorId:t.author_id,inline:t.inline,msgId:n,subID:p}];m="vkpay"===g?[{class:"BotsKeyboard__buttonInner",inner:[o.a.wrap(v.mobile_mail_keyboard_label_vkpay),o.a.wrap("&nbsp;"),o.a.wrap("&nbsp;"),Object(a.a)(Object(c.a)())]}]:"location"===g?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(l.S)()},o.a.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.a.wrap(v.mobile_mail_keyboard_label_location)]}]}]:"open_app"===g?[{class:"BotsKeyboard__buttonInner",inner:[{tag:"span",class:"BotsKeyboard__leadingIcon",inner:Object(a.a)(Object(u.a)())},o.a.wrap("&nbsp;"),{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.a.wrap(e.action.label)]}]}]:"open_link"===g?[{class:"BotsKeyboard__buttonInner",inner:[{class:"BotsKeyboard__buttonLabelWrapped",inner:[o.a.wrap(e.action.label)]},o.a.wrap("&nbsp;"),Object(a.a)(Object(d.a)())]}]:[o.a.wrap(e.action.label)];var w=!1,y="";p&&(y=p+"|");var O=""+y+h+","+f;_&&_[O]&&(w=!0);return Object(i.a)({class:b,isLoading:w,spinner:!0,on_click:A,use_native_onclick:!0,inner:m,theme:"none",size:"normal",type:"button",attrs:{"data-position":O}})}(e,t,n,_,p,h,f++)}))}}t.b=_},B9v3:function(e,t,n){"use strict";n.d(t,"a",(function(){return oe}));var i=n("OcsD"),a=n("Y6JH"),o=n("VRji"),r=n("p5n7"),s=n("29dZ"),c=n("+sJP"),l=n("EDm3"),u=n("ETBP"),d=n("dvEy"),_=n("3ZCC"),p=n("Fbxv"),h=n("Lq6a"),f=n("2fMF"),m=n("PssS");function v(e){return void 0===e&&(e={}),{class:"SharePanel SharePanel-header SharePanel--active ShareHeaderConversationsPanel","aria-hidden":"false","data-name":"ShareHeaderConversationsPanel",inner:[{"aria-label":Object(c.t)("mobile_close"),onclick:"cur.share.destroy()",role:"button",class:"SharePanel-header__close",inner:Object(l.z)()},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(c.t)("mobile_like_publish_head_title")},{class:"SharePanel-headerText__receivers"}]},{class:"SharePanel-headerRight",inner:[{"aria-label":Object(c.t)("mobile_search"),class:"SharePanel-headerRight__search",role:"button",inner:Object(l.W)(),onclick:"cur.share.toggleConversationsSearch(true)"},e.supportsExternalShare?{"aria-label":Object(c.t)("mobile_share_external"),class:"SharePanel-headerRight__externalShare",role:"button",inner:"iOS"===e.platform?Object(a.a)(Object(u.a)()):Object(a.a)(Object(d.a)()),onclick:"cur.share.externalShare()"}:null]}]}}function g(e){var t=e.buttons,n=e.options,i="boolean"!=typeof e.active||e.active;return{class:"ActionsPanel SharePanel "+(i?"SharePanel--active":""),"data-name":"ActionsPanel","aria-hidden":!i,style:!(n.can_to_own||n.can_to_club||n.can_bookmark)?"display: none;":"",inner:t.map((function(e){if(e)return function(e){var t=e.href?"a":"div",n=e.onclick,i={tag:t,role:"button",tabindex:-1,href:e.href,onclick:n,class:"ActionsPanel-button ActionsPanel-button--"+e.target,inner:[{class:"ActionsPanel-button__icon",inner:e.icon},{class:"ActionsPanel-button__label",inner:e.label}]};"boolean"==typeof e["aria-pressed"]&&(i["aria-pressed"]=e["aria-pressed"]+"");return i}(e)}))}}var b=function(e){var t=e.can_bookmark,n=e.is_bookmarked,i=e.object,u=e.list,d=e.from,b=e.post_from,A=e.supportsExternalShare,w=e.isVKApp,y=e.targetOwnOnClick,O=Object(c.O)("/wall",{act:"add",share_box:1,is_vk_app:w,object:i,list:u,from:d,post_from:b});return{inner:[{inner:[v({platform:e.platform,supportsExternalShare:A}),{class:"SharePanel ShareHeaderSearch ShareHeaderConversationsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderConversationsSearchPanel",role:"search",inner:Object(r.a)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "peers", true)',prefix:{text:{role:"button",inner:Object(l.r)()}},postfix:{text:{class:"ShareHeaderSearch__clear",role:"button",onclick:'cur.share.clearSearch(event, "peers")',inner:Object(l.A)()}},class:"ShareHeaderConversationsSearchPanel__input",id:"ShareHeaderConversationsSearchPanel__input",placeholder:Object(c.t)("mobile_search"),spellcheck:!1})},{class:"SharePanel SharePanel-header ShareHeaderGroupsPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsPanel",inner:[{"aria-label":Object(c.t)("mobile_back"),onclick:"cur.share.toggleGroupsPanel(false)",role:"button",class:"SharePanel-header__close",inner:Object(l.y)()},{class:"SharePanel-headerText",inner:[{class:"SharePanel-headerText__label",inner:Object(c.t)("mobile_like_publish_head_title")}]},{class:"SharePanel-headerRight",inner:[{class:"SharePanel-headerRight__search",role:"button",inner:Object(l.W)(),onclick:'cur.share.setActivePanel(this, "ShareHeaderGroupsSearchPanel", true)'}]}]},{class:"SharePanel ShareHeaderSearch ShareHeaderGroupsSearchPanel","aria-hidden":"true","data-name":"ShareHeaderGroupsSearchPanel",role:"search",inner:Object(r.a)({disabled:!0,autocomplete:!1,onblur:'cur.share.clearSearch(event, "group", true)',prefix:{text:{"aria-label":Object(c.t)("mobile_search"),role:"button",inner:Object(l.r)()}},postfix:{text:{class:"ShareHeaderSearch__clear",onclick:'cur.share.clearSearch(event, "group")',inner:Object(l.A)()}},class:"ShareHeaderGroupsSearchPanel__input",id:"ShareHeaderGroupsSearchPanel__input",placeholder:Object(c.t)("mobile_search"),spellcheck:!1})}],class:"SharePanelRoot ShareHeader",tag:"header"},{id:"Share__input",style:"display: none;",tag:"input"},{inner:[{class:"ShareConversations SharePanel SharePanel--active filter_peer_wrap","data-name":"ShareConversations","aria-hidden":"false",role:"group",id:"ShareConversations"},{class:"ShareGroups SharePanel","data-name":"ShareGroups","aria-hidden":"true",role:"group",id:"ShareGroups"}],class:"SharePanelRoot ShareLists",tag:"section"},{inner:[g({active:!0,options:e,buttons:[e.can_to_own?{target:"own",label:Object(c.t)("mobile_share_target_own"),onclick:y||"cur.share.go('"+O+"')",icon:Object(a.a)(Object(h.a)())}:null,e.can_to_club?{target:"group",label:Object(c.t)("mobile_share_target_group"),icon:Object(l.zb)()}:null,t?{target:"bookmark","aria-pressed":n,label:n?Object(c.t)("mobile_share_target_bookmark_active"):Object(c.t)("mobile_share_target_bookmark"),icon:Object(a.a)(e.is_bookmarked?Object(f.a)():Object(m.a)())}:null]}),{class:"SharePanel MessagePanel","aria-hidden":"true","data-name":"MessagePanel",inner:[Object(r.a)({tabindex:-1,autocomplete:!1,class:"MessagePanel__input",on_click:["cur.share.expandMessage"],placeholder:Object(c.t)("mobile_share_message_placeholder"),spellcheck:!1,readonly:!0,disabled:!0}),Object(s.a)({stretch:!0,size:"large",inner:Object(c.t)("mobile_share_message_single"),on_click:"cur.share.sendMessage(event)",use_native_onclick:!0})]},{class:"SharePanel ExpandedMessagePanel","aria-hidden":"true","data-name":"ExpandedMessagePanel",inner:[{class:"ExpandedMessagePanel__textareaWrap",inner:[Object(o.a)({placeholder:Object(c.t)("mobile_share_message_placeholder"),rows:1}),{class:"ExpandedMessagePanelSend",inner:Object(a.a)(Object(_.a)())}]}]},{class:"SharePanel ProcessingPanel","aria-hidden":"true","data-name":"ProcessingPanel",inner:[{class:"ProcessingPanel__icon ProcessingPanel__icon--loading",inner:Object(a.a)(Object(p.a)())},{class:"ProcessingPanel__label",inner:Object(c.t)("mobile_share_state_progress")}]}],class:"SharePanelRoot ShareBottom",tag:"footer"}],class:"Share",role:"dialog","aria-label":Object(c.t)("mobile_like_publish_head_title"),hidden:"false",tabindex:"-1",tag:"div"}},A=n("wTbK"),w=n("YU/R"),y=n("Qz23"),O=n("+cqQ");function k(e){return/^((?:([a-z]+)_)?([a-z_]+))(-?\d+)?(?:_(\d+))?$/.test(e)}var j=n("UxAg"),S=n("j80l"),C=n("aiw/"),E=n("H5mD"),T=n("uEFA"),I=n("yOyn"),M=n("L3oE"),P=n("1u0X"),x=n("1UEa"),L=n("KMpi"),R="/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1",B="ShareConversations",N=0,D=!1,H={bookmarks:{}};function U(e){F(e)}function V(e){nav.go(e),cur.share.destroy({isNavigation:!0})}function F(e){if(cur.share){var t=cur.share._els.header,n=e.scrollTop;t.classList.toggle("ShareHeader--scrolled",n>=10)}}function W(e,t,n){if(!cur.share||cur.share.blocked)return!1;if(z(!0),Object(i.j)(n),Object(i.gb)("inline_item_selected",t))return cur.shareSearch.toggleAttach(e,!1),function(e,t){for(var n=0;n<cur.share.selected.length;n++)if(cur.share.selected[n]===e){cur.share.selected.splice(n,1);break}return K(!1),$(),!1}(e);cur.shareSearch.toggleAttach(e,!0);for(var a=!1,o=0;o<cur.share.selected.length;o++)if(cur.share.selected[o]===e){a=!0;break}return a||cur.share.selected.push(e),z(!1),K(!1),$(),!1}function q(e,t,n){if(cur.share&&!cur.share.blocked){e=e.closest(".SharePanelRoot");var a,o=Object(j.b)(".SharePanel",e);t&&(a=Object(j.a)("."+t,e)),o.forEach((function(e){var t=e===a;e.setAttribute("aria-hidden",!t),e.classList.toggle("SharePanel--active",t),t?e.removeAttribute("tabindex"):e.setAttribute("tabindex",-1),Object(j.b)("input, ul",e).forEach((function(e){e.setAttribute("aria-hidden",!t);var n=e.closest(".TextInput");t?(null==n||n.classList.remove("TextInput_disabled"),e.removeAttribute("disabled"),e.setAttribute("tabindex",0)):(null==n||n.classList.add("TextInput_disabled"),e.setAttribute("disabled",!0),e.setAttribute("tabindex",-1))}))}));var r=Object(j.a)("input",a);r&&n&&r.focus(),Object(i.jc)(e,{height:a?a.clientHeight:0})}}function z(e){var t=Object(j.a)(".ShareModal");t&&t.classList.toggle("ShareModal--disableAnimations",!e)}function Y(e){if(cur.share){var t=cur.share._els,n=t.header,i=t.content,a=t.bottom;i.classList.add("ShareLists--transition"),z(!0),q(n,e?"ShareHeaderGroupsPanel":"ShareHeaderConversationsPanel"),q(i,e?"ShareGroups":"ShareConversations"),q(a,e?"":"ActionsPanel"),setTimeout((function(){i.classList.remove("ShareLists--transition")}),300),Object(j.a)(".SharePanel--active ul",i).focus(),$(),F(e?Object(j.a)("#ShareGroups .ShareList__container"):Object(j.a)("#ShareConversations .ShareList__container"))}}function G(e){if(cur.share){var t=cur.share._els,n=t.header,a=t.bottom,o=X();D=e,z(!1),q(a,e?"":o),e&&q(n,"ShareHeaderConversationsSearchPanel",!0),!E.f&&window.innerWidth<T.d&&$(e),setTimeout((function(){browser.ios&&Object(i.gc)(document.activeElement)}),500)}}function Q(){if(cur.share){var e=cur.share._els,t=e.content,n=e.bottom,i=e.messageTextarea;q(n,"ExpandedMessagePanel"),t.classList.add("ShareLists--transition"),E.f||$(!1),i.focus({preventScroll:!0})}}function K(e){if(void 0===e&&(e=!0),cur.share){var t=cur.share,n=t.selected,a=t._els;Object(i.M)(B)&&(!function(){if(!cur.share)return;var e=cur.share.cache._cache,t=Object(j.a)(".ShareHeaderConversationsPanel"),n=Object(j.a)(".ShareHeaderConversationsPanel .SharePanel-headerText__receivers",t),i=cur.share.selected,a=i.length;t.classList.toggle("ShareHeaderConversationsPanel--hasReceivers",a>0);var o="";if(1===a){o=Object(c.t)("mobile_share_box_to_single");var r=e[i[0]][0];o=o.replace("{name}",r)}else if(2===a){o=Object(c.t)("mobile_share_box_to_couple");var s=e[i[0]][6]||e[i[0]][0],l=e[i[1]][6]||e[i[1]][0];o=o.replace("{name1}",s).replace("{name2}",l)}else if(a>2){o=Object(c.t)("mobile_share_box_to_many");var u=e[i[0]][6]||e[i[0]][0];o=o.replace("{name}",u).replace("{count}",a-1)}n.innerHTML=o}(),J());var o,r,s=X();q(a.bottom,s,e),o=n.length>1,r=cur.share._els.messagePanel,Object(j.a)(".Btn",r).innerHTML=o?Object(c.t)("mobile_share_message_many"):Object(c.t)("mobile_share_message_single")}}function X(){if(cur.share){var e=cur.share,t=e.selected,n=e.content,i=Object(j.a)(".SharePanel--active",n).getAttribute("data-name");return"ShareHeaderGroupsSearchPanel"===i||"ShareHeaderGroupsPanel"===i?"":document.activeElement&&document.activeElement.closest(".ExpandedMessagePanel")?"ExpandedMessagePanel":t.length>0?"MessagePanel":"ActionsPanel"}}function $(e){if(cur.share&&cur.share._els){var t=cur.share._els,n=t.header,a=t.bottom,o=t.content,r=t.groupsList;if(n&&a&&o){var s=400;(e=D||e)&&(s+=cur.share.lastBottomHeight-Object(i.U)(a)),a.clientHeight&&(cur.share.lastBottomHeight=a.clientHeight);var c=[n,a].reduce((function(e,t){var n=Object(j.a)(".SharePanel--active",t);return n&&(e+=n.clientHeight,Object(i.jc)(t,{height:n.clientHeight})),e}),0),l=Math.min(s,Object(i.S)()-c),u=c+l!==N;u||(z(!1),o.classList.remove("ShareLists--transition")),Object(i.jc)(r,{bottom:-a.clientHeight}),Object(i.jc)(o,{height:l}),u||z(!0),N=c+l}}}function J(){cur.share&&Object(i.D)(Object(i.N)("inline_item",Object(j.a)("ShareConversations__container")),(function(e,t){if(cur.share){var n=Object(i.mb)((t.id||"").substr(4)),a=-1!==cur.share.selected.indexOf(n);Object(i.vc)("inline_item_selected",t,a),t.setAttribute("aria-selected",a);var o=Object(j.a)('input[type="checkbox"]',t);o&&(o.checked=a)}}))}function Z(e){var t=cur.share._els.bookmarkButton;if(t){var n=Object(j.a)(".ActionsPanel-button__icon",t),i=Object(j.a)(".ActionsPanel-button__label",t);t.setAttribute("aria-pressed",e),e?(n.innerHTML=Wd.html(Object(l.ib)()),i.innerHTML=Object(c.t)("mobile_share_target_bookmark_active")):(n.innerHTML=Wd.html(Object(l.jb)()),i.innerHTML=Object(c.t)("mobile_share_target_bookmark")),window.thover.clear()}}function ee(e){var t=cur.share._els,n=t.bottom,o=t.processingPanel,r=this.mail_hash,s=this.object,l=this.list,u=this.appId,d=this.shouldInteractWithGlobalStories,_={_ajax:1,from:"share_box",hash:r,list:l,message:Object(j.a)(".ExpandedMessagePanel__textareaWrap textarea").value,to:cur.share.selected.join(","),app_id:u};k(cur.share.options.object)?_.media=s:_.link=s,z(!0),e&&Object(i.j)(e),q(n,"ProcessingPanel"),cur.share.blocked=!0,(s.startsWith("story")||s.startsWith("narrative"))&&!1!==d&&window.Stories.sendAnalyticsEvent("share_to_message"),setTimeout((function(){$()})),setTimeout((function(){$()}),350),window.ajax.post("/mail?act=send",_,{onDone:function(e){z(!0);var t=Object(j.a)(".ProcessingPanel__icon",o),n=Object(j.a)(".ProcessingPanel__label",o);t.classList.remove("ProcessingPanel__icon--loading");var i=e.error;t.innerHTML=Wd.html(i?Object(a.a)(Object(P.a)()):Object(a.a)(Object(M.a)())),n.innerText=i?Object(c.t)("mobile_share_state_error"):Object(c.t)("mobile_share_state_success"),setTimeout((function(){cur.app&&(i&&cur.app.hasOwnProperty("vkMiniAppShareFail")?cur.app.vkMiniAppShareFail():!i&&window.isFunction(cur.app.vkMiniAppShareSuccess)&&cur.app.vkMiniAppShareSuccess(0)),cur.share&&cur.share.destroy({isFail:i})}),1e3)}})}function te(e,t,n){void 0===n&&(n=!1),Object(i.Tb)(e);var a,o,r,s=cur.share._els.header;if("group"===t?(a=Object(i.M)("ShareHeaderGroupsSearchPanel__input"),o="ShareHeaderGroupsPanel",r=cur.shareGroupSearch):"peers"===t&&(a=Object(i.M)("ShareHeaderConversationsSearchPanel__input"),o="ShareHeaderConversationsPanel",r=cur.shareSearch),z(!1),a.value){if(n)return void z(!0);r.clear()}else"peers"===t?(q(s,o),G(!1)):(q(s,o),z(!0))}function ne(){var e,t=cur.share.options.object,n="unknown";if(k(cur.share.options.object)){e=/^([a-z_]+)(-?\d+)_(\d+)$/.exec(cur.share.options.object),n=e[1];var a=e[2],o=e[3];"app"===n&&"0"===o&&(t="app"+a),cur.share.options.list&&(t+="?list="+cur.share.options.list),t=t.replace("wall_reply","wall")}else cur.share.options.isVKApp&&(n="link");t=cur.share.options.external_url||t;var r=navigator.share({url:t});if(!r)return Object(i.oc)("mvk_share_external",n);r.then((function(){cur.share&&Object(i.oc)("mvk_share_external",n)}))}function ie(e,t,n){var a=e.split("_"),o=31,r=5,s=6,c=[o,r,3,s].includes(Object(i.tc)(t.bookmark_type)),l=[2,s].includes(t.bookmark_type);if(window.ajax.post("/bookmarks.php",{_ajax:1,from:"share_box",wide:l?1:0,star:c?1:0,act:t.is_bookmarked?"bookmark_remove":"bookmark_add",item_type:t.bookmark_type,item_oid:a[0],item_id:a[1],hash:t.bookmark_hash,link_url:t.link_url,link_title:t.link_title,link_img:t.link_img},{onDone:function(e,t,n,a,r){var s=Object(j.a)("."+e),c=Object(i.l)(t);s&&Object(i.ac)(c,s.parentNode),n&&n.item_type===o&&r&&Object(x.c)(x.a.addToBookmarks,n.item_oid,n.item_id,x.b.storyViewer)}}),t.bookmark_type===r&&window.Article.toggleButton(e,!t.is_bookmarked),t.bookmark_type===o&&!1!==t.shouldInteractWithGlobalStories){var u=Object(j.a)(".StoryMenu__button");window.Stories.toggleBookmark(u,!0)}t.is_bookmarked=!t.is_bookmarked,H.bookmarks[e]=t.is_bookmarked,n()}function ae(){$(!1)}var oe=function(e,t,n){var r=t.can_to_own,s=void 0===r||r,l=t.can_to_club,u=void 0===l||l,d=t.can_bookmark,_=t.is_bookmarked,p=t.from,h=t.post_from,f=t.list,m=t.targetOwnOnClick,v=t.appId,g=t.isVKApp;cur.share&&cur.share.destroy();var T=!k(t.object);if(!T||g){T&&!/^(https|http)?:\/\//i.test(t.object)&&(t.object="https://"+e,e=t.object),w.c&&w.c.close(),t.withoutScrollView||Object(y.c)(),T||(_=void 0!==H.bookmarks[e]?H.bookmarks[e]:_,t.is_bookmarked=_),Object(i.j)(n);var M=!!navigator.share,P=browser.ios?"iOS":"Android",x=Object(A.f)({on_overlay_click:"cur.share.destroy()",class:"ShareModal",attached:!0,body:b({targetOwnOnClick:!!m&&"cur.share.toOwnWall()",can_to_own:s,can_to_club:u,supportsExternalShare:M,platform:P,can_bookmark:d,is_bookmarked:_,list:f,from:p,post_from:h,object:t.object,isVKApp:t.isVKApp})}),N=t.withoutHash?null:"share";A.f.open(Wd.elem(x),!0,N,{swipeDown:!0,onClose:function(){cur.share&&cur.share.destroy({closeModal:!1})}});var D=Object(j.a)(".ShareModal"),F=Object(j.a)(".ShareHeader"),X=Object(j.a)(".ShareLists"),oe=Object(j.a)(".ShareBottom"),re=Object(j.a)(".ActionsPanel-button--bookmark"),se=Object(j.a)(".ActionsPanel-button--group");setTimeout((function(){!function(e){void 0===e&&(e={});cur.shareSearch=new window.QuickSearch;var t=e.appId?R+"&app_id="+e.appId:R,n=e.appId?R+"&app_id="+e.appId+B:"/hints?act=a_json_friends&mobile=1&from=imwrite&case=Nom&qs=1ShareConversations";cur.shareSearch.init({action:t,field:"ShareHeaderConversationsSearchPanel__input",container:B,top_len:20,onFocusChanged:function(e){e?C.d("top"):C.b(),$(e),setTimeout((function(){$(e)}),200)},tpl:function(e,t){return'<ul aria-multiselectable="true" aria-hidden="false" class="ScrollView ShareConversations__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(e,t){if(cur.share){var n=cur.share.cache._cache,i=n[this.id][0],o=!(!n[this.id][8]||!n[this.id][8].is_casper)?'<span class="ShareConversationsCasperTitle">\n             <span class="ShareConversationsCasperTitle__text">'+this.highlight(i)+'</span>\n             <span class="ShareConversationsCasperTitle__icon">'+Wd.html(Object(a.a)(Object(I.a)()))+"</span>\n           </span>":this.highlight(i),r=-1!==cur.share.selected.indexOf(+this.id)?"inline_item_selected":"",s=Wd.html(Object(L.a)({mode:Object(c.q)({id:this.id,name:i}),backgroundTheme:this.id,text:i,textLength:Object(c.r)(this.id),src:t,size:44,mix:"ii_img",attrs:{"aria-hidden":"true"}}));return'\n        <label aria-label="'+i+'" tabindex="0" role="checkbox" id="peer'+this.id+'" onclick="cur.share.select('+this.id+', this)" class="inline_item active '+r+'">\n          <input type="checkbox" style="display: none;">\n            '+s+'\n            <div class="ii_body">\n              <div class="ii_owner">\n                 '+o+"\n              </div>\n            </div>\n          </input>\n        </label>\n      "}},null_tpl:function(e){var t=Object(c.t)("mobile_friends_search_not_found").replace("%s",Object(i.ib)(e));return e||(t=Object(c.t)("mobile_share_list_no_friends")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}}),cur.share.cache=window.QuickSearchCache[n],J()}({appId:v})}),250),Object(i.b)(re,"click",ie.bind(this,e,t,(function(){Z(t.is_bookmarked)})),{passive:!0}),Object(i.b)(se,"click",(function(){Y(!0)}),{passive:!0});var ce=Object(j.a)(".ExpandedMessagePanel textarea"),le=Object(j.a)(".MessagePanel__input input");ce.value=t.message||"",le.value=t.message||"",Object(o.b)(ce),Object(i.b)(ce,"input blur focus",(function(e){var t=cur.share._els.content;le.value=ce.value.replace(/\n/gi," "),z(!1),"input"===e.type&&$(!1),"focus"===e.type&&(t.classList.remove("ShareLists--transition"),D.classList.add("ModalMenu--blocked"),D.classList.add("ModalMenu--focused"),C.d("bottom"),setTimeout((function(){K(!0),z(!1),$()}),100)),"blur"===e.type&&(D.classList.remove("ModalMenu--blocked"),e.preventDefault(),e.stopPropagation(),C.b(),z(!1),D.classList.remove("ModalMenu--focused"),E.f||$(!1),setTimeout((function(){K(!1),z(!1),$()}),100))})),Object(i.b)(Object(j.a)(".ExpandedMessagePanelSend"),"click touchend",(function(e){e.stopPropagation(),e.preventDefault(),document.activeElement&&document.activeElement.blur(),cur.share.sendMessage()}),{capture:!0}),Object(i.b)(ce,"touchmove",(function(e){Object(i.pc)(e)}),{capture:!0}),C.c(ae),Object(i.b)(ce,"keydown",(function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey&&browser.mac)&&cur.share.sendMessage(e)}));var ue={act:"publish_box",object:"null"};v&&(ue.app_id=v),t.object?(ue.object=t.object,t.list&&(ue.list=t.list)):T&&(ue.link=e,delete ue.object);var de=Object(S.b)("/like",ue);cur.share={open:!0,onClose:Object(O.a)(),go:V,options:t,externalShare:ne,actionBox:de,blocked:!1,updateHeights:$,_els:{actionsPanel:Object(j.a)(".ActionsPanel"),messagePanel:Object(j.a)(".MessagePanel"),processingPanel:Object(j.a)(".ProcessingPanel"),groupsList:Object(i.M)("ShareGroups"),conversationsList:Object(i.M)("ShareConversations"),bookmarkButton:re,messageTextarea:ce,header:F,content:X,bottom:oe},selected:[],expandMessage:Q,toggleGroupsPanel:Y,toggleConversationsSearch:G,select:W,clearSearch:te,setActivePanel:q,onScroll:U,sendMessage:ee.bind(t),lastBottomHeight:oe.clientHeight,destroy:function(e){void 0===e&&(e={}),e=Object(i.K)({closeModal:!0,isFail:!0,isNavigation:!1},e),C.a(ae);var t=Object(j.a)(".ShareModal");e.isFail&&cur.app&&cur.app.vkMiniAppShareFail&&cur.app.vkMiniAppShareFail(),t&&e.closeModal&&A.f.close(t),cur.share&&(cur.share.onClose(e.isNavigation),cur.share.open=!1),cur.share.options.withoutScrollView||Object(y.d)(),delete cur.share,delete cur.shareSearch,delete cur.shareGroupSearch}},m&&(cur.share.toOwnWall=m),setTimeout((function(){!function(){cur.shareGroupSearch=new window.QuickSearch;var e=window.Icon({icon:"chevron_right"});if(!cur.share||!cur.share.options.can_to_club)return;cur.shareGroupSearch.init({load_once:!0,field:"ShareHeaderGroupsSearchPanel__input",container:"ShareGroups",action:cur.share.actionBox,onFocusChanged:function(e){e?C.d("top"):C.b(),setTimeout((function(){$(!1)}),100)},tpl:function(e,t){return'<ul aria-hidden="true"  class="ScrollView ShareGroups__container ShareList__container" onscroll="cur.share.onScroll(this)">'+e+"</ul>"},item_tpl:function(t,n){if(!cur.share)return"";var a=function(){if(!cur.share)return{};var e=cur.share.actionBox+"ShareGroups";return window.QuickSearchCache[e]}()._cache[this.id][0],o=cur.share.options,r=o.object,s=o.list,l=o.from,u=o.post_from,d={act:"add",share_box:"1"};r&&(d=Object(i.K)(d,{object:r,list:s,from:l,post_from:u})),cur.share.options.isVKApp&&(d.is_vk_app=+cur.share.options.isVKApp);var _=Object(S.b)("/wall"+this.id,d),p=Wd.html(Object(L.a)({mode:Object(c.q)({id:this.id,name:a}),backgroundTheme:this.id,text:a,textLength:Object(c.r)(this.id),src:n,size:44,mix:"ii_img",attrs:{"aria-hidden":"true"}}));return'\n        <li aria-label="'+a+'" tabindex="0" role="link" id="group'+this.id+'" onclick="cur.share.go(\''+_+"', "+cur.share.options.isVKApp+')" class="inline_item " xmlns="http://www.w3.org/1999/html">\n          '+p+'\n          <div class="ii_body">\n            <div class="ii_owner">\n               '+this.highlight(a)+'\n            </div>\n            <div class="ii_go">\n               '+e+"\n            </div>\n          </div>\n        </li>\n      "},null_tpl:function(e){var t=Object(c.t)("mobile_groups_no_groups_found");return e||(t=Object(c.t)("mobile_share_list_no_groups")),'<div class="service_msg_box"><div class="service_msg service_msg_null">'+t+"</div></div>"}})}()}),300),Z(_),$(),F.closest(".Share").focus(),window.onBodyResize((function(){document.activeElement&&"INPUT"===document.activeElement.tagName?$(!0):$(!1),setTimeout((function(){z(!0)}),150)})),window.onBodyResize(!0)}else console.warn("Can't share link outside miniapp")};window.Share=oe,Object(i.K)(window.Share,{setBookmarkState:function(e,t){H.bookmarks[e]=t}})},"BJj/":function(e,t,n){"use strict";function i(e,t,n){var i;return function(){var a=this,o=arguments,r=function(){i=null,n||e.apply(a,o)},s=n&&!i;clearTimeout(i),i=setTimeout(r,t),s&&e.apply(this,o)}}n.d(t,"a",(function(){return i}))},BLcx:function(e,t){var n,i=(n=document.getElementsByClassName("gift_create_post_counter"),{counter:function(e){var t=n[0];if(t){var i=e.value.length,a=e.maxLength;if(i>a)e.value=e.value.substr(0,a);else if(i>a/2){var o=Math.max(a-i,0);t.innerText=langNumeric(o,lang.text_N_symbols_remain),show(t)}else hide(t)}}});window.GiftsSendFormCounter=i},BZzM:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));function i(e,t,n){var i=ge(t)||document,a="[data-poster-resized='false']";(e||n)&&(a="");var o=domQuery(".poster__text"+a,i),r=[],s=cur.posterConfig&&cur.posterConfig.constants;if(!s){if(!o.length)return;s=JSON.parse(domData(o[0].parentElement,"poster-constants"))}for(var c=0;c<o.length;c++){var l=o[c],u=domPN(l);r.push(domPN(u).clientWidth)}for(var d=0;d<o.length;d++){var _=o[d],p=domPN(_),h=r[d],f=s.font_size_ratio_range_1*h+"px",m=Math.round(s.line_height_ratio_range_1*h)+"px",v="0 "+Math.round(h*(1/18))+"px";_.textContent.length>s.range_threshold&&(f=Math.round(s.font_size_ratio_range_2*h)+"px",m=Math.round(s.line_height_ratio_range_2*h)+"px"),setStyle(p,{height:h*(3/4)+"px",width:h}),setStyle(_,{fontSize:f,lineHeight:m,padding:v}),domData(_,"poster-resized",!0)}}},BoyB:function(e,t,n){"use strict";var i=n("TYsd"),a=n("z9sQ"),o=n("EDm3"),r=function(e){void 0===e&&(e={});var t=[e.class||e.mix,a.a.class("Loading",{white:e.white,large:e.large,spinner:e.spinner},"_")];if(e.spinner)return i.a.html({inner:[Object(o.s)()],class:t,tag:"div"});return i.a.html({inner:[{inner:[[{class:"Loading__item Loading__item_0",tag:"div"},{class:"Loading__item Loading__item_1",tag:"div"},{class:"Loading__item Loading__item_2",tag:"div"}]],class:"Loading__items",tag:"div"}],class:t,tag:"div"})};t.a=r;window.Loading=r},CQvH:function(e,t,n){"use strict";n.d(t,"b",(function(){return b})),n.d(t,"d",(function(){return A})),n.d(t,"e",(function(){return w})),n.d(t,"a",(function(){return y})),n.d(t,"c",(function(){return O}));var i=n("OcsD"),a=n("H5mD");n("UxAg");var o=function(){function e(e){var t=e.capacity,n=void 0===t?1:t;this._capacity=n,this.clear()}var t=e.prototype;return t.add=function(e){this._cursor>=this._capacity&&(this._cursor=0),this._buffer[this._cursor]=e,this._cursor++,this._size<this._capacity&&this._size++},t.clear=function(){this._buffer=Array(this._capacity),this._cursor=0,this._size=0},t.size=function(){return this._size},t.toArray=function(){return this._buffer},e}(),r=n("DM2o"),s=n("Cz26"),c=n("W9Tc");!function(){var e=new o({capacity:15}),t=new o({capacity:15}),n=new o({capacity:15}),i=new o({capacity:15}),a=null;if(window.addEventListener("mousemove",(function(){if(a){var t=Date.now()-a;t>500&&(t-500<500&&e.add(!1),a=null)}else a=Date.now()}),{capture:!0,passive:!0}),new s.a({timer:1e4}).add((function(){e.add(!0)})),window.addEventListener("touchstart",(function(e){if(e&&e.touches)if(e.touches.length>1)t.add(!1);else{if(1===e.touches.length){var n=e.touches[0];if(0!==n.radiusX&&0!==n.radiusY)return void t.add(!1)}t.add(!0)}}),{capture:!0,passive:!0}),window.addEventListener("click",(function(a){if(a&&a.target){var o=0===a.pageX&&0===a.pageY&&0===a.screenX&&0===a.screenY,s=a.target.getBoundingClientRect(),c=Math.abs(s.width/2+s.left-a.clientX)<2&&Math.abs(s.height/2+s.top-a.clientY)<2;if(o||c){n.add(!0);try{i.add(function e(t){if(t.id)return"#"+t.id;var n=t.tagName.toLowerCase(),i="";t.name&&(i+='[name="'+t.name+'"]');var a="";!i&&t.className&&(a=t.className.split(/ +/g).map((function(e){return"."+e})).join(""));var o="";if(!i)for(var r=0,s=0;s<t.parentNode.children.length;s++){var c=t.parentNode.children[s];if(c.tagName===t.tagName&&r++,t===c){o=":nth-of-type("+r+")";break}}var l=n+i+a+o;return t.parentNode===document.body?"body > "+l:e(t.parentNode)+" > "+l}(a.target)+"—"+c+"—"+o)}catch(e){}}else n.add(!1),i.add(!1);if(n.size()>3){var l=e.toArray().filter((function(e){return e})).length>=Math.round(e.size()/2),u=t.toArray().filter((function(e){return e})).length>=Math.round(t.size()/2),d=n.toArray().filter((function(e){return e})).length>=Math.round(n.size()/2);if(localStorage&&localStorage.getItem){var _=localStorage.getItem("isKeyboardUser1"),p=d&&u&&l,h=document.querySelector(".keyboardUser");h&&(p?(h.style.display="block",h.innerHTML=e.toArray().filter((function(e){return e})).length+"."+t.toArray().filter((function(e){return e})).length+"."+n.toArray().filter((function(e){return e})).length):h.style.display="none"),(p&&null===_||null!==_&&_!==String(p))&&(localStorage.setItem("isKeyboardUser1",p),Object(r.a)("accessibility","is_keyboard_user",p))}}}}),{capture:!0,passive:!0}),Object(c.b)("mvk_show_a11y_box")){var l=window.onDOMReady||function(e){setTimeout(e,5e3)};l&&l((function(){if(document.body&&!document.querySelector(".keyboardUser")){var e=document.createElement("div");e.style.background="rgba(230,0,255,.7)",e.style.position="fixed",e.style.top="3px",e.style.right="3px",e.style.color="#fff",e.style.fontSize="10px",e.style.minWidth="8px",e.style.height="14px",e.style.lineHeight="14px",e.style.textAlign="center",e.style.border="1px solid rgba(255,255,255, 0.2)",e.style.display="none",e.style.zIndex=9999999999,e.innerHTML="K",e.style.padding="0 3px",e.className="keyboardUser";var t=document.createElement("textarea");if(t.style.position="fixed",t.style.opacity=.9,t.style.top=0,t.style.right=0,t.style.bottom=0,t.style.left=0,t.style.width="100%",t.style.padding="10px",t.style.zIndex=9999999,t.style.display="none",document.body.appendChild(t),e.addEventListener("click",(function(){t.innerHTML=i.toArray().join("\n\n"),"none"===t.style.display?t.style.display="block":t.style.display="none"})),document.body.appendChild(e),localStorage&&localStorage.getItem)"true"===localStorage.getItem("isKeyboardUser1")&&(e.style.display="block")}}))}}();var l=38,u=40,d=36,_=35,p=32,h=13,f=27,m=9,v=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","audio","video","[contenteditable]","[tabindex]"];function g(){document.body.classList.add("tabbing")}function b(){return document.body.classList.contains("tabbing")}function A(e){if(a.f&&a.e>8)return!1;if(!e)throw new Error("A11y: No element passed to setFocusTrap");var t=Array.from(e.querySelectorAll(v.join()));if(!(t=t.filter((function(e){return null!==e.offsetParent}))).length)return!1;var n=t[0],i=t[t.length-1],o=j(e,(function(e){var t=e.event,a=e.exit;t.keyCode===m&&(t.shiftKey?document.activeElement===n&&(t.preventDefault(),i.focus()):document.activeElement===i&&(t.preventDefault(),n.focus())),t.keyCode===f&&a()}));return cur.destroy.push((function(){o()})),setTimeout((function(){n.focus()})),o}function w(e,t){void 0===t&&(t={});var n=void 0===t.enableInitialFocus||t.enableInitialFocus;if(a.f&&a.e>8)return!1;if(!e)throw new Error("A11y: No element passed to setMenuNavigation");if(!["menu","menubar"].includes(e.getAttribute("role")))throw new Error('A11y: Element must be `role="menu"` or `role="menubar"`');var i=['[role="menu"]','[role="menubar"]'].join(),o=['[role="menuitem"]','[role="menuitemradio"]','[role="menuitemcheckbox"]'].join(),r=Array.from(e.querySelectorAll(i)),s=Array.from(e.querySelectorAll(o));if(r.forEach((function(e){Array.from(e.querySelectorAll(o)).forEach((function(e){s[s.indexOf(e)]=null}))})),!(s=(s=s.filter((function(e){return e}))).filter((function(e){return null!==e.offsetParent}))).length)return!1;if("menu"===e.getAttribute("role")&&!s.every((function(e){return"-1"===e.getAttribute("tabindex")})))throw new Error('A11y: Every `menuitem` must have `tabindex="-1" attribute`');var c=j(e,(function(e){var t=e.event,n=e.exit,i=document.activeElement,a=s[0],o=s[s.length-1||0],r=s.indexOf(i),c=s[r+1],v=s[r-1];t.keyCode===l&&(v?k(v,t):o&&k(o,t)),t.keyCode===u&&(c?k(c,t):a&&k(a,t)),t.keyCode===d&&a&&k(a,t),t.keyCode===_&&o&&k(o,t),t.keyCode!==p&&t.keyCode!==h||(n(),i.click(),t.preventDefault()),t.keyCode!==f&&t.keyCode!==m||n()}),{onExit:function(){}});return n&&setTimeout((function(){k(s[0])})),c}function y(e){if(!e)throw new Error("A11y: No element passed to expandPopup");if(!e.getAttribute("aria-haspopup"))throw new Error("A11y: No `aria-haspopup` attribute on expanded element");if(null==e.getAttribute("aria-expanded"))throw new Error("A11y: No `aria-expanded` attribute on expanded element");if(null==e.getAttribute("aria-controls"))throw new Error("A11y: No `aria-controls` attribute on expanded element");if(!document.getElementById(e.getAttribute("aria-controls")))throw new Error("A11y: No element that the `aria-controls` refers to. Try to call `expandPopup` _after_ appending a popup");return e.setAttribute("aria-expanded",!0),j(e,(function(e){var t=e.event,n=e.exit;t.keyCode===f&&n()}),{onExit:function(){e.setAttribute("aria-expanded",!1)}})}function O(e,t){var n,i;void 0===t&&(t={});var a=null!=(n=t.startThreshold)?n:10,o=null!=(i=t.ignoreBubbledEvents)&&i;return new Promise((function(t){var n=setTimeout((function(){e.removeEventListener("transitionrun",i),t()}),a),i=function i(a){if(o&&a.target!==a.currentTarget)return!1;clearTimeout(n),e.removeEventListener("transitionrun",i);e.addEventListener("transitionend",(function n(i){if(o&&i.target!==i.currentTarget)return!1;e.removeEventListener("transitionend",n),t()}),!1)};e.addEventListener("transitionrun",i,!1)}))}function k(e,t){t&&(g(),t.preventDefault());var n=!1;null!=e.getAttribute("tabindex")&&(n=!0),n||e.setAttribute("tabindex",0),e.focus(),setTimeout((function(){n||e.removeAttribute("tabindex")}))}function j(e,t,n){void 0===n&&(n={}),e._enteredA11yElementKeyDownHandler&&document.removeEventListener("keydown",e._enteredA11yElementKeyDownHandler);var a=document.activeElement,o=!1;function r(t){if(t&&r.exitIntent&&!1===r.exitIntent(t))t.preventDefault();else if(!o){o=!0;var c=Object(i.gc)(),l=Array.from(e.querySelectorAll(v.join()));document.activeElement&&!l.includes(document.activeElement)||(a&&k(a),Object(i.gc)(c)),document.removeEventListener("keydown",s),n.onExit&&n.onExit()}}function s(e){e.ctrlKey||e.altKey||e.metaKey||t({event:e,exit:r.bind(null,e)})}return document.addEventListener("keydown",s),e._enteredA11yElementKeyDownHandler=s,r}addEvent(window,"keydown",(function(e){e.keyCode===m&&g()}),{passive:!0}),addEvent(window,"mousedown touchstart",(function(){document.body.classList.remove("tabbing")}),{capture:!0,passive:!0}),document._buttonA11yFix||(document._buttonA11yFix=!0,document.addEventListener("keydown",(function(e){e.ctrlKey||e.altKey||e.metaKey||(e.keyCode!==h&&e.keyCode!==p||"button"!==e.target.getAttribute("role")||(e.target.click(),e.preventDefault()),e.keyCode!==p||"checkbox"!==e.target.getAttribute("role")&&"radio"!==e.target.getAttribute("role")||(e.target.click(),e.preventDefault()))})))},Cbap:function(e,t,n){"use strict";var i=function(){function e(){this.routes=[]}e.getRouter=function(){return window.router||(window.router=new e),window.router};var t=e.prototype;return t.addRoute=function(e,t,n){this.routes.push({isActive:!1,test:e,activateCallback:t,deactivateCallback:n})},t.test=function(e){var t=e.test;if(nav.cur)return"function"==typeof t?t(window.nav.cur):t instanceof RegExp?t.test(window.nav.cur):!(!window.nav.cur||"string"!=typeof t)&&window.nav.cur.startsWith(t)},t.deactivateAllRoutes=function(){this.routes=this.routes.map((function(e){return e.isActive=!1,e.deactivateCallback&&e.deactivateCallback(),e}))},t.checkRoutes=function(){var e=this;this.routes=this.routes.map((function(t){var n=e.test(t);return n&&t.activateCallback&&t.activateCallback(),!n&&t.isActive&&t.deactivateCallback&&t.deactivateCallback(),t.isActive=n,t}))},e}();t.a=i,window.Router=i},CkGd:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("9y81");function r(){var e=Object(i.a)(['\n    <div class="','" ',">","</div>\n  "]);return r=function(){return e},e}function s(){var e=Object(i.a)(['\n    <button class="','" aria-label="','" ',"></button>\n  "]);return s=function(){return e},e}function c(){var e=Object(i.a)(['\n    <button class="Btn Btn_theme_small ','" ',">\n      ","\n    </button>\n  "]);return c=function(){return e},e}function l(){var e=Object(i.a)(['\n    <div class="','">\n\n      ','\n\n      <div class="mailActs__counter"></div>\n\n      <div class="mailActs__buttons">\n        <div class="mailActs__buttonsIn">\n          ',"\n          ",'\n        </div>\n        <div class="mailActs__chevron">\n          <div class="mailActs__chevronIn">\n            ',"\n            ","\n            ","\n            ","\n            ",'\n          </div>\n          <div class="mailActs__chevronMore">\n            <div class="mailActs__chevronMoreIcon" ','></div>\n            <div class="mailActs__chevronList">\n              ',"\n              ","\n              ","\n              ","\n              ","\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n  "]);return l=function(){return e},e}var u=function(e){e||(e={});window.lang;var t=a.a.onClick("MailActs._onMoreClick"),n=Object(o.b)({mix:"mailActs__close",icon:"close12",attrs:a.a.onClick("MailActs._onCloseClick")}),i=d("reply"),r=d("forward"),s=_("edit",e),c=_("pin",e),u=_("important",e),h=_("remove",e),f=_("spam",e),m=p("edit",e),v=p("pin",e),g=p("important",e),b=p("remove",e),A=p("spam",e),w=a.a.class("mailActs",{canPin:e.canPin,pinned:e.isPinned,important:e.isImportant,isChannel:e.isChannel,isEdu:e.isEdu});return a.a.html(l(),w,n,i,r,s,c,u,h,f,t,m,v,g,b,A)};function d(e){var t=window.lang,n=a.a.class("mailActs__button",{type:e}),i=a.a.onClick("MailActs._onButtonClick",e),o="reply"===e?t.mobile_mail_messages_actions_reply:t.mobile_mail_messages_actions_forward;return a.a.html(c(),n,i,o)}function _(e,t){var n,i=window.lang,o=a.a.class("mailActs__icon",{type:e}),r=a.a.onClick("MailActs._onButtonClick",e),c=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,l=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=c;break;case"important":n=l;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.a.html(s(),o,n,r)}function p(e,t){var n,i=window.lang,o=a.a.class("mailActs__chevronListItem",{type:e}),s=a.a.onClick("MailActs._onButtonClick",e),c=t.isPinned?i.mobile_mail_messages_actions_unpin:i.mobile_mail_messages_actions_pin,l=t.isImportant?i.mobile_mail_messages_actions_important_off:i.mobile_mail_messages_actions_important;switch(e){case"edit":n=i.mobile_mail_messages_actions_edit;break;case"pin":n=c;break;case"important":n=l;break;case"remove":n=i.mobile_mail_messages_actions_delete;break;case"spam":n=i.mobile_mail_messages_actions_spam}return a.a.html(r(),o,s,n)}var h,f=n("UxAg"),m=n("+cqQ");function v(){store.mail.cur&&O()}function g(e){store.mail.cur&&function(e){var t=e.target,n=$(".mailActs");n&&n.classList.contains("mailActs_menuOpened")&&!t.closest(".mailActs__chevronList")&&!t.closest(".mailActs__chevronMoreIcon")&&n.classList.remove("mailActs_menuOpened")}(e)}function b(e){w({canEdit:e})}function A(e){$(".mailActs__button_type_forward").disabled=!e}function w(e){Object(f.b)(".mailActs").forEach((function(t){var n=a.a.parseClass("mailActs",t.getAttribute("class"));t.setAttribute("class",a.a.class("mailActs",Object.assign({},n,e)))}))}function y(e){switch(e){case"edit":u.onEditClick();break;case"remove":u.onRemoveClick();break;case"important":u.onImportantClick();break;case"reply":u.onReplyClick();break;case"forward":u.onForwardClick();break;case"spam":u.onSpamClick();break;case"pin":u.onPinClick()}}function O(){var e=document.querySelector(".mailActs__chevron"),t=e.offsetWidth-1,n=e.querySelectorAll(".mailActs__chevronListItem"),i=e.querySelectorAll(".mailActs__icon");Array.prototype.forEach.call(i,(function(e,a){t<36*i.length?t-34>=36*(a+1)?(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden")):(e.classList.add("mailActs__icon_hidden"),n[a].classList.remove("mailActs__chevronListItem_hidden")):(e.classList.remove("mailActs__icon_hidden"),n[a].classList.add("mailActs__chevronListItem_hidden"))})),w({cutted:t<36*i.length})}function k(){Object(f.b)(".mailActs").forEach((function(e){return e.classList.toggle("mailActs_menuOpened")}))}Object.assign(u,((h={onCloseClick:Object(m.a)(),onRemoveClick:Object(m.a)(),onImportantClick:Object(m.a)(),onReplyClick:Object(m.a)(),onForwardClick:Object(m.a)(),onSpamClick:Object(m.a)(),onPinClick:Object(m.a)(),onMoreClick:Object(m.a)(),onEditClick:Object(m.a)(),setCount:function(e){var t=langNumeric(e,lang.mobile_mail_messages_selected).replace("{count}",e);Object(f.b)(".mailActs__counter").forEach((function(e){return e.innerText=t})),1!=e&&b(!1);O()},setEditAvailable:b,setImportantAvailable:function(e){w({canImportant:e})},toggleQuickButtons:function(e){$(".mailActs__buttonsIn").hidden=!e},setForwardAvailable:A,setReplyAvailable:function(e){$(".mailActs__button_type_reply").disabled=!e}}).setForwardAvailable=A,h.togglePin=function(e){Object(f.b)(".mailActs").forEach((function(t){return t.classList.toggle("mailActs_canPin",e)}))},h.setModifiers=w,h.setLabels=function(e){var t=window.lang,n=e.pinned?t.mobile_mail_messages_actions_unpin:t.mobile_mail_messages_actions_pin,i=e.important?t.mobile_mail_messages_actions_important_off:t.mobile_mail_messages_actions_important;$(".mailActs__icon_type_pin").setAttribute("aria-label",n),$(".mailActs__icon_type_important").setAttribute("aria-label",i),$(".mailActs__chevronListItem_type_pin").innerHTML=n,$(".mailActs__chevronListItem_type_important").innerHTML=i},h.update=O,h)),u._onButtonClick=y,u._onCloseClick=u.onCloseClick,u._onMoreClick=k,onBodyResize(v),document.addEventListener("click",g,{passive:!0});t.default=u;window.MailActs=u},Cz26:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(){function e(e){var t=e.timer,n=void 0===t?1e3:t,i=e.autostart,a=void 0===i||i;this._list=[],this._timer=n,this._autostart=a}var t=e.prototype;return t._animate=function(e){var t=!1;return function n(){t||requestAnimationFrame((function(){t||(e(),n())}))}(),function(){t=!0}},t.add=function(e,t){var n=(void 0===t?{}:t).id;this.remove(e),n?(this.remove(n),this._list.push({id:n,callback:e})):this._list.push({callback:e}),!this._cancellation&&this._autostart&&this.start()},t.remove=function(e){this._list="function"==typeof e?this._list.filter((function(t){return t.callback!==e})):this._list.filter((function(t){return t.id!==e}))},t.start=function(){var e=this,t=Date.now();return this._cancellation=this._animate((function(){var n=Date.now();t+e._timer<n&&(e._list.forEach((function(n){var i=t;Promise.resolve().then((function(){var t=Date.now()-(i+e._timer);n.callback(Math.floor(t/e._timer)+1)}))})),t=n)})),this._cancellation},t.stop=function(){return!!this._cancellation&&(this._cancellation(),this._list=[],!0)},e}()},DLiR:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=new(function(){function e(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return e.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},e.prototype.requestWakeLock=function(){var e=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(t){e.wakeLockSentinel=t})):Promise.reject()},e.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},e.prototype.lock=function(){var e=this;return this.requestWakeLock().then((function(){e.wakeLockSentinel&&document.addEventListener("visibilitychange",e.onVisibilityChange)})).catch((function(){}))},e.prototype.unlock=function(){var e=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){e.wakeLockSentinel=null}))):Promise.resolve()},e}())},DOEQ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i="donut_duration"},DVnk:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedFriends"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_SLIDER){if(e._friendsSliderHandlersAdded)return;e._friendsSliderHandlersAdded=!0}}))},Dh0N:function(e,t){function n(e,t){var n=t.$select,o=t.value;n.closest(i.email).classList.toggle(a.groupsVisible,e.includes(o)||e.includes(Number(o)))}window.SettingsEmail={},SettingsEmail._onFrequencyChange=n;var i={email:".settingsEmail"},a={groupsVisible:"settingsEmail_groupsVisible"}},DkIl:function(e,t,n){"use strict";n.r(t),n.d(t,"MailHat",(function(){return i.a})),n.d(t,"MailHat__Title",(function(){return i.b})),n.d(t,"MailHat__icon",(function(){return i.d})),n.d(t,"MailHat_main",(function(){return i.g})),n.d(t,"MailHat_convo",(function(){return i.e})),n.d(t,"MailHat_page",(function(){return i.h}));var i=n("k9Tg"),a=n("UxAg"),o=n("bZ/P"),r=n("+cqQ"),s=n("gy8s");function c(e){Object(a.b)(".mailHat").forEach((function(t){var n=o.a.parseClass("mailHat",t.getAttribute("class"));t.setAttribute("class",o.a.class("mailHat",Object.assign({},n,e)))}))}Object.assign(i.g,{onUnreadClick:Object(r.a)(),onBurgerClick:Object(r.a)(),onCancelForwardTap:Object(r.a)(),setFolder:function(e){Object(a.b)(".mailHat__folder").forEach((function(t){s.a.setActive(t,e)}))},setImportantCount:function(e){Object(a.b)(".mailHat__folder").forEach((function(t){s.a.setCount(t,"important",e)}))},setForwarding:function(e){Object(a.b)(".mailHat_type_main").forEach((function(t){return t.classList.toggle("mailHat_forwarding",e)}))},setModifiers:c}),Object.assign(i.e,{onBackTap:Object(r.a)(),onCancelEditingTap:Object(r.a)(),setOnline:function(e,t){var n=Object(i.f)(e,t);Object(a.b)(".mailHat__convoDetailsText").forEach((function(e){return e.innerText=n}))},setMobile:function(e){Object(a.b)(".mailHat__convo").forEach((function(t){return t.classList.toggle("mailHat__convo_mobile",e)}))},setHasPinnedMsg:function(e){Object(a.b)(".mailHat_type_convo").forEach((function(t){return t.classList.toggle("mailHat_hasPinnedMsg",e)}))},setModifiers:c}),window.MailHat_main=i.g,window.MailHat_convo=i.e},EEfc:function(e,t,n){"use strict";var i,a;n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return u}));var o="mvk"===(null===(a=null===(i=window.vk)||void 0===i?void 0:i.statsMeta)||void 0===a?void 0:a.platform),r=36e5,s={feed:8*r,im:6*r,profile:6*r,audio:6*r,apps:6*r,group:4*r,groups:4*r,public:4*r,video:8*r,wall:8*r,board:4*r,photos:4*r,activation:6*r,"i-oauth":6*r,mail:6*r},c=["unknown","app","docs","invite","wall_donut","wall_archive","support","helpdesk","abuse","noSpam","sf"],l=o?{group:.05,index:.05,profile:.05,video:.1,feed:.05,mail:.1,wall:.2,login:.2,"i-oauth":.05,notifications:.3,recommended:.3,search:.4,menu:.4,join:.5}:{feed:.025,im:.05,profile:.075,public:.1,groups:.2,groups_list:.3,audio:.3,photos:.3,friends:.4,board:.5,video:.5,wall:.5},u={FID:300,LCP:4e3,CLS:.25,TTFB:600,FCP:3e3}},EXR0:function(e,t,n){"use strict";var i=n("+sJP"),a=n("EDm3");t.a=function(e){return void 0===e&&(e={}),{inner:[{inner:[Object(a.z)()],class:"ModalMenuHeader__close","aria-label":Object(i.t)("mobile_close"),onClick:e.onClose,tag:"button"},{inner:[e.inner],class:"ModalMenuHeader__title",tag:"div"}],class:"ModalMenuHeader",tag:"div"}}},EnJO:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i={screens:[],hash:"",replacedScreen:"",isEnabled:!1},a={setHash:function(e){i.hash=e},getHash:function(){return i.hash},getScreens:function(){var e=[];return i.screens.forEach((function(t){e.push(t)})),e},replaceScreen:function(e){i.replacedScreen=e},setScreen:function(e){i.screens.push(e),i.screens.length>5&&i.screens.shift()},getScreen:function(){return""!==i.replacedScreen?i.replacedScreen:i.screens.length>0?i.screens[i.screens.length-1]:""},getPrevScreen:function(){return i.screens.length>1?i.screens[i.screens.length-2]:""},popScreen:function(){return i.screens.length>0?String(i.screens.pop()):""},setEnabled:function(e){i.isEnabled=e},isEnabled:function(){return i.isEnabled}}},FbVm:function(e,t,n){"use strict";n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return v})),n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return w})),n.d(t,"f",(function(){return O})),n.d(t,"c",(function(){return i.j})),n.d(t,"i",(function(){return k})),n.d(t,"h",(function(){return j})),n.d(t,"g",(function(){return S})),n.d(t,"j",(function(){return C}));var i=n("r0fY"),a=n("J8bf"),o=function(){function e(){this.productStatCollector=new v,this.actionStatCollector=new b(this.productStatCollector)}return e.prototype.logEvent=function(e,t,n,o){var r;void 0===o&&(o="");var s={campaign:e,source:n,event:t,unauth_id:Object(a.a)("remixstid")};o&&(s.url=o);var c=((r={type:i.a.TYPE_MARKETING_TRANSITION_ITEM})[i.a.TYPE_MARKETING_TRANSITION_ITEM]=s,r);this.actionStatCollector.logEvent(c)},e}(),r=function(){function e(){this.productStatCollector=new v,this.actionStatCollector=new b(this.productStatCollector)}return e.prototype.logEvent=function(e,t,n,a){var o,r={webview_url:e,mini_app_id:t,event:n,error:a},s=((o={type:i.a.TYPE_BRIDGE_EVENT_ITEM})[i.a.TYPE_BRIDGE_EVENT_ITEM]=r,o);this.actionStatCollector.logEvent(s)},e}(),s=function(){function e(){this.productStatCollector=new v,this.actionStatCollector=new b(this.productStatCollector)}return e.prototype.logEvent=function(e,t,n,a){var o,r={egg_id:e,egg_event_id:t,position_id:n,event_type:a},s=((o={type:i.a.TYPE_EASTER_EGGS_ITEM})[i.a.TYPE_EASTER_EGGS_ITEM]=r,o);this.actionStatCollector.logEvent(s)},e}(),c=function(){function e(){this.productStatCollector=new v,this.clickStatCollector=new w(this.productStatCollector)}return e.prototype.logEvent=function(e,t,n){var a,o={type:n},r=((a={type:i.b.TYPE_MINI_APP_ITEM})[i.b.TYPE_MINI_APP_ITEM]=o,a),s={type:t,id:e};this.clickStatCollector.logEvent(r,s)},e}(),l=function(){return(l=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u=function(){function e(){this.productStatCollector=new v,this.viewStatCollector=new O(this.productStatCollector)}return e.prototype.logEvent=function(e,t,n,a){var o;void 0===n&&(n=""),void 0===a&&(a="");var r=l(l({},e),t),s=((o={type:i.n.TYPE_MINI_APPS_VIEW_ITEM})[i.n.TYPE_MINI_APPS_VIEW_ITEM]=r,o.start_view=n,o.end_view=a,o);this.viewStatCollector.logEvent(s,e)},e}(),d=n("HLtZ"),_=n("W9Tc"),p=function(){return(p=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},h=function(){function e(e){this.ProductionStatCollector=e,this.tabId=this.ProductionStatCollector.getIntId()%128}return e.prototype.logEvent=function(e){var t,n=p(p({},this.ProductionStatCollector.getBaseEvent()),((t={type:i.k.TYPE_NAVGO})[i.k.TYPE_NAVGO]=e,t));return this.ProductionStatCollector.logEvent(n),{statEvent:n}},e.prototype.getEventTabOpen=function(e){return{subtype:i.j.TAB_OPEN,tab_id:this.tabId,screen:e}},e.prototype.getEventMove=function(e,t){var n,a,o=this.lastStatEvents,r=this.lastNavEvents;return o&&r?(r.subtype===i.j.TAB_OPEN?n=r.screen:(n=r.screen_to,a=r.screen),{prev_navgo_id:o.id,subtype:t,screen:n,screen_to:e,screen_prev:a,prev_navgo_timestamp:o.timestamp,tab_id:this.tabId}):(Object(d.b)(new Error("NavigationStatCollector: previous event not found.")),null)},e.prototype.addStatEvent=function(e,t){if(void 0===t&&(t=i.j.GO),Object(_.b)("navigation_timespent")){var n;if(t===i.j.TAB_OPEN)n=this.getEventTabOpen(e);else{var a=this.getEventMove(e,t);if(!a)return;n=a}var o=this.logEvent(n).statEvent;this.lastStatEvents=o,this.lastNavEvents=n}},e.prototype.getModule=function(){var e,t;return null!==(t=null===(e=window.cur)||void 0===e?void 0:e.module)&&void 0!==t?t:"unknown"},e}(),f=n("W0P9"),m=n("Bj12"),v=function(){function e(){this.DEBUG=!1}return e.prototype.getCurrentTime=function(e){void 0===e&&(e=!0);var t=Date.now().toString(10);return e?t+"000":t},e.prototype.getIntId=function(){return Math.floor(Math.random()*e.MAX_INT32)},e.prototype.logEvent=function(e,t){this.DEBUG&&Object(f.b)(e),e.type&&e[e.type]?(Object(m.c)(e,t),this.lastEvent=e):Object(d.b)(new Error("ProductionStatCollector: invalid event."))},e.prototype.getLastEvent=function(){return this.lastEvent},e.prototype.getBaseEvent=function(){var e;return{id:this.getIntId(),prev_id:null===(e=this.lastEvent)||void 0===e?void 0:e.id,timestamp:this.getCurrentTime(),url:window.location.href}},e.MAX_INT32=2147483647,e}(),g=function(){return(g=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},b=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e,t){var n,a=g(g({},this.productionStatCollector.getBaseEvent()),((n={type:i.k.TYPE_ACTION})[i.k.TYPE_ACTION]=e,n));this.productionStatCollector.logEvent(a,t)},e}(),A=function(){return(A=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},w=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e,t){var n,a=A(A({},this.productionStatCollector.getBaseEvent()),((n={type:i.k.TYPE_CLICK})[i.k.TYPE_CLICK]=A({item:t},e),n));this.productionStatCollector.logEvent(a)},e}(),y=function(){return(y=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},O=function(){function e(e){this.productionStatCollector=e}return e.prototype.logEvent=function(e,t){var n,a=y(y({},this.productionStatCollector.getBaseEvent()),((n={type:i.k.TYPE_VIEW})[i.k.TYPE_VIEW]=y({item:t},e),n));this.productionStatCollector.logEvent(a)},e}(),k=(function(){function e(e){this.actionStatCollector=e,this.fields={}}e.prototype.logFieldInteraction=function(e,t,n){void 0===n&&(n=!1),[i.l.PASSWORD,i.l.SMS_CODE,i.l.RULES_ACCEPT].includes(e)&&(t=t?"1":"0");var a=n?"0":this.actionStatCollector.productionStatCollector.getCurrentTime(!1),o=this.fields[e];o?(o.value=t,o.end_interaction_time=a):this.fields[e]={name:e,value:t,start_interaction_time:a,end_interaction_time:a}},e.prototype.getFieldInteractions=function(){return Object.values(this.fields)},e.prototype.resetFieldInteractions=function(){for(var e=0,t=Object.getOwnPropertyNames(this.fields);e<t.length;e++){var n=t[e];delete this.fields[n]}},e.prototype.logEvent=function(e,t,n,o){var r;if(Object(_.b)("registration_item_stat")){var s={event_type:e,screen:t,unauth_id:Object(a.a)("remixstid"),sid:Object(a.a)("remixnreg_sid")};[i.m.SCREEN_PROCEED,i.m.SCREEN_SKIP,i.m.SCREEN_RETURN].includes(e)&&(s.screen_to=n,s.fields=this.getFieldInteractions(),this.resetFieldInteractions());var c=((r={type:i.a.TYPE_REGISTRATION_ITEM})[i.a.TYPE_REGISTRATION_ITEM]=s,r);this.actionStatCollector.logEvent(c,o)}}}(),new o),j=new s,S=new r,C=new c;new u},Fhlr:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_promoButton"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_PROMO_BUTTON){if(e._promoButtonClickHandlerAdded)return;var t=geByClass1("feedAssistancePromoButtonInstallApp__button",e),n=t?"install_app":"";addEvent(t||e,"click",(function(){!function(e,t,n){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_PROMO_BUTTON_SUB,e,t,n)})}(e,FeedAssistanceStats.EVENTS.SUB_EVENT_PROMO_BUTTON_CLICK,n)})),e._promoButtonClickHandlerAdded=!0}}))},Fkq0:function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return d}));var i=n("ZD4m"),a=n("W9Tc"),o=n("tGJf");function r(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];(Object(a.b)("extended_client_logging")||o.a.getItem("market_extended_client_logging"))&&("error"===e?console.error("[market "+t+"]: ",n):"warn"===e?console.warn("[market "+t+"]: ",n):"info"===e?console.info("[market "+t+"]: ",n):console.debug("[market "+t+"]: ",n))}function s(e,t){void 0===t&&(t="market");var n=new RegExp(t+"(-?[0-9]+)_([0-9]+)"),i=e.match(n);if(!i||i.length<3)return null;var a=i[1],o=i[2];return{id:a+"_"+o,ownerId:parseInt(a),itemId:parseInt(o)}}function c(e){var t=e.match(/market(\-?[0-9]+).+section=album_([0-9]+)/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:n+"_"+i,ownerId:parseInt(n),itemId:parseInt(i)}}function l(e){var t=e.match(/_([0-9]+)_(\-?[0-9]+)_4/);if(!t||t.length<3)return null;var n=t[1],i=t[2];return{id:i+"_"+n,ownerId:parseInt(i),itemId:parseInt(n)}}function u(e){var t;return"none"!==(null===(t=e.style)||void 0===t?void 0:t.display)}function d(e,t,n,a){void 0===t&&(t=50),void 0===n&&(n=null);var o=n?n.left:0,r=n?n.top:0,s=Object(i.c)(),c=Object(i.a)(e),l=Object(i.b)(e),u=l.width*t/100,d=l.height*t/100;if(a){if(a.width>s.width)return!1;if(a.height>s.height)return!1;s=a}return!(c.left+l.width<o+u)&&(!(c.left+u>s.width)&&(!(c.top+l.height<r+d)&&!(c.top+d>s.height)))}},G0UO:function(e,t,n){"use strict";var i=n("hw56"),a=Array.isArray,o={mail:{},helpHints:{all:{},shown:{},locked:{}}},r={injectStore:function(e){o.mail={};var t=e.mail,n=t.cur,r=t.rolls,s=t.reached;t.msgs,t.queue;a(e.mail.msgs)&&(e.mail.msgs={}),a(e.mail.replies)&&(e.mail.replies={}),r&&a(r.peer)&&(r.peer={}),r&&a(r.search.peers)&&(r.search.peers={}),r&&a(r.search.msgs)&&(r.search.msgs={}),s&&a(s.search.peers)&&(s.search.peers={}),s&&a(s.search.msgs)&&(s.search.msgs={}),s&&a(s.peer.before)&&(s.peer.before={}),s&&a(s.peer.after)&&(s.peer.after={}),o.mail=e.mail,o.mail.pendingReplies={},o.mail.presend={},n&&(n.msgSelected={},n.msgRemoved={},n.msgAttached={},n.msgReply={},n.keyboards={},n.typings={},n.peerMembers={}),"notificationsCount"in o||(o.notificationsCount=e.notificationsCount),"menuNotifications"in o||(o.menuNotifications=e.menuNotifications),Array.isArray(n.drafts)?n.drafts={}:n.drafts&&(Object(i.j)(n.viewerId),Object.keys(n.drafts).forEach((function(e){var t=n.drafts[e];Object(i.w)(n.viewerId,e,t)})))},injectMail:function(e){var t=o.mail,n=e,i=isObject(t.peers)&&isObject(n.peers)&&Object.assign({},t.peers);isObject(n.msgs)&&Object.assign(t.msgs,n.msgs),isObject(n.peers)&&Object.assign(t.peers,n.peers),isObject(n.members)&&Object.assign(t.members,n.members),isObject(n.replies)&&Object.assign(t.replies,n.replies),isObject(n.forwards)&&Object.assign(t.forwards,n.forwards),t.page=n.page,n.mrs&&(t.cur.countMR=n.mrs.count,t.rolls.mrs=n.mrs.rolls,t.reached.mrs=n.mrs.reached,t.scraps.mrs=n.mrs.rolls,Object.keys(n.msgs).forEach((function(e){var i=n.msgs[e],a=i.peerId;t.rolls.peer[a]=[i.id],t.reached.peer.after[a]=!0})),t.mrs=n.mrs),i&&Object.keys(i).forEach((function(e){var a=t.peers[e],o=n.peers[e],r=i[e];a&&(a.peerProfileData=r.peerProfileData),r&&r.actionUrls&&o&&!o.actionUrls&&(a.actionUrls=r.actionUrls)}))},injectMsg:function(e){var t;r.injectMail({msgs:(t={},t[e.id]=e,t)})},resetMail:function(){o.mail={}}};window.storeMethods=r,window.store=o},GVTI:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n("vOib"),a=n("rc7J"),o=n("+sJP"),r=n("29dZ"),s=n("vk58"),c=n("Q8gl"),l=n("O5lf"),u=n("vhZE");function d(e){var t="wi_like_wrap";e.liked_people||(t+=" is_empty");var n="PhotoviewPage__description";return e.photo.description||(n+=" PhotoviewPage__description--empty"),{inner:[e.photo.caption?{inner:[Wd.wrap(e.photo.caption)],class:"PhotoviewPage__caption",tag:"div"}:null,{inner:[Wd.wrap(e.photo.description)],class:n,tag:"div"},{inner:[e.liked_people?e.liked_people:null],class:t,tag:"div"},e.buttons?{inner:[{inner:[e.buttons],class:"wi_buttons",tag:"div"}],class:"wi_buttons_wrap",tag:"div"}:null,e.author,e.replies],class:"PhotoviewPage__footer",tag:"div"}}function _(e){var t=window.lang;return{inner:[{inner:[e.edit_data.rotate.can_rotate?Object(s.a)({inner:[Object(r.a)({inner:[t.mobile_photos_edit_rotate_left],url:e.edit_data.rotate.left,stretch:!0}),Object(r.a)({inner:[t.mobile_photos_edit_rotate_right],url:e.edit_data.rotate.right,stretch:!0})],nowrap:!0}):null,{inner:[{inner:[t.mobile_photos_edit_desc_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.photo.description],name:"text",class:"textfield",rows:"4",tag:"textarea"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[{inner:[t.mobile_photos_edit_album_label],class:"fi_label",tag:"dt"},{inner:[{inner:[e.edit_data.albums.map((function(e){return{inner:[e.name],selected:e.selected?"selected":null,value:e.id,tag:"option"}}))],name:"aid",tag:"select"},{inner:[Object(c.a)({withoutWrap:!0,name:"cover",label:t.mobile_photos_edit_cover_label,type:"checkbox"})],class:"fi_subrow",tag:"div"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[Object(s.a)({inner:[Object(r.a)({inner:[t.mobile_photos_edit_save_btn],type:"submit"}),Object(r.a)({inner:[t.mobile_cancel],theme:"link",url:e.edit_data.back_url})]})],class:"fi_row",tag:"div"}],action:e.edit_data.action,method:"post",tag:"form"}],class:"form_item",tag:"div"}}function p(e){return void 0===e&&(e=[]),{inner:[Object.keys(e).map((function(t){return{inner:[{class:"fill",tag:"div"}],class:"pv_tag",id:"pv_tag"+t,style:function(e){if(!Object(o.A)(e))return"";var t=e[0];return Object(o.A)(t)?"left: "+t[0]+"%; top: "+t[1]+"%; width: "+t[2]+"%; height: "+t[3]+"%":""}(e[t]),tag:"div"}}))],class:"PhotoviewPage__tags",tag:"div"}}var h=function(e){void 0===e&&(e={});var t=e.info||{},n=e.photo||{},r=e.is_loading||!1,s=e.navigation_buttons||{},c=Object(o.h)("PhotoviewPage ",e.class);e.info&&(e.author=Object(a.a)({url:t.url,author_url:t.author_url,avatar:t.avatar,name:t.name,id:t.id,title:t.title,subtitle:t.subtitle,withoutBottomBorder:!e.has_replies})),e.photo||(e.photo={}),e.photo.description||(e.photo.description="");var h,f="",m=null;r&&(c=Object(o.h)(c," PhotoviewPage--skeleton"),n.width?f+=" width"+e.width+"px;":m=Wd.wrap(Object(l.a)({mix:"al_loading",type:"pageLoader"})));var v=["PhotoviewPage__photo"];e.photo.restriction&&("block"===e.photo.restriction.type?v.push("PhotoviewPage__photo--block"):"blur"===e.photo.restriction.type&&v.push("PhotoviewPage__photo--blur")),h=[{src:n.src,style:f,tag:"img"},p(e.tags)];var g,b=!!e.photo.restriction;return b&&((g=e.photo.restriction).width=e.width,g.height=e.height||e.width),Object(i.a)({inner:[{inner:[{inner:[m||{inner:[h],class:v,href:n.href,tag:"a"},{inner:[Object(u.a)(g)],class:"PhotoviewPage__restrictedInfo",style:b?"":"display: none;",tag:"div"},s],class:"PhotoviewPage__thumb",tag:"div"},e.edit_mode?_(e):d(e)],id:e.photo.id,tag:"div"}],class:c})};t.b=h},GtpT:function(e,t,n){"use strict";n.d(t,"b",(function(){return u}));var i=n("Y6JH"),a=n("z9sQ"),o=n("EDm3"),r=n("CW4u");var s=function(e){var t,n,s=e.album,c=s.url,l=s.title,u=s.photos_count_label,d=s.restriction,_="";if(d){var p={};p[d.type]=!0,_=a.a.class("AlbumItem__restriction",p)}if(t=e.emptyIcon?e.emptyIcon:Object(i.a)({icon:Object(r.a)()}),d&&"geo"===d.type)n={inner:[{inner:[Object(o.Ib)()],class:_,tag:"div"}],class:"AlbumItem__thumb",tag:"div"};else{var h=[a.a.class("AlbumItem__thumb",{blur:d&&"blur"===d.type})];n={inner:[!s||s.thumb||d?null:{inner:[t],class:"AlbumItem__emptyThumbIcon",tag:"div"},d&&d.type?{inner:[Object(o.Mb)()],class:_,tag:"div"}:null],class:h,"data-thumb-id":s.thumb_id,style:"background-image: url("+s.thumb+")",tag:"div"}}return{inner:[{inner:[n],class:"AlbumItem__thumbWrap",tag:"div"},{inner:[{inner:[l],class:"AlbumItemInfo__title",tag:"div"},{inner:[u],class:"AlbumItemInfo__subtitle",tag:"div"}],class:"AlbumItemInfo",tag:"div"}],href:c,class:"AlbumItem al_album",onclick:e.onClick,"data-count":s.count,tag:"a"}},c=n("OcsD"),l=n("UxAg");function u(e){if(!e.classList.contains("AlbumItem"))return{};var t=Object(c.zc)(Object(l.a)(".AlbumItemInfo__title",e))||"",n=Object(c.zc)(Object(l.a)(".AlbumItemInfo__subtitle",e))||"",i=e.getAttribute("href"),a=Object(l.a)(".AlbumItem__thumb",e),o=/url\("(.*)"\)/.exec(a.style.backgroundImage),r=!!o&&o[1],s=Object(l.a)(".AlbumItem__restriction",e),u=!1;return s&&(s.classList.contains("AlbumItem__restriction--blur")?u={type:"blur"}:s.classList.contains("AlbumItem__restriction--geo")&&(u={type:"geo"})),{album:{title:Wd.wrap(t),photos_count_label:n,url:i,thumb:r,restriction:u},onClick:e.getAttribute("onclick")}}t.a=s},Gyo5:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("r0fY"),a=n("FbVm"),o=new(function(){function e(){this.productionStatCollector=new a.e,this.actionStatCollector=new a.a(this.productionStatCollector)}return e.prototype.logEvent=function(e){var t;return this.actionStatCollector.logEvent(((t={type:i.a.TYPE_CUSTOM_METRICS_ITEM})[i.a.TYPE_CUSTOM_METRICS_ITEM]=e,t))},e}())},Gzds:function(e,t,n){"use strict";var i,a,o=n("+cqQ"),r=n("wkhI"),s=n("UxAg"),c=n("SVPb"),l=n("DOEQ"),u=n("OcsD"),d=n("+sJP"),_=n("zvhO"),p=n("cZev"),h=n("TYsd"),f=n("EDm3");onDOMReady((function(){p.a.onStickerPanelUpdate((function(){if(cur.waitingStickerPanel)clog("Show sticker panel after waiting"),m.stickersToggle(null,!0);else if("mail"!==cur.module){var e=Object(s.a)("#stickers_panel");Object(u.v)(e,"need-update",1),e&&"none"!==e.style.display&&m.stickersToggle(null,!1)}})),Object(c.b)()}));var m={curGif:null,onStickersTabSelected:Object(o.a)(),onStickerClick:Object(o.a)(),onStickersInit:se(),onReplyClick:se(),add_attach:function(e,t){var n=window.al;remove("feed_extra_field");var i=gpeByTag("form",e),a=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_attach",value:2});if(i){var o=!1;if(each(i,(function(e,t){if("submit"===t.type)return o=t,!1})),o)return append(a,i),window.al&&n.ver?nav.go(o,t):i.submit()}return!0},saveDraft:function(e,t,n,i){if(e&&e.preventDefault(),!i||!i.classList.contains("CreatePostButtons__item--disabled")){var a=ge("feed_add_form"),o=qs2obj(nav.params),s={act:"post",save_draft:1,redirect:n,hash:t};o.comment&&(s.comment=o.comment),each(a.elements,(function(e,t){if(!["submit","file"].includes(t.type)){if(Object(r.a)(t))return;s[t.name]="checkbox"===t.type?(+t.checked).toString():t.value}})),ajax.post(window.nav.path,s)}},toggleActions:function(e,t){var n=gpeByClass("post_item",e);return toggleClass("pi_actions_opened",n),cancelEvent(t),!1},wallActions:function(e,t){var n=window.tooltip,i=gpeByClass("_audioPlaylist",e)||gpeByClass("wall_item",e)||gpeByClass("post",e);if(!i)return!0;if(hasClass("wi_actions_opened",i))removeClass("wi_actions_opened",i),n.hide();else{var a=geByClass1("wi_actions_wrap",i),o=geByClass1("wi_actions",a),r=geByClass1("wi_actions_btn",i);m.wallActionsHide(),addClass("wi_actions_opened",i);var s=getY(i)+45+getH(o)+7,c=scrollTop()+getCh();toggleClass("wi_actions_top",a,s>c),n.addHandler(m.wallActionsHide),n.show(a,r)}return cancelEvent(t),!1},wallActionsHide:function(){var e=window.tooltip;removeClass("wi_actions_opened",geByClass1("wi_actions_opened")),e.hide()},wallPostOpen:function(e,t){var n=gpeByClass("wall_item",e),i=geByClass1("wi_date",n);return!i||nav.go_after(i,t)},toggleGif:function(e,t,n,a){return void 0===a&&(a=!1),!e||(!!checkEvent(t)||(clearInterval(i),hasClass("current_gif",e)?m.hideGif(e,t,a):(a||Gif.autoplayTest(),m.showGif(e,t,n,a))))},hidePlayingGifs:function(e,t){geByClass("current_gif","mcont").forEach((function(n,i){n!==e&&m.hideGif(n,!1,t)}))},showGif:function(e,t,n,o){var r=window.cur;if(!e)return!0;if(checkEvent(t))return!0;if(n){if(r.loadedGifs||(r.loadedGifs={}),!r.loadedGifs[e.href]&&!confirm(n))return!1;r.loadedGifs[e.href]=!0}if(clearInterval(i),!o){var c=getY(e),l=scrollTop();scrollTop(l-(c-getY(e)))}geByClass("current_gif","mcont").forEach((function(e,t){m.hideGif(e,!1,o)}));var u=!hasClass("not_mp4",e)&&Gif.isMp4Supports()&&e.href.includes("&mp4"),d=function(t,n){hasClass("current_gif",e)&&(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),"VIDEO"===a.tagName&&document.body.contains(a)?a.play():append(a,e),m.curGif=e,n&&n())};if(u){var _=geByClass1("ph_img",e).src;(a=Object(s.a)("video.gif_original",e)||ce("video",{src:e.href,className:"gif_original",loop:!0,muted:!0,autoplay:!0,poster:_})).setAttribute("playsinline",!0),a.setAttribute("webkit-playsinline",!0),a.setAttribute("controls",!0),a.controls=!1,a.readyState>=2&&"VIDEO"===a.tagName?(e.classList.remove("gif_loading"),e.classList.add("gif_opened"),a.play(),d()):a.load()}else a=ce("img",{src:e.href,className:"gif_original"});return e.classList.add("current_gif"),e.classList.contains("gif_opened")||e.classList.add("gif_loading"),u?a.oncanplay=function(){e!==m.curGif&&(statlogsValueEvent("gif_play",0,"mp4",null,o?1:0),d())}:i=setInterval((function(){a.complete&&(statlogsValueEvent("gif_play",0,"gif",null,o?1:0),d(),clearInterval(i))}),100),t&&!t.defaultPrevented?cancelEvent(t):void 0},hideGif:function(e,t,n){if(void 0===n&&(n=!1),!e)return!0;if(checkEvent(t))return!0;if(removeClass("current_gif",e),removeClass("gif_opened",e),removeClass("gif_loading",e),geByClass("gif_original").forEach((function(e){"VIDEO"===e.tagName?e.pause():remove(e)})),!n){var i=Gif.getState(),a=i.currentAutoplayElement,o=i.ignore;a===e&&(o.push(e),Gif.setState("ignore",o))}return m.curGif=null,t&&!t.defaultPrevented?cancelEvent(t):void 0},replyNamesRE:function(){var e=window.cur;if(!e.replyNames)return!1;var t=[];return each(e.replyNames,(function(){t.push(escapeRE(this[0]))})),new RegExp("^("+t.join("|")+")")},stickerPanelInit:function(){if(Object(s.a)("#stickers_panel"))return!0;var e=!1;if("mail"===cur.module&&window.isNewMail)e=Object(s.a)(".uMailWrite__popupStickers").childNodes[0];else{var t=Object(s.a)(".RepliesField_wrap")||(Object(s.a)(".create_post")||{}).parentNode;if(!t)return!1;e=(Array.from(t.children).find((function(e){return!(!e||!e.nextSibling||e.nextSibling.nodeType!==Node.COMMENT_NODE)}))||{}).nextSibling}if(e&&e.nodeType===Node.COMMENT_NODE){var n,i=p.a.getStickerPanel();if(!i)return!1;var a=document.createElement("div");return a.innerHTML=i,e&&(n=e).after.apply(n,a.childNodes),e&&e.remove(),m.stickersInit(),!0}return!1},stickersInit:function(){if(!window.isNewMail||!geByClass1("messenger")){var e=window.cur,t=window.Scroller,n=Object(s.a)("#stickers_panel");if(!n)return!m.stickerPanelInit()||(m.stickersInit(),"cached");var i=geByClass1("sp_body",n),a=geByClass1("sp_stickers_tabs",n);e.scroller&&e.scroller.destroy(),e.scroller=new t(i,{byPage:!0}),e.scroller.init(),e.destroy.push((function(){e.scroller.destroy()})),e.tabScroller&&e.tabScroller.destroy(),e.tabScroller=new t(a),e.tabScroller.init(),e.destroy.push((function(){e.tabScroller.destroy()})),m.onStickersInit(!0)}},replyTo:function(e,t,n,i,a){var o=window.cur;if(checkEvent(e))return!0;n=n||0,removeClass("nc_current_reply",geByClass1("nc_current_reply"));var r=ge("nc_form"),s=ge("nc_message"),c=geByClass1("nc_reply_name",r),l=gpeByClass("near_btn",c),u=ge("nc_reply_as"),d=val(s),_=m.replyNamesRE();if(n){var p=ge(t+"_"+n),h=getY(p)+getH(p),f=scrollTop();after(r,p),addClass("nc_current_reply",geByClass1("pi_reply_wrap",p)),scrollTop(f+getY(p)+getH(p)-h);var v=o.replyNames[i]||{},g=v[0]||"",b=v[1]||"";d=d?_?d.replace(_,g):d:g,m.onReplyClick(!0,g)}else{append(r,geByClass1("wall_replies")),scrollToEl(r);b="";d=_?d.replace(_,""):d}return val(s,replaceEntities(d)),val(c,b),toggle(l,n),u&&(val(u,+a),toggleClass("cp_post_as_group",r,+a)),val("nc_reply_to",n),o.replyTo=n,elfocus(s),!1},stickersToggle:function(e,t){var n=window.cur;if(!p.a.getStickers())return p.a.checkStickers(),!0;isUndefined(t)&&(t=!isVisible("stickers_panel")),!t&&n.waitingStickerPanel&&delete n.waitingStickerPanel;var i=ge("write_form")||ge("nc_form"),a=ge("stickers_panel"),o=geByClass1("cp_sticker_btn",i);if(!a){var r=m.stickersInit();if("cached"===r)return m.stickersToggle(e,t);if(!0===r)return n.waitingStickerPanel=!0,void p.a.checkStickers()}if(n.waitingStickerPanel&&delete n.waitingStickerPanel,!t&&Object(u.v)(a,"need-update")){var c=Object(d.y)("target")||safeGet(window.store,"mail.cur.peerId"),l=p.a.getStickerPanel(c),_=document.createElement("div");_.innerHTML=l;var h=Object(s.a)(".stickers_panel",_);a.innerHTML=h.innerHTML,m.stickersInit()}return toggle(a,t),toggleClass("cp_sticker_btn_sel",o,t),t&&n.tabScroller&&n.tabScroller.onShow(),n.onStickersToggleCallbacks&&n.onStickersToggleCallbacks.forEach((function(e){return e(t)})),!1},saveCurrentStickersPanelToCache:function(){var e=Object(s.a)(".stickers_panel");if(e){var t=safeGet(window.store,"mail.cur.peerId"),n=(Object(d.y)("target")||"").toString()||(t?"mail"+t:"");if(n){var i=p.a.getStickerPanel(),a=document.createElement("div");a.innerHTML=i,Object(s.a)(".stickers_panel",a).innerHTML=e.innerHTML.replace(new RegExp(n,"g"),"mail0"),p.a.saveStickerPanel(a.innerHTML)}}},stickersClick:function(e,t){var n=p.a.getStickers();return n&&n[t]?(window.isNewMail&&"/mail"===location.pathname&&(window.uMailWrite.drawStickers(),window.uMailWrite.openStickersPanel()),m.stickersToggle(null,!0),m.stickersSelectTab(null,t)):nav.go(e)},stickersStoreOpen:function(e){var t=window.cur;return setTimeout((function(){p.a.checkStickers({force:!0})}),1e3),ajax.click(e,!1,{url_params:{reply_to:t.replyTo||0}})},fromStickerToObject:function(e){return{id:e[0],size:e[1],url:e[2],animationUrl:e[3],recent:e[4],ref:e[5]}},fromObjectToSticker:function(e){return[e.id,e.size,e.url,e.animationUrl,e.recent,e.ref]},getTarget:function(){var e=(Object(d.y)("target")||"").toString();if(e)return e;var t=safeGet(window.store,"mail.cur.peerId");return t?"mail"+t:null},getStickersTabHTML:function(e){var t=(p.a.getStickers()||{})[e]||{},n=t.title,i=t.can_gift,a=t.stickers,o=window.isNewMail?16:8,r=[];if(a&&a.length)for(var s=0;s<a.length/o;s++)r.push(a.slice(s*o,s*o+o));var c=r.map((function(e){return e&&Object(u.ob)(e)?'\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            '+e.map((function(e){var t=m.fromStickerToObject(e),n=t.id,i=t.size,a=t.url,o=t.animationUrl,r=t.recent,s=t.ref,c="",l="";return o&&(c=" sticker_animation",l='\n          data-animation-path="'+o+'"\n          data-uniq-id="'+Date.now()+Math.round(1e8*Math.random())+'"\n          data-sticker-id="'+n+'"\n          data-loop-count="3"\n          ontouchstart="StickersAnimation.touchStartSticker(this);"\n          ontouchend="StickersAnimation.touchEndSticker(this);"\n        '),'\n          <div class="sticker_item'+(" sticker"+n)+'">\n            <a class="sticker_thumb thumb_item'+c+'" '+(' onclick="return post.sendSticker(this, '+n+", "+Boolean(r)+", '"+s+"');\"")+" "+l+'>\n              <img src="'+a+'" class="th_img sticker_img" height="'+i+'"/>\n            </a>\n          </div>\n        '})).join("\n")+"\n          </div>\n        </div>\n      ":""})).join("\n"),l='\n        <div class="sp_page scroller_page">\n          <div class="stickers_list">\n            <div class="stickers_null">'+getLang("mobile_common_stickers_no_recent")+"</div>\n          </div>\n        </div>\n    ",d=r.map((function(e,t){return'\n        <span class="sp_ppt '+(0===t?"sp_ppt_sel":"")+'" data-i="'+t+'">\n            <span class="sp_pptw"></span>\n        </span>\n      '})).join("\n"),_=function(e){var t=e.title?{inner:[e.title],class:"StickersKeyboardPackHeader__title",tag:"div"}:null,n=e.canGift&&e.target?{inner:[Object(f.K)()],class:"StickersKeyboardPackHeader__gift",href:"/attachments?act=stickers_gift&stickers_id="+e.packId+"&ref=stickers_keyboard&target="+e.target,tag:"a"}:null;return t||n?{inner:[{inner:[t],class:"StickersKeyboardPackHeader__main",tag:"div"},{inner:[n],class:"StickersKeyboardPackHeader__aside",tag:"div"}],class:"StickersKeyboardPackHeader",tag:"div"}:null}({packId:e,canGift:i,title:n,target:m.getTarget()});return'\n        <div class="sp_cont scroller_wrap">\n          '+(_?h.a.html(_):"")+'\n          <div class="scroller_cont">\n            '+(a&&a.length?c:l)+'\n          </div>\n        </div>\n        <div class="sp_pages_pts">\n            '+(r.length>1?d:"")+"\n        </div>\n      "},stickersSelectTab:function(e,t){var n=window.cur;if(!window.isNewMail&&n.tabScroller&&!n.tabScroller.canClick())return!1;var i=ge("stickers_panel"),a=geByClass1("sp_body",i),o=geByClass1("sp_tab_selected",i);n.scroller&&n.scroller.destroy(),val(a,m.getStickersTabHTML(t)),n.scroller&&n.scroller.init(),e||(e=geByClass1("sp_tab"+t,i)),removeClass("sp_tab_selected",o),addClass("sp_tab_selected",e);var r=getY(i),s=r+getW(i),c=scrollTop(),l=c+getCh();return(r<c||s>l)&&scrollToEl(i),n.tabScroller&&n.tabScroller.showElem(e),StickersAnimation&&StickersAnimation.loadAutoplayAnimationStickers(),m.saveCurrentStickersPanelToCache(),window.isNewMail&&m.onStickersTabSelected(),!1},addRecentSticker:function(e,t,n){window.cur;var i=gpeByClass("sticker_item",e);if(p.a.getStickers()&&i){var a=Object.keys(p.a.getStickers()).reduce((function(e,n){return e||p.a.getStickers()[n].stickers.find((function(e){return m.fromStickerToObject(e).id===t}))}),null);if(!a)throw new Error("Sticker "+t+" not found");var o=m.fromStickerToObject(a),r=o.id,c=o.size,l=o.url,u=o.animationUrl,d=(p.a.getStickers()[-1]||{}).stickers,h=void 0===d?[]:d;(h=h.filter((function(e){return m.fromStickerToObject(e).id!==r}))).unshift(m.fromObjectToSticker({id:r,size:c,url:l,animationUrl:u,recent:1,ref:"recent"})),h=h.filter((function(e,t){return t<(window.isNewMail?16:8)})),p.a.setStickerTab(-1,h);var f=-1;if(!n){var v=Object(s.a)(".stickers_panel .sp_tab_selected"),g=v&&v.className.split(" ").find((function(e){return/sp_tab.([0-9])*/.test(e)})).split("sp_tab")[1];Object(_.a)(+g)&&(f=+g)}m.stickersSelectTab(!1,f)}},sendSticker:function(e,t,n,i){if(window.isNewMail&&m.onStickerClick(t,i))return m.addRecentSticker(e,t,!1),!1;var a=window.cur;if(a.scroller&&!a.scroller.canClick())return!1;m.stickersToggle(e,!1);var o=ge("write_submit"),r={lock:!0,url_params:{media:"sticker"+t,_af:srand()}};if(n&&!i&&(r.url_params.media_from="recent"),a.ref&&(r.url_params.ref=a.ref,a.ref=void 0),a.refSource&&(r.url_params.ref_source=a.refSource,a.refSource=void 0),!i){var s=attr(e,"href");s&&(i=s.split("sticker_referrer=")[1].split("&")[0])}return i&&(r.url_params.sticker_referrer=i),m.addRecentSticker(e,t,n),o?ajax.click(o,extend({save:!0},Dialog),r):(o=ge("nc_submit"))?(Replies.getCurrentTimestamp()||Replies.setCurrentTimestamp(-1),setTimeout((function(){Replies.setCurrentTimestamp(0)}),0),ajax.click(o,{},r)):void 0},toggleMarkAsAds:function(e,t){var n=Object(s.a)("input[name='from_group']");if(n&&!n.checked)return cancelEvent(t);var i=Object(s.a)("input",e);if(i.disabled)return cancelEvent(t);var a=Object(s.a)("input[name='mute_notifications']");a&&(a.checked=i.checked,a.disabled=i.checked),m.checkCopyright()},toggleDonut:function(e,t){var n=Object(s.a)("input[name='from_group']");if(!n||n.checked){var i=Object(s.a)("#feed_add_form"),a=Object(s.a)('input[name="donut_only"]'),o=Object(s.a)("#select-donut-duration"),c=Object(s.a)('[name="'+l.a+'"]',i),d=!a.checked,_=Object(s.a)("input",o);Object(r.b)(c,d),o.classList.toggle("post__select_hidden",d),Object(u.v)(_,"ignore-field",d);var p=Object(s.a)("input[name='marked_as_ads']");if(p){var h="1"===Object(u.v)(p,"value");a.checked?(Object(u.v)(p,"value",p.checked?"1":"0"),p.checked=!1):(Object(u.v)(p,"value",null),p.checked=h),p.disabled=a.checked}}},toggleSender:function(e,t){t.stopPropagation(),t.preventDefault();var n=e.querySelector("input"),i={group:[],user:["marked_as_ads","signed","close_comments","mute_notifications","donut_only"]},a=Object(s.a)("input[name='marked_as_ads']");Object(s.a)("input[name='donut_only']");$$(".Control.Control_type_switcher.Row").forEach((function(e){if(!hasClass("Control__blocked",e)){var t=e.querySelector("input[name]");if("from_group"!==t.name)(n.checked&&!i.group.includes(t.name)||!n.checked&&i.user.includes(t.name))&&(t.disabled=!n.checked),"mute_notifications"===t.name&&a&&a.checked&&(t.disabled=!0);else{var o=Object(s.a)(".header__user"),r=Object(s.a)(".header__group"),c=Object(s.a)("#select-timer"),l=Object(s.a)("input[name=postpone]"),u=Object(s.a)("input#add_post_btn");if(n.checked?(o.classList.add("header_hidden"),r.classList.remove("header_hidden"),c.style.display="inline-block",l.disabled=!1):(o.classList.remove("header_hidden"),r.classList.add("header_hidden"),c.style.display="none",l.disabled=!0),u){var d=u.value;u.value=u.dataset.value,u.dataset.value=d}}}})),m.checkCopyright()},checkCopyright:function(){var e=Object(s.a)("input[name='marked_as_ads']"),t=Object(s.a)("input[name='from_group']"),n=ge("select-copyright"),i=Object(s.a)('input[name="copyright"]'),a=Object(s.a)(".create_post__source-option");if(n){var o=Object(s.a)(".Btn",a),r=Object(s.a)(".Btn__text",o);e&&e.checked&&(!t||t.checked)?(hide(n),attr(o,"disabled",!0),a.classList.add("create_post__source-option--disabled"),r.innerHTML=getLang("mobile_wall_post_copyright_add_button")):(attr(o,"disabled",!1),a.classList.remove("create_post__source-option--disabled"),i.value?(setStyle(n,"display","inline-block"),r.innerHTML=getLang("mobile_wall_post_copyright_edit_button")):r.innerHTML=getLang("mobile_wall_post_copyright_add_button"))}}};t.a=m;window.post=m},HGMY:function(e,t,n){"use strict";n.d(t,"e",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return d}));n("TYsd");var i=n("/Id8"),a=function(){store.mail.pendingMsgs;return{class:"MailPreSendList__box"}};function o(e){var t=store.mail,n=t.members[e.authorId],a=e.peerId,o=t.peers[a],r=Object(i.Msg__authorName)(n,a,t.cur.userId);return Object(i.default)({id:e.id,text:e.text,important:e.isImportant,unread:e.isUnread,authorPhoto:n.avatar,authorName:r,authorUrl:n.url,date:e.date,removed:t.cur.msgRemoved[e.id],admin:e.adminName?{name:e.adminName,url:e.adminUrl}:null,edited:e.edited,channel:o.isChannel&&o.ownerId!==t.cur.viewerId,attaches:e.attaches,attachesHTML:e.attachesHTML,attachesLoading:e.attachesLoading,forwards:e.forwards,reply:e.reply,pending:e.pending,failed:e.failed,sendId:e.sendId,sticker:e.sticker,ts:e.ts,maxDepth:store.mail.cur.maxMsgDepth})}var r=n("UxAg");function s(){return Object(r.a)(".MailPreSendList__box")}function c(e){s().innerHTML=e.map((function(e){return o(e)})).join("")}function l(e){s().insertAdjacentHTML("beforeend",o(e)),MailScrap.peerGoToBottom(),e.attaches.audiomsg&&AudioMessagePlayer.redrawWaves()}function u(e){var t=i.default.getElem(e.sendId);t&&t.remove()}function d(e){return i.default.getElem(e.sendId)}t.b=a},HON1:function(e,t,n){"use strict";var i=n("+sJP"),a=n("rycc"),o=n("Y6JH"),r=n("gZry"),s=n("LBnd"),c=n("EDm3"),l=n("KMpi"),u=function(e){var t=e.img?e.img:"",n=!!e.url&&e.url,u=!!e.innerHref&&e.innerHref,d=e.title?e.title:"",_=e.subtitle?e.subtitle:"",p=!!e.verified,h=e.mix?e.mix:"",f=e.type||null,m=e.online?e.online:"",v=!!e.actions&&e.actions,g=e.link?e.link:null,b=!!e.attrs&&e.attrs,A=!!e.linkAttrs&&e.linkAttrs,w=!!e.icon&&e.icon,y="artist"!==f||t?null:{inner:[Object(c.rb)()],class:"OwnerRow__placeholderWrapper",tag:"div"},O=e.style||{},k=e.titleIcon?e.titleIcon:null,j=Object(i.q)({id:e.owner_id,name:e.owner_name});return{inner:[Object(a.a)({inner:[{inner:[w||{inner:[Object(l.a)({mode:j,backgroundTheme:e.owner_id,text:e.owner_name,textLength:Object(i.r)(e.owner_id),size:44,src:t,href:u}),m?m.mobile?{inner:[{inner:[Object(o.a)({icon:Object(r.a)()})],class:"mlvi_default",tag:"span"},{inner:[Object(o.a)({icon:Object(s.a)()})],class:"mlvi_muted",tag:"span"}],class:"lvi mlvi OwnerRow__online OwnerRow__online--mobile","aria-label":Object(i.t)("mobile_accessibility_profile_online"),tag:"b"}:{class:"lvi OwnerRow__online","aria-label":Object(i.t)("mobile_accessibility_profile_online"),tag:"b"}:null,y],class:"OwnerRow__img",tag:"div"}],class:"OwnerRow__left",tag:"div"},{inner:[{inner:[Object(a.a)({inner:[d],href:u,class:"OwnerRow__title"}),p?{class:"OwnerRow__verified",tag:"div"}:null,k],class:Object(i.f)("OwnerRow__header",{"OwnerRow__header--verified":p}),tag:"div"},{inner:[_],class:"OwnerRow__subtitle",tag:"div"}],class:"OwnerRow__right",tag:"div"},g?{inner:[g],class:"OwnerRow__link",tag:"div"}:null],class:"OwnerRow__content",href:n,attrs:A}),v?{inner:[v],class:"OwnerRow__actions",tag:"div"}:null],attrs:b,class:Object(i.f)("OwnerRow",{OwnerRow_actions:!!v,"OwnerRow--noPadding":O.no_padding},h),tag:"div"}};t.a=u;window.OwnerRow=u},HdGT:function(e,t,n){"use strict";n.d(t,"g",(function(){return v})),n.d(t,"f",(function(){return g})),n.d(t,"b",(function(){return A})),n.d(t,"c",(function(){return w})),n.d(t,"d",(function(){return y})),n.d(t,"e",(function(){return O})),n.d(t,"h",(function(){return k})),n.d(t,"a",(function(){return j})),n.d(t,"k",(function(){return S})),n.d(t,"j",(function(){return C})),n.d(t,"i",(function(){return E}));var i=n("W38l"),a=n("OcsD"),o={},r={};function s(e,t){var n=o[e];delete n.items[t];var i=n.pending.indexOf(t),a=n.failed.indexOf(t);-1!==i&&n.pending.splice(i,1),-1!==a&&n.failed.splice(a,1),d(e)}function c(e){var t=o[e];t.failed=t.failed.concat(t.pending),t.pending=[],r[e]="idle",t.sendingItemId=null,t.onStopped(),d(e)}function l(e){var t=o[e];return t.loaded?Promise.resolve():(t.retrieving||(t.retrieving=function(e){return new Promise((function(t){var n=Object(a.Eb)("q_"+e)||{items:{},pending:[],failed:[]};n.failed=n.failed.concat(n.pending).filter((function(e){return!!n.items[e]})),n.pending=[],t(n)}))}(e).then((function(t){var n=t.pending,i=t.failed,a=t.items,r=o[e];r.retrieving=null,r.loaded=!0,r.pending=n,r.failed=i,r.items=a}))),t.retrieving)}function u(e,t){if(!1!==navigator.onLine){var n=o[e];if("sending"!==r[e]&&n.pending.length&&!n.backoffTimer){var i=n.pending[0],a=n.items[i];if(!a.fails||t)r[e]="sending",n.sendingItemId=i,n.onSend(a.id,a.data);else{var s=Math.pow(2,Math.max(a.fails-2,0));n.backoffTimer=setTimeout((function(){n.backoffTimer=null,u(e,!0)}),1e3*s)}}}}function d(e){var t=o[e],n=t.pending,i=t.failed,r=t.items;Object(a.Fb)("q_"+e,{pending:n,failed:i,items:r})}window.addEventListener("online",(function(){Object.keys(o).forEach((function(e){u(e)}))}));var _,p,h=n("qHA9"),f=n("+cqQ"),m=n("j80l"),v=Object(f.a)(),g=Object(f.a)(),b=Object(f.a)(),A=Object(f.a)(),w=Object(f.a)(),y=Object(f.a)(),O=Object(f.a)();function k(){return l("mail_send")}function j(){return{pending:(e=o["mail_send"]).pending,failed:e.failed,items:e.items};var e}function S(e){k().then((function(){var t;i.d((t=o["mail_send"])?t.pending.length:0);var n=Object(h.o)(e);!function(e,t,n){var i={id:t,data:n,fails:0},a=o[e];s(e,t),a.items[t]=i,a.pending.push(t),u(e),d(e)}("mail_send",n.sendId,{data:e}),y(n)}))}function C(e,t){var n,i=(n=e,o["mail_send"].items[n]||null);t&&(i.data=t(i.data)),s("mail_send",e),S(i.data.data)}function E(e,t){s("mail_send",e),"silent"!==t&&O(e)}p={onSend:function(e,t){!function(e,t){e=Object.assign({},e);var n="/mail",a="edit_message"===e.act;a?Object.keys(e).forEach((function(t){"attached_messages"!==t&&"has_reply"!==t||delete e[t]})):(n=Object(m.b)("/mail",{act:"send",to:e.to,from:e.from,hash:e.hash,_af:e._af,ref:e.ref||"",ref_source:e.ref_source||""}),Object.keys(e).forEach((function(t){"act"!==t&&"to"!==t&&"from"!==t&&"hash"!==t&&"_af"!==t&&"attachesHTML"!==t||delete e[t]}))),i.c(t,a?"edit":"send");var s=function(e){var n,s,c;i.e(t,"server"),a&&!e.was_modified&&O(t),g(),s=o[n="mail_send"],(c=s.sendingItemId)&&(s.pending[0]===c&&s.pending.shift(),delete s.items[c]),r[n]="idle",s.sendingItemId=null,u(n),d(n)};Object(h.m)(n,e).then(s,(function e(n){var a=n.type,l=n.code,d=n.message,_=n.data;if(i.b(t,"server_send",a),"captcha"!==a&&i.a(t),"server"===a&&l&&l!==h.c)return d&&w(d),void c("mail_send");"captcha"!==a?(function(e){var t=o[e],n=t.sendingItemId;if(n&&t.pending[0]===n){var i=t.items[n];if(i&&(i.fails+=1,i.fails>=t.maxFails))return void c(e)}r[e]="idle",t.sendingItemId=null,u(e)}("mail_send"),b()):A(_,(function(n){if(!n)return i.a(t),void c("mail_send");n.then(s,e)}))}))}(t.data,e)},onStopped:v,maxFails:5},o[_="mail_send"]={pending:[],failed:[],items:{},onSend:p.onSend,onStopped:p.onStopped,maxFails:0|p.maxFails,loaded:!1,sendingItemId:null,backoffTimer:null},r[_]="idle"},I7Du:function(e,t,n){"use strict";var i=n("z9sQ");var a=function(e){void 0===e&&(e={});var t=e.on_change;return{inner:[{inner:[e.options.map((function(e){return e?{inner:[e.label],attrs:e.attrs,class:"Select__option",value:e.value,selected:e.selected?"selected":null,tag:"option"}:null}))],class:"Select__native",name:e.name,disabled:e.disabled,onchange:e.nativeOnChange?e.onChange:t?["Select._onChange","this",t]:null,required:e.required,tag:"select"}],class:[e.mix||e.class,i.a.class("Select",{disabled:e.disabled},"_")],tag:"div"}};t.a=a},IetZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));function i(e){var t=null;document.querySelectorAll(e+":not(.cutTextToHighlight)").forEach((function(e){if(e.classList.add("cutTextToHighlight"),null===t){var n=getComputedStyle(e).font;i=n,(a=document.createElement("canvas").getContext("2d")).font=i,t=function(e){var t=a.measureText(e).width;return Math.ceil(t)}}var i,a;e.innerHTML=function(e,t,n){void 0===n&&(n="…");var i=e.querySelector(".highlight");if(!i)return e.innerHTML;var a=e.innerHTML.indexOf('<em class="highlight">');if(i.offsetLeft+i.offsetWidth<=e.offsetWidth-15)return e.innerHTML;if(i.offsetWidth<e.offsetWidth-15){for(var o=0,r="",s=a;s>0&&o+i.offsetWidth<=e.offsetWidth;){var c=e.innerHTML.lastIndexOf(" ",s-1);if(-1===c&&(c=0),r=e.innerHTML.substring(c,s)+r,!((o=t(n+r.trim()))+i.offsetWidth<=e.offsetWidth-15))break;s=c}a=s}if(a>0)return n+e.innerHTML.substring(a).trim();return e.innerHTML}(e,t)}))}},IjIm:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("PU8N"),a=n("LiVZ"),o=n("vOql"),r=n("6VgB"),s={newAvatarUrl:"",oldAvatarUrl:"",newAvatarStrokeWidth:17,newAvatarStrokeColor:"#fff",oldAvatarStrokeWidth:17,oldAvatarStrokeColor:"#fff",baseWidth:1080,baseHeight:1920,displayWidth:375,backgroundColor:"rgba(0, 0, 0, .16)",newAvatarInBackgroundBlur:160,avatarWidth:500,title:window.getLang("stories_new_avatar_story_title_header"),titleColor:"#fff",titleTextAlign:"center",titleFont:"TT Commons",titleFontSize:69,titleLineHeight:87,titleShadowOffsetX:0,titleShadowOffsetY:4,titleShadowBlur:12,titleShadowColor:"rgba(0, 0, 0, 0.24)",pollStickerX:r.d,pollStickerY:r.e,blobImageType:"image/jpeg",blobQuality:1};function c(e,t){var n=Object.assign({},c.defaultOptions,e||{}),r=n.newAvatarUrl,s=n.oldAvatarUrl,l=n.newAvatarStrokeWidth,u=n.newAvatarStrokeColor,d=n.oldAvatarStrokeWidth,_=n.oldAvatarStrokeColor,p=n.baseWidth,h=n.baseHeight,f=n.displayWidth,m=n.backgroundColor,v=n.newAvatarInBackgroundBlur,g=n.avatarWidth,b=n.title,A=n.titleColor,w=n.titleTextAlign,y=n.titleFont,O=n.titleFontSize,k=n.titleLineHeight,j=n.titleShadowOffsetX,S=n.titleShadowOffsetY,C=n.titleShadowBlur,E=n.titleShadowColor,T=n.pollStickerX,I=n.pollStickerY,M=n.pollStickerOptions,P=n.blobImageType,x=n.blobQuality;p=p||Number(c.defaultOptions.baseWidth),h=h||Number(c.defaultOptions.baseHeight),f=f||Number(c.defaultOptions.displayWidth),M=Object.assign({},{title:window.getLang("stories_new_avatar_story_poll_sticker_title")},M||{});var L=f*(h/p),R=t||document.createElement("canvas"),B=R.getContext("2d");return B?(R.width=p,R.height=h,R.style.width=f+"px",R.style.height=L+"px",new Promise((function(e,t){Object(i.j)([r,s]).then((function(n){var r=n[0],s=n[1];B.clearRect(0,0,R.width,R.height),B.fillStyle=String(m||""),B.fillRect(0,0,R.width,R.height),B.save(),B.filter="blur("+v+"px)";var c=Object(a.b)(r.naturalWidth,r.naturalHeight,R.width,R.height,.5,.5);if(B.drawImage(r,c.offsetLeft,c.offsetTop,c.width,c.height),B.restore(),"none"!==B.filter){var p=Object(i.a)(B);B.fillStyle="rgb("+p.r+", "+p.g+", "+p.b+")",B.fillRect(0,0,R.width,R.height)}B.save(),B.shadowOffsetX=Number(j),B.shadowOffsetY=Number(S),B.shadowBlur=Number(C),B.shadowColor=String(E||""),B.font="600 "+O+"px/"+k+"px "+y,B.fillStyle=String(A||""),B.textAlign=String(w);var h=null==b?void 0:b.split("{br}");null==h||h.forEach((function(e,t){var n=Number(k)*t,i=R.width/2,a=R.height/2-Number(k)*h.length/2+n-395;B.fillText(e,i,a)})),B.restore();var f=(R.width-Number(g))/2,L=Math.min(s.width,s.height),N=Math.min(r.width,r.height);B.save(),Object(a.a)(B,s,Number(g)/2,0,0,L,L,f-165,665,Number(g),Number(g)),B.lineWidth=Number(d),B.strokeStyle=String(_),B.stroke(),Object(a.a)(B,r,Number(g)/2,0,0,N,N,f+165,665,Number(g),Number(g)),B.lineWidth=Number(l),B.strokeStyle=String(u),B.stroke(),B.restore(),Object(o.a)(M).then((function(t){B.drawImage(t,Number(T),Number(I)),null==R||R.toBlob(e,P,x)})).catch(t)})).catch(t)}))):Promise.reject(new Error("canvas context not found"))}c.defaultOptions=s},JCKH:function(e,t,n){"use strict";n.r(t),n.d(t,"GroupCallSnippet",(function(){return a})),n.d(t,"GroupCallSnippetSkin",(function(){return s}));var i=n("ZMWW"),a={join:function(e){i.a.isIntegrated&&i.a.sendMessage("call_join",{callData:e,peerId:store.mail.cur.peerId})}},o=n("+sJP"),r=n("EDm3");function s(e){var t=e.data,n=t?{inner:[Object(o.t)("mobile_mail_snippet_groupcall_connect")],class:"GroupCallSnippet__link",tag:"div"}:{inner:[Object(o.t)("mobile_mail_snippet_groupcall_ended")],class:"GroupCallSnippet__ended",tag:"div"};return{inner:[{inner:[Object(r.Q)()],class:"GroupCallSnippet__left",tag:"div"},{inner:[{inner:[Object(o.t)("mobile_mail_snippet_groupcall_title")],class:"GroupCallSnippet__title",tag:"div"},n],class:"GroupCallSnippet__main",tag:"div"}],class:"MailButton GroupCallSnippet",type:"button",onClick:t?["GroupCallSnippet.join",t]:"",tag:"button"}}window.GroupCallSnippet=a},JlTo:function(e,t,n){"use strict";n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return _})),n.d(t,"a",(function(){return p})),n.d(t,"e",(function(){return A})),n.d(t,"b",(function(){return w})),n.d(t,"d",(function(){return y})),n.d(t,"f",(function(){return O})),n.d(t,"c",(function(){return k}));var i=n("wx14"),a=n("J8bf"),o=n("W9Tc"),r=n("DM2o"),s="miniAppEvent",c=["mt_registration","mt_login"];function l(){return window.vk&&window.vk.id?window.vk.id:0}function u(e){if(!(window.vk&&window.vk.zero||window.__dev)){if(e&&e.goal&&c.includes(e.goal)){if(Object(o.b)("mt_log_disable"))return;Object(r.a)("counters_check_tmr",e.goal)}window._tmr=window._tmr||[],window._tmr.push(e)}}function d(e,t){u({id:"2579437",url:e,referrer:t,type:"pageView",start:(new Date).getTime(),pid:l(),userid:l()}),Object(a.a)("remixtmr_login")&&(Object(a.b)("remixtmr_login","",-1),u({id:"2579437",type:"reachGoal",goal:"mt_login",userid:l()}))}function _(){u({id:"2579437",type:"reachGoal",goal:"mt_registration",userid:l()})}function p(e,t){void 0===t&&(t={}),u({id:"2579437",type:"reachGoal",goal:e,userid:l(),params:t})}function h(e){var t=l();l&&u({id:"2579437",type:s,params:Object(i.a)({},e,{platformUserId:String(t)})})}var f="open",m="close",v="login",g="registration",b="custom";function A(e,t){h({eventType:f,miniAppId:e,queryParams:t})}function w(e){h({eventType:m,miniAppId:e})}function y(e,t){h({eventType:v,miniAppId:e,customUserId:t})}function O(e,t){h({eventType:g,miniAppId:e,customUserId:t})}function k(e,t){h(Object(i.a)({eventType:b,miniAppId:e},t))}},KMpi:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("TYsd"),a=n("EDm3"),o=n("+sJP"),r=n("uBUF");function s(e){var t,n,s=e.mode||"image",l=e.size||"inherit",u=e.src?Object(o.A)(e.src)?e.src:[e.src]:[],d=e.borderRadius||"full",_=e.backgroundTheme?Math.abs(e.backgroundTheme)>6?Math.abs(e.backgroundTheme)%6+1:e.backgroundTheme:1,p=e.mix?Object(o.A)(e.mix)?e.mix.join(" "):e.mix:"",h=function(e,t,n,i,a,o){return["Avatar","Avatar--mode-"+e,"Avatar--size-"+t,"Avatar--images-"+n,"Avatar--borderRadius-"+i,"image"!==e&&"Avatar--theme-"+a,o]}(s,l,u.length,d,_,p),f=e.inner?Object(o.F)(e.inner)?e.inner:i.a.wrap(e.inner):null,m=null,v=null,g=null;return"text"===s?(t=e.text,n=e.textLength||2,m={inner:[c(t,n)],class:"Avatar__text",tag:"div"}):(v=function(e){for(var t=[],n=e.length<=4?e.length:4,i=0;i<n;i++){var a=i+1;t.push({class:"Avatar__image Avatar__image-"+a,style:"background-image: url('"+e[i]+"')",tag:"div"})}return t}(u),u.length||f||(g=Object(a.X)())),Object(r.a)({inner:[v,g,m,f],tag:e.href?"a":"div",href:e.href,class:h,attrs:e.attrs,role:"img"})}function c(e,t){void 0===t&&(t=2);for(var n="",i=Object(o.g)(Object(o.k)(Object(o.i)(e))).split(" "),a=i.length,r=0;r<a;r++)n+=Object(o.P)(i[r],0,1,"utf-8");return n=Object(o.P)(n,0,t,"utf-8"),n=Object(o.j)(n)}},L9Nh:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return QueueManager}));var _babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("wx14"),_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("OcsD"),QUEUE_CREATION_TIME_INDEX=0,QUEUE_TIMESTAMP_INDEX=1,QUEUE_KEY_INDEX=2,QUEUE_CALLBACK_INDEX=3,INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE=2,KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE=4,TRANSPORT_FRAME_ID="queue_transport_frame",QueueManager=function(){function QueueManager(){}return QueueManager.addQueue=function(e,t){QueueManager.initialized&&(QueueManager.queues[e.key]=[vkNow(),e.ts,e.key,t])},QueueManager.start=function(){QueueManager.initialized&&!QueueManager.started&&(QueueManager.createFrame(QueueManager.check),QueueManager.started=!0)},QueueManager.check=function check(){var _this=this,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},addQueues=[],now=vkNow();Object.keys(QueueManager.queues).forEach((function(e){var t=QueueManager.queues[e],n=t[QUEUE_CREATION_TIME_INDEX],i=t[QUEUE_TIMESTAMP_INDEX];now-n>3e4&&!e.match(/nccts/)?delete QueueManager.queues[t]:(params.ts+="_"+i,params.key+=e,addQueues.push(e))})),curNotifier.lpMakeRequest&&curNotifier.lpMakeRequest(curNotifier.frame_url,params,(function(text){try{var response=eval("("+text+")"),main_response=response,addResponse,addQueue,busy=0;if(isArray(response))for(main_response=response.shift(),curNotifier.timestamp=main_response.ts;(addResponse=response.shift())&&(addQueue=addQueues.shift(),addQueue);)addResponse.failed!==INCORRECT_KEY_OR_TIMESTAMP_ERROR_CODE||addResponse.err!==KEY_IS_BLOCKED_BY_ANOTHER_REQUEST_ERROR_CODE?addResponse.failed?delete QueueManager.queues[addQueue]:QueueManager.callQueue(addQueue,addResponse):busy|=1;else if(response.failed)for(;addQueue=addQueues.shift();)delete QueueManager.queues[addQueue];busy||(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(QueueManager.check.bind(_this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(QueueManager.check.bind(_this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}),(function(){return!0}))},QueueManager.init=function(e){window.curNotifier=Object(_babel_runtime_helpers_esm_extends__WEBPACK_IMPORTED_MODULE_0__.a)({},e),QueueManager.initialized=!0,delete curNotifier.makeRequest},QueueManager.createFrame=function(e){re(TRANSPORT_FRAME_ID),Object(_mobile_lib_Utils__WEBPACK_IMPORTED_MODULE_1__.s)({id:TRANSPORT_FRAME_ID,name:TRANSPORT_FRAME_ID,src:window.curNotifier.frame_path,ariaHidden:!0});var t=setInterval((function(){curNotifier.lpMakeRequest&&(clearInterval(t),e())}),500);setTimeout((function(){return clearInterval(t)}),1e4)},QueueManager.callQueue=function(e,t){var n=QueueManager.queues[e];if(Array.isArray(n)&&n.length){n[QUEUE_TIMESTAMP_INDEX]=t.ts;var i=n[QUEUE_CALLBACK_INDEX];isFunction(i)&&i(n[QUEUE_KEY_INDEX],t)}},QueueManager}();QueueManager.queues={},QueueManager.started=!1,QueueManager.initialized=!1,window.QueueManager=QueueManager},LiVZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return o}));var i=function(e,t,n,i,a,o,r,s,c,l,u){var d=s||i,_=c||a,p=l||o||t.naturalWidth,h=u||r||t.naturalHeight;e.beginPath(),e.arc(d+n,_+n,n,Math.PI,Math.PI+Math.PI/2),e.lineTo(d+p-n,_),e.arc(d+p-n,_+n,n,Math.PI+Math.PI/2,2*Math.PI),e.lineTo(d+p,_+h-n),e.arc(d+p-n,_+h-n,n,2*Math.PI,Math.PI/2),e.lineTo(d+n,_+h),e.arc(d+n,_+h-n,n,Math.PI/2,Math.PI),e.closePath(),e.save(),e.clip(),e.drawImage(t,i,a,o,r,s,c,l,u),e.restore()},a=function(e,t,n,i,a,o){var r={};if("number"==typeof o)r={tl:o,tr:o,br:o,bl:o};else{var s={tl:0,tr:0,br:0,bl:0};for(var c in s)r[c]=r[c]||s[c]}e.save(),e.beginPath(),e.moveTo(t+r.tl,n),e.lineTo(t+i-r.tr,n),e.quadraticCurveTo(t+i,n,t+i,n+r.tr),e.lineTo(t+i,n+a-r.br),e.quadraticCurveTo(t+i,n+a,t+i-r.br,n+a),e.lineTo(t+r.bl,n+a),e.quadraticCurveTo(t,n+a,t,n+a-r.bl),e.lineTo(t,n+r.tl),e.quadraticCurveTo(t,n,t+r.tl,n),e.closePath(),e.restore()},o=function(e,t,n,i,a,o){var r,s,c=e/t;return c>n/i?(r=i,s=i*c):(s=n,r=n/c),{width:s,height:r,offsetLeft:(n-s)*(a=void 0===a?.5:a),offsetTop:(i-r)*(o=void 0===o?.5:o)}}},Mc5h:function(e,t,n){"use strict";var i=n("2IoG");t.a=i.a,window.Brick=i.a},MzAf:function(e,t){function n(e){return function(t){t.$control.closest(a.sms).classList.toggle(o[e])}}function i(e,t){var n=t.$select,i=t.value;n.closest(a.sms).classList.toggle(o.pmUsersVisible,e.includes(i)||e.includes(Number(i)))}window.SettingsSms={},SettingsSms._onEnabledChange=n("enabled"),SettingsSms._onTimeLimitedChange=n("timeLimited"),SettingsSms._onFrequencyChange=i;var a={sms:".settingsSms"},o={enabled:"settingsSms_enabled",timeLimited:"settingsSms_timeLimited",pmUsersVisible:"settingsSms_pmUsersVisible"}},N4ZS:function(e,t,n){"use strict";function i(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.d(t,"a",(function(){return i}))},O5lf:function(e,t,n){"use strict";var i=n("9y81"),a=n("Y6JH"),o=n("z9sQ"),r=n("Fbxv"),s=function(e){void 0===e&&(e={});var t=e.mix||"",n="pageLoader"===(e.type||"gray"),s=o.a.class("Spinner",{pageLoader:n,hidden:e.isHidden,fixed:e.isFixed}),c=t+" "+s;if(n)return Wd.html({inner:[Object(a.a)(Object(r.a)())],class:c,tag:"div"});return Object(i.b)({mix:c,icon:"spinner"})};var c=n("jE6c");var l={show:function(e){Object(c.j)(e)&&e.classList.remove("Spinner--hidden")},hide:function(e){Object(c.j)(e)&&(e.classList.contains("Spinner--hidden")||e.classList.add("Spinner--hidden"))}};Object.assign(s,l),window.Spinner=s;t.a=s},OGWK:function(e,t){window.SubscribeBtn={onClick:function(e,t,n,i,a,o){try{var r=o+"_unsubscribe",s=o+"Icon",c=o+"Icon_unsubscribe",l=o+"Icon_subscribe",u=hasClass(e,r),d=u?i:n,_=u?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),p=!u,h=geByClass1(s,e),f=function(e){var t=intval(domData(e,"block-id"));if(!t){var n=domCA(e,".feedAssistance");t=intval(domData(n,"block-id"))||null}return t}(e),m=domData(e,"from")||null;h&&(toggleClass(c,h,p),toggleClass(l,h,!p)),attr(e,"aria-label",escapeAttr(_)),toggleClass(r,e,p),"group"===a?function(e,t,n,i){(n?Groups.leave:Groups.enter).call(Groups,e,t,i)}(t,d,u):function(e,t,n,i,a){(n?Friends.decline:Friends.accept).call(Friends,e,t,i,a)}(t,d,u,m,f)}catch(e){console.trace(e)}return!1}}},Ogzf:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var i=n("wx14"),a=n("OcsD");function o(e,t,n,i){void 0===t&&(t=350);var o,s=void 0===i?{}:i,c=s.cancelLongPressOnMove,l=void 0!==c&&c,u=s.eventsRelease,d=void 0===u?"touchcancel touchend touchmove mouseout mouseup mousemove scroll":u,_=s.initialTouchStartEvent,p=s.onRelease,h=s.onStart,f=s.shouldPreventDefault,m=s.ignoreMouseLongpress,v=s.canStart,g=function(n){if(!isFunction(v)||v({event:n,type:"start"})){var i=n.target;f&&r(n),Object(a.b)(e,d,A,{passive:!0}),null==h||h(n),(0===n.button||Object(a.vb)(n.button))&&(o=setTimeout(w.bind(i,n),t))}},b=function(){clearTimeout(o),_&&Object(a.Zb)(e,d,A,{passive:!0})},A=function t(n){clearTimeout(o),Object(a.Zb)(e,d,t,{passive:!0}),null==p||p(n)};function w(t){var i,r;t.touches?(i=t.touches[0].pageX,r=t.touches[0].pageY):(i=t.pageX,r=t.pageY),Object(a.Zb)(e,d,A,{passive:!0}),clearTimeout(o),!t.touches&&m||n({event:t,pageX:i,pageY:r})}return Object(a.b)(e,"touchstart mousedown",g,{capture:!0,passive:!f}),l&&Object(a.b)(e,"touchmove",b,{passive:!1}),_&&_ instanceof Event&&g(_),function(){clearTimeout(o),Object(a.Zb)(e,"touchstart mousedown",g,{capture:!0,passive:!0}),l&&Object(a.Zb)(e,"touchmove",b,{passive:!1})}}var r=function(e){(function(e){return"touches"in e})(e)&&e.touches.length<2&&e.preventDefault&&e.preventDefault()};function s(e,t,n,a,s){void 0===s&&(s={});var c=!1,l=s,u=l.shouldPreventDefault,d=void 0!==u&&u,_=l.canStart;return o(e,t,(function(){d&&e.removeEventListener("touchend",r,{passive:!1}),isFunction(_)&&!_()||c||(n.apply(void 0,arguments),c=!0)}),Object(i.a)({},s,{eventsRelease:s.ignoreMoveEvent?"touchend mouseleave mouseup scroll":"touchend touchmove mouseleave mouseup scroll",onRelease:function(t){(d&&e.removeEventListener("touchend",r,{passive:!1}),!isFunction(_)||_())&&(["mouseup","touchend"].includes(t.type)&&!c&&(a(t),c=!0))},onStart:function(t){c=!1,d&&e.addEventListener("touchend",r,{passive:!1}),null==s.onStart||s.onStart(t)}}))}},PU8N:function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"f",(function(){return o})),n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"l",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"k",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"i",(function(){return _})),n.d(t,"j",(function(){return p})),n.d(t,"h",(function(){return f})),n.d(t,"c",(function(){return m}));var i=function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function a(){return!!window.isMVK}function o(e){return void 0===e&&(e=""),new Promise((function(t,n){var i=document.createElement("video");i.addEventListener("loadedmetadata",(function(){return t(i.duration)}),{once:!0}),i.addEventListener("error",n,{once:!0}),i.crossOrigin="anonymous",i.preload="metadata",i.src=e}))}function r(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){if(404===i.response.status)return n();t(i.response)},i.onerror=n,i.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}var c=function(){};function l(e,t,n,i,a){void 0===t&&(t=0),void 0===n&&(n=0);var o,r={r:0,g:0,b:0};i=i||e.canvas.width,a=a||e.canvas.height;try{o=e.getImageData(t,n,i,a)}catch(e){return r}for(var s=-4,c=0;(s+=20)<o.data.length;)++c,r.r+=o.data[s],r.g+=o.data[s+1],r.b+=o.data[s+2];return r.r=~~(r.r/c),r.g=~~(r.g/c),r.b=~~(r.b/c),r}function u(e){return new Promise((function(t,n){var i=document.createElement("video");i.muted=!0,i.autoplay=!0,i.addEventListener("canplay",(function(){i.pause(),t(i)}),{once:!0}),i.addEventListener("error",n,{once:!0}),i.crossOrigin="anonymous",i.src=e}))}function d(e,t){void 0===t&&(t=[0]);var n=[];return new Promise((function(i,a){var o=document.createElement("canvas"),r=o.getContext("2d"),s=e.videoWidth,c=e.videoHeight;o.width=s,o.height=c,function l(u){var d=e.currentTime;e.addEventListener("seeked",(function(){null==r||r.drawImage(e,0,0,s,c,0,0,s,c),e.currentTime=d,_(o.toDataURL("image/jpeg",1)).then((function(a){n.push(a),u>=t.length-1?(e.src="",i(n)):l(u+1)})).catch(a)}),{once:!0}),e.currentTime=-1===t[u]?e.duration:t[u]}(0)}))}function _(e){return new Promise((function(t,n){var i=new Image;i.crossOrigin=e.startsWith("data:")?null:"Anonymous",i.onerror=function(){return n(new Error("Failed to load image's URL: "+e))},i.onload=function(){return t(i)},i.src=e}))}var p=function(e){return new Promise((function(t){var n=e.map((function(e){return _(e)}));Promise.all(n).then((function(e){return t(e)})).catch((function(){}))}))};function h(e,t){var n,i,a,o,r,s,c,l,u={normal:"400",500:"500",600:"600",bold:"700"},d={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},_={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function p(e){var t=[];return each(e,(function(e,n){t.push(e+":"+n)})),t.join(";")}function h(e,t,n){return Math.abs(e.width-t.offsetWidth)>n||Math.abs(e.height-t.offsetHeight)>n}function f(){o||(utilsNode.appendChild(r),o=!0,a={sansSerif:{width:c.offsetWidth,height:c.offsetHeight},serif:{width:s.offsetWidth,height:s.offsetHeight}},browser.opera&&!browser.chrome?(c.style.fontFamily='"'+e+'", sans-serif',s.style.fontFamily='"'+e+'", serif'):(setStyle(c,"font-family",'"'+e+'", sans-serif'),setStyle(s,"font-family",'"'+e+'", serif'))),o&&a&&(h(a.sansSerif,c,t.tolerance)||h(a.serif,s,t.tolerance))?(re(r),t.success()):(new Date).getTime()-i.getTime()>t.timeout?(re(r),t.error()):!o&&"requestAnimationFrame"in window?window.requestAnimationFrame(f):window.setTimeout(f,t.delay)}for(var m in d)t.hasOwnProperty(m)||(t[m]=d[m]);_["font-weight"]=t.weight,_["font-style"]=t.style,!t.glyphs&&"fonts"in document?(t.timeout&&(n=setTimeout((function(){t.error()}),t.timeout)),function(n){each(null===document||void 0===document?void 0:document.fonts,(function(i){i.family.toLowerCase()===e.toLowerCase()&&(u[i.weight]||i.weight)===""+t.weight&&i.style===t.style&&i.load().then((function(){t.success(),clearTimeout(n)}))}))}(n)):(l="AxmTYklsjo190QW"+t.glyphs,i=new Date,r=ce("div"),c=ce("div",{innerHTML:l}),s=ce("div",{innerHTML:l}),c.setAttribute("style",p(extend({"font-family":"sans-serif"},_))),s.setAttribute("style",p(extend({"font-family":"serif"},_))),r.appendChild(c),r.appendChild(s),f())}function f(e,t){return new Promise((function(n,a){h(e,i(i({},t),{glyphs:"",success:function(){var e=function(){n(),(null==t?void 0:t.success)&&t.success()};browser.safari?setTimeout(e,150):e()},error:function(){a(),(null==t?void 0:t.error)&&t.error()}}))}))}function m(e,t,n,i,a,o){return void 0===o&&(o=0),new Promise((function(r,s){("string"==typeof e?_(e):Promise.resolve(e)).then((function(e){var c=document.createElement("canvas");c.width=90===o||270===o?e.naturalHeight:e.naturalWidth,c.height=90===o||270===o?e.naturalWidth:e.naturalHeight;var l=c.getContext("2d");if(l){l.fillStyle="#fff",l.fillRect(0,0,l.canvas.width,l.canvas.height),o?(l.translate(c.width/2,c.height/2),l.rotate(o*Math.PI/180),l.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2)):l.drawImage(e,0,0);var u=l.getImageData(t,n,i,a),d=document.createElement("canvas");d.width=i,d.height=a;var p=d.getContext("2d");if(p)return p.putImageData(u,0,0),_(d.toDataURL("image/jpeg",1)).then(r).catch(s);r(e)}else r(e)})).catch(s)}))}},PUg3:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("TYsd"),r=n("Mc5h"),s=n("9y81"),c=n("AXyT"),l=n("gy8s"),u=n("29dZ"),d=n("Y6JH"),_=n("/Id8"),p=n("BoyB"),h=n("+sJP"),f=n("EDm3"),m=n("hgAR");function v(){var e=Object(i.a)(['\n    <input type="hidden" name="attached_messages" value="','" />\n  ']);return v=function(){return e},e}function g(){var e=Object(i.a)(['\n    <div class="uMailWrite__attachedMsgs">\n      ',"\n      ","\n      ",'\n      <div class="uMailWrite__attachedMsgsText">',"</div>\n    </div>\n  "]);return g=function(){return e},e}function b(){var e=Object(i.a)(['\n    <div class="',' _preventMenuOpen">\n      ',"\n      ","\n    </div>\n  "]);return b=function(){return e},e}function A(){var e=Object(i.a)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n    </div>\n  "]);return A=function(){return e},e}function w(){var e=Object(i.a)(['\n    <div class="uMailWrite__templates">\n      <div class="uMailWrite__templatesHeader">\n        ','\n        <a class="uMailWrite__templatesAdd" href="','" ',">\n          ",'\n        </a>\n      </div>\n      <div class="uMailWrite__templatesBody ScrollView"></div>\n    </div>\n  ']);return w=function(){return e},e}function y(){var e=Object(i.a)(['\n    <div class="uMailWrite__buttonKeyboardIcon"></div>\n  ']);return y=function(){return e},e}function O(){var e=Object(i.a)(['\n    <div class="uMailWrite__keyboard ScrollView">\n\n    </div>\n  ']);return O=function(){return e},e}function k(){var e=Object(i.a)(['\n    <div class="uMailWrite__SVGIcon uMailWrite__SVGIcon_','"></div>\n  ']);return k=function(){return e},e}function j(){var e=Object(i.a)(['\n    <div class="uMailWrite__main">\n      <div class="uMailWrite__button uMailWrite__buttonAttach">','</div>\n      <div class="uMailWrite__button uMailWrite__buttonKeyboard" ',">",'</div>\n      <div class="uMailWrite__button uMailWrite__buttonStickers" ',">","",'</div>\n      <button class="','" type="submit" ',">\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ","\n        ",'\n      </button>\n      <div class="uMailWrite__textareaContainer">\n        <textarea\n          class="uMailWrite__textarea"\n          name="message"\n          placeholder="','"\n          maxlength="4096"\n          ',"\n          ","\n          ","\n          ","\n          ","\n          ","\n          ",'\n        ></textarea>\n        <div class="uMailWrite__textareaGhost"></div>\n      </div>\n    </div>\n  ']);return j=function(){return e},e}function S(){var e=Object(i.a)(["\n    ","\n    ","\n  "]);return S=function(){return e},e}function C(){var e=Object(i.a)(['\n    <form\n      class="','"\n      method="POST"\n      action="/mail?act=send&to=',"&hash=","&from=dialog",'"\n      ','\n    >\n      <div class="uMailWrite__toBottom" ',">","</div>\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </form>\n  "]);return C=function(){return e},e}function E(){var e=Object(i.a)(['\n      <div class="uMailWrite uMailWrite_unableToWrite">\n        ','\n        <div class="uMailWrite__unableToWriteText">\n          ',"\n        </div>\n        ","\n      </div>\n    "]);return E=function(){return e},e}var T=function(){var e=window.lang,t=store.mail,n=t.cur.peerId;if(!n)return'<form class="uMailWrite"></form>';var i=t.peers[n];if(i.unableToWrite){if(i.isChannel)return"";var c=i.isUserNotDon,_=i.kickedMessage||e.mobile_msg_mail_privacy_error;c&&(_=e.mobile_msg_mail_not_don_error);var p=c?null:Object(s.b)({mix:"uMailWrite__unableToWriteIcon",icon:"warning"}),v=c?o.a.html(Object(u.a)({inner:[e.mobile_mail_donate],url:i.subscriptionUrl})):null;return a.a.html(E(),p,_,v)}var g=a.a.onSubmit("window.uMailWrite && uMailWrite._onSubmit","event","this"),b=a.a.onClick("window.uMailWrite && uMailWrite.onToBottomClick"),A=Object(r.a)({mix:"uMailWrite__popupStickers _preventMenuOpen",inner:""}),k=P(null),S=x(n),T=function(e){var t=window.lang,n=store.mail,i=n.cur,r=n.queue,c=a.a.onMouseDown("window.uMailWrite && uMailWrite._onStickersClick","event"),u=a.a.onMouseDown("window.uMailWrite && uMailWrite._onKeyboardClick","event"),_=n.peers[e],p=i.groupId,v=Math.abs(p),g=p?"&community="+v:"",b=!Object(h.H)(),A=!Object(h.H)()&&_.canSendGift,w=!Object(h.H)()&&_.canSendGift,O=!Object(h.H)(),k=Object(h.H)(),S=Object(h.H)(),C=!Object(h.H)(),E=Object(l.a)({icon_html:o.a.html(Object(f.Z)()),name:"uMailWrite_attachments",position:"bottomLeft",items:[{text:i.inlineUploadHTML.replace(/mail\d+/g,"mail"+e),icon:Object(f.tb)(),attrs:a.a.onClick("mediaUpload.onUnfoldItemClick","event","this")},C?{text:t.mobile_attachments_add_photo_vk,url:"/attachments?act=choose_photo&target=mail"+e+g,icon:Object(f.bb)()}:null,k?{text:t.mobile_attachments_add_device_video,icon:Object(f.Ab)(),attrs:a.a.onClick("SAKIntegration.sendMessage","attach_video",{peerId:e})}:null,O?{text:t.mobile_attachments_add_video,url:"/attachments?act=choose_video&target=mail"+e+g,icon:Object(f.Ab)()}:null,b?{text:t.mobile_attachments_add_audio,url:"/attachments?act=choose_audio&target=mail"+e+g,icon:Object(f.sb)()}:null,{text:t.mobile_attachments_add_doc,url:"/attachments?act=choose_doc&target=mail"+e+g,icon:Object(f.fb)()},S?{text:t.mobile_attachments_add_device_document,icon:Object(f.fb)(),attrs:a.a.onClick("SAKIntegration.sendMessage","attach_document",{peerId:e})}:null,A?{text:t.mobile_attachments_add_gift,url:"/gifts"+e+"?act=send&from=mail&ref=media_selector",icon:Object(f.kb)()}:null,w?{text:t.mobile_attachments_add_money,url:"/attachments?act=attach_money&target=mail"+e+g,icon:Object(f.pb)()}:null,_.canAttachPoll?{text:t.mobile_attachments_add_poll,url:"/attachments?act=attach_poll&target=mail"+e+g,icon:Object(d.a)(Object(m.a)()),mix:"uMailWrite__pollUnfoldItem"}:null]}),T=a.a.onKeyUp("window.uMailWrite && uMailWrite._onKeyUp"),I=a.a.onInput("window.uMailWrite && uMailWrite._onInput","event","this"),P=a.a.onKeyDown("window.uMailWrite && uMailWrite._onKeyDown","event","this"),x=a.a.onFocus("window.uMailWrite && uMailWrite._onFocus","event","this"),L=a.a.onBlur("window.uMailWrite && uMailWrite._onBlur","event","this"),R=a.a.onClick("window.uMailWrite && uMailWrite._onClick","event","this"),B=a.a.onTouchEnd("window.uMailWrite && uMailWrite._onSendTouchEnd","event","this"),N=o.a.html({class:"uMailWrite__buttonSendIcon Icon_send",inner:Object(f.ub)()}),D=o.a.html({class:"uMailWrite__buttonSendIcon Icon_send Icon_active",inner:Object(f.ub)()}),H=o.a.html({class:"uMailWrite__buttonVoiceIcon",inner:Object(f.Cb)()}),U=M("accept"),V=M("remove"),F=M("templates"),W=M("templatesActive"),q=Object(s.b)({mix:"uMailWrite__buttonSendIcon",icon:"spinner"}),z=o.a.html({class:"uMailWrite__buttonStickersIcon Icon_sticker",inner:Object(f.wb)()}),Y=o.a.html({class:"uMailWrite__buttonStickersIcon Icon_sticker Icon_active",inner:Object(f.wb)()}),G=a.a.html(y()),Q=_.attachmentsHTML.length,K=i.msgAttached[i.peerId],X=K&&K.length,$=!!(r[i.peerId]||[]).length,J=a.a.class("uMailWrite__button","uMailWrite__buttonSend",{send:!0,sendActive:!!(Q>150||X),loading:$});return a.a.html(j(),E,u,G,c,z,Y,J,B,N,D,H,q,U,V,F,W,t.mobile_mail_message_placeholder,x,T,I,P,x,L,R)}(n),L=a.a.html(O()),R=function(){var e=window.lang,t=Object(s.b)({icon:"plus"}),n=store.mail.cur.peerId,i=store.mail.cur.communityParam,o="/mail?act=template&from="+n+i,r=a.a.onClick("uMailWrite.loadTemplatePage","event","this",o);return a.a.html(w(),e.mobile_mail_templates_panel_title,o,r,t)}(),B=i.isChannel&&Object(h.D)()?function(e){var t=window.lang,n=store.mail,i=n.cur,a=n.peers,r=n.members,s=a[e],c=(i.groupId?r[s.ownerId]:r[i.userId]).name;return o.a.html({inner:[o.a.wrap(t.mobile_mail_from.replace("{name}",'<a onclick="uMailWrite.onSwitcherClick(event, '+e+')">'+c+"</a>"))],class:"uMailWrite__switcher",tag:"div"})}(n):"",N=I(),D=a.a.class("uMailWrite",{canAttachMoney:!!i.canAttachMoney,canAttachPoll:!0});return a.a.html(C(),D,n,i.hashSend,t.cur.communityParam,g,b,N,k,S,B,T,A,L,R)};function I(){var e=store.mail,t=e.cur,n=e.peers,i=n[t.peerId]?n[t.peerId].countUnread:null,o=i?Object(c.a)({mix:"uMailWrite__toBottomValue",value:i}):"",r=Object(s.b)({mix:"uMailWrite__toBottomIcon",icon:"arrowDown"});return a.a.html(S(),o,r)}function M(e){return a.a.html(k(),e)}function P(e){var t=store.mail.cur,n=store.mail.members,i=t.peerId,o=t.msgReply[i],r=null;o&&(r=store.mail.forwards[o]||store.mail.msgs[o]);var s="",c="";if(r){var l=Object(_.Msg__authorName)(n[r.authorId],i,t.userId);s=Object(_.Msg__reply)(r,l,e),c='\n      <input type="hidden" name="attached_messages" value="'+o+'" />\n      <input type="hidden" name="has_reply" value="true" />\n    ',t.editing&&(c+='\n        <input type="hidden" name="mail_edit_attach_fwd" value="1" />\n      ')}var u=a.a.class("uMailWrite__reply",{visible:!!s}),d=MailButton({class:"uMailWrite__replyClose",onClick:a.a.onClick("uMailWrite.onReplyClose")});return a.a.html(A(),u,s,d,c)}function x(e){var t,n=store.mail,i=n.cur,o=n.peers[e].attachmentsHTML,r=a.a.class("uMailWrite__attachments",((t={})[e]=!0,t)),c=i.msgAttached[e]||[],l=c.length,u="";l>0&&(u=function(e,t){var n=window.lang,i=a.a.onClick("uMailWrite.onAttachedMsgsRemove"),o=Object(s.b)({mix:"uMailWrite__attachedMsgsIcon",icon:"msgMini"}),r=Object(s.b)({mix:"uMailWrite__attachedMsgsRemove",icon:"close9",attrs:i}),c=langNumeric(e,n.mobile_mail_messages),l=function(e){return a.a.html(v(),e)}(t);return a.a.html(g(),l,r,o,c)}(l,c.join(";")));return a.a.html(b(),r,u,o)}var L=n("wx14"),R=n("UxAg"),B=n("+cqQ"),N=n("jk6M"),D=n("rKp0"),H=n("V4qE"),U=n("HGMY"),V=n("t7Ww"),F=n("r/ag");function W(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((function(e,t){return e+t})))}}catch(e){}return intval(rand(0,2147483647).toFixed(0))}var q=n("N4ZS"),z=n("9M99"),Y=n("H5mD"),G=n("aiw/"),Q=n("Qz23"),K=(n("jE6c"),n("UlUB")),X=n("hw56"),$=n("rudk"),J=n("j80l"),Z=n("wcVR"),ee=n("B+U2");function te(e){var t=e.length,n=!t;return o.a.html([ne(n),{class:"uMailWrite__templatesRows",attrs:{hidden:n},inner:e.map((function(e,n){return function(e,t,n){var i=t>0&&t===n-1,r=store.mail.cur.communityParam,s=store.mail.cur.peerId,c=e.name,u=e.text;c=Object(z.a)(c),u=ie(u,!0);var d="_touched uMailWrite__templatesRow";d+=" uMailWrite__templatesRow"+e.id,e.deleting&&(d+=" uMailWrite__templatesRow_hidden");return{class:d,inner:[{class:"uMailWrite__templatesRowContent",attrs:{onclick:["uMailWrite.onTemplateClick","event","this",e.id]},inner:[{class:"uMailWrite__templatesRowName",inner:o.a.html(c)},{class:"uMailWrite__templatesRowText",inner:o.a.html(u)}]},{class:"uMailWrite__templatesRowMore",inner:[o.a.wrap(Object(l.a)({mix:"",icon:"more",position:i?"bottomRight":"topRight",items:[{text:lang.mobile_mail_templates_action_edit,name:"edit",url:"/mail?act=template&id="+e.id+r+"&from="+s},{text:lang.mobile_mail_templates_action_delete,name:"delete",attrs:a.a.onMouseDown("uMailWrite._onDeleteTemplate",e.id)}]}))]}]}}(e,n,t)}))}])}function ne(e){var t="/mail?act=template&from="+store.mail.cur.peerId+store.mail.cur.communityParam,n=a.a.onClick("uMailWrite.loadTemplatePage","event","this",t);return{class:"uMailWrite__templatesEmpty",attrs:{hidden:!e},inner:[{class:"uMailWrite__templatesEmptyInfo",inner:lang.mobile_mail_templates_empty_info},Object(u.a)({type:"button",theme:"small",attrs:n,inner:lang.mobile_mail_templates_empty_button})]}}function ie(e,t){void 0===t&&(t=!1);var n,i=store.mail.members,a=store.mail.cur,o=i[a.peerId],r=i[a.userId],s=i[a.groupId],c=o.raw_name.replace(o.firstName,"").trim(),l=r.raw_name.replace(r.firstName,"").trim();if((e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<br>/g,"\n")).replace(/&lt;br&gt;/g,"\n")).replace(/\t/g,"\n")).replace(/{user name}/g,o.firstName)).replace(/{user surname}/g,c)).replace(/{admin name}/g,r.firstName)).replace(/{admin surname}/g,l)).replace(/{community}/g,s.name)).match(/{greeting}/g)){var u,d=(n=Date.now()+1e3*store.mail.cur.timeShift,new Date(n).getHours());u=d>=3&&d<12?lang.mobile_mail_templates_greeting_morning:d>=12&&d<17?lang.mobile_mail_templates_greeting_afternoon:d>=17&&d<=23?lang.mobile_mail_templates_greeting_evening:lang.mobile_mail_templates_greeting_night,e=e.replace(/{greeting}/g,u)}return t&&(e=Object(z.a)(e)),e}var ae=n("HdGT"),oe=n("qHA9"),re=n("cZev"),se=n("W9Tc"),ce=n("OcsD"),le=n("Sn6X"),ue=n.n(le),de=n("xt6h"),_e=n("kGB6"),pe=n("b46l");function he(e){return void 0===e&&(e={}),{inner:[{inner:[{inner:[Object(f.p)()],class:"audio-msg-track--playIcon",tag:"div"},{inner:[Object(f.n)()],class:"audio-msg-track--pauseIcon",tag:"div"}],class:"audio-msg-track--btn audio-msg-track--btnSvg",tag:"button"},{inner:[Object(h.n)(e.duration)||"0:00"],class:"audio-msg-track--duration",tag:"div"},{inner:[{class:"audio-msg-track--wave",tag:"svg"}],class:"audio-msg-track--wave-wrapper",tag:"div"}],class:"audio-msg-track audio-msg-track--preview clear_fix voicemsg0",onClick:"AudioMessagePlayer.togglePlay(this);cancelEvent(event);","data-duration":e.duration,"data-mp3":e.url,"data-ogg":e.url,"data-wave":e.wave,tag:"div"}}var fe=n("VPdG");function me(e){var t=window.lang;return"preview"===e.state?null:{inner:[{inner:[Object(f.D)()],class:"VoiceRecordControls__lockChevron",tag:"div"},{inner:[Object(d.a)({icon:"locked"===e.state?Object(fe.a)():Object(pe.a)()})],class:"VoiceRecordControls__lockIcon",tag:"div"}],class:"VoiceRecordControls__lock","aria-label":t.mobile_mail_voice_record_stop_aria,tag:"div"}}function ve(e){void 0===e&&(e={});var t,n=window.lang;"preview"!==e.state?t=["locked"===e.state?Object(u.a)({inner:[n.mobile_cancel],class:"VoiceRecordControls__cancel VoiceRecordControls__cancel--button",theme:"tertiary",use_native_onclick:!0,onClick:"uMailWrite._cancelVoiceRecord()"}):{inner:[Object(f.f)(),n.mobile_cancel],class:"VoiceRecordControls__cancel",tag:"span"},{inner:[{class:"VoiceRecordControls__marker",tag:"span"},{inner:[e.duration||"0:00"],class:"VoiceRecordControls__durationText",tag:"span"},{inner:[Wd.wrap(Object(p.a)({spinner:!0}))],class:"VoiceRecordControls__spinner",tag:"div"}],class:"VoiceRecordControls__duration",tag:"span"}]:t=[{inner:[Object(f.cb)()],class:"VoiceRecordControls__cancel VoiceRecordControls__cancel--button",onClick:"uMailWrite._cancelVoiceRecord()","aria-label":n.mobile_mail_voice_record_cancel_aria,tag:"button"},{inner:[he({url:e.url,duration:e.audioMessagePreviewData.duration,wave:e.audioMessagePreviewData.waves.join(",")||"0"})],class:"VoiceRecordControls__player",tag:"div"},{inner:[Object(f.ub)()],class:"VoiceRecordControls__send","aria-label":n.mobile_mail_voice_record_send_aria,tag:"button"}];return{inner:[t],class:Object(h.f)("VoiceRecordControls__panel",{"VoiceRecordControls__panel--preview":"preview"===e.state}),tag:"div"}}var ge=n("rf2p"),be=n("CQvH"),Ae=n("DLiR"),we=n("4sM2"),ye=function(){function e(e,t){var n=this;this.onSend=Object(B.a)(),this.onDestroy=Object(B.a)(),this.onPreviewProcessComplete=Object(B.a)(),this.audioMessagePreviewData=null,this.initialized=!1,this.lastDurationSend=0,this.state="moving",this.moving=!1,this.needLock=!1,this.floatPosition=[0,0],this.isSending=!1,this.isPreviewProcessing=!1,this.init=function(e,t,i){var a,r,s,c,l,u;n.state=t,n.recorder&&(n.recorder.duration=0),n.recordingID=i;var _=function(e){void 0===e&&(e={});var t=window.lang;return{inner:[ve(e),me(e),"preview"!==e.state?{inner:[{inner:[{inner:[Object(f.ub)()],class:"VoiceRecordControls__circleSend",tag:"div"},{inner:[Object(d.a)({icon:Object(_e.a)()})],class:"VoiceRecordControls__circleMicrophone",tag:"div"},{inner:[Object(f.eb)()],class:"VoiceRecordControls__circleCancel",tag:"div"}],class:"VoiceRecordControls__circle",tag:"div"},{class:"VoiceRecordControls__shadow",tag:"div"}],class:"VoiceRecordControls__float","aria-label":t.mobile_mail_voice_record_send_aria,tag:"button"}:null],class:Object(h.f)("VoiceRecordControls",{"VoiceRecordControls--locked":"locked"===e.state,"VoiceRecordControls--lock":"locked"===e.state,"VoiceRecordControls--show":"locked"===e.state}),tag:"div"}}({state:"moving"===n.state?"":n.state,audioMessagePreviewData:n.audioMessagePreviewData});if(n.elements.appendElement&&_&&(n.elements.controls=o.a.elem(_),n.elements.controls&&n.elements.appendElement.appendChild(n.elements.controls)),n.findPanelElements(),"preview"!==n.state&&(n.elements.float=Object(R.a)(".VoiceRecordControls__float",n.elements.controls),n.elements.lock=Object(R.a)(".VoiceRecordControls__lock",n.elements.controls),n.elements.lockChevron=Object(R.a)(".VoiceRecordControls__lockChevron",n.elements.controls),n.elements.lockIcon=Object(R.a)(".VoiceRecordControls__lockIcon",n.elements.controls),n.calculateTransitionData()),"moving"===n.state&&e){e.preventDefault(),e.stopPropagation();var p=e.touches[0];n.moveElements([p.pageX,p.pageY])}else"locked"===n.state&&n.lock();n.applyVolume(0),null===(a=n.elements.controls)||void 0===a||a.classList.add("VoiceRecordControls--show"),window.nav.onBeforeGo((function(){return n.cancel(!0)})),"moving"===n.state&&(Object(ce.b)(n.elements.initialElement,"touchmove",n.onTouchMove,{passive:!0}),Object(ce.b)(n.elements.initialElement,"touchend touchcancel",n.onTouchEnd,{passive:!0}),Object(ce.b)(window,"resize",n.onResize),document.addEventListener("visibilitychange",n.onVisibilityChange,!1)),"preview"!==n.state&&(Object(ce.b)(n.elements.float,"click",n.onFloatClick),Object(ce.b)(n.elements.lock,"click",(function(){"locked"===n.state&&(n.getDuration()>0?n.showPreview():n.cancel(!0))})),Object(ce.b)(window,"click",n.onGlobalClick,{capture:!0}),window.Speech&&(window.Speech.onRecordProgress(n.onProgress),window.Speech.onRecordStart(n.onRecordStart),window.Speech.onStop(n.onStop),window.Speech.onCancel(n.onCancel)),Ae.a.lock()),n.initialized=!0,"preview"===n.state?(n.updatePanel(!0),window.requestAnimationFrame((function(){window.AudioMessagePlayer.redrawWaves()}))):("locked"===t?null===(r=n.recorder)||void 0===r||r.record():"moving"===t&&setTimeout((function(){var e;null===(e=n.recorder)||void 0===e||e.record()}),window.browser.iphone?250:0),"suspended"===(null===(s=n.recorder)||void 0===s?void 0:s._ctx.state)&&(null===(u=null===(c=n.recorder)||void 0===c?void 0:(l=c._ctx).resume)||void 0===u||u.call(l))),setTimeout((function(){Object(ce.oc)("mvk_audio_messages_event",null,"init",n.state)}),400)},this.setAudioMessagePreviewData=function(e){n.audioMessagePreviewData=e},this.getDuration=function(){return n.recorder?n.recorder.duration:n.audioMessagePreviewData?n.audioMessagePreviewData.duration:0},this.calculateTransitionData=function(){var e=Object(ce.Y)(n.elements.appendElement)[0],t=Object(ce.S)(),i=t-160-40,a=0;n.elements.panel&&(a=parseInt(getComputedStyle(n.elements.panel).marginBottom,10)),n.elements.initialElement=document.body,n.transitionData={cancelPositionX:Math.max(e/2,e-240),cancelOpacityDecreaseStartX:e-320,minY:t-40-a,maxX:e-40,maxLockY:i+40,maxY:i}},this.findPanelElements=function(){n.elements.panel=Object(R.a)(".VoiceRecordControls__panel",n.elements.controls),n.elements.duration=Object(R.a)(".VoiceRecordControls__duration",n.elements.controls),n.elements.cancel=Object(R.a)(".VoiceRecordControls__cancel",n.elements.controls),n.elements.previewPlayer=Object(R.a)(".audio-msg-track",n.elements.controls)},this.onPreviewPanelShow=function(){n.findPanelElements(),n.elements.send=Object(R.a)(".VoiceRecordControls__send",n.elements.controls),Object(ce.b)(n.elements.send,"click",n.send),n.state="preview"},this.updatePanel=function(e){var t,i;void 0===e&&(e=!1),"preview"===n.state&&(e=!0);var a={state:n.needLock?"locked":""};if(!e&&n.recorder&&(a.duration=Object(de.c)(n.getDuration())),null===(t=n.elements.controls)||void 0===t||t.classList.toggle("VoiceRecordControls--locked","locked"===n.state),e){n.needLock=!0,n.previewBuffer=n.previewBuffer||(null===(i=n.recorder)||void 0===i?void 0:i.buffer);var r=URL.createObjectURL(n.previewBuffer);a.state="preview",a.url=r,window.Speech&&n.recorder&&n.audioMessagePreviewData&&window.Speech.saveRecordingBuffer(n.audioMessagePreviewData.bufferKey,n.previewBuffer).then((function(){window.clog("[VoiceRecorder] Voice record was cached")})),a.audioMessagePreviewData=n.audioMessagePreviewData,n.onPreviewProcessComplete(n.audioMessagePreviewData),Object(ce.Xb)(n.elements.float),Object(ce.Xb)(n.elements.lock),n.transitionData&&n.moveElements([n.transitionData.maxX,n.transitionData.minY])}var s=o.a.elem(ve(a));n.elements.panel&&s&&(n.elements.panel.outerHTML=s.outerHTML),n.findPanelElements(),e?n.onPreviewPanelShow():n.movePanelElements(),window.requestAnimationFrame((function(){window.AudioMessagePlayer.redrawWaves()}))},this.onFinish=function(){var e,t;n.isPreviewProcessing=!1,null===(e=n.elements.controls)||void 0===e||e.classList.remove("VoiceRecordControls--longProcessing"),Object(ce.Zb)(window,"click",n.onGlobalClick,{capture:!0}),Object(ce.Zb)(n.recorder,"finish",n.onFinish);var i=n.audioMessagePreviewData||{bufferKey:n.key,duration:n.getDuration(),waves:null===(t=n.recorder)||void 0===t?void 0:t._waveData};n.setAudioMessagePreviewData(i),n.isSending||n.updatePanel(!0)},this.showPreview=function(){var e;n.isPreviewProcessing||(Object(ce.oc)("mvk_audio_messages_event",null,"show_preview"),n.isPreviewProcessing=!0,Object(ce.b)(n.recorder,"finish",n.onFinish),setTimeout((function(){var e;n.isPreviewProcessing&&(null===(e=n.elements.controls)||void 0===e||e.classList.add("VoiceRecordControls--longProcessing"))}),500),null===(e=n.recorder)||void 0===e||e.stop())},this.applyVolume=Object(de.e)((function(e){var t=Object(R.a)(".VoiceRecordControls__shadow");ce.jc.transform(t,.7+Math.min(e,.2))}),50),this.setDuration=function(e){n.elements.duration&&(Object(R.a)(".VoiceRecordControls__durationText",n.elements.duration).innerHTML=e)},this.isTouchCancel=function(e){var t;return!(null===(t=n.recorder)||void 0===t?void 0:t._aquireing)&&e.pageX<=n.transitionData.cancelPositionX},this.moveElements=function(e){void 0===e&&(e=[0,0]);var t=[Math.min(n.transitionData.maxX,e[0])-40,Math.max(Math.min(n.transitionData.minY,e[1])-40,n.transitionData.maxY)];n.floatPosition=t;var i="locked"===n.state?0:1-(n.transitionData.minY-t[1]-40)/(n.transitionData.minY-n.transitionData.maxLockY-40),a=[Math.max(0,Math.min(6,6*i)),Math.max(0,Math.min(10,10*i))],r=[t[0]+20,t[1]-80-a[0]-a[1]];ue.a.mutate((function(){ce.jc.transform(n.elements.float,{translate:t}),ce.jc.transform(n.elements.lock,{translate:r}),Object(ce.jc)(n.elements.lock,{"padding-top":a[0],"padding-bottom":a[1]}),ce.jc.transform(n.elements.lockIcon,{translate:[0,Math.max(-10,Math.min(0,-10*(1-i)))]}),ce.jc.transform(n.elements.lockChevron,{translate:[Math.max(-8,Math.min(0,-8*(1-i))),0],rotate:-90}),Object(ce.jc)(n.elements.lockChevron,{opacity:i}),n.movePanelElements()}));var s=i<=0;if("locked"===n.state||n.needLock!==s){var c=void 0;"locked"===n.state?c=Object(fe.a)():(n.needLock=s,c=n.needLock?Object(ge.a)():Object(pe.a)()),n.elements.lockIcon&&"locked"!==n.state&&(n.elements.lockIcon.innerHTML=o.a.html(Object(d.a)({icon:c})))}},this.movePanelElements=function(){var e=[n.floatPosition[0]-160,0];ce.jc.transform(n.elements.duration,{translate:e}),n.transitionData&&Object(ce.jc)(n.elements.cancel,{opacity:e[0]/n.transitionData.cancelOpacityDecreaseStartX})},this.lock=function(){var e,t;if("locked"!==n.state){Object(ce.oc)("mvk_audio_messages_event",null,"lock"),n.needLock=!0,n.state="locked",null===(e=n.elements.controls)||void 0===e||e.classList.add("VoiceRecordControls--lock"),null===(t=n.elements.controls)||void 0===t||t.classList.add("VoiceRecordControls--locked"),n.initialized&&(ce.jc.animate(n.elements.lock,"transform",{duration:150,func:"ease"}),ce.jc.animate(n.elements.duration,"transform",{duration:150,func:"ease"}));var i=function(){if(n.updatePanel(),n.elements.lockIcon&&(n.elements.lockIcon.innerHTML=o.a.html(Object(d.a)({icon:Object(fe.a)()}))),n.elements.lock&&(n.elements.lock.setAttribute("tabindex","0"),n.elements.lock.setAttribute("role","button")),n.elements.float&&(n.elements.float.setAttribute("tabindex","0"),n.elements.float.setAttribute("role","button"),n.elements.float.focus()),n.elements.controls){var e=Object(be.d)(n.elements.controls);e&&(n.cancelFocusTrap=e,n.cancelFocusTrap.exitIntent=function(){return n.cancel(!0)})}};n.initialized?ce.jc.animate(n.elements.float,"transform",{duration:200,func:"ease"},(function(){i()})):i(),n.moveElements([n.transitionData.maxX,n.transitionData.minY])}else n.moveElements([n.transitionData.maxX,n.transitionData.minY])},this.onGlobalClick=function(e){if("preview"!==n.state)return n.moving?(e.preventDefault(),e.stopPropagation(),void(n.getDuration()?n.cancel(!0):n.lock())):void(!e.target||e.target.closest(".VoiceRecordControls")||e.target.closest(".uMailWrite__buttonSend")||e.target.classList.contains("uMailWrite__buttonSend")||(e.preventDefault(),e.stopPropagation(),n.getDuration()<=0?n.cancel(!0):n.showPreview()))},this.onTouchMove=function(e){var t,i,a,o,r,s;if("suspended"===(null===(t=n.recorder)||void 0===t?void 0:t._ctx.state)&&(null===(o=null===(i=n.recorder)||void 0===i?void 0:(a=i._ctx).resume)||void 0===o||o.call(a)),"moving"===n.state){n.moving=!0;var c=e.touches[0];null===(r=n.elements.controls)||void 0===r||r.classList.toggle("VoiceRecordControls--cancel",n.isTouchCancel(c)),n.moveElements([c.pageX,c.pageY]),null===(s=n.elements.controls)||void 0===s||s.classList.toggle("VoiceRecordControls--lock",n.needLock)}},this.onTouchEnd=function(e){var t;if("moving"===n.state){n.moving=!1;var i=n.isTouchCancel(e.changedTouches[0]);(null===(t=n.recorder)||void 0===t?void 0:t._aquireing)||n.needLock&&!i?n.lock():i||n.getDuration()<=0?n.cancel():n.send()}},this.onFloatClick=function(){"locked"===n.state&&n.send()},this.onResize=function(){n.calculateTransitionData(),n.lock()},this.onCancel=function(){n.cancel(!0)},this.onStop=function(){n.getDuration()>0?n.showPreview():n.cancel(!0)},this.onProgress=function(){if(n.recorder&&n.recorder._waveData){var e=n.recorder._waveData[n.recorder._waveData.length-1];n.applyVolume(e/.5)}n.setDuration(Object(de.c)(n.getDuration())||"0:00")},this.onRecordStart=function(){n.elements.controls&&n.elements.controls.classList.add("VoiceRecordControls--recording")},this.onVisibilityChange=function(){document.hidden&&"moving"===n.state&&n.lock()},this.stopRecording=function(){n.recorder&&n.recorder.isRecording&&n.recorder._stream&&n.recorder.stop()},this.detachEvents=function(){Object(ce.Zb)(n.elements.initialElement,"touchmove",n.onTouchMove),Object(ce.Zb)(n.elements.initialElement,"touchend",n.onTouchEnd),Object(ce.Zb)(window,"click",n.onGlobalClick,{capture:!0}),Object(ce.Zb)(window,"resize",n.onResize),document.removeEventListener("visibilitychange",n.onVisibilityChange,!1),window.Speech&&(window.Speech.onRecordProgress.off(n.onProgress),window.Speech.onRecordStart.off(n.onRecordStart),window.Speech.onCancel.off(n.onCancel),window.Speech.onStop.off(n.onStop))},this.send=function(){if(!(n.isSending||n.getDuration()<=0)){n.isSending=!0;var e=function(){if(n.onFinish(),Object(ce.Zb)(n.recorder,"finish",e),n.audioMessagePreviewData&&n.previewBuffer){var t=Object(we.a)(n.audioMessagePreviewData.waves,n.previewBuffer,n.previewBuffer.type);n.onSend(t,n.recordingID)}else{t=n.recorder.getFormData();n.onSend(t,n.recordingID)}};window.Speech&&n.audioMessagePreviewData&&window.Speech.saveRecordingBuffer(n.audioMessagePreviewData.bufferKey,null),Object(ce.oc)("mvk_audio_messages_event",null,"send"),!n.audioMessagePreviewData&&n.recorder.isRecording?(Object(ce.b)(n.recorder,"finish",e),n.stopRecording(),n.destroy()):(e(),n.destroy(!0))}},this.cancel=function(e){void 0===e&&(e=!1),Object(ce.oc)("mvk_audio_messages_event",null,"cancel"),window.clog("[VoiceRecorder] Voice send cancelled"),n.stopRecording(),n.destroy(e)},this.destroy=function(e){var t;void 0===e&&(e=!1),n.audioMessagePreviewData=void 0,n.previewBuffer=void 0,null===(t=n.elements.controls)||void 0===t||t.classList.add("VoiceRecordControls--destroying"),n.detachEvents(),Ae.a.unlock();var i=function(){n.cancelFocusTrap&&n.cancelFocusTrap(),Object(ce.Xb)(n.elements.controls),n.elements.previewPlayer&&window.AudioMessagePlayer.togglePlay(n.elements.previewPlayer,null,!1),n.onDestroy()};e?i():setTimeout(i,250)},this.key=e,this.elements={},this.elements.appendElement=t}return e.prototype.clearCache=function(){window.Speech&&window.Speech.saveRecordingBuffer(this.key,null)},e}(),Oe=n("uEFA"),ke=n("Ogzf"),je=n("a0wW"),Se=n("TAKr"),Ce=n("hC3G"),Ee=n("Gyo5"),Te=n("5s+S"),Ie=n("2oAq"),Me=n("pOR2"),Pe=n("i2ua");Object.assign(T,{onToBottomClick:Object(B.a)(),onAttachedMsgsRemove:Object(B.a)(),onReplyClose:Object(B.a)(),onMessage:Object(B.a)(),replyAsChange:Object(B.a)(),showToBottom:function(){if(Ve)return;Fe&&(clearTimeout(Fe),Fe=null);addClass("uMailWrite__toBottom_visible",Object(R.a)(".uMailWrite__toBottom"))},hideToBottom:function(){clearTimeout(null),Fe=setTimeout((function(){removeClass("uMailWrite__toBottom_visible",Object(R.a)(".uMailWrite__toBottom"))}),100)},preventShowToBottom:function(){Ve=!0,setTimeout((function(){Ve=!1}),300)},openStickersPanel:ot,redrawReply:bt,uiRedrawAttachments:At,redrawToBottom:function(){Object(R.b)(".uMailWrite__toBottom").forEach((function(e){return e.innerHTML=I()}))},drawStickers:nt,setModifiers:function(e){Object(R.b)(".uMailWrite").forEach((function(t){var n=a.a.parseClass("uMailWrite",t.getAttribute("class"));t.setAttribute("class",a.a.class("uMailWrite",Object.assign({},n,e)))}))},hideStickersPanel:at,setText:qt,renderKeyboardIfNeeded:Yt,openKeyboard:Qt,init:function(){var e=store.mail,t=e.cur,n=e.msgs,i=e.pendingReplies,a=e.flags,o=t&&Object(X.h)(t.viewerId,t.peerId);"templates"===Object(X.g)()?_t():Yt();o&&!t.editing&&(o.text&&function(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value;Object(R.b)(".uMailWrite__textarea").forEach((function(e){return e.value=n}));var i=Object(R.a)(".uMailWrite__textareaGhost");i.innerText=n,"\n"===last(n)&&(i.innerHTML+="&nbsp;");Ke()}(o.text),o.audioMessagePreviewData&&Ge().then((function(){store.mail.cur.peerId===t.peerId&&window.Speech.getRecordingBuffer(o.audioMessagePreviewData.bufferKey).then((function(e){if(e){var n=W();jt[n]={peerId:t.peerId},Ot(),Re.previewBuffer=e,Re.setAudioMessagePreviewData(o.audioMessagePreviewData),Re.init(null,"preview",n)}})).catch((function(){}))})).catch((function(e){})));tn(),$e(),o&&!t.editing&&Array.isArray(o.msgs)&&(t.msgAttached[t.peerId]=o.msgs);if(o&&!t.editing&&isFinite(o.reply)){var r=_.default.getReplyDataFromHTML(o.reply);r&&(t.msgReply[t.peerId]=o.reply,i[o.reply]=r)}bt(),At(t.peerId),Object.keys(n).forEach((function(e){CasperTimer.init(e)})),Object(R.b)(".uMailWrite__textarea").forEach((function(e){Object(Q.e)(e,{topBanner:!1,overscrollY:!1})})),Object(R.b)(".uMailWrite__attachments").forEach((function(e){Object(Q.e)(e,{topBanner:!1,allowY:!1})})),a.areAudioMessagesEnabled&&je.e.getFlag(je.c)&&Ge().then((function(){Ht();var e=Object(R.a)(".uMailWrite__buttonSend");Object(ke.b)(e,150,Ct,Et,{canStart:function(){return!!Ht().canVoiceRecord},shouldPreventDefault:!0,ignoreMoveEvent:!0,ignoreMouseLongpress:!0})})).catch((function(){}));ln()},reset:function(){Object(X.v)("")},loadTemplatePage:function(e,t,n){e.preventDefault(),uMessenger.loadMailPage(n)},onSwitcherClick:function(e,t){!function(e,t){e.preventDefault();var n=Object(V.g)({class:Object(de.a)("uMailWrite__replyAsModalMenu",{"uMailWrite__replyAsModalMenu--mobile":store.mail.cur.isMobileView}),title:lang.mobile_mail_message_author,close:store.mail.cur.isMobileView,items:[{id:"mail_write_reply_as_users_list",inner:Xt(t)}]}),i=Object(ce.l)(o.a.html(n));V.g.open(i,!0)}(e,t)},onUserListItemClick:function(e,t,n){e.preventDefault(),V.g.close(t);var i=Object(R.a)(".uMailWrite__textarea");T.replyAsChange(n,i.value)},updateNewConvoStickersHint:ln}),uVK.onReady(Xe),T._onBlur=Nt,T._onKeyUp=It,T._onKeyDown=Lt,T._onFocus=Bt,T._onInput=Mt,T._onSubmit=wt,T._onClick=Rt,T._onAttachClick=ht,T._onStickersClick=it,T._onKeyboardClick=rt,T._onKeyboardButtonClick=st,T._onDeleteTemplate=$t,T._onConfirmDeleteTemplate=Jt,T._onSendTouchEnd=Tt,T._onRetryFailedMsg=an,T._onDeleteFailedMsg=on,T._onCancelPendingMsg=rn,T._onConfirmSendGeo=ct,T._cancelVoiceRecord=kt,T._resendAudioMessage=function(){},mediaUpload.onRemove(Je),mediaUpload.onComplete(tt),mediaUpload.onStart(Ze),mediaUpload.onError(et),post.onStickersTabSelected(ft),post.onStickerClick(mt),re.a.onStickerPanelUpdate(vt),ae.f(en),ae.c(sn),_.default.onPendingClick(nn),l.a.onOpen("uMailWrite_attachments")(Qe),T.onToBottomClick((function(){var e=Object(R.a)(".uMailWrite__toBottom_visible");e&&e.classList.remove("uMailWrite__toBottom_visible"),D.default.removeDivider()})),T.onReplyClose((function(){var e=store.mail.cur;e.msgReply[e.peerId]=null,Object(X.w)(e.viewerId,e.peerId,{reply:void 0},e.editing),e.editing||ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),bt()})),T.onTemplateClick=function(e,t,n){var i;n&&(store.mail.cur.templates.some((function(e){if(e.id===n)return i=e,!0})),i&&qt(ie(i.text)))},Mention.onOpen((function(){if(store.mail.cur){var e=store.mail.cur,t=e.peerMembers,n=e.peerId;t[n]||(t[n]=!0,ajaxRequest("/mail",{act:"get_members",peer_id:n},(function(e){Object.assign(store.mail.members,e);var t=Pt(n);Mention.update({items:t,defaultItems:t})}),(function(){t[n]=!1})))}}));var xe,Le,Re,Be="uMailWrite__popupAttach_open",Ne="uMailWrite__popupStickers_open",De="uMailWrite_canAttachPoll",He=".uMailWrite",Ue=".attachment_type_poll",Ve=!1,Fe=null,We=[],qe=!1,ze=Object(K.a)(Ht,100),Ye=Object(K.a)(Dt,1e3);function Ge(){return n.e("audio_messages").then(n.bind(null,"tPJ0")).catch((function(e){return Object(ce.oc)("mvk_audio_messages_event",null,"chunk_error",e.name)}))}function Qe(){function e(e,t){return e=e.replace(/&edit_msg_id=\d+/,"").replace(/=mailedit(-?\d+)/,"=mail$1"),store.mail.cur.editing&&(e=e.replace(/=mail(-?\d+)/,"=mailedit$1"),e+=t?"&edit_msg_id="+store.mail.cur.editing:""),e}Object(R.b)("a.Unfold__item").forEach((function(t){var n=e(t.getAttribute("href"),!0);t.setAttribute("href",n)})),Object(R.b)("input.inline_upload").forEach((function(t){t.setAttribute("data-upload-url",e(t.getAttribute("data-upload-url")))}))}function Ke(){var e=Object(R.a)(".uMailWrite__textareaGhost").offsetHeight;Object(R.b)(".uMailWrite__textarea").forEach((function(t){return setStyle(t,"height",e)})),Object(R.b)(".uMailWrite__main").forEach((function(t){return setStyle(t,"height",e+8)})),Object(R.b)(".uMailWrite__popupStickers .stickersHints").forEach((function(t){setStyle(t,"bottom",e+8+-5)})),Ht()}function Xe(){if("/mail"===location.pathname||0===location.pathname.indexOf("/write")){var e=store.mail.cur;if(e&&e.peerId){var t=geBySel(".uMailWrite__attachments .medias_thumb").length,n=geBySel(".uMailWrite__attachments .medias_row").length,i=(e.msgAttached[e.peerId]||[]).length?1:0;e.hasAttachments=t+n+i>0,Object(R.b)(".uMailWrite__attachments").forEach((function(t){toggleClass("uMailWrite__attachments_hasAttachments",t,e.hasAttachments)})),function(){var e=Object(R.a)(".uMailWrite__buttonAttach");if(!e)return;var t=(n=Object(R.a)(".uMailWrite__attachments"),(n?n.$$(".thumb_item").length+n.$$(".medias_row").length-n.$$(".fwd_item").length:0)>=10);var n;e.classList.add("uMailWrite__button_disabled",t),t?e.addEventListener("mousedown",Wt,!0):e.removeEventListener("mousedown",Wt,!0)}()}}}function $e(){var e=store.mail.cur;if(e&&e.peerId){if(!Object(oe.g)(e.peerId))return;We=Pt(e.peerId),Mention.init({defaultItems:We,items:We,appendTo:Object(ce.O)("uMailWrite__main"),url:null,params:{},preferDomain:!0,afterInsert:function(t){var n=Object(R.a)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,Ke(),Dt(i,e.viewerId,e.peerId)}})}}function Je(e){if(store.mail.cur){var t=store.mail,n=t.cur,i=t.peers,a=n.peerId;if(a&&(i[a].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+a+" .cp_attached_wrap").outerHTML,At(a)),e.closest(Ue))Object(R.a)(He).classList.add(De)}}function Ze(){store.mail.cur&&(Xe(),Ht())}function et(){if(store.mail.cur){var e=store.mail,t=e.cur,n=(e.peers,t.peerId);n&&(At(n),Messenger.scrollConvoToBottom())}}function tt(){var e=store.mail,t=e.cur,n=e.peers;if(t){var i=t.peerId;i&&(n[i].attachmentsHTML=geBySel1(".uMailWrite__attachments_"+i+" .cp_attached_wrap").outerHTML,Ht())}}function nt(){var e=store.mail.cur,t=Object(R.a)(".uMailWrite__popupStickers");e&&t&&!t.childElementCount&&(re.a.checkStickers(),t.innerHTML=re.a.getStickerPanel("mail"+e.peerId),t.innerHTML||(e.waitingStickerPanel=!0),Object(R.b)(".sp_body",t).forEach((function(e){Object(Q.e)(e,{topBanner:!1})})),Object(R.b)(".scroller_wrap",t).forEach((function(e){Object(Q.e)(e,{topBanner:!1,allowY:!1})})),post.stickersSelectTab(null,-1))}function it(e){var t=Object(R.a)(".uMailWrite__popupStickers"),n=hasClass(Ne,t);e.preventDefault(),nt(),Kt("stickers"),n?at():ot()}function at(){"stickers"===Object(X.g)()&&Object(X.v)("");var e=Object(R.a)(".uMailWrite__popupStickers");removeClass(Ne,e),Ut(!1);var t=Object(ce.M)("stickers_panel");t&&"block"===t.style.display&&(t.style.display="none"),domData(e,"need-update")&&(clog("[mail sticker panel] inject new sticker panel after close"),gt(),domData(e,"need-update",null))}function ot(){Object(X.v)("stickers");var e=Object(R.a)(".uMailWrite__popupStickers");addClass(Ne,e),post.stickerPanelInit(),post.stickersInit(),Ut(!0);var t=store.mail.cur;e.classList.toggle("uMailWrite__popupStickers--canGift",t&&t.peerId&&Object($.e)(t.peerId)&&t.viewerId&&Object($.e)(t.viewerId))}function rt(e){var t=Object(R.a)(".uMailWrite__keyboard"),n=hasClass("uMailWrite__keyboard_open",t);e.preventDefault(),Kt("buttons"),n?lt({store:!0}):ut({store:!0})}function st(e,t,n){var i=n.authorId,o=n.inline,r=n.msgId,s=n.subID,c=JSON.parse(n.action),l=c.type,d=c.payload,_=c.rawLabel,p=store.mail,h=p.cur,f=p.members,m=p.peers,v=p.msgs;if(store.mail.cur){t.stopPropagation();var g,b,A=f[i],w=W();if(r){var y=v[r];g=y.peerId,b=y.conversationMsgId}else g=h.peerId;var O,k=m[g],j=_||"";if(g>=2e9)if(A.domain)O="@"+A.domain+" "+j;else{var S=A.url.replace(/^\//,"");O="@"+S+" ("+A.firstName+") "+j}else O=j;var C=l,E=o?"inline":"normal";if("open_app"===C&&(C="app"),Object(ce.oc)("message_send_from_keyboard",0,h.viewerId,g,i,C,E),"vkpay"!==l)if("open_app"!==l)if("open_link"!==l)if("location"!==l){if("callback"===l)return u.a.setLoading(e,!0,"spinner"),void ajaxRequest("/mail",{act:"sendEvent",peer_id:g,author_id:i,message_id:r,conversation_message_id:b,payload:d,hash:k.hashSend},(function(t){var n=t.result.event_id;clog("waiting for "+n+" event callback"),Object(X.n)(g,e,n,r,s)}),(function(){H.g({type:H.d,text:lang.mobile_unknown_error}),u.a.setLoading(e,!1)}));Ft({act:"send",to:g,from:"dialog",hash:k.hashSend,message:O,media:"",_af:h._af,random_id:w,payload:d}),o&&!h.peerId&&nav.go(Object(J.b)("/mail",{act:"show",peer:g,community:nav.getQuery("community")}))}else{Z.a.init()?(u.a.setLoading(e,!0,"blue"),Z.a.getCurrentPosition((function(t){var n=t.coords,i=n.latitude,o=n.longitude;u.a.setLoading(e,!1),MailDialog.open({body:lang.mobile_mail_geo_send_question,confirmText:lang.mobile_mail_geo_send_confirm,cancelText:lang.mobile_cancel,onConfirm:a.a.onClick("uMailWrite._onConfirmSendGeo",i,o,d,O,g)})}),(function(){u.a.setLoading(e,!1),H.g({text:lang.mobile_mail_geo_not_available})}),{maximumAge:100,enableHighAccuracy:!0,timeout:1e4})):H.g({text:lang.mobile_mail_geo_not_available})}else{var T=c.link;g===Ce.d&&Object($.c)(T)&&Ee.a.logEvent({experiment_id:1285,service:"messages",metric_name:"push_find_friends_button",metric_value:4,unit_id:h.viewerId,unit_type_id:1});var I=Object(q.a)(T,!0);nav.hard_go(I)}else{var M=c.app_id,P=c.hash,x=Object(J.b)("/app"+M,{from:nav.cur.slice(1)});nav.go(x+"#"+P)}else{var L=c.hash,R=Object(J.b)("/app6217559",{from:nav.cur.slice(1)});nav.go(R+"#"+L)}}}function ct(e,t,n,i,a){var o=store.mail,r=o.cur,s=o.peers[a],c=W();Ft({act:"send",to:a,from:"dialog",hash:s.hashSend,message:i,media:"",_af:r._af,random_id:c,payload:n,attach1_type:"map",attach1:e+"_"+t}),MailDialog.close(),nav.go(Object(J.b)("/mail",{act:"show",peer:a,community:nav.getQuery("community")}))}function lt(e){"buttons"===Object(X.g)()&&Object(X.v)("");var t=Object(R.a)(".uMailWrite__keyboard");if(removeClass("uMailWrite__keyboard_open",t),Vt(!1),e&&e.store){var n=store.mail.cur.peerId,i=store.mail.peers[n];i&&i.keyboard&&(xe[n]=i.keyboard.chat_local_id,lsSet("mail_keyboard_hidden",xe))}}function ut(e){Object(X.v)("buttons");var t=Object(R.a)(".uMailWrite__keyboard"),n=e&&e.forceRender;addClass("uMailWrite__keyboard_open",t),Vt(!0);var i=Object(X.f)(store.mail.cur.peerId);!n&&!!i.rendered||function(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(!i||!i.keyboard||!i.keyboard.buttons)return;var a=o.a.render(Object(ee.b)({keyboard:i.keyboard,pressed:cn(t.peerId)})),r=Object(R.a)(".uMailWrite__keyboard");r.innerHTML=a,Object(Q.e)(r,{topBanner:!1}),Object(X.f)(t.peerId).rendered=!0}(),e&&e.store&&dt()}function dt(){var e=store.mail.cur.peerId;Object(X.c)(e),xe&&(delete xe[e],lsSet("mail_keyboard_hidden",xe))}function _t(){Object(X.v)("templates");var e=Object(R.a)(".uMailWrite__templates");addClass("uMailWrite__templates_open",e),Ht(),Gt()}function pt(){"templates"===Object(X.g)()&&Object(X.v)("");var e=Object(R.a)(".uMailWrite__templates");removeClass("uMailWrite__templates_open",e),Ht()}function ht(e){var t=Object(R.a)(".uMailWrite__popupAttach"),n=Object(R.a)(".uMailWrite__popupStickers");e.preventDefault(),e.stopPropagation(),hasClass(Ne,n)&&removeClass(Ne,n),hasClass(Be,t)?removeClass(Be,t):(addClass(Be,t),addEvent(window,"click",(function e(n){removeClass(Be,t),removeEvent(window,"click",e)})))}function ft(){store.mail.cur&&(Object(ce.O)("sp_body")&&(cur.scroller&&cur.scroller.destroy(),Object(ce.O)("sp_body").scrollTop=0,removeClass("scroller_wrap",Object(ce.O)("sp_cont")),geByClass("sp_page").forEach((function(e){return removeClass("scroller_page",e)}))))}function mt(e,t){if(store.mail.cur){var n=store.mail,i=n.cur,a=n.peers,o=(Object(ce.O)("uMailWrite"),Object(R.a)(".uMailWrite__popupStickers")),r=W(),s=0===t.indexOf("suggestion"),c={act:"send",to:i.peerId,from:"dialog",hash:a[i.peerId].hashSend,message:"",media:"sticker"+e,_af:i._af,random_id:r,sticker_referrer:t};post.addRecentSticker(!1,e,!1);var l=i.msgReply[i.peerId];if(l&&(c.attached_messages=l,c.has_reply=!0,Object(X.w)(i.viewerId,i.peerId,{reply:void 0}),ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),i.msgReply[i.peerId]=null),s){var u=Object(R.a)(".uMailWrite__textarea");u.value="",Dt("",i.viewerId,i.peerId),Mt({},u)}return Ft(c),Ht(),bt(),Object(R.a)(".sp_tab_selected",o).classList.contains("sp_tab-1")&&setTimeout((function(){post.stickersSelectTab(!1,-1)})),!0}}function vt(){var e=Object(R.a)(".uMailWrite__popupStickers");if(!e)return!1;clog("[mail sticker panel] received panel update event");var t=e.classList.contains("uMailWrite__popupStickers_open"),n=!e.innerHTML;t&&!n?domData(e,"need-update",1):(clog("[mail sticker panel] redraw closed sticker panel"),n&&nt(),gt(),qe&&(qe=!1,nt(),StickersHints.init({peerId:store.mail.cur.peerId}),StickersHints.showNewConvoHints()))}function gt(){var e=store.mail.cur,t=Object(R.a)(".uMailWrite__popupStickers");if(!t)return!1;var n=Object(R.a)("#stickers_panel");if(!n)return!1;var i=Object(R.a)(".sp_tab_selected",n),a=Array.from(i.classList).reduce((function(e,t){if(t.startsWith("sp_tab")){var n=parseInt(t.split("sp_tab")[1]);isNaN(n)||(e=n)}return e}),0);return t.innerHTML=re.a.getStickerPanel("mail"+e.peerId),post.stickersSelectTab(!1,a),!0}function bt(){var e=store.mail,t=e.cur,n=e.replies,i=t.msgReply[t.peerId],a="";if(t.editing){var o=n[i];o&&(a=o.preview_url)}else{var r=i&&_.default.getElem(i);if(r){var s=Object(R.a)(".thumbs_map .thumb_map_img_as_div",r);(a=s&&s.style.backgroundImage)&&(a=a.replace(/^url\((['"])?/,"").replace(/(['"])?\)$/,""))}}Object(R.b)(".uMailWrite__reply").forEach((function(e){e.outerHTML=P(a)}))}function At(e){Object(R.b)(".uMailWrite__attachments_"+e).forEach((function(t){t.outerHTML=x(e)})),Xe(),Object(R.a)(".uMailWrite__textarea")&&Ht();var t=Object(R.a)(He);if(t){var n=!!t.$(Ue);t.classList.toggle(De,!n)}}function wt(e){if(e&&e.preventDefault(),!mediaUpload.checkUploading())return!1;var t,n=Object(R.a)(".uMailWrite__textarea"),i=store.mail,a=i.cur,o=i.peers,r=W(),s=store.mail.cur.editing,c=s&&store.mail.msgs[s],l=c?{act:"edit_message",id:s,peerId:c.peerId,hash:o[a.peerId].hashSend}:{act:"send",to:a.peerId,from:"dialog",hash:o[a.peerId].hashSend,_af:a._af,random_id:r,entrypoint:store.mail.cur.mvk_entrypoint||""};if(!zt())return c?MsgDeleteDialog.open({isEditing:!0}):a.groupId&&!Object(oe.g)(a.peerId)&&(t=Object(R.a)(".uMailWrite__templates"),Kt("templates"),hasClass("uMailWrite__templates_open",t)?pt():_t()),!1;each(Object(ce.O)("uMailWrite"),(function(e,t){return!(t.name&&!t.disabled)||("radio"===t.type&&!t.checked||("checkbox"===t.type&&!t.checked||("button"===t.type||("submit"===t.type||("image"===t.type||void(l[t.name]=t.value))))))})),s?(uMailHat.onCancelEditing(!0),Ft(l)):(Ft(l),store.mail.cur.mvk_entrypoint="",Object(X.k)(a.peerId),n.value="",Dt("",a.viewerId,a.peerId),Object(X.w)(a.viewerId,a.peerId,{msgs:void 0,reply:void 0},a.editing),a.msgReply[a.peerId]&&!a.editing&&ajaxRequest("/mail",{act:"reply_cancel",peer_id:store.mail.cur.peerId,hash:store.mail.hash.reply}),a.msgAttached[a.peerId]=[],a.msgReply[a.peerId]=null,Mt({},n)),D.default.onSystemMessageClick(),At(a.peerId),bt(),StickersHints.actualizeVisibility(),Y.f?(n.focus(),setTimeout((function(){return n.focus()}))):N.a.msie_edge||(n.focus(),requestAnimationFrame((function(){return n.focus()})))}function yt(e){var t=store.mail,n=t.cur,i=t.peers,a=n.peerId,o=i[a];o&&ajaxRequest("/mail",{_ajax:1,act:"typing",peer:a,hash:o.hashTyping,community:nav.getQuery("community"),type:e})}function Ot(){var e=store.mail.cur;Kt("text");var t=Object(R.a)(".messenger__layer_convo .messenger__content");Re=new ye(e.viewerId+"_"+e.peerId,t),setStyle(t,{overflow:"visible"}),Object(B.b)(Re.onDestroy,(function(){setStyle(t,{overflow:""}),Re=null})),Object(B.b)(Re.onPreviewProcessComplete,(function(e){var t=store.mail.cur,n=t&&Object(X.h)(t.viewerId,t.peerId);Object(X.w)(t.viewerId,t.peerId,Object(L.a)({},n,{audioMessagePreviewData:e}),t.editing)})),Object(B.b)(Re.onSend,(function(e,t){!function e(t,n){var i=store.mail,a=i.cur,o=i.peers,r=a.peerId,s=o[r],c=jt[n];if(!c||c.peerId!==r)return window.clog("Recording peer id and target not same"),delete jt[n],void Object(ce.oc)("mvk_audio_messages_event",null,"abort","pid");function l(){Object(ce.oc)("mvk_audio_messages_event",null,"upload_fail"),mediaUpload.finishFakeUploading();var i=H.g({duration:3e4,type:SNACKBAR_TYPE_ERROR,text:window.getLang("mail_audio_message_upload_error"),action:{text:window.getLang("mobile_mail_audio_message_upload_retry"),onclick:"uMailWrite._resendAudioMessage()"}});T._resendAudioMessage=function(){Object(ce.oc)("mvk_audio_messages_event",null,"upload_retry"),window.Snackbar.close(i,!0),e(t,n)}}T._resendAudioMessage=function(){},uploadFile(a.audio_msg.upload_url,t,{onStart:function(){mediaUpload.startFakeUploading()},onComplete:function(e){Object(ce.oc)("mvk_audio_messages_event",null,"upload_complete"),ajaxRequest(a.audio_msg.done_url,JSON.parse(e.target.responseText),(function(e){if(e){mediaUpload.finishFakeUploading(),delete jt[n];var t=e.owner_id+"_"+e.id,i=W(),o=a.msgReply[a.peerId];Ft({act:"send",to:r,from:"dialog",hash:s.hashSend,message:"",media:"audiomsg",attach1:t,attach1_type:"doc",attached_messages:o,has_reply:!!o,_af:a._af,random_id:i}),a.msgReply[a.peerId]=null,bt(),Object(B.b)(ae.d,(function(){uMessenger.cacheAudioMessageWaves()}))}else l()}),l)},onError:l})}(e,t),Re=null,AudioMessagePlayer.resumeGlobalMedia()}))}function kt(){Re&&(Re.clearCache(),Re.cancel(!0))}var jt={};function St(e){var t=store.mail.cur,n=Object(R.a)(".uMailWrite__textarea");setStyle.transform(n,0),Ot();var i=window.Speech.startRecording();Re.recorder=i,Promise.all([i.getAvailableMicrophones(),i.aquireMicrophone()]).then((function(e){if(0===e[0].length){var t=new Error;throw t.name="DevicesNotFoundError",t}})).catch((function(e){delete jt[o];var t="Error"===e.name?e.constructor.name||"Error":e.name;Object(ce.oc)("mvk_audio_messages_event",null,"aquire_error",t||"Empty");var i=null;switch(t){case"DevicesNotFoundError":case"NotFoundError":case"OverconstrainedError":case"NotReadableError":i=window.getLang("mail_audio_message_device_error");break;case"NotAllowedError":case"PermissionDeniedError":case"PermissionDismissedError":Object(Se.d)(window.getLang("mobile_mail_record_unavailable_title"),window.getLang("mobile_mail_record_unavailable_text"));break;default:i=window.getLang("mail_audio_message_unsupported_error")}i&&H.g({type:SNACKBAR_TYPE_ERROR,text:i}),AudioMessagePlayer.resumeGlobalMedia(),Re.cancel(!0),Re=null,setStyle.transform(n,1)})),Object(B.b)(Re.onDestroy,(function(){delete jt[o],setStyle.transform(n,1),AudioMessagePlayer.resumeGlobalMedia(),window.Speech.onTypingEvent.off(a)})),AudioMessagePlayer.pauseGlobalMedia(),AudioMessagePlayer.detachPlayer();var a=function(){return yt("audio")};window.Speech.onTypingEvent(a);var o=W();jt[o]={peerId:t.peerId},Re.init(e,e?"moving":"locked",o)}function Ct(e){var t=e.event;t.target.closest(".Tooltip")||Object(R.a)(".uMailWrite__buttonSend").classList.contains("uMailWrite__buttonSend_canVoiceRecord")&&Object(ce.T)()<Oe.d&&St(t)}function Et(e){var t;e.target.closest(".Tooltip")||Object(R.a)(".uMailWrite__buttonSend").classList.contains("uMailWrite__buttonSend_canVoiceRecord")&&((null==(t=Re)?void 0:t.initialized)?Re.lock():St())}function Tt(e){N.a.msie_edge&&(e.preventDefault(),wt(e))}function It(){var e=It,t=e.typingData||(e.typingData={});if(!(0===Object(R.a)(".uMailWrite__textarea").value.length||store.mail.cur&&store.mail.cur.editing)){var n=Date.now(),i=store.mail.cur.peerId;i<=-2e9||t[i]&&n-t[i]<5e3||(t[i]=n,yt("text"))}}function Mt(e,t){var n=Object(R.a)(".uMailWrite__textareaGhost"),i=t.value;n.innerText=i,"\n"===last(i)&&(n.innerHTML+="&nbsp;");var a=store.mail.cur,o=n.offsetHeight;Object(R.b)(".uMailWrite__textarea").forEach((function(e){return setStyle(e,"height",o)})),Object(R.b)(".uMailWrite__main").forEach((function(e){return setStyle(e,"height",o+8)})),Object(R.b)(".uMailWrite__popupStickers .stickersHints").forEach((function(e){setStyle(e,"bottom",o+8+-5)})),ze(),a&&Ye(i,a.viewerId,a.peerId),xt(e,t,(function(){Mention.onKeyUp(e,t)}))}function Pt(e){var t=store.mail,n=t.peers,i=t.members,a=t.cur,r=n[e].memberIds||[],s=[],c=[];r.forEach((function(e,t){if(e!==a.viewerId){var n=i[e];if(n){var o=[n.id,n.name,n.url.replace("/","@"),n.avatar,n.url.replace("/",""),null,null,null,n.firstName,n.domain];s.push(o)}else{var r=["fake"+t,"...","@...",i[0].avatar,"",null,null,null,"...",null];c.push(r)}}}));var l=o.a.html(Object(f.u)()),u=[];return Ce.a.online.forEach((function(e){var t=["online",lang.mobile_mail_mention_online,"@"+e,null,"",null,null,null,e,e,'<div class="MentionItem__img MentionItem__online">'+l+"</div>"];u.push(t)})),Ce.a.all.forEach((function(e){var t=["all",lang.mobile_mail_mention_all,"@"+e,null,"",null,null,null,e,e,'<div class="MentionItem__img MentionItem__all">'+l+"</div>"];u.push(t)})),s.concat(c).concat(u)}function xt(e,t,n){We.length&&(!hasClass("Mention_inited",Object(ce.O)("uMailWrite__main"))&&$e(),n(e,t))}function Lt(e,t){xt(e,t,(function(){Mention.onKeyDown(e,t)})),(10==e.keyCode||13==e.keyCode&&(e.ctrlKey||e.metaKey))&&wt()}function Rt(e,t){xt(e,t,(function(){Mention.onClick(e,t)}))}function Bt(e,t){Object(X.v)("text");var n=function(){store.mail.cur&&(nt(),Kt("text"),StickersHints.init({peerId:store.mail.cur.peerId}),xt(e,t,(function(){Mention.onFocus(e,t)})))};Y.f?n():requestAnimationFrame((function(){requestAnimationFrame((function(){n()}))})),G.d("bottom")}function Nt(e,t){if("text"===Object(X.g)()&&Object(X.v)(""),G.b(),Ye._timer&&clearTimeout(Ye._timer),store.mail&&store.mail.cur){var n=store.mail.cur,i=n.viewerId,a=n.peerId;Dt(t.value,i,a)}}function Dt(e,t,n){var i=store.mail.cur.editing;Object(X.w)(t,n,{text:e},i)}function Ht(){var e=store.mail,t=e.cur,n=(e.queue,e.flags);if(t&&t.peerId){var i=!zt(),o=!mediaUpload.checkUploading(),r=!!t.editing,s={sendActive:!(i||r||o||l),loading:o,editAccept:r&&!i,editRemove:r&&i},c=n.templates&&!(r||!t.groupId||Object(oe.g)(t.peerId)||!i||s.loading||s.uploading);s.templates=c&&"templates"!==Object(X.g)(),s.templatesActive=c&&"templates"===Object(X.g)();var l=n.areAudioMessagesEnabled&&!o&&!c&&!r&&i&&!(!window.AudioContext&&!window.webkitAudioContext||!navigator.mediaDevices);s.showVoiceRecord=l,s.canVoiceRecord=l&&"Speech"in window;var u=!(s.sendActive||s.showVoiceRecord||s.loading||s.editAccept||s.editRemove||s.templates||s.templatesActive);s.disabled=u;var d=a.a.class("uMailWrite__button","uMailWrite__buttonSend",s);return Object(R.b)(".uMailWrite__buttonSend").forEach((function(e){return e.className=d})),s}}function Ut(e){var t=a.a.class("uMailWrite__button","uMailWrite__buttonStickers",{active:e});Object(R.b)(".uMailWrite__buttonStickers").forEach((function(e){return e.className=t}))}function Vt(e){var t=a.a.class("uMailWrite__button","uMailWrite__buttonKeyboard",{active:e});Object(R.b)(".uMailWrite__buttonKeyboard").forEach((function(e){return e.className=t}))}function Ft(e){if(store.mail.cur){var t=store.mail.cur,n=t.ref,i=t.refSource,a=e.to;if(i&&(e.ref_source=i,e.ref=n,store.mail.refSource=void 0,store.mail.ref=void 0),ae.k(e),a){var o=store.mail.peers[a];if(o&&o.keyboard&&o.keyboard.one_time)o.keyboard=null,Object(X.f)(a).updateTime=Date.now(),Yt()}Ht()}}function Wt(e){e.stopPropagation(),alert(lang.mobile_mail_attachments_limit)}function qt(e){var t=document.createElement("textarea");t.innerHTML=e;var n=t.value,i=Object(R.b)(".uMailWrite__textarea");i.forEach((function(e){return e.value=n})),Mt({},i[0])}function zt(){var e=Object(R.a)(".uMailWrite__textarea");return!!e&&(function(){var e=store.mail,t=e.cur;e.peers;return!!t&&t.hasAttachments}()||!!e.value.trim())}function Yt(e){if(Object(R.a)(".uMailWrite__keyboard")){var t,n=store.mail,i=n.cur,o=n.peers,r=i.peerId&&o[i.peerId];t=!(i.groupId||!r||r.closed||r.kicked)&&!(!r.keyboard||!r.keyboard.buttons.length);var s=Object(R.a)(".uMailWrite"),c=a.a.parseClass("uMailWrite",s.className);if(c.keyboard!==t&&(s.className=a.a.class("uMailWrite",Object.assign({},c,{keyboard:t}))),Object(X.f)(i.peerId).rendered=!1,t){xe||(xe=lsGet("mail_keyboard_hidden")||{});var l=r.keyboard,u=xe[i.peerId];e&&!0===e.update&&Object(X.c)(i.peerId);var d=!Object(X.g)()||"buttons"===Object(X.g)()||"text"===Object(X.g)(),_=!1;u&&(u==l.chat_local_id?d=!1:_=!0),d?Qt("buttons",{store:_}):_&&dt()}else lt()}}function Gt(){var e=store.mail,t=e.cur,n=e.peers,i=t.peerId&&n[t.peerId];if(t.groupId&&i&&!i.closed&&!i.kicked){var a=Object(R.a)(".uMailWrite__templatesBody"),o=t.templates;if(a)return o?void function(e,t){e.innerHTML=te(t)}(a,o):(function(e){e.innerHTML=Loading({mix:"uMailWrite__templatesLoading"})}(a),Le||(Le=new Promise((function(e){ajaxRequest("/mail",{act:"get_templates"},(function(t){e(t)}),(function(t){e()}))}))),void Le.then((function(e){Le=null,store.mail&&store.mail.cur&&(store.mail.cur.templates=e),Gt()})))}}function Qt(e,t){switch(Kt(e),e){case"stickers":ot();break;case"buttons":ut(t);break;case"text":(n=Object(R.a)(".uMailWrite__textarea"))&&n.focus();break;case"templates":_t()}var n}function Kt(e){var t;"stickers"!==e&&at(),"buttons"!==e&&lt(),"text"!==e&&(t=Object(R.a)(".uMailWrite__textarea"))&&document.activeElement===t&&t.blur(),"templates"!==e&&pt()}function Xt(e){var t=store.mail,n=t.cur,i=t.peers,a=t.members,o=i[e],r=a[n.userId],s=a[o.ownerId],c=!!n.groupId,l=[Object(Te.a)({id:n.userId,name:lang.mobile_mail_you,class:c?"":"uMailWrite__modalMenuUserListItem_active",href:r.url,image:r.avatar||Object(Me.a)(),onclick:"return uMailWrite.onUserListItemClick(event, this, "+parseInt(r.id)+")"}),Object(Te.a)({id:o.ownerId,name:s.name,class:c?"uMailWrite__modalMenuUserListItem_active":"",href:s.url,image:s.avatar||Object(Ie.a)(),onclick:"return uMailWrite.onUserListItemClick(event, this, "+parseInt(s.id)+")"})];return Object(Te.b)({users:l})}function $t(e){var t=store.mail.cur.templates.find((function(t){return t.id===e}));if(t){var n=lang.mobile_mail_templates_delete_popup_text;n=n.replace("{name}",Object(z.a)(t.name)),MailDialog.open({body:n,confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:a.a.onClick("uMailWrite._onConfirmDeleteTemplate",e)})}}function Jt(e){var t=store.mail.cur.templates,n=t.findIndex((function(t){return t.id===e}));if(-1!==n){var i=t[n],a=Object(R.a)(".uMailWrite__templatesRow"+i.id);i.deleting=!0,a.classList.add("uMailWrite__templatesRow_hidden"),ajaxRequest("/mail",{act:"delete_template",hash:store.mail.hash.templateDelete,id:e},(function(n){if(n.error)Zt(e);else{var i=t.findIndex((function(t){return t.id===e}));t.splice(i,1),Gt()}}),(function(){Zt(e)}))}MailDialog.close()}function Zt(e){var t=store.mail.cur.templates,n=Object(R.a)(".uMailWrite__templatesRow"+e),i=t.findIndex((function(t){return t.id===e})),a=t[i];a.deleting=!1,n.classList.remove("uMailWrite__templatesRow_hidden");var o=lang.mobile_mail_templates_delete_error;o=o.replace("{name}",a.name),H.g({text:o,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;H.f(n)}}})}function en(){D.default.clearSystemMessage2(),remove(Object(ce.O)("message__newMsgsDivider")),remove(Object(ce.O)("Unfold__item_returnToChat"))}function tn(){var e=store.mail,t=e.cur,n=e.presend,i=e.pendingReplies,a=[],o=n.failed[t.peerId]||[],r=n.pending[t.peerId]||[];(o.length||r.length)&&(o.concat(r).map((function(e){var t=n.msgs[e];if(t)if(0===t.sendId.indexOf("edit"))T.onMessage(t);else{if(t.reply){var o=_.default.getReplyDataFromHTML(t.reply);o&&(i[t.reply]=o)}a.push(t)}})),U.e(a))}function nn(e,t,n){var i;n?i=[Object(V.b)({inner:lang.mobile_mail_presend_menu_retry,onclick:["uMailWrite._onRetryFailedMsg","this",t]}),Object(V.b)({inner:lang.mobile_mail_presend_menu_delete,onclick:["uMailWrite._onDeleteFailedMsg","this",t]})]:i=[Object(V.b)({inner:lang.mobile_mail_presend_menu_cancel,onclick:["uMailWrite._onCancelPendingMsg","this",t]})];var a=Object(V.g)({close:!0,closeText:lang.mobile_mail_presend_menu_close,items:i});F.a.open(o.a.elem(a),!0)}function an(e,t){V.g.close(e);var n=store.mail.presend.msgs[t];Object(X.o)(n),ae.j(t,(function(e){var t=store.mail.cur.peerId,n=store.mail.peers[t];return e.data.hash=n.hashSend,e}))}function on(e,t){V.g.close(e),ae.i(t)}function rn(e,t){V.g.close(e),ae.i(t)}function sn(e){H.g({duration:0,text:e,action:{text:lang.mobile_mail_templates_toast_action_ok,callback:function(e,t){var n=t.id;H.f(n)}}})}function cn(e){return store.mail&&store.mail.cur&&store.mail.cur.pressedButtons?store.mail.cur.pressedButtons.peers[e]:{}}function ln(e){if(void 0===e&&(e=!1),!Object(se.b)("mail_new_conversation_stickers_hint"))return!1;(e||function(){var e=store.mail;return!!e&&Object(Pe.a)(e.cur.peerId,e)}())&&(qe=!0,re.a.checkStickers({force:!0,ignore_hash:!0}))}t.default=T;window.uMailWrite=T},"Po+v":function(e,t,n){"use strict";t.a=function(e){void 0===e&&(e={});var t=[];if(e.on_overlay_click_native)t=e.on_overlay_click_native;else{var n=!0;"boolean"==typeof e.hide_on_overlay_click&&(n=e.hide_on_overlay_click),t=["Popup._onOverlayClick","this",e.on_overlay_click||null,n]}e.content||(e.content=e.inner);return{inner:[e.rel?e.rel:null,{class:"Popup__overlay",onclick:t,tag:"div"},{inner:[{inner:[e.header?{inner:[e.header.title?{inner:[e.header.title],class:"Popup__headerTitle",tag:"div"}:null,e.header.corner?{inner:[e.header.corner.text],class:["Popup__headerCorner",e.header.corner.class],href:e.header.corner.url,onclick:e.header.corner.onclick,tag:"a"}:null],class:"Popup__header",tag:"div"}:null,e.scrollable?{inner:[{inner:[e.content],class:"Popup__scrollContent",tag:"div"}],class:"Popup__scroll ScrollView",tag:"div"}:e.content,e.footer?{inner:[e.footer],class:"Popup__footer",tag:"div"}:null],class:"Popup__content",role:"dialog","aria-modal":"true",tag:"div"}],class:"Popup__wrap",tag:"div"}],id:e.id,attrs:e.attrs,class:[e.mix?e.mix:e.class,Bem.class("Popup",{open:e.open,scrollable:e.scrollable},"_")],tag:"div"}}},Q8gl:function(e,t,n){"use strict";var i=n("OcsD"),a=n("zhKY"),o=n("TYsd"),r={setChecked:function(e,t){void 0===t&&(t=!0);d(e).checked=t},isChecked:function(e){return d(e).checked}},s=r;r._onChange=u;var c=".Control",l=".Control__native";function u(e,t){o.a.handle(t,{$control:e.closest(c),name:e.name,checked:e.checked,value:e.value})}function d(e){return e.$(l)}var _=Object(i.K)(a.a,s);t.a=_;window.Control=_},QBkA:function(e,t,n){"use strict";n.r(t);var i=n("bZ/P"),a=n("9y81"),o=n("EDm3"),r=function(e){var t=window.lang,n=e.query;return Wd.html({class:[Bem.class("mailFilter",{hasQuery:!!n},"_"),e.mix],inner:[Object(o.r)(),{class:"mailFilter__input",tag:"input",placeholder:t.mobile_search,value:n,oninput:["MailFilter._onInput","this"],attrs:i.a.onFocus("MailFilter._onFocus")},{class:"mailFilter__right",inner:[Wd.wrap(Object(a.b)({mix:"mailFilter__clear",icon:"close12",attrs:i.a.onMouseDown("MailFilter._onClearMouseDown","this")}))]}]})};var s=n("UxAg"),c=n("+cqQ"),l=n("jk6M"),u=n("aiw/");function d(e){requestAnimationFrame((function(){var t=e.value;h(e.value),r.onChange(t)}))}function _(){u.d("top")}function p(e){var t=e.closest(".mailFilter").$(".mailFilter__input"),n=document.activeElement===t;(l.a.ios?setTimeout:requestAnimationFrame)((function(){h(""),t.value="",n&&t.focus(),r.onClear(),r.onChange("")}))}function h(e){Object(s.b)(".mailFilter").forEach((function(t){return t.classList.toggle("mailFilter_hasQuery",!!e)}))}Object.assign(r,{onChange:Object(c.a)("query"),onClear:Object(c.a)(),setQuery:function(e){var t=Object(s.a)(".mailFilter__input");t&&t.value!==e&&(t.value=e,r.onChange(e),h(e))},setQuerySilently:function(e){var t=Object(s.a)(".mailFilter__input");t&&t.value!==e&&(t.value=e,h(e))}}),r._onInput=d,r._onClearMouseDown=p,r._onFocus=_;t.default=r;window.MailFilter=r},QMH7:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n("OcsD"),a=n("UxAg"),o=n("Qz23");n("H5mD").f&&window.MutationObserver&&document.addEventListener("DOMContentLoaded",c);var r=".ScrollView",s="_scrollViewHealed";function c(){(l(),document.body)&&new MutationObserver(l).observe(document.body,{childList:!0,subtree:!0})}function l(){var e,t;(null==(e=window.Speech)||null==(t=e.recorder)?void 0:t.isRecording)||Object(a.b)(r).forEach(u)}function u(e){if(!e[s]){e[s]={};var t=getComputedStyle(e),n=parseInt(t.paddingTop,10),a=parseInt(t.paddingBottom,10);e.style.paddingTop=n+1+"px",e.style.paddingBottom=a+1+"px",_(e),Object(o.e)(e,{override:!1}),Object(i.gb)("messenger__body",e)||Object(i.b)(e,"scroll",h),Object(i.b)(e,"scroll",p)}}function d(e){e[s]&&(e[s]=null,e.style.paddingTop="",e.style.paddingBottom="",Object(o.a)(e),Object(i.Zb)(e,"scroll",h),Object(i.Zb)(e,"scroll",p))}function _(e){var t=e.scrollTop;t<0||(0===t?e.scrollTop+=1:t+e.offsetHeight===e.scrollHeight&&(e.scrollTop-=1))}function p(e){var t=e.target,n=t[s];n&&(n.timer&&clearTimeout(n.timer),n.timer=setTimeout((function(){t[s]&&_(t)}),50))}function h(){onBodyScroll(!0)}},QQoL:function(e,t,n){"use strict";var i=n("TYsd"),a=n("z9sQ"),o=n("9y81"),r=function(e){var t=window.lang,n=e.count;return i.a.html({class:[a.a.class("Bell",{empty:!n},"_"),"al_menu"],href:e.url,onclick:e.onclick,"aria-label":t.mobile_notifications_title,"data-header":t.mobile_notifications_title,"data-skiponclick":1,inner:[i.a.html(Object(o.b)({mix:"Bell__icon",icon:"bell"})),{class:"Bell__counter",inner:n,tag:"em"}]})};var s=n("UxAg");Object.assign(r,{setCount:function(e){Object(s.b)(l).forEach((function(t){var n=t.$(u);t.classList.toggle(c,!e),n.innerText=e}))}});var c="Bell_empty",l=".Bell",u=".Bell__counter";t.a=r;window.Bell=r},Qg0H:function(e,t,n){"use strict";var i=n("UxAg"),a=n("TYsd"),o=n("+cqQ");window.Voting={cls:"Voting",setLoading:m,setHtml:function(e,t){p(e).forEach((function(e){e.outerHTML=t})),p(e).forEach((function(e){e.classList.add(s)})),setTimeout((function(){p(e).forEach((function(e){e.classList.remove(s),Voting.onHtmlUpdate(e)}))}),30)},getVotingsById:p,onHtmlUpdate:Object(o.a)("$voting")},Voting._onSubmit=v,Voting._onSingleAnswerClick=f,Voting._onCheckboxClick=h,Voting._onRevoteClick=g;var r="Voting_loading",s="Voting_beforeAnimation",c="Voting_hasCheckedOptions",l=".Voting",u=function(e){return'.Voting[data-id="'+e+'"]'},d=".Voting__option",_=".Voting__optionControl";function p(e){return Object(i.b)(u(e))}function h(e){var t=e.closest(l),n=Array.from(Object(i.b)(_)).some((function(e){return e.checked}));e.closest(d).setAttribute("aria-checked",e.checked),t.classList.toggle(c,n)}function f(e){var t=e.name,n=e.value,i=e.closest("form"),a=i.getAttribute("action");i._Voting_singleAnswerAction=a+"&"+t+"="+encodeURIComponent(n)}function m(e){e.classList.add(r)}function v(e,t,n){var i;if(e.preventDefault(),t._Voting_singleAnswerAction)i=t._Voting_singleAnswerAction,m(t);else{var o=Array.from(t.$$("input:checked"));if(0===o.length)return;var r=o[0].name,s=o.map((function(e){return e.value})).join(","),c=t.getAttribute("action"),l=c.includes("?")?"&":"?";m(t),i=""+c+l+r+"="+s+"&is_board="+t.$('input[name="is_board"]').value}a.a.handle(n,{$voting:t,url:i})}function g(e,t){var n=e.closest(l);a.a.handle(t,{$voting:n})}},Qz23:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return g})),n.d(t,"c",(function(){return b})),n.d(t,"d",(function(){return A})),n.d(t,"e",(function(){return j})),n.d(t,"a",(function(){return S}));var i,a,o,r,s,c,l,u=n("UxAg"),d=n("aiw/"),_=n("H5mD"),p=!0,h=!1,f="closed",m=!1,v=[];function g(e){m&&w(),b(e)}function b(e){void 0===e&&(e={}),_.f&&(!0!==e.stack&&m||(l={initialized:!1,scrollViews:[]},v.push(l),e.layoutElement&&e.layoutElement.nodeType?l.layoutElement=e.layoutElement:l.layoutElement=Object(u.a)(e.layoutElement||".layout")),!1===e.topBanner?l.topBanner=!1:l.topBanner=!0,m||(m=!0,addEvent(window,"focusin",R),addEvent(window,"focusout",B),addEvent(document,"touchmove",P,{capture:!0}),addEvent(document,"touchmove",x,{capture:!1}),addEvent(window,"resize",E),d.c(N),_.m||(addEvent(window,"orientationchange",T),requestAnimationFrame((function(){Object(_.k)()?T(null,!0):(E(),l&&!l.topBanner?requestAnimationFrame(H):o||requestAnimationFrame(U))})))))}function A(){m&&(m=!1,w(),1===v.length&&(l.layoutOffset=null,V(),document.body.style.height=""),l.layoutElement=null,v.pop(),(l=v.length?v[v.length-1]:null)&&V(),removeEvent(window,"focusin",R),removeEvent(window,"focusout",B),removeEvent(document,"touchmove",P,{capture:!0}),removeEvent(document,"touchmove",x,{capture:!1}),removeEvent(window,"resize",E),removeEvent(window,"orientationchange",T),removeEvent(window,"resize",I),removeEvent(window,"scroll",M),d.a(N))}function w(){l.scrollViews.forEach((function(e){return S(e)})),l.scrollViews=[]}function y(e){var t=e.currentTarget.__ScrollView;if("prevented"!==t.state){if(!("start"!==t.state||t.allowX&&t.allowY)){var n=Math.abs(t.startX-e.changedTouches[0].clientX),i=Math.abs(t.startY-e.changedTouches[0].clientY);if(!t.allowX&&n>i)return void(t.state="prevented");if(!t.allowY&&i>n)return void(t.state="prevented")}if("allowed"!==t.state&&(t.state="allowed"),p=!1,!t.overscrollX){var a=e.currentTarget.scrollLeft,o=t.startX-e.changedTouches[0].clientX;(a<=0&&o<=0||a>=t.maxX&&o>=0)&&(p=!0,t.standalone&&e.preventDefault())}if(!t.overscrollY){var r=e.currentTarget.scrollTop,s=t.startY-e.changedTouches[0].clientY;(r<=0&&s<=0||r>=t.maxY&&s>=0)&&(p=!0,t.standalone&&e.preventDefault())}}}function O(e){var t=e.currentTarget,n=t.__ScrollView;n.state="start",n.startX=e.changedTouches[0].clientX,n.startY=e.changedTouches[0].clientY,n.maxX=n.overscrollX?null:t.scrollWidth-t.clientWidth,n.maxY=n.overscrollY?null:t.scrollHeight-t.clientHeight}function k(e){e.currentTarget.__ScrollView.state=""}function j(e,t){if(void 0===t&&(t={}),_.f&&(!1!==t.override||!e.__ScrollView)){if(!0!==t.standalone){if(!m)return;e.__ScrollView||l.scrollViews.push(e)}e.__ScrollView={allowX:!1!==t.allowX,allowY:!1!==t.allowY,overscrollX:!1!==t.overscrollX,overscrollY:!1!==t.overscrollY,standalone:!0===t.standalone},l&&(_.m||(!1!==t.topBanner&&(e.__ScrollView.topBanner=t.topBanner||{hide:30,show:60}),addEvent(e,"scroll",C))),addEvent(e,"touchstart",O),addEvent(e,"touchmove",y),addEvent(e,"touchend",k)}}function S(e){e.__ScrollView=null,removeEvent(e,"touchstart",O),removeEvent(e,"touchmove",y),removeEvent(e,"touchend",k),removeEvent(e,"scroll",C)}function C(e){if("closed"!==f||Object(_.k)())return h=!1,void(r&&clearTimeout(r));h=!0;var t=e.target.__ScrollView.topBanner;l&&l.topBanner&&t?D(e.target,t.show,t.hide):D(e.target,1/0,0),r&&clearTimeout(r),r=setTimeout((function(){h=!1,E()}),100)}function E(){if(!h)if(c)c=!1;else if(!Object(_.k)()){window.pageYOffset;"closed"===f&&(_.m||(i=document.documentElement.offsetHeight,a=innerHeight,o=i===a,"show"===s?(s=null,requestAnimationFrame(U)):"hide"===s&&(s=null,requestAnimationFrame(H))))}}function T(e,t){_.h?l.topBanner||setTimeout((function(){H()}),400):90===Math.abs(window.orientation)?(addEvent(window,"resize",I),document.body.style.height="",l.layoutHeight=null,t?setTimeout((function(){window.scrollTo(0,-300),I()})):setTimeout((function(){window.scrollTo(0,-300)}),400)):(removeEvent(window,"resize",I),l.layoutOffset=null,V(),l.topBanner||setTimeout((function(){H()}),400))}function I(){if("closed"===f){var e=document.body.offsetHeight,t=e-innerHeight;l.layoutOffset=t,V(),window.scrollTo(0,e)}}function M(){pageYOffset&&(f="opened",removeEvent(window,"scroll",M))}function P(e){p=!0}function x(e){p&&e.preventDefault()}function L(e){var t=e&&e.target,n=0===e.eventPhase&&t.getAttribute("autofocus"),i=!1;return"textarea"!==t.tagName.toLowerCase()||n||(i=!0),"input"!==t.tagName.toLowerCase()||["checkbox","radio","image","submit"].includes(t.type)||n||(i=!0),"select"===t.tagName.toLowerCase()&&(i=!0),i}function R(e){if(L(e)){var t,n=e&&e.target;f="opening",addEvent(window,"scroll",M),window.isCustomScroll&&(t=n.dataset.scrollviewposition),d.d(t,{exitIfStarted:!0})}}function B(e){L(e)&&d.b({exitIfStarted:!0})}function N(){removeEvent(window,"scroll",M),f="closed",setTimeout((function(){Object(_.k)()?I():E()}),100)}function D(e,t,n){var i=e.scrollTop;i<=-t&&(o||s)?(s="show",window.scrollTo(0,-10)):i>=n&&(!o||s)&&(s="hide",window.scrollTo(0,10))}function H(){window.scrollTo(0,300)}function U(){window.setImmediate?e((function(){window.scrollTo(0,-300)})):window.scrollTo(0,-300)}function V(){var e=l.layoutOffset;l.layoutElement.style.top=e?e+"px":""}}).call(this,n("URgk").setImmediate)},RJa5:function(e,t,n){"use strict";var i,a,o,r;n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return r})),function(e){e.MARKET="market",e.GROUP="group",e.USER_PROFILE="user_profile",e.BOOKMARKS="bookmarks",e.FEED="feed"}(i||(i={})),function(e){e.GOODS="ecomm_goods",e.ORDERS="ecomm_orders"}(a||(a={})),function(e){e.TRANSITION_TO_ITEM="transition_to_item",e.TRANSITION_TO_ALBUM="transition_to_album",e.SWITCH_ITEM_VARIANT_1="switch_item_variant_1",e.SWITCH_ITEM_VARIANT_2="switch_item_variant_2",e.TRANSITION_TO_ITEM_LEFT="transition_to_item_left",e.TRANSITION_TO_ITEM_RIGHT="transition_to_item_right",e.VIEW_ITEM="view_item",e.VIEW_ALBUM="view_album",e.CLOSE_ITEM="close_item",e.TRANSITION_TO_OWNER="transition_to_owner",e.VIEW_ITEM_MEDIA="view_item_media",e.ADD_ITEM_TO_CART="add_item_to_cart",e.EXPAND_ITEM_DESCRIPTION="expand_item_description",e.ADD_ITEM_TO_BOOKMARKS="add_item_to_bookmarks",e.REMOVE_ITEM_FROM_BOOKMARKS="remove_item_from_bookmarks",e.EXPAND_COMMENTS="expand_comments",e.COMMENT="comment",e.ADD_TO_CART_HS="add_to_cart_hs",e.OPEN_WIKI="open_wiki",e.SEND_MESSAGE_TO_OWNER="send_message_to_owner",e.OPEN_CHAT_WITH_OWNER="open_chat_with_owner",e.LIKE_ITEM="like_item",e.UNLIKE_ITEM="unlike_item",e.SHARE_ITEM="share_item",e.CTA_LINK="cta_link",e.CREATE_ITEM="create_item",e.CREATE_ALBUM="create_album",e.EDIT_ITEM="edit_item",e.EDIT_ALBUM="edit_album",e.DELETE_ITEM="delete_item",e.DELETE_ALBUM="delete_album",e.GROUP_ITEMS="group_items",e.ADD_PROPERTY="add_property",e.ADD_PROPERTY_VALUE="add_property_value",e.DELETE_PROPERTY="delete_property",e.DELETE_PROPERTY_VALUE="delete_property_value",e.TRANSITION_TO_EDIT_PROPERTIES="transition_to_edit_properties",e.TRANSITION_TO_EDIT_ALBUMS="transition_to_edit_albums",e.TRANSITION_TO_ADD_ALBUM="transition_to_add_album",e.TRANSITION_TO_ADD_ITEM="transition_to_add_item",e.TRANSITION_TO_EDIT_ITEM="transition_to_edit_item",e.TRANSITION_TO_DELETE_ALBUM="transition_to_delete_album",e.TRANSITION_TO_GROUP_ITEMS="transition_to_group_items",e.VIEW_FEEDBACK="view_feedback",e.OPEN_FEEDBACK_PHOTO="open_feedback_photo"}(o||(o={})),function(e){e.EVENT_MAKE_ORDER="make_order",e.CANCEL_ORDER="cancel_order",e.EXPAND_ORDER_INFO="expand_order_info",e.TRANSITION_TO_ORDERS="transition_to_orders",e.OPEN_MARKET_GROUP_ORDERS="open_market_group_orders",e.OPEN_MARKET_GROUP_ITEMS="open_market_group_items",e.OPEN_MARKET_GROUP_SETTINGS="open_market_group_settings",e.OPEN_MARKET_GROUP_DELIVERY="open_market_group_delivery",e.TRANSITION_TO_MARKET_SUPPORT="transition_to_market_support",e.OPEN_ORDER_INFO="open_order_info",e.ADD_TRACK_CODE="add_track_code",e.ADD_INTERNAL_COMMENT="add_internal_comment",e.CHANGE_ORDER_STATUS="change_order_status",e.OPEN_CHAT_WITH_CUSTOMER="open_chat_with_customer",e.SEND_MESSAGE_TO_CUSTOMER="send_message_to_customer",e.OPEN_ORDER_HISTORY="open_order_history",e.FILTER_ORDERS_BY_STATUS="filter_orders_by_status",e.EXPORT_ORDERS_DATA="export_orders_data"}(r||(r={}))},SNk7:function(e,t,n){"use strict";n.r(t);var i=n("+sJP"),a=n("Y6JH"),o=n("DsG2"),r=function(){return{inner:[{inner:[Object(a.a)({icon:Object(o.a)()})],class:"CasperHiddenMessages__buttonIcon","aria-hidden":"true",tag:"span"},{inner:[Object(i.t)("mobile_casper_chat_message_has_gone")],class:"CasperHiddenMessages__buttonText",tag:"span"}],class:"CasperHiddenMessages__button",onClick:["CasperHiddenMessages.clickHandler","this","event"],"aria-haspopup":"true","aria-expanded":"false","aria-controls":"mail-dialog",tag:"button"}};var s=n("iS9e"),c=n("TYsd"),l=n("CQvH"),u=null,d={clickHandler:function(e){s.default.open({body:c.a.html({inner:[Object(i.t)("mobile_casper_message_modal_info")],class:"CasperHiddenMessages__paragraph",tag:"p"}),title:Object(i.t)("mobile_casper_message_modal_title"),class:"CasperHiddenMessages__dialog",buttons:c.a.html({inner:[{inner:[Object(i.t)("mobile_casper_message_modal_close")],tag:"span"}],class:"Btn Btn_theme_secondary Btn_size_small mailDialog__confirmButton",tag:"button"}),onConfirm:function(){u(),s.default.close()},onClose:function(){u(),s.default.close()}}),(u=Object(l.a)(e)).exitIntent=function(){s.default.close()}}};window.CasperHiddenMessages=d;t.default=r},STl5:function(e,t,n){"use strict";var i=n("QQoL"),a=function(){var e=window.store,t="/feed?section=notifications";return Object(i.a)({url:t,count:e.notificationsCount,onclick:["nav.onMenuItemClick",t]})};t.a=a;window.uBell=a},SVPb:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l}));var i=n("OcsD"),a=n("TYsd"),o=n("jdQ7"),r=n("YTuE"),s=n("6Mr/"),c=function(){Object(s.e)(s.a.ACCOUNT_HINT_FEED_POST_REACTION)},l=function(){!function(e){var t=e.buttonHintResult,n=s.a.ACCOUNT_HINT_FEED_POST_PREVIEW_REACTIONS;if(Object(s.b)(n))if(null==t?void 0:t.hasBeenShown)var o=Object(r.a)((function(e){o();var t=document.getElementById(e.objectRaw);t&&c(t)}));else c();function c(e){void 0===e&&(e=document.body);var t=e.querySelector(".ReactionsPreview"),o=null==t?void 0:t.querySelector(".ReactionsPreview__label");if(t&&o){var r=Object(s.c)({onboarding:!0,theme:"accent",inner:Object(i.W)("intro_hint_description_feed_post_preview_reactions"),pos:"center-right","tooltip-id":n,style:"right: -16px"}),c=a.a.elem(r);c&&(o.style.position="relative",o.appendChild(c),t.addEventListener("click",(function(){Object(s.e)(n)}),{once:!0}))}}}({buttonHintResult:function(){var e=s.a.ACCOUNT_HINT_FEED_POST_REACTION;if(!Object(o.b)()&&Object(s.b)(e)){var t=document.querySelector('[data-section-ref="reactions-button-container"]');if(t){var n=Object(s.c)({onboarding:!0,theme:"accent",inner:Object(i.W)("intro_hint_title_mvk_post_reaction"),pos:"top_left","tooltip-id":e,style:"top: -12px; width: 250px"}),r=a.a.elem(n);return r?(t.appendChild(r),{hasBeenShown:!0}):void 0}}}()})}},T24x:function(e,t,n){"use strict";var i=n("BZzM"),a=(n("CQvH"),n("QMH7")),o=n("Y6JH"),r=n("qHA9"),s=n("9b/I"),c={onChange:se(),onChanged:se(),onReadyOrChanged:se(),onRestore:se(),fast_load:!1,need_hard_go:!1,getHash:function(e){if("#player"===e.hash)return e.path+e.hash;var t=qs2obj(e.params);return delete t.z,e.path+obj2qs(t)},getAlias:function(e){if(!e)return!1;var t=(e||"").split("?"),n=t[0],i=qs2obj(t[1]);return i.from&&delete i.offset,delete i.from,delete i.z,delete i.ref,Object.keys(i).forEach((function(e){0===e.indexOf("_")&&delete i[e]})),n+obj2qs(i)},set:function(e,t,n,o){void 0===n&&(n={});var s=window,l=s.zlayer,u=s.cur,d=s.nav,_=s.menu,p=s.audioplayer,h=$("body.fixed"),f=h?Math.abs(parseInt(getStyle(h,"top"),10)):scrollTop(),m=null;if(window.isNewMail){var v=e.split("?");toggleClass("vk__page_mail",window.bodyNode,Object(r.k)(v[0],v[1]))}l.opened()&&(f=l._st);var g=n.forceUpdate&&t.newHTML,b=!g&&d.hasUpdate(o,e,t),A=!!b||d.needUpdate(o,e,t),w=0;if(!n.force&&!b&&A||g?(w=scrollTop(),m=remove("m"),each(geByClass("_cntr",m),(function(){remove(this)})),each(geByClass("ScrollView",m),(function(){Object(a.a)(this)})),remove(geByClass1("_cntrs",m))):each(geByClass("ScrollView",geByClass1("m")),(function(){Object(a.a)(this)})),!n.after&&!c.fast_load){var y=c.getHash(d),O=o||t.options||{};o&&o.is_native_back&&(O.prev_tab=O.native_prev),c.save(y,{html:null,st:f,page:m,state:c.stash(),cur:window.cur,options:O},!0)}if(n.before||c.clear(),(n.before||!n.before&&!n.after)&&(window.lm_qsearch_counter?window.lm_qsearch_counter++:window.lm_qsearch_counter=1),n.before){var k=o&&o.target;c.fast_load=!0,k&&addClass("__al_target",k);var j=m.cloneNode(!0);k&&removeClass("__al_target",k);var S=geByClass1("__al_target",j);removeClass("__al_target",S),n.beforeAppend&&n.beforeAppend(j,S),after(j,"l"),scrollTop(w),u.toggleHeaderSearch&&u.toggleHeaderSearch(!1),n.afterAppend&&n.afterAppend(j),_&&_.clear_hover(),_&&_.closeSearch(),_&&_.enabled(!0)}else{o&&o.zProcess&&o.zProcess(0,!0)&&delete o.zProcess;var C=!1;if(o&&d.set(o),c.need_hard_go)return d.hard_go(d.cur,null,{replace:!0});if(!n.force&&!b&&A||g){var E;if(t.title&&(document.title=t.title),g?((E=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(E,t.newHTML)):(E=t.page)?C=!0:((E=ce("div",{className:"layout__basis",id:"m"})).setAttribute("role","main"),val(E,t.html)),_.opened()){var T=ce("div",{id:"m_helper",onclick:_.close});append(T,E)}after(E,"l")}c.fast_load=!1,thover.clear(),!b&&A&&(t.lm&&_.refresh(t.lm),t.bc&&(window.bodyNode.className=t.bc),l.opened(),o&&o.zProcess?o.zProcess(0,!1)&&delete o.zProcess:l.close()),n.force||(C&&(window.qsearch.isCachedPage=!0),t.js&&evalJs(t.js),C&&(window.qsearch.isCachedPage=!1),t.state&&c.stash(t.state),t.cur&&extend(window.cur,t.cur),o&&(t.options=o),post.wallActionsHide(),c.save(e,t));var I=o?o.nav&&o.nav.hash:d.hash;if(b||A)if(b)Tabbar.showUpdateButton(b.currentCache.d.page);else if(t.st||!I){var M=window.isCustomScroll&&hasClass("ScrollView","mcont")?1:0;scrollTop(t.st||M),scrollTop(t.st||M,10)}else I?scrollToHash(I):n.no_scroll&&!n.force?(scrollTop(f),scrollTop(f,10)):scrollToHash();else;p&&p.initAudio(),AudioMessagePlayer&&AudioMessagePlayer.redrawWaves()}var P=window.Tabs;onBodyResize(P.actualizeShowMoreVisibility),P.actualizeShowMoreVisibility(),Object(i.a)(),c.onChange(!0,o&&o.nav&&o.nav.push),(n.al_transition||n.restored)&&c.onChanged(!0)},save:function(e,t,n){if(e){var i=window.nav,a=n?i.page_get(e,t.options.prev_tab):{};a&&i.page_set(e,extend(a,t),c.getAlias(e))}},restore:function(e){var t=window.nav,n=t.page_get(e);return n||(n=t.page_get(c.getAlias(e))),!!n&&(c.onRestore(!0),n)},stash:function(e){var t=window.cur;return window.cur&&t.stash&&t.stash(e)||!1},clear:function(){var e=window.cur,t=window.zlayer,n=window.menu,i=window.tooltip;onBodyScroll("__clear"),onBodyResize("__clear"),n&&n.initEvents(),t.isReady&&t.initEvents(),i&&i.clear(),window.cur&&e.destroy&&each(e.destroy,(function(){this()})),window.cur={destroy:[]}},hideHeader:function(e){var t=geByClass1("mhead",e);hide(t)},setMhead:function(e,t,n,i,a){void 0===a&&(a={});var r=geByClass1("mhead",e),c=geByClass1("mhb_logo",r),l=geByClass1("mh_header",e),u=!1,d=window.nav,_=document.body,p=geByClass1("SliderTabs",r),h=geByClass1("header__right",r),f=geByClass1("header__gear",r);p&&remove(p),h&&remove(h),f&&remove(f),removeClass("vk_header_tabs",_);var m="header__title hb_btn mh_header mhi_back";if(a.movable&&(m+=" header__title--movable header__title--initial-position"),n){!0===n?u=d.path+(d.params?"?"+d.params:""):n&&(u=n),t||(t=val(l)||"&nbsp;");var v=geByClass1("mhb_back",e),g="",b=hasClass("mh_nobr",v)?" mh_nobr":"",A=i?' onclick="'+i+'"':"";if("/"==u)g='<div class="hb_wrap mhb_back'+b+'"'+A+'><h1 class="hb_btn mh_header">'+t+"</h1></div>";else{var w=Wd.html(Object(o.a)(Object(s.a)()));g='\n        <div class="header__center hb_wrap mhb_back '+b+'">\n          <a class="header__back al_back" href="'+escapeAttr(u)+'" accesskey="0" '+A+">"+w+'</a>\n          <h1 class="'+m+'">\n            <div class="header__text">\n                '+t+"\n            </div>\n          </h1>\n        </div>\n      "}if(r&&c){var y=geByClass1("mhb_notify",e);val(r,(window.al&&window.al.menu?'<a href="/" class="hb_wrap mhb_home" accesskey="*" onclick="return menu.toggle(event);"><div class="hb_btn mhi_home">&nbsp;</div></a>':'<a href="/" class="hb_wrap mhb_home mhb_vkhome" accesskey="*"><div class="hb_btn mhi_home mhi_vkhome">&nbsp;</div></a>')+'<div id="header_msgs" class="hb_wrap mhb_notify'+(!y||hasClass("mhb_no_notify",y)?" mhb_no_notify":"")+'">'+val(y)+"</div>"+g)}else v&&(v.outerHTML=g);var O=$(".header__center");O&&O.classList.toggle("is_unfold",$(".Unfold",O))}else t&&val(l,t)}};window.page=c,onDOMReady((function(){c.onReadyOrChanged(!0),c.onChanged((function(){c.onReadyOrChanged(!0)}))})),t.a=c},T3FL:function(e,t,n){"use strict";n.d(t,"b",(function(){return o}));var i=n("FbVm");n.d(t,"a",(function(){return i.c}));var a=new i.e,o=new i.d(a)},TAKr:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return w})),n.d(t,"b",(function(){return y})),n.d(t,"d",(function(){return k}));var i=n("vWwi"),a=n("1By4"),o=n("UxAg"),r=n("j80l"),s=n("OcsD"),c=n("29dZ"),l={open:w,close:y};l._onOverlayClick=b;var u="Popup",d="Popup_open",_="Popup_hasScroll",p="ScrollView",h="Popup--closing",f={open:"."+d,popup:"."+u,wrap:"."+"Popup__wrap",content:"."+"Popup__content",scroll:".Popup__scroll",header:".Popup__header",footer:".Popup__footer"},m=!1,v={},g=[];function b(e,t,n){var i=e.closest(f.popup);Object(s.qb)(t)?t({$popup:i}):t&&a.a.handle(t,{$popup:i}),n&&y(i)}function A(e,t){var n=e.$(f.header),i=e.$(f.footer);t.scrollHeight-6>t.offsetHeight?(Object(s.a)(e,_),Object(s.a)(t,p),ContentScrollView.restore()):(Object(s.Yb)(e,_),Object(s.Yb)(t,p),t.scrollTop=0);var a=Object(s.S)(),o=0,r=0;n&&(o=n.offsetHeight),i&&(r=i.offsetHeight);var c=Math.min(a-o-r-100,420);Object(s.jc)(t,"max-height",c+"px")}function w(e,t,n){void 0===n&&(n={});var a=n,o=a.hash,r=a.oncloseCallback,c=a.withoutCloning;if(O(e),m=Boolean(n.forceScrollDisable),t){if(!c){var l=e;(e=l.cloneNode(!0)).original=l}e.appendedToBody=!0,e.withoutCloning=c,document.body.appendChild(e)}e.classList.add(d);var u=e.$(f.scroll);if(Object(i.a)(e,{forceScrollDisable:m}),r&&g.push([e,r]),u){if(A(e,u),e.onResizeHandler=function(){A(e,u)},Object(s.b)(window,"resize",e.onResizeHandler),!window.MutationObserver)return e;e.scrollContentObserver=new MutationObserver(e.onResizeHandler),e.scrollContentObserver.observe(u,{childList:!0,subtree:!0})}if(o){var _="#pop_"+o,p=nav.cur.split("#")[0];nav.go(p+_,!1,{push_only:!0}),v[_]=e}return e}function y(e,t){void 0===t&&(t={});var n=t,a=n.smooth,c=n.velocity,l=n.lastY;if(e&&!e.classList.contains(u)&&(e=e.closest(f.popup)),e||(e=Object(o.a)(f.open)),e){var _=Object(o.a)(f.wrap,e),p=Object(o.a)(f.content,e);if(a&&c&&l){var v=Object(s.U)(p),b=(v-l)*c.y;return b>=300&&(b=200),b=Math.max(150,Math.min(300,b)),s.jc.animate(_,"transform",{duration:b,func:"cubic-bezier(0.0, 0.0, 0.2, 1)"}),s.jc.transform(_,1,[0,v+"px"]),e.classList.add(h),setTimeout((function(){y(e,{onClose:t.onClose})}),1.1*b)}if(a){e.classList.add(h);var A=Object(s.U)(p);return s.jc.transform(_,1,[0,A+"px"]),setTimeout((function(){y(e,{onClose:t.onClose})}),200*1.1)}if(e.classList.remove(d),e.appendedToBody&&document.body.contains(e)&&Object(s.ac)(e,e.withoutCloning?e:e.original),e.classList.remove(h),s.jc.transform(_),Object(s.Zb)(window,"resize",e.onResizeHandler),e.scrollContentObserver&&e.scrollContentObserver.disconnect(),Object(o.a)(f.open)||Object(i.b)(void 0,{forceScrollDisable:m}),nav.cur&&nav.cur.startsWith("#pop_")){var w=r.a.make(nav.path,qs2obj(nav.params));nav.set({nav:Object(s.K)({},nav,{cur:nav.path,path:nav.path||"",push:w||""})})}var k,j=(k=e,(g.find((function(e){return e[0]===k}))||[])[1]);j&&(j(),O(e)),t.onClose&&t.onClose(),window.cur&&window.cur.app&&window.cur.app.frame&&window.cur.app.frame.focus()}}function O(e){var t=g.findIndex((function(t){return t[0]===e}));t>=0&&g.splice(t,1)}function k(e,t){void 0===e&&(e=""),void 0===t&&(t="");var n=l({scrollable:!0,header:{title:e},content:[t,{inner:[Object(c.a)({inner:[Object(s.W)("mobile_close")],theme:"secondary",class:"Popup__button",onClick:"Popup.close(this)",use_native_onclick:!0})],class:"Popup__buttons",tag:"div"}]});l.open(a.a.elem(n),!0)}nav.onPopState&&nav.onPopState((function(){var e=v[nav.cur];e&&(y(e),delete v[nav.cur])}))},TdLS:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("tgcV"),a=n("PU8N"),o=n("IjIm"),r=n("OcsD"),s=n("6VgB"),c=n("bKAG"),l=n("V4qE");var u={openNewAvatarStory:function(e,t,n){e.metaKey||e.ctrlKey||(e.preventDefault(),window.Stories.init(t+"/"+t+"_"+n,{source:c.c.PROFILE_SNACKBAR}))},saveNewAvatarStory:function(e,t){return Object(c.f)(t,e.newAvatarStorySaveHash).then((function(e){return e.story})).catch((function(e){l.g({type:l.d,text:e&&e.message||Object(r.W)("global_error")})}))},initNewAvatarStory:function(e,t,n){var l;return Object(i.a)((l={},l[e.newAvatarStoryFontsCssPath]=null,l)).then((function(){return Promise.all([Object(a.h)("TT Commons",{weight:500}),Object(a.h)("TT Commons",{weight:600})])})).then((function(){return Promise.all([Object(o.a)({newAvatarUrl:n,oldAvatarUrl:e.currentPhoto,title:Object(r.W)("mobile_stories_new_avatar_story_title_header"),pollStickerOptions:{title:Object(r.W)("mobile_stories_new_avatar_story_poll_sticker_title"),voteButtonText:Object(r.W)("mobile_stories_poll_sticker_vote_button_text")}}),Object(s.f)(e.newAvatarStoryCreatePollHash).then((function(e){return e||Promise.reject()})).then((function(n){return Object(c.e)({clickable_stickers:JSON.stringify({original_width:1080,original_height:1920,clickable_stickers:[Object(s.g)(t,n)]}),hash:e.newAvatarStoryUploadUrlHash,entry_point:c.b.CHANGE_AVATAR,ref:window.cur.module})}))]).then((function(e){var t=e[0],n=e[1];return window.StoryPublisher.uploadStoryBlobToServer(t,n)}))}))}};window.NewAvatarStory=u},Tjn9:function(e,t){function n(e){(e=ge(e))&&(addClass(e,"profileEdit_selected"),setTimeout((function(){addClass(e,"profileEdit_animated"),setTimeout((function(){removeClass(e,"profileEdit_selected"),removeClass(e,"profileEdit_animated")}),1e3)}),1500))}function i(e){(e=ge(e))&&setTimeout((function(){var t=getXY(e)[1],i=getSize("mhead")[1],a=scrollGetY(),o=getCh();t<i+a||t>a+o?setTimeout((function(){scrollTo(0,t-i),n(e)}),0):n(e)}),0)}window.ProfileEditor={init:function(){var e=(qs2obj(nav.params)||{}).hl;e&&i(geByClass1("_"+e))},highlightRow:n,scrollHighlightRow:i}},U34x:function(e,t){var n="dropdown_open",i={_onTogglerClick:function(e,t){preventEvent(e),stopEvent(e);var i=gpeByClass("dropdown",t);if(toggleClass(i,n),!1!==i.isFirstClick){i.isFirstClick=!1;var a=function(){removeClass(i,n)};addEvent(window,"click",a),window.cur.destroy.push((function(){removeEvent(window,"click",a),i.isFirstClick=!0}))}}};window.Dropdown=i},UWnA:function(e,t,n){"use strict";var i=n("WWoJ");n.d(t,"a",(function(){return i.a})),t.b=i.b},Ubt6:function(e,t,n){"use strict";var i=n("z9sQ");t.a=function(e){return{class:[e.class,i.a.class("Tooltip",{pos:e.pos,onboarding:e.onboarding,theme:e.theme||"",closeOnOverlayClick:e.closeOnOverlayClick},"_")],"tooltip-id":e["tooltip-id"],inner:{class:i.a.class("Tooltip__inner",{pos:e.pos,textAlignCenter:"center"===e.textAlign,theme:e.theme||""},"_"),inner:e.inner},style:e.style,onclick:e.onclick}}},UlUB:function(e,t,n){"use strict";function i(e,t){var n,i,a=!1;return function o(){if(a)return n=arguments,void(i=this);e.apply(this,arguments),a=!0,setTimeout((function(){a=!1,n&&(o.apply(i,n),n=i=null)}),t)}}n.d(t,"a",(function(){return i}))},UvyM:function(e,t,n){"use strict";var i=n("z9sQ"),a=n("BoyB"),o=n("TYsd"),r=n("+sJP");t.a=function(e){void 0===e&&(e={});var t=e.url,n=e.is_icon,s=e.icon,c=e.tag||"button",l=e.before||null,u=e.after||null,d=e.role||"button",_=e.on_click||e.onClick||e.onclick,p=e.use_native_onclick,h=e.inner||e.children;Object(r.A)(h)&&1===h.length&&"string"==typeof h[0]&&(h=h[0]);var f=!1;"function"==typeof _&&(p=!0,f=!0);_&&!p&&(_=["Btn._onClick","event","this",_]);var m={class:[e.class,i.a.class("Btn",{theme:e.theme||"regular",size:e.size||"",stretch:e.stretch,flex:!(!l&&!u)},"_")],onclick:_,ref:e.ref,attrs:e.attrs,tag:"div"};f&&(m.onClick=_,delete m.onclick);var v=e.hide?"; display: none;":"",g=e.style?e.style+v:v,b=null;e.isLoading&&(m.class.push("Btn_loading"),b=o.a.wrap(Object(a.a)({mix:"Btn__loader",white:"secondary"===e.theme?"white":"",large:!0,spinner:e.spinner||"white"!==e.theme})));if(t)return Object(r.R)(m,{inner:[l,s?[{inner:[s],class:"Btn__icon",tag:"div"},{inner:[h],class:"Btn__text",tag:"div"}]:n?h:{inner:[h],class:"Btn__text",tag:"div"},u],_:o.a.getInternalData(),href:t,role:d,style:g,target:(e.open_in_new_tab?"_blank":e.target)||"",tag:"a"});var A=e.is_submit?"submit":null,w=e.type||A,y={inner:[s?[b,{inner:[s],class:"Btn__icon",tag:"div"},{inner:[h],class:"Btn__text",tag:"div"}]:n?[b,h]:[b,{inner:[h],class:"Btn__text",tag:"div"}]],_:o.a.getInternalData(),"aria-label":e["aria-label"]||"",style:g,disabled:e.disabled,type:w,tag:"div"};return y.tag=c,Object(r.R)(m,y)}},V2dH:function(e,t,n){"use strict";n.r(t);var i=n("rKUZ"),a=n("iWgD"),o=function(){return Object(i.a)(r())};function r(){var e,t,n=store.mail.cur.peerId,i=Object(a.b)(n);return i&&("mixed"===i.type?(e="dots",t="mixed"):"audio"===i.type?(e="audio",t="audio"):"text"===i.type&&(e="dots",t="")),{id:"curConvo",typing:Object(a.a)(i),typingCount:i?i.count:0,dimmed:!0,animation:e,text:t}}Object.assign(o,{redraw:function(){if(!store.mail.cur.peerId)return;var e=i.a.getElem("curConvo"),t=r();q.parseClass("typing",e.className).animation===t.animation?i.a.setTyping(e,t):e.outerHTML=Object(i.a)(t)}});t.default=o;window.uCurConvoTyping=o},V4qE:function(e,t,n){"use strict";n.d(t,"g",(function(){return j})),n.d(t,"f",(function(){return E})),n.d(t,"a",(function(){return v})),n.d(t,"e",(function(){return A})),n.d(t,"d",(function(){return w})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return O}));var i=n("z9sQ"),a=n("29dZ"),o=n("Y6JH"),r=n("+sJP"),s=n("xlrz"),c=n("XJmI"),l=n("EXPB"),u=n("0qaj"),d=function(e){void 0===e&&(e={});var t=e.position||"bottom",n=!(!e.type||e.image),d={class:i.a.class("SnackbarItem__cell",{left:!0,image:!!e.image,top:e.avatar&&"left"===e.avatar_position,icon:n},"_")},_={class:i.a.class("SnackbarItem__cell",{right:!0,avatar:!!e.avatar},"_")},p=!1,h=!1;if(e.type){p=!0;var f=null;switch(e.type){case 1:f=Object(o.a)(Object(s.a)());break;case 2:f=Object(o.a)(Object(c.a)());break;case 3:f=Object(o.a)(Object(l.a)());break;case 4:f=Object(o.a)(Object(u.a)())}d.inner={class:"SnackbarItem__icon",inner:f}}e.image&&(p=!0,d.inner={class:"SnackbarItem__image",inner:{tag:"img",src:e.image}});e.action&&(h=!0,_.inner=Object(a.a)({theme:"none",class:"SnackbarItem__action",url:e.action.url,target:e.action.target,on_click:e.action.onclick,use_native_onclick:!0,inner:Wd.wrap(e.action.text),attrs:e.action.attrs}));if(e.avatar){var m={tag:"img",class:"SnackbarItem__avatar",src:e.avatar};e.avatar_position&&"right"!==e.avatar_position?"left"===e.avatar_position&&(p=!0,d.inner=m):(h=!0,_.inner=m)}return{style:e.style?e.style:"",class:["SnackbarItem_"+e.id,"SnackbarItem--"+t+" ",i.a.class("SnackbarItem",{static:!!e.static,vertical:!!e.vertical,hasIcon:n}),e.className||e.class],attrs:{"data-snackbar-id":e.id},inner:[{class:"SnackbarItem__table",inner:[p?d:null,e.text?{class:i.a.class("SnackbarItem__cell",{text:!0},"_"),inner:{class:"SnackbarItem__text",inner:Object(r.F)(e.text)?e.text:Wd.wrap(e.text)}}:null,h?_:null]}]}};var _=n("OcsD"),p=n("UxAg"),h=n("kr3z"),f=n("uEFA"),m=n("ZMWW");window.Snackbar={init:j,close:E,_onActionClick:function(e,t){var n=b[t];if(!n)return void Object(_.hb)(t);var i=n.callback,a=n.url;i?"function"==typeof i?i.call(null,e,{id:t,url:a}):Wd.handle2(i,e,{id:t,url:a}):Object(_.hb)(t)},_onRestoreClick:function(e,t,n){var i=t.closest(".SnackbarItem"),a=Object(_.v)(i,"snackbar-id"),o=b[a];e.stopPropagation(),e.preventDefault();var r=o.callback;r&&("function"==typeof r?r.call(null,e,{id:a,url:n}):Wd.handle2(r,e,{id:a,url:n}));E(a),h.a.click(n,null,{url_params:{_ajax:1,_snackbar:1}})}};var v="mail",g=0,b={},A=1,w=2,y=3,O=4,k=[];function j(e){if(!m.a.isIntegrated){var t=isFinite(e.duration)?e.duration:5e3,n=g++,i=e.action&&e.action.callback,a=e.action&&e.action.url;e.position=e.position||"common";var o=e.position;e.id=n,i&&!e.action.onclick&&(e.action.onclick=["Snackbar._onActionClick","event",n]),e.bottom&&(e.style="bottom: "+e.bottom+"px");var r,s=Wd.elem(SnackbarItem(e));return function(e,t){if("common"===t.position)Object(_.f)(e,document.body);else if(t.position===v){var n="msg"===window.store.mail.cur.page?Object(p.a)(".messenger__layer_page .messenger__header"):Object(p.a)(".messenger__layer_convo .messenger__header");Object(_.f)(e,n)}setTimeout((function(){e.classList.add("SnackbarItem_added")}),100)}(s,e),t&&(r=C(n,t)),Object(_.b)(s,"touchstart",B,{passive:!0}),Object(_.b)(s,"touchmove",N,{capture:!1}),Object(_.b)(s,"touchcancel touchend",D,{passive:!0}),b[n]={id:n,timer:r,callback:i,url:a,duration:t,position:o},k.push(n),S(),n}m.a.sendMessage("show_snackbar",{type:e.type,text:e.text})}function S(){var e=(k=k.filter((function(e){var t=b[e],n=T(e);return!(!t||!n)}))).reduce((function(e,t){var n=b[t];return e[n.position]||(e[n.position]=[]),e[n.position].push(t),e}),{});Object.keys(e).forEach((function(t){var n=e[t],i=0,a=t===v?8:12;n.forEach((function(e,n){var o=T(e),r=Object(_.U)(o);b[e].vertical=t===v?i:-i,_.jc.transform(o,1,[0,b[e].vertical]),i+=r+a}))}))}function C(e,t){return setTimeout((function(){E(e,!1)}),t)}function E(e,t){var n=b[e],i=T(e);n&&(n.timer&&clearTimeout(n.timer),delete b[e]),i&&function(e,t){if(Object(_.Zb)(e,"touchstart",B,{passive:!0}),Object(_.Zb)(e,"touchmove",N,{capture:!1}),Object(_.Zb)(e,"touchcancel touchend",D,{passive:!0}),t)return Object(_.Xb)(e),void S();e.classList.add("SnackbarItem--closing");if(!e)return;e.classList.add("SnackbarItem_removed"),setTimeout((function(){Object(_.Xb)(e),S()}),600)}(i,t)}function T(e){return Object(p.a)(".SnackbarItem_"+e)}onDOMReady((function(){onBodyResize(S)}));var I=!1,M=null,P=!1,x=0,L=!1,R=Object(_.T)();function B(e){if(R=Object(_.T)(),e.touches&&e.touches.length>1)I=!1;else{var t=e.target.closest(".SnackbarItem");t.classList.add("SnackbarItem--dragging");var n=Object(_.v)(t,"snackbar-id");if(R>=f.d&&(L=!0),b[n].position===v){L=!1;var i=Object(p.a)(".messenger");R=Object(_.ab)(i),b[n].parentXY=Object(_.cb)(i)}else b[n].parentXY=Object(_.cb)(bodyNode);b[n].timer&&clearTimeout(b[n].timer),M=e.touches[0],x=e.touches[0].clientX,I=!0,P=n,document.body.style.overflow="hidden"}}function N(e){var t=P;if(e.preventDefault(),e.touches&&e.touches.length>1)I=!1;else if(M&&I){var n=e.touches[0],i=e.target.closest(".SnackbarItem"),a=-(x-n.clientX);L&&(a=Math.min(a,0));var o=Object(_.bb)(i),r=(Object(_.ab)(i)+a)/2+o-b[t].parentXY[0],s=r>=.95*R||r<=R/.95-R;b[t].canClose=s,_.jc.transform(i,1,[a,b[t].vertical])}}function D(e){var t=e.target.closest(".SnackbarItem");t.classList.remove("SnackbarItem--dragging");var n=Object(_.v)(t,"snackbar-id"),i=b[n];if(b[n].dragging=!1,P=!1,document.body.style.overflow="visible",i.canClose){var a=Object(_.bb)(t)>0?Object(_.T)():-Object(_.T)();return Object(_.T)()>=f.d&&(a=Object(_.bb)(t)>Object(_.T)()/2?Object(_.T)():-Object(_.T)()),_.jc.transform(t,1,[a,b[n].vertical||0]),void E(n)}b[n].timer=C(n,i.duration),t&&_.jc.transform(t,1,[0,b[n].vertical||0])}window.SnackbarItem=d},VRji:function(e,t,n){"use strict";n.d(t,"b",(function(){return r}));var i=n("+sJP");var a=function(e){return void 0===e&&(e={}),Object(i.m)({inner:[e.text],class:["Textarea",e.mix],name:e.name,placeholder:e.placeholder,rows:e.rows?e.rows:3,maxlength:e.maxlength,tag:"textarea"},e.attrs)},o=n("OcsD");function r(e,t){void 0===t&&(t=3);var n=Object(o.k)("span",{className:"Textarea__ghost"});Object(o.jc)(n,{width:e.clientWidth+"px",padding:Object(o.Z)(e,"padding"),lineHeight:Object(o.Z)(e,"line-height")}),n.innerText="_",Object(o.f)(n,e.parentNode);var i=n.clientHeight;Object(o.b)(e,"input",(function(){var a=e.value.replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");("\n"===Object(o.Ab)(a)||a.endsWith("<br />"))&&(a+="&nbsp;"),n.innerHTML=a,e.rows=Math.max(1,Math.min(t,Math.ceil(n.clientHeight/i)))}))}t.a=a},W38l:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return d}));var i={bluetooth:"2g",cellular:"2g",ethernet:"4g",mixed:"unknown",none:"none",other:"unknown",unknown:"unknown",wifi:"3g",wimax:"4g"};function a(){if(!1===navigator.onLine)return"none";var e=navigator.connection||navigator.webkitConnection||navigator.mozConnection;if(!e)return"unknown";if(e.effectiveType)return e.effectiveType;var t=+(e.downlinkMax||e.downlink);return t?t<50?"slow-2g":t<70?"2g":t<700?"3g":"4g":i[e.type]||"unknown"}var o=n("WwUR"),r={};function s(e,t){var n={action:t,startTime:Date.now(),networkType:a(),lpState:o.a.isLongPollingEnabled()};r[e]=n}function c(e,t){if(r[e]){var n=r[e],i=n.startTime,a=n.action,o=n.lpState,s=n.networkType;statlogsValueEvent("mvk_mail_send_time",Date.now()-i,a,t,o,s)}}function l(e,t,n){if(r[e]){var i=r[e],a=i.action,o=i.lpState,s=i.networkType;statlogsValueEvent("mvk_mail_send_error",0,a,t,n,o,s)}}function u(e){delete r[e]}function d(e){statlogsValueEvent("mvk_mail_send_queue_size",e,a())}},WCKs:function(e,t){},WWoJ:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n("8ZMO"),a=(n("p5n7"),n("I7Du")),o=n("9y81"),r=(n("29dZ"),n("z9sQ")),s=n("uBUF");function c(e){void 0===e&&(e={});var t=e.anchor,n=e.attrs||{},a=e.style||{},c=e.url,l=e.count,u=c&&!a.no_go_icon&&!l,d=e.tag;d||(d=c?"a":"div");var _=null;return u?_=Wd.wrap(Object(o.b)({mix:"Row__right",icon:"chevron_right"})):l&&(_={inner:[l],class:"Row__right Row__count",tag:"div"}),Object(s.a)({inner:[t?Object(i.a)({id:t}):null,_,e.icon?{inner:[e.icon],class:"Row__icon "+e.icon_class,tag:"div"}:null,e.content||e.inner],tag:d,class:[e.mix||e.class,r.a.class("Row",{go:u,style_withBorder:a.with_border,style_withBorderForce:a.with_border_force,style_withHover:a.with_hover,style_smallPaddings:a.small_paddings,style_noPaddingTop:a.no_padding_top,style_noPaddingBottom:a.no_padding_bottom,style_tinyPaddingTop:a.tiny_padding_top,style_tinyPaddingBottom:a.tiny_padding_bottom,paddingTop_short:a.padding_top_short},"_")],attrs:n,href:c,role:e.role})}function l(e){return u({anchor:e.anchor,style:e.style,label:e.label,content:Object(a.a)(e)})}function u(e){return c({anchor:e.anchor,url:e.url,style:e.style,content:[d({is_mini:e.is_mini,label:e.label}),_({content:e.content})]})}function d(e){return{inner:[e.label],class:[r.a.class("Row__label",{mini:e.is_mini},"_"),e.class||""].join(" "),tag:"div"}}function _(e){return{inner:[e.content],class:["Row__labeledContent",e.class||""].join(" "),tag:"div"}}t.b=c},WwUR:function(e,t,n){"use strict";var i,a=n("OcsD"),o=n("+cqQ"),r=n("DM26"),s=n("cGUQ"),c=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e};!function(e){e[e.MENTIONS=1]="MENTIONS",e[e.CASPER=2]="CASPER"}(i||(i={}));var l=n("rudk"),u=function(e){var t=e[0],n=e[1],a=e[2],o=e[3],r=e[4],s=e[5],c=e[6],u=e[7],d=e[8],_=e[9],p=Object.assign({},s||{},c||{});return Array.isArray(p.marked_users)&&(p.marked_users=p.marked_users.filter((function(e){return Object.values(i).includes(e[0])}))),{messageId:t,flags:n,peerId:a,date:o,attaches:Object(l.a)(p,t),subject:p.title||"",text:r,kludges:p,randomId:u,userId:Object(l.b)(a)?Number(p.from)||0:a,update_time:_,chat_local_id:d}};n("jE6c");var d=function(){return(d=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function _(e){switch(e[0]){case 0:return{type:"event_delete",localId:e[1]};case 1:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_replace_flags",messageId:t,mask:n,peerId:i}}(e);case 2:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_set_flags",messageId:t,flags:n,peerId:i}}(e);case 3:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_reset_flags",messageId:t,flags:n,peerId:i}}(e);case 4:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],r=e[6],s=e[7],c=e[8],l=e[9],_=e[10],p=e[11];return d(d({type:"event_add_message"},u([Number(t),Number(n),Number(a),Number(o),r,s,c,l,_,p])),{minorSortId:i})}(e);case 5:return p(e);case 6:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_read_inbound",peerId:t,upToId:n,unread:i}}(e);case 7:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_read_outbound",peerId:t,upToId:n,unread:i}}(e);case 10:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_reset_directories",peerId:t,mask:n,local:void 0!==i&&i}}(e);case 11:return function(e){var t=e[1],n=e[2];return{type:"event_replace_directories",peerId:t,mask:n}}(e);case 12:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_set_directories",peerId:t,mask:n,local:void 0!==i&&i}}(e);case 13:return function(e){var t=e[1],n=e[2];return{type:"event_delete_dialog",peerId:t,localId:n}}(e);case 18:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],r=e[6],s=e[7],c=e[8],l=e[9],_=e[10];return d({type:"event_replace_message"},u([Number(t),Number(n),Number(i),Number(a),o,r,s,c,l,_]))}(e);case 19:return function(e){var t=e[1];return{type:"event_invalidate_event",messageId:t}}(e);case 20:return function(e){var t=e[1],n=e[2];return{type:"event_convo_major_id_changed",peerId:t,majorId:n}}(e);case 21:return function(e){var t=e[1],n=e[2];return{type:"event_convo_minor_id_changed",peerId:t,minorId:n}}(e);case 23:return function(e){var t=e[1],n=e[2];return{type:"peer_tags_changed",peerId:t,peerTagsMask:n}}(e);case 51:return function(e){var t=e[1],n=e[2];return{type:"event_chat_changed",chatId:t,self:n}}(e);case 52:return function(e){var t=e[1],n=e[2],i=e[3];return{type:"event_chat_updated",peerId:n,updateType:t,updateArg:i}}(e);case 63:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:"event_typing",peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 64:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4];return{type:"event_recoding_audio",peerId:t,userIds:n,totalCount:i,ts:a}}(e);case 70:return function(e){var t=e[1],n=e[2];return{type:"event_video_call",userId:t,callId:n}}(e);case 80:return function(e){var t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],r=e[6];return{type:"event_unread_count",count:t,countNotMuted:n,showOnlyNotMuted:i,businessNotifyUnread:a,headerTotalUnread:o,headerNotMutedUnread:r}}(e);case 114:return function(e){var t=e[1]||{},n=t.peer_id,i=t.sound,a=t.disabled_until;return{type:"event_notify_settings_changed",peerId:n,sound:i,disabledUntil:a}}(e);case 115:return function(e){var t=e[1];return{type:"incoming_call",payload:t}}(e);case 116:return function(e){var t=e[1]||{},n=t.id,i=t.flags,a=t.peer_id,o=t.date,r=t.message,s=t.kludges,c=t.random_id,l=t.chat_local_id,u=t.update_time,d=t.title;return p([5,n,i,a,o,r,Object.assign({},s||{},{title:d||""}),{},c,l,u])}(e);case 117:return function(e){var t=e[1]||{},n=t.uuid,i=t.device_name;return{type:"event_audio_start",uuid:n,deviceName:void 0===i?"":i}}(e);case 119:return function(e){var t=e[1],n=t.event_id,i=t.owner_id,a=t.peer_id,o=t.action;return{type:"event_keyboard_callback_received",event_id:n,owner_id:i,peer_id:a,action:o}}(e);case 120:return{type:"peer_profile_tags_changed"};case-1:return{type:"event_resync"};case-2:return function(e){var t=e[1],n=e[2];return{type:"event_refresh_lp_key",key:t,url:n}}(e);case-3:return function(e){var t=e[1];return{type:"event_waiting_for_reconnect",timeout:t}}(e);case-4:return{type:"event_reconnecting"};case-5:return{type:"event_reconnected"};default:return function(e){return{type:"event_empty",params:e}}(e)}}function p(e){var t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],r=e[6],s=e[7],c=e[8],l=e[9],_=e[10];return d({type:"event_edit_message"},u([Number(t),Number(n),Number(i),Number(a),o,r,s,c,l,_]))}var h=function(){return(h=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function f(e,t){e.waitAbortFns.push(t)}function m(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=function(e,t,n){void 0===n&&(n={});var i=new XMLHttpRequest;return{request:new Promise((function(a,o){var r,c=Date.now(),l=n.timeout||60,u=Object(s.a)(t);i.onreadystatechange=function(){4==i.readyState&&(window.clearInterval(r),i.status>=200&&i.status<300?a([i.responseText,i]):o([i.responseText,i]))};try{i.open("GET",e+"?"+u,!0)}catch(e){return o([e,i])}i.send(),r=window.setInterval((function(){Date.now()-c>1e3*l&&(window.browser.safari&&i.abort(),o(["",{}]),window.clearInterval(r))}),1e3)})),cancel:function(){i.abort()}}}(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,window.lpDebug={startedAt:Date.now(),finishedAt:null,error:!1,request:n,cancel:i},n.then((function(t){var n=t[0],i=t[1];return window.lpDebug&&(window.lpDebug=h(h({},window.lpDebug),{finishedAt:Date.now(),request:null,cancel:null})),e.onData(e,i),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var n=t[1];return window.lpDebug&&(window.lpDebug=h(h({},window.lpDebug),{finishedAt:Date.now(),error:!0,request:null,cancel:null})),e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?Object(r.a)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},i=n.abort,a=n.pause;switch(t.failed){case 1:return f(e,i),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(a).then((function(){return m(e)}));case 2:return f(e,i),e.onKeyExpired(e,t).then((function(t){var n=t[0],i=t[1],a=t[2],o=t[3];return e.onResult({ts:+o,updates:[[-2,n,i+"/"+a],[-1]]})})).then(a).then((function(){return m(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function v(e){e.isStoppedFn()||m(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&g(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),g(e,-3);var n=Object(r.a)(e.waitTimeout,null),i=n.abort,a=n.pause;return f(e,i),a().then((function(){return g(e,-4)}))}(e,t)})).then((function(){return v(e)}))}function g(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function b(e){return e||function(){}}function A(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}function w(e,t,n){var i=0,a=e,o=[],r=!1;function s(){!o.length||i>0||r||(t(o),o=[])}return{pause:function(){i++},resume:function(){i>0&&(i--,s())},onLp:function(e,t,i){r||(a>=e?(a=t,o.push.apply(o,i),s()):n&&(r=!0,n(a).then((function(e){var t=e[1],n=e[2];a=t,r=!1,o.push.apply(o,n),s()}))))}}}var y,O=function(){return(O=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};!function(e){e.Online="online"}(y||(y={}));var k=function(e){var t=this,n=e.getQueue,i=e.registerQueue;this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=function(){t.intervalId&&clearInterval(t.intervalId),0!==t.retriesLeft&&(t.retriesLeft--,t.getQueue().then((function(e){t.retriesLeft=t.MAX_RETRIES;var n=O({},e);t.intervalId=window.setInterval((function(){t.registerQueue(n,(function(e,i){if(function(e){return void 0!==e.err}(i))t.restart();else{n.ts=i.ts;for(var a=0,o=i.events;a<o.length;a++)for(var r=o[a],s=0,c=t.listeners;s<c.length;s++)(0,c[s])(r)}}))}),t.QUEUE_KEY_TTL)})).catch((function(e){console.error(e),setTimeout(t.restart,t.QUEUE_KEY_TTL)})))},this.subscribe=function(e){return t.listeners.push(e),1===t.listeners.length&&t.restart(),function(){t.listeners=t.listeners.filter((function(t){return t!==e})),0===t.listeners.length&&(t.retriesLeft=t.MAX_RETRIES,t.intervalId&&clearInterval(t.intervalId))}},this.registerQueue=i,this.getQueue=n};var j=n("qHA9"),S=n("ZMWW"),C=n("L9Nh"),E={onNewMsg:Object(o.a)("{ peerId, msgId, authorId, text, date, hasAttachments, flags, isService }"),onEditMsg:Object(o.a)("{ peerId, msgId, authorId, text, date, hasAttachments, flags }"),onMsgReadByMe:Object(o.a)("msgId","dialogId"),onMsgReadByOther:Object(o.a)("msgId","dialogId"),onOnlineChange:Object(o.a)("{ userId, isOnline, onlinePlatform, lastActionTime }"),onConvoMinorIdChanged:Object(o.a)("peerId","{ minorSortId }"),onConvoMajorIdChanged:Object(o.a)("peerId","{ majorSortId }"),onTyping:Object(o.a)("dialogId","authorId"),onMultiTyping:Object(o.a)("peerId","userIds","totalCount"),onRecordingAudio:Object(o.a)("peerId","userIds","totalCount"),onMsgImportantRemove:Object(o.a)("msgId"),onMsgImportantAdd:Object(o.a)("msgId"),onMsgRequestChange:Object(o.a)("peerId","type"),onCallInProgress:Object(o.a)("peerId","inProgress"),onIsNewChange:Object(o.a)("peerId","isNew"),onMsgRemove:Object(o.a)("msgId"),onMsgListen:Object(o.a)("msgId"),onMsgRestore:Object(o.a)("msgId"),onPeerKeyboard:Object(o.a)("peerId"),onPeerBanner:Object(o.a)("peerId"),onPeerConvert:Object(o.a)("peerId","convertId"),onPeerAdmin:Object(o.a)("peerId","userId","isAdmin"),onDialogImportant:Object(o.a)("peerId","isImportant"),onDialogMarkedUnread:Object(o.a)("peerId","isMarkedUnread"),onDialogPin:Object(o.a)("peerId"),onDialogUnpin:Object(o.a)("peerId"),onDialogAdTag:Object(o.a)("peerId"),onDialogRemove:Object(o.a)("peerId"),onUnreadCount:Object(o.a)("event"),onIncomingCall:Object(o.a)("event"),onKeyboardCallback:Object(o.a)("eventId","peerId","ownerId","action"),onResync:Object(o.a)(),_onLpEvents:Object(o.a)("Array<Object>"),init:function(e){E._lpConnect&&(E._onLpEvents.off(),E._lpConnect.stopConnection(),E._lpQueue=null,E._lpConnect=null),E._unsubscribeEventQueue&&(E._unsubscribeEventQueue(),E._unsubscribeEventQueue=null),E._lpConfig=e},isLongPollingEnabled:function(){return!(!E._lpConnect||E._lpConnect.isStopped())},on:function(){clog("[longpoll] start"),window.addEventListener("online",T),window.addEventListener("offline",T),E._unsubscribeEventQueue||E._createEventQueue(),E._lpConnect?E._lpConnect.reinitConnection():E._createLongpoll(E._lpConfig)},off:function(){clog("[longpoll] stop"),window.removeEventListener("online",T),window.removeEventListener("offline",T),E._lpConnect&&E._lpConnect.stopConnection(),E._unsubscribeEventQueue&&(E._unsubscribeEventQueue(),E._unsubscribeEventQueue=null)},pause:function(){clog("[longpoll] pause"),E._lpQueue&&E._lpQueue.pause()},resume:function(){clog("[longpoll] resume"),E._lpQueue&&E._lpQueue.resume()},abortWaiting:function(){clog("[longpoll] abort waiting"),E._lpConnect.abortWaiting()},_createLongpoll:function(e){if(!E._lpConnect){var t=w(e.ts,(function(e){E._onLpEvents(e)})),n=function(e,t){var n=!!e.stopped,i={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||14,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&o(i.ts,e.ts,e.updates.map(_))},onData:b(t.onData),onRequestError:b(t.onRequestError),onHistoryLost:A(t.onHistoryLost),onKeyExpired:A(t.onKeyExpired),onLpBroken:A(t.onHistoryLost)},a=t.onEvents;function o(e,t,n){i.ts=t;for(var o=0;o<n.length;++o)"event_refresh_lp_key"===n[o].type&&(i.key=n[o].key||"",i.url=n[o].url||"");a(e,t,n)}var r={options:i,isStopped:function(){return n},stopConnection:function(){n=!0,i.stopFn&&i.stopFn(),i.stopFn=void 0,document.removeEventListener("resume",s),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",s),g(i,-4),n=!1,v(i)},abortWaiting:function(){i.waitAbortFns.forEach((function(e){return e()})),i.waitAbortFns=[],i.waitTimeout=2},onLp:o};function s(){r.abortWaiting()}return document.addEventListener("resume",s),v(i),r}(e,{onEvents:function(e,n,i){i.length?i.forEach((function(i){t.onLp(e,n,[i])})):t.onLp(e,n,[])},onHistoryLost:function(){clog("[longpoll] ts expired")},onKeyExpired:function(e){return clog("[longpoll] key expired"),t="/mail",(n={act:"get_key",user_id:e.id})&&(n.im_v=3),new Promise((function(e,a){window.ajax.post(t,n,{timeout:i,onDone:function(){e.apply(null,[c([],arguments)])},onFail:function(){return a.apply(null,c([],arguments)),!0}})}));var t,n,i},onLpBroken:function(){clog("[longpoll] broken, reload"),window.location.reload()}});E._lpQueue=t,E._lpConnect=n,E._onLpEvents((function(e){try{e.forEach(E._onEvent)}catch(e){console.error(e)}}))}},_onEvent:function(e){var t=e.type;switch("edu"===S.a.type&&S.a.sendMessage("longpoll",{event:e},"mvk_embedded_background"),t){case"event_replace_flags":var n=e.flags,i=e.messageId;e.peerId;8&n?E.onMsgImportantAdd(i):E.onMsgImportantRemove(i),128&n||64&n?E.onMsgRemove(i):E.onMsgRestore(i);break;case"event_set_flags":var o=e.flags,r=e.messageId;e.peerId;8&o&&E.onMsgImportantAdd(r),(128&o||64&o)&&E.onMsgRemove(r),4096&o&&E.onMsgListen(r);break;case"event_reset_flags":var s=e.flags,c=e.messageId;e.peerId;8&s&&E.onMsgImportantRemove(c),(128&s||64&s)&&E.onMsgRestore(c);break;case"event_add_message":case"event_edit_message":case"event_replace_message":var l=e.messageId,u=e.peerId,d=e.randomId,_=e.text,p=e.minorSortId,h=e.flags,f=e.attaches,m=e.kludges,v=e.date,g=Object(a.tc)(m.from_admin)||null,b=function(e){if(2&e.flags)return E._lpConfig.id;return e.userId}(e),A=!!m.source_act,w="event_edit_message"===t||"event_replace_message"===t,y=2&h,O=!!(65536&h),k={peerId:u,id:l,authorId:b,attaches:f,text:_,ts:v,flags:h,adminId:g,randomId:d,isService:w?void 0:A,edited:!!w||void 0,replaced:"event_replace_message"===t,keyboard:m.keyboard,isStealth:O,isOut:y,hasReply:function(e,t){t&1<<21&&function(e){e.fwd_count}(e)}(m,h),hasTemplate:!!m.has_template,ttl:m.ttl||m.expire_ttl&&parseInt(m.expire_ttl)||null,isExpired:m.is_expired};w?E.onEditMsg(k):E.onNewMsg(k,p);break;case"event_read_inbound":case"event_read_outbound":var j=e.peerId,C=e.upToId;e.unread;"event_read_inbound"===t?E.onMsgReadByMe(C,j):E.onMsgReadByOther(C,j);break;case"event_reset_directories":case"event_set_directories":var T=e.mask,I=e.peerId;e.local;1&T?E.onDialogImportant(I,"event_set_directories"===t):32768&T?E.onDialogAdTag(I):T&1<<20&&E.onDialogMarkedUnread(I,"event_set_directories"===t);break;case"event_replace_directories":var M=e.mask,P=e.peerId;e.local;E.onDialogImportant(P,!!(1&M));break;case"event_delete_dialog":var x=e.peerId;E.onDialogRemove(x);break;case"event_convo_major_id_changed":var L=e.peerId,R=e.majorId;E.onConvoMajorIdChanged(L,{majorSortId:R});break;case"event_convo_minor_id_changed":var B=e.peerId,N=e.minorId;E.onConvoMinorIdChanged(B,{minorSortId:N});break;case"event_chat_updated":var D=e.peerId,H=e.updateType,U=e.updateArg;if(11===H&&E.onPeerKeyboard(D),10===H&&E.onPeerBanner(D),13===H&&E.onPeerConvert(U,D),12===H){var V="";switch(U){case 3:V="created";break;case 2:V="rejected";break;case 1:V="accepted";break;case 0:V="canceled"}E.onMsgRequestChange(D,V)}3===H&&E.onPeerAdmin(D,U,!0),9===H&&E.onPeerAdmin(D,U,!1),19===H&&E.onCallInProgress(D,U),22===H&&E.onIsNewChange(D,U);break;case"event_typing":var F=e.peerId,W=e.userIds,q=e.totalCount;e.ts;E.onMultiTyping(F,W,q);break;case"event_recoding_audio":var z=e.peerId,Y=e.userIds,G=e.totalCount;e.ts;E.onRecordingAudio(z,Y,G);break;case"event_video_call":break;case"event_unread_count":E.onUnreadCount(e);break;case"event_notify_settings_changed":break;case"incoming_call":E.onIncomingCall(e);break;case"event_keyboard_callback_received":var Q=e.owner_id,K=e.peer_id,X=e.event_id,$=e.action;E.onKeyboardCallback(X,K,Q,$);break;case"event_resync":E.onResync()}},_createEventQueue:function(){if(!E._unsubscribeEventQueue){var e=new k({getQueue:function(){return Object(j.m)("/mail",{act:"queue_params"})},registerQueue:function(e,t){C.a.addQueue(e,t),C.a.start()}});E._unsubscribeEventQueue=e.subscribe(E._onEventQueueEvent)}},_onEventQueueEvent:function(e){switch(e.entity_type){case y.Online:E.onOnlineChange({userId:e.data.user_id,isOnline:e.data.online,onlinePlatform:[1,2,3,4,5].includes(e.data.platform)?"mobile":"desktop",lastActionTime:e.data.last_seen})}}};t.a=E;function T(e){"online"===e.type?(clog("[longpoll] online"),E._lpConnect.reinitConnection()):(clog("[longpoll] offline"),E._lpConnect.stopConnection())}},XCiN:function(e,t,n){"use strict";var i=n("izth");window.isBootstrapInited||(window.cur={destroy:[]},window.lang={},Object(i.a)(),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),window.isBootstrapInited=!0)},XLP4:function(e,t){window.FeedAssistanceImportContacts={importContacts:function(e,t,i){if(!window.XMLHttpRequest||i)return;var a=domData(e,"service-id");return window.open(t),n[a]=e,!1}};var n={},i="feedAssistanceImportContacts__desc",a=!1;FeedAssistanceStats.registerTrackingCls("feedAssistance_importContacts"),FeedAssistanceStats.onStartViewElement((function(e){FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_IMPORT_CONTACTS&&(a=!0)})),Friends.onImportSuccess((function(){var e=arguments[0],t=arguments[2],o=n[e];if(o){var r=geByClass1(i,o);r.textContent=getLang("mobile_join_friends_found_count",t)}a&&FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_FEED_ASSISTANCE,o,"m_mp",FeedAssistanceStats.EVENTS.SUB_EVENT_FILLED)})})),Friends.onImportFailed((function(e){var t=n[e];t&&(geByClass1(i,t).textContent=getLang("mobile_friends_import_error"))}))},XNGt:function(e,t,n){"use strict";function i(e){for(var t=Array.from(e),n=[],i=0,a=null,o=0;o<t.length;o+=1){var r=t[o],s=r.offsetWidth,c=r.offsetLeft,l=r.offsetHeight;a=0===o?c:a,n.push({width:s,height:l,offsetLeft:c,marginLeft:a}),i<s&&(i=s)}for(var u=0;u<n.length;u+=1)n[u].width=i;return n}function a(e,t){Array.from(e).forEach((function(e,n){e.style.marginLeft=t[n].marginLeft+"px",e.style.width=t[n].width+"px",e.style.height=t[n].height+"px",e.style.flex="none"}))}function o(e,t,n){return-1*(e[t].offsetLeft+e[t].width/2-n/2)}function r(e,t){var n=e.timeStamp,i=e.touches,a=i?i[0]:e,o=a.clientX,r=a.clientY,s=t.to||{},c=s.x,l=void 0===c?o:c,u=s.y,d={x:o-l,y:r-(void 0===u?r:u)},_=n-(t.time||0);return{to:{x:o,y:r},offset:d,time:n,speed:{x:d.x/_,y:d.y/_},duration:_}}n.d(t,"a",(function(){return u}));var s,c,l=n("OcsD"),u=function(){function e(e,t){this.container=null,this.scrollEl=null,this.items=null,this.centralElementIndex=0,this.dimensions=[],this.currentIndex=0,this.isTouchActive=!1,this.startOffset=null,this.startInfo=null,this.currentInfo=null,this.state=null,this.container=e,this.scrollEl=t,this.items=this.scrollEl.childNodes,this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.handleTransitionEnd=this.handleTransitionEnd.bind(this),this.resortSlides=this.resortSlides.bind(this),this.handleWindowDimensionsChange=this.handleWindowDimensionsChange.bind(this),this.handleDragstart=this.handleDragstart.bind(this),this.init()}var t=e.prototype;return t.init=function(){this.items.length<=1||(this.cloneSlides(),this.dimensions=i(this.items),a(this.items,this.dimensions),this.dimensions=i(this.items),this.setCentralSlidePosition(),this.scrollEl.style.width="max-content",this.setupCallbacks(),this.enableAutoscroll(),this.state="idle")},t.setupCallbacks=function(){Object(l.b)(this.container,"dragstart",this.handleDragstart),Object(l.b)(this.container,"mousedown touchstart",this.handleTouchStart),Object(l.b)(this.container,"mousemove touchmove",this.handleTouchMove,{passive:!1}),Object(l.b)(this.container,"mouseleave mouseup touchend touchcancel dragend",this.handleTouchEnd),Object(l.b)(this.scrollEl,"transitionend",this.handleTransitionEnd),window.addEventListener("orientationchange",this.handleWindowDimensionsChange)},t.destroy=function(){this.disableAutoscroll(),cancelAnimationFrame(c),Object(l.Zb)(this.container,"dragstart",this.handleDragstart),Object(l.Zb)(this.container,"mousedown touchstart click",this.handleTouchStart),Object(l.Zb)(this.container,"mousemove touchmove",this.handleTouchMove),Object(l.Zb)(this.container,"mouseleave mouseup touchend touchcancel dragend",this.handleTouchEnd),Object(l.Zb)(this.scrollEl,"transitionend",this.handleTransitionEnd),window.removeEventListener("orientationchange",this.handleWindowDimensionsChange)},t.handleDragstart=function(e){e.target!==this.scrollEl&&(e.preventDefault(),e.stopPropagation())},t.handleTouchStart=function(e){this.isTouchActive||(this.initTouchEvent(e),this.disableAutoscroll())},t.initTouchEvent=function(e){this.startOffset=this.getScrollPosition(),this.startInfo=r(e,{}),this.currentInfo=this.startInfo},t.handleTouchMove=function(e){if(this.startInfo)if(this.currentInfo=r(e,this.startInfo),this.isTouchActive){e.cancelable&&e.preventDefault();var t=this.startOffset+this.currentInfo.offset.x;this.setScrollPosition(t)}else this.shouldMove(this.currentInfo)&&(this.isTouchActive=!0,this.initTouchEvent(e))},t.shouldMove=function(e){if("moving"===this.state||"resort"===this.state||"recalculating"===this.state)return!1;var t=e.offset;return 180*Math.atan(Math.abs(t.y)/Math.abs(t.x))/Math.PI<30},t.handleTouchEnd=function(e){if(this.startInfo=null,!this.isTouchActive||function(e){if(!e)return!1;var t=e.offset,n=e.duration;return Math.abs(t.x)<1&&Math.abs(t.y)<1&&n<200}(this.currentInfo))return t=e.target,void((n=t.closest("a"))&&n.href&&(window.location=n.href));var t,n;e.preventDefault(),e.stopPropagation(),this.go(this.currentInfo),this.enableAutoscroll(),this.isTouchActive=!1},t.cloneSlides=function(){var e=this.items;this.centralElementIndex=e.length;for(var t=document.createDocumentFragment(),n=document.createDocumentFragment(),i=0;i<e.length;i+=1)t.appendChild(e[i].cloneNode(!0)),e.length<4&&n.appendChild(e[i].cloneNode(!0));this.scrollEl.insertBefore(t,this.scrollEl.firstChild),this.scrollEl.appendChild(n)},t.go=function(e){var t=e.speed.x,n=Math.abs(t);if(0!==n){var i=t<0?-1:1,a=this.getScrollPosition();n>.6&&Math.abs(e.offset.x)<150&&(a+=i*Math.min(600*n,this.getContainerWidth()));var o=function(e,t,n){for(var i=null,a=null,o=n/2-e,r=0;r<t.length;r+=1){var s=t[r].offsetLeft+t[r].width/2,c=Math.abs(s-o);(null===i||c<i)&&(i=c,a=r)}return a}(a,this.dimensions,this.getContainerWidth());o===this.currentIndex&&n>.1&&(o=this.currentIndex-i),o-this.currentIndex>1&&(o=this.currentIndex+1),o-this.currentIndex<-1&&(o=this.currentIndex-1),this.scrollToSlide(o)}},t.resortSlides=function(){var e=this.centralElementIndex,t=this.scrollEl,n=this.currentIndex;if(e!==n){var i=document.createDocumentFragment();if(n>e){for(var a=n-e;a>0;)i.appendChild(t.childNodes[0]),a-=1;t.appendChild(i)}if(n<e){for(var o=e-n,r=t.childNodes.length-o;o>0;)i.appendChild(t.childNodes[r]),o-=1;t.insertBefore(i,t.firstChild)}this.setCentralSlidePosition()}},t.setScrollPosition=function(e){this.scrollEl.style.transform="translateX("+e+"px)"},t.getScrollPosition=function(){return parseFloat(this.scrollEl.style.transform.replace("translateX(",""))},t.getContainerWidth=function(){return this.container.offsetWidth},t.setCentralSlidePosition=function(){var e=o(this.dimensions,this.centralElementIndex,this.getContainerWidth());this.currentIndex=this.centralElementIndex,this.setScrollPosition(e)},t.scrollToSlide=function(e){this.state="moving",this.scrollEl.style.transition="transform 200ms cubic-bezier(.42,.65,.27,.99)";var t=o(this.dimensions,e,this.getContainerWidth());this.setScrollPosition(t),this.currentIndex=e},t.handleTransitionEnd=function(){var e=this;this.scrollEl.style.transition=null,this.state="resort",c=window.requestAnimationFrame((function(){e.resortSlides(),e.state="idle"}))},t.scrollToNext=function(){var e=(this.currentIndex+1)%this.items.length;this.scrollToSlide(e)},t.enableAutoscroll=function(){var e=this;s&&clearInterval(s),s=setInterval((function(){e.scrollToNext()}),4e3)},t.disableAutoscroll=function(){s&&(clearInterval(s),s=null)},t.handleWindowDimensionsChange=function(){var e,t=this;this.state="recalculating",e=this.items,Array.from(e).forEach((function(e){e.style.marginLeft="",e.style.width="",e.style.height="",e.style.flex=""})),this.scrollEl.style.width="",window.requestAnimationFrame((function(){setTimeout((function(){t.dimensions=i(t.items),a(t.items,t.dimensions),t.dimensions=i(t.items),t.setCentralSlidePosition(),t.state="idle"}))}))},e}()},Y6JH:function(e,t,n){"use strict";var i=n("+sJP");var a=function(e,t){void 0===t&&(t="");var n,a,o,r,s=e;if(t){var c=Object(i.z)(t);c&&(s=c)}else Object(i.F)(e)&&Object(i.F)(e.icon)&&(s=e.icon);return Object(i.F)(s)||(s={name:e,icon:""}),n={name:s.name,icon:s.icon},a=n.name,o=n.icon,r=Object(i.f)("svgIcon","svgIcon-"+a),{inner:[Wd.wrap(o)],"aria-hidden":"true",class:r,tag:"div"}};t.a=a;window.SVGIcon=a},YTuE:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));var i=n("uQjJ"),a=function(){var e,t,n=null===(e=window)||void 0===e?void 0:e.Reactions,a=null!==(t=null==n?void 0:n.dataEventsEmitter)&&void 0!==t?t:new i.a;return n&&!n.dataEventsEmitter&&(n.dataEventsEmitter=a),a},o=function(e){var t,n=a(),i=((t={})["reaction_set_reaction:success"]=e,t);return n.addListeners(i),function(){n.removeListeners(i)}},r=function(e){a().emit("reaction_set_reaction:success",e)}},"YU/R":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));var i=n("OcsD"),a=n("wTbK");function o(e){return Object(a.f)({on_overlay_click:["return ContextMenu.close","this"],class:"ContextMenu",close:!0,onClose:["return ContextMenu.close","this"],items:[e.list?{tag:"ul",class:"ContextMenu__list",inner:e.withoutWrap?e.list:Wd.wrap(e.list)}:null]})}function r(e){return{inner:[{inner:[e.title],attrs:e.attrs,"data-ref":e.ref,href:e.href,target:e.target,class:"ContextMenu__listLink",onClick:e.onclick,tag:"a"}],class:"ContextMenu__listItem","data-name":e.name,tag:"li"}}var s=n("t7Ww"),c=n("UxAg"),l={open:function(e,t,n){void 0===n&&(n={});var i;i=n.pureMenu?e:n.menuEl;if(!i){var a=e.closest(t);i=Object(c.a)(d,a)}if(i)return i=s.g.open(i,n.appendToBody||n.pureMenu,"",{withoutPopupCloning:n.withoutPopupCloning}),u=function(){p(i)},nav.onBeforeGo(u),i;return!1},close:p},u=function(){},d=".ContextMenu",_=".ContextMenu.Popup_open";function p(e){return e||(e=Object(c.a)(".Popup_open.ContextMenu")||Object(c.a)(_)),e&&s.g.close(e),nav.onBeforeGo.off(u),!1}Object(i.K)(o,l);t.c=o;window.ContextMenu=o},ZD4m:function(e,t,n){"use strict";function i(e){var t=e.getBoundingClientRect();return{left:t.left,top:t.top}}function a(){var e=document.documentElement;return{width:e.clientWidth,height:e.clientHeight}}function o(e){var t=e.getBoundingClientRect(),n=t.width,i=t.height;return n&&i?{width:n,height:i}:{width:e.offsetWidth,height:e.offsetHeight}}n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return o}))},aJgW:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return r}));var i,a,o=n("J8bf");!function(e){e.Light="light",e.Dark="dark",e.Auto="auto"}(i||(i={})),function(e){e.Dark="space_gray",e.Light="bright_light"}(a||(a={}));var r,s=function(){function e(){this.currentMode="",this.subscribers=[],this.initSubscribers=[],this.isExecuted=!1,this.isModeSavingAllowed=!0,this.isSchemeSavingAllowed=!0}return e.prototype.init=function(t){var n=this;this.isExecuted||(this.schemesMap=t.schemesMap,this.setMode(t.mode),this.initSubscribers.forEach((function(e){e()})),e.isSchemesAutoSwitchingSupported()&&(window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){n.currentMode===i.Auto&&n.setScheme(e.matches)})),this.isExecuted=!0))},e.prototype.setScheme=function(t){e.isSchemesSupported()&&(this.applyScheme(document.body,t?a.Dark:a.Light),this.currentIsDark=t,this.isSchemeSavingAllowed&&Object(o.b)("remixdark_color_scheme",Number(t),365),this.subscribers.forEach((function(e){e()})))},e.prototype.isDarkScheme=function(){return this.currentIsDark},e.prototype.getMode=function(){return this.currentMode},e.prototype.setMode=function(t){this.currentMode=t;var n=!1;switch(t){case i.Light:n=!1;break;case i.Dark:n=!0;break;case i.Auto:if(e.isSchemesAutoSwitchingSupported())n=window.matchMedia("(prefers-color-scheme: dark)").matches}this.setScheme(n),this.isModeSavingAllowed&&Object(o.b)("remixcolor_scheme_mode",t,365)},e.prototype.applyScheme=function(e,t){var n,i=(null===(n=this.schemesMap)||void 0===n?void 0:n[t])||t;e.setAttribute("scheme",i)},e.prototype.subscribe=function(e){var t=this;return this.subscribers.push(e),function(){t.subscribers=t.subscribers.filter((function(t){return e!==t}))}},e.prototype.onInit=function(e){var t=this;return this.initSubscribers.push(e),function(){t.initSubscribers=t.initSubscribers.filter((function(t){return e!==t}))}},e.isSchemesSupported=function(){return window.isNewMail&&window.CSS&&CSS.supports&&CSS.supports("color","var(--custom-property)")},e.isSchemesAutoSwitchingSupported=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme)").matches},e}();r=window.colorScheme?window.colorScheme:new s,window.colorScheme=r,window.isSchemesSupported=s.isSchemesSupported.bind(null)},"aiw/":function(e,t,n){"use strict";n.d(t,"d",(function(){return z})),n.d(t,"b",(function(){return Y})),n.d(t,"c",(function(){return G})),n.d(t,"a",(function(){return Q})),n.d(t,"e",(function(){return K}));var i=0,a=0,o=null,r=null;function s(){var e=pageYOffset;e!==i&&999999!==e&&(i=e,a=Math.max(a,e),scrollTo(0,999999)),clearTimeout(r),r=setTimeout((function(){r=null,window.removeEventListener("scroll",s),scrollTo(0,999999),setTimeout((function(){return scrollTo(0,999999)}),1e3)}),150)}var c,l,u,d,_,p,h,f,m,v=n("H5mD"),g=0,b=0,A="",w=!1,y={},O=0;function k(e){if(A=e,w=!1,c=!1,u=0,d=0,p=0,h=0,y={},void 0,f="start",m=0,O=0,v.i)if("top"===A||"bottom"===A){I()<v.b&&M(0);var t=document.body;_=t.offsetHeight,t.offsetWidth,window.addEventListener("scroll",S),"top"===A&&Object(v.k)()||(E(),C())}else document.body.classList.add("ScrollViewsDisabled")}function j(){"top"===A||"bottom"===A?(l&&clearTimeout(l),window.removeEventListener("scroll",S)):document.body.classList.remove("ScrollViewsDisabled"),w=!1,A="",c=!1,_=0,0}function S(){if(E(),"top"!==A){if("bottom"===A){var e=pageYOffset,t=I();c&&(c=!1,e===p)||(v.m?h<=5&&C():e>v.b?e>t?(M(e),v.m||C()):e<t?y[e]||e>T(t)?(y[e]=!0,C(_)):C():e!==T(t)&&C():t||(e<v.a?(u===e?d++:(u=e,d=1),d>=3&&(window.removeEventListener("scroll",S),M(u)),setTimeout((function(){C()}),300)):C()))}}else{if(Object(v.k)())return;if(v.m)return void(0!==pageYOffset&&C(0));var n=innerHeight;if("start"===f&&(n<_?f="animate":C(1)),"animate"===f)if(m=_-n,O||(O=Math.max(1,Math.min(4,Math.floor(m/10)))),m<=0)f="stop";else{var i=v.h?v.e<11?3:2:1;C(Math.min(m,O)*i)}"stop"===f&&C(1)}}function C(e){c=!0;var t,n=I();"bottom"===A?t=e||(!n||v.m||v.h?_:T(n)):"top"===A&&(t=isFinite(e)?e:1),h++,p=t,window.scrollTo(0,t)}function E(){l&&clearTimeout(l),w||(l=setTimeout((function(){w=!0,l=null,window.removeEventListener("scroll",S)}),500))}function T(e){return v.h||v.m||90===Math.abs(window.orientation)&&screen.width>=375||(v.j?e-=v.d:e-=v.c),e}function I(){return 90===Math.abs(window.orientation)?g:b}function M(e){90===Math.abs(window.orientation)?g=e:b=e}var P=null,x=0,L=0;function R(){if(!(visualViewport.height>=x)){var e=x-visualViewport.height;L!==e&&(!v.m&&e<v.a?scrollTo(0,0):scrollTo(0,e))}}var B=!1,N=!1,D=!1,H=null,U=[],V=[],F=null,W=v.l&&(v.h||v.m),q=v.l&&v.e<=12;function z(e,t){void 0===e&&(e="default");var n=(void 0===t?{}:t).exitIfStarted,c=void 0!==n&&n;if(v.f&&!(v.e<8)&&!(N&&c||B)){if(F=e,N=!0,H&&(clearTimeout(H),H=null),"bottom"===e){if((Object(v.k)()||!W&&!q)&&!function(){if(P||(P={onceBlocked:!1}),P.onceBlocked&&(P.opened=!0),!P.onceBlocked&&!P.opened){P.onceBlocked=!0;var e=document.activeElement;return e.blur(),e.focus(),!1}return P.opened=!0,window.visualViewport&&(x=visualViewport.height,L=0,setTimeout(R),visualViewport.addEventListener("scroll",R),visualViewport.addEventListener("resize",R)),!0}())return;!W&&q&&k(e),W&&function(e){void 0===e&&(e="default"),o&&(clearTimeout(o),o=null),r&&(clearTimeout(r),r=null),i=0,0,0,a=0,window.addEventListener("scroll",s),setTimeout((function(){scrollTo(0,999999)}),10),setTimeout((function(){scrollTo(0,999999)}),100),setTimeout((function(){scrollTo(0,999999)}),200),setTimeout((function(){scrollTo(0,999999)}),300),setTimeout((function(){scrollTo(0,999999)}),400),setTimeout((function(){scrollTo(0,999999)}),500)}()}else!W&&q&&k(e);V.length&&V.forEach((function(e){return e()})),B=!0,N=!1}}function Y(e){var t=(void 0===e?{}:e).exitIfStarted,n=void 0!==t&&t;if(v.f&&!(v.e<8)&&(!D||!n)){if(D=!0,"bottom"===F){if((Object(v.k)()||!W&&!q)&&(!P||P.onceBlocked&&!P.opened||(window.visualViewport&&(setTimeout(R),visualViewport.removeEventListener("scroll",R),visualViewport.removeEventListener("resize",R)),P=null,x=0,L=0,0)))return;if(!B)return;!W&&q&&j(),W&&(clearTimeout(o),clearTimeout(r),i=0,0,0,o=null,r=null,window.removeEventListener("scroll",s))}else!W&&q&&j();B=!1,D=!1,F=null,H&&clearTimeout(H),H=setTimeout((function(){scrollTo(0,0),U.length&&U.forEach((function(e){return e()}))}),10)}}function G(e){-1===U.indexOf(e)&&U.push(e)}function Q(e){var t=U.indexOf(e);-1!==t&&U.splice(t,1)}function K(e){-1===V.indexOf(e)&&V.push(e)}},asMm:function(e,t,n){"use strict";n.d(t,"e",(function(){return _})),n.d(t,"g",(function(){return p})),n.d(t,"h",(function(){return h})),n.d(t,"i",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"d",(function(){return v})),n.d(t,"a",(function(){return g})),n.d(t,"c",(function(){return b})),n.d(t,"b",(function(){return A})),n.d(t,"k",(function(){return O})),n.d(t,"j",(function(){return k}));var i=n("+cqQ"),a=n("UxAg"),o=n("j80l"),r=n("OcsD"),s=n("TYsd"),c=n("Y6JH"),l=n("EDm3"),u=n("Fbxv"),d=n("z1UI");var _=function(){return{id:0}},p=function(e,t){void 0===e&&(e=_());var n=e.id+1;e.id=n,t.sessionId=n},h=function(e,t){Object(i.b)(window.nav.onBeforeGo,(function(){return p(e,t)}))},f=function(e){Object(i.b)(window.nav.onBeforeGo,(function(){return e.abort()}))},m=function(e){var t=window.open("");return null==t||t.focus(),null==t||t.document.write(e),Object(i.b)(window.nav.onBeforeGo,(function(){return null==t?void 0:t.close()})),t||void 0},v=function(){return m(Object(r.W)("mobile_market_cart_payment_info_waiting"))},g=function(e){return e&&e.close()},b=function(e){var t=e.userId,n=e.orderId,i=e.hash,a=window.ajax.post("/market.php",{act:"get_payment_url_by_order",order_user_id:t,order_id:n,hash:i});return f(a),a.promise.then((function(e){var t=e.json;if(!e.skip){if(!t||!t.data||!t.data.length)throw Error();return decodeURIComponent(t.data[0])}}))},A=function(e){var t=e.orderId,n=e.userId;return Object(o.b)("/market.php",{act:"check_payment_by_order",order_id:t,order_user_id:n})},w=function(e){var t=e.icon,n=e.title,i=e.description,o=e.type,_=e.continueButtonURL,p=Object(a.a)('[data-section-ref="payment_content"]');if(p){var h=t||function(e){switch(e){case"error":return{inner:[Object(l.Jb)()],class:"SplashScreen__icon",tag:"div"};case"timeout":return{inner:[Object(l.Tb)()],class:"SplashScreen__icon",tag:"div"};case"loading":return{inner:[Object(c.a)({icon:Object(u.a)()})],class:"SplashScreen__icon SplashScreen__icon--loading",tag:"div"};case"success":default:return{inner:[Object(l.Hb)()],class:"SplashScreen__icon",tag:"div"}}}(o);try{p.innerHTML=s.a.html(function(e){void 0===e&&(e={});var t={inner:[e.icon],class:"SplashScreen__icon",tag:"div"};return Object(d.a)({icon_raw:t,title:e.title,text:e.description,action_text:e.actionText,action_url:e.actionUrl})}({icon:h,title:n||Object(r.W)("mobile_market_cart_payment_info_error"),description:i||"",actionText:Object(r.W)("mobile_market_cart_payment_button"),actionUrl:_||window.nav.path}))}catch(e){console.error(e)}}},y=function(e){var t=(void 0===e?{continueButtonURL:void 0}:e).continueButtonURL;w({continueButtonURL:t,title:Object(r.W)("mobile_market_cart_payment_info_error"),description:Object(r.W)("mobile_market_cart_payment_info_canceled_text"),type:"error"})},O=function(e){var t=e.sessionIdCurrent,n=e.paymentURL,a=e.paymentWindow,o=e.waitingTimeSec,r=void 0===o?5:o,s=e.getIsSuccess,c=e.onLoading,l=e.onResponse,u=e.onCancel,d=e.onFailure,_=e.onTimeout,p=t;window.clog("Open VK Pay window. Starting payment check"),a.location.href=n,c();var h=setInterval((function(){if(p!==t)return clearInterval(h),void m();a&&a.window&&!a.window.closed||(window.clog("VK Pay window was manually closed. Unsubscribing from events"),clearInterval(h),m(),u())}),500),f=function(e){if(p===t)if("externalAppDone"===e.data.method&&e.data.params.status){window.clog("Received VK Pay done event. Waiting for payment success check"),m(),clearInterval(h);var n=Date.now(),i=!0,a=setInterval((function(){return p!==t?(clearInterval(a),void(i=!1)):i?Date.now()-n>=1e3*r?(window.clog("Payment check timeout. Showing done info."),clearInterval(a),i=!1,void _()):void s().then((function(e){if(!i||!e)return!1;window.clog("Payment check succeeded. Showing done info"),clearInterval(a),i=!1})).catch((function(){window.clog("Received VK Pay close or fail event. Unsubscribing from events"),clearInterval(a),d()})):void 0}),1e3);l&&l()}else"closeApp"!==e.data.method&&"externalAppFail"!==e.data.method||(window.clog("Received VK Pay close or fail event. Unsubscribing from events"),clearInterval(h),m(),d());else m()};function m(){window.removeEventListener("message",f,!1)}window.addEventListener("message",f,!1);Object(i.b)(window.nav.onBeforeGo,(function(){m()}))},k=function(e){var t=e.paymentComponent,n=e.checkIsPaidUrl,i=e.sessionIdCurrent,a=e.paymentURL,o=e.paymentWindow,s=e.onCancel,c=e.onFail,l=e.onTimeout;return O({sessionIdCurrent:i,paymentURL:a,paymentWindow:o,waitingTimeSec:40,getIsSuccess:function(){var e=window.ajax.post(n,{});return f(e),e.promise.then((function(e){var n,a=e.json;if(!e.skip){if(i!==t.sessionId)throw Error();if(!a)throw Error();return!!(null===(n=null==a?void 0:a.data)||void 0===n?void 0:n[0].status)&&(function(e){var t=e.description,n=e.continueButtonURL;w({description:t,continueButtonURL:n,title:Object(r.W)("mobile_market_cart_payment_info_success"),type:"success"})}({description:a.data[0].text}),!0)}}))},onLoading:function(){!function(e){var t=e.title,n=e.description,i=e.continueButtonURL;w({title:t,description:n,continueButtonURL:i,type:"loading"})}({title:Object(r.W)("mobile_market_cart_payment_info_waiting"),description:Object(r.W)("mobile_market_cart_payment_info_waiting_text")})},onCancel:function(){s&&s(),y()},onFailure:function(){c&&c(),y()},onTimeout:function(){l&&l(),function(e){var t=(void 0===e?{continueButtonURL:void 0}:e).continueButtonURL;w({continueButtonURL:t,title:Object(r.W)("mobile_market_cart_payment_info_success"),description:Object(r.W)("mobile_market_cart_payment_info_success_later_text"),type:"timeout"})}()}})}},bKAG:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return u}));n("jE6c");var i,a,o,r=n("PU8N"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},c=16;function l(e){return new Promise((function(t,n){window.ajax.post(Object(r.g)()?"stories.php":"al_stories.php",s({act:"get_upload_url"},e),{onDone:t,onError:n,onFail:n})}))}function u(e,t){return new Promise((function(n,i){window.ajax.post(Object(r.g)()?"stories.php":"al_stories.php",{act:"save",upload_result:e,hash:t},{onDone:n,onError:i,onFail:i})}))}!function(e){e.PHOTO="photo",e.VIDEO="video"}(i||(i={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(a||(a={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar"}(o||(o={}))},bRFj:function(e,t){window.Friends={onImportSuccess:befall("serviceId","friendsHtml","total"),onImportFailed:befall("serviceId"),accept:function(e,t,i,a,o,r,s,c){void 0===i&&(i="");void 0===a&&(a=null);void 0===o&&(o="");void 0===r&&(r="");void 0===s&&(s=null);void 0===c&&(c=null);n("accept",e,t,i,a,o,r,s,c)},decline:function(e,t,i,a,o,r,s,c){void 0===i&&(i="");void 0===a&&(a=null);void 0===o&&(o="");void 0===r&&(r="");void 0===s&&(s=null);void 0===c&&(c=null);n("decline",e,t,i,a,o,r,s,c)},makeImportRequest:function(e,t,n){if(!window.XMLHttpRequest)return void(window.location=e);ajax.plainpost(e,{_ajax:1},(function(e){return function(e,t,n){var a=parseJSON(e),o=a.user,r=a.user_hash,s=a.contacts,c="/friends.php?act=save_contacts&type="+n;if(a.error)return void i(n);ajax.post(c,{_ajax:1,user:o,userhash:r,hash:t,contacts:s},{onDone:function(e,t){return function(e,t,n){var i=geByClass1("friendsImport__loading"),a=geByClass1("friendsImport__result");addClass("friendsImport__loading_hidden",i),a&&(a.innerHTML=t,addClass("friendsImport__result_shown",a));autoScroll((function(){return geByClass1("friendsList__footerBtn_showMore")}),ImportedFriends,{no_cache:!0}),Friends.onImportSuccess(e,t,n),window.opener&&window.opener.Friends.onImportSuccess(e,t,n)}(n,e,t)},onFail:function(){return i(n)}})}(e,t,n)}),(function(){return i(n)}),!0)}};function n(e,t,n,i,a,o,r,s,c){var l={act:e,hash:n,id:t};i&&(l.from=i),a&&(l.block_id=a),o&&(l.ref=o),r&&(l.track_code=r);var u="/friends"+obj2qs(l);ajax.post(u,{_ajax:1},{onDone:s,onFail:c})}function i(e){Friends.onImportFailed(e),window.opener&&(window.opener.Friends.onImportFailed(e),window.close())}},"bZ/P":function(e,t,n){"use strict";var i={};function a(e,t){return e+'="'+t+'"'}function o(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a(e,r(n))}}function r(e){return e[0]+"("+e.slice(1).map(s).join(", ")+")"}function s(e){return"number"==typeof e||"event"===e||"this"===e?e:JSON.stringify(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function c(e,t){var n,i=[];"string"==typeof t&&((n={})[t]=!0,t=n);return Object.keys(t).forEach((function(n){var a=t[n];!0===a?i.push(e+"_"+n):a&&i.push(e+"_"+n+"_"+a)})),i}Object.assign(i,{html:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a="";return e.forEach((function(e,t){var i=n[t];a+=e+(i||0===i?i:"")})),a}}),Object.assign(i,{attr:a,onBlur:o("onblur"),onClick:o("onclick"),onFocus:o("onfocus"),onInput:o("oninput"),onKeyDown:o("onkeydown"),onKeyPress:o("onkeypress"),onKeyUp:o("onkeyup"),onMouseDown:o("onmousedown"),onMouseUp:o("onmouseup"),onScroll:o("onscroll"),onSubmit:o("onsubmit"),onTouchEnd:o("ontouchend"),onTouchMove:o("ontouchmove"),onTouchStart:o("ontouchstart"),onWheel:o("onwheel"),onChange:o("onchange")}),Object.assign(i,{list:function(e,t){void 0===t&&(t=null);Array.isArray(e)||(e=[e]);return t?e.map(t).join(""):e.join("")}}),Object.assign(i,{class:function(){for(var e=[],t=null,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return i.forEach((function(n){"string"==typeof n?(e.push(n),t=n):n&&(e=e.concat(c(t,n)))})),e.join(" ")},parseClass:function(e,t){var n={};return t.trim().split(/\s+/).forEach((function(t){if(t!==e){var i=t.replace(e+"_","").split("_");n[i[0]]=!(i.length>1)||i[1]}})),n}});t.a=i;window.q=i},cGUQ:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("jE6c"),a={},o=function(e){if(a[e])return e;try{return encodeURIComponent(e)}catch(e){return""}};function r(e,t){var n=[];for(var a in e)if(e.hasOwnProperty(a)&&null!=e[a]&&!Object(i.m)(e[a]))if(Object(i.i)(e[a]))for(var r=0,s=0,c=e[a].length;r<c;++r)null==e[a][r]||Object(i.m)(e[a][r])||(n.push(o(a)+"["+s+"]="+o(e[a][r])),++s);else n.push(o(a)+"="+o(e[a]));return t||n.sort(),n.join("&")}},cLcH:function(e,t){function n(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}window.FeedAssistanceExploreBait={onSubscribeLinkClick:function(e,t,n,i,a,r){var s=hasClass(e,"post__subscribeBtn_unsubscribe"),c=s?i:n,l=s?getLang("mobile_groups_public_subscribe"):getLang("mobile_groups_you_are_in_public"),u=!s,d=(_=e,p=domCA(_,".post_exploreBait"),intval(domData(p,"block-id")));var _,p;attr(e,"aria-label",escapeAttr(l)),toggleClass("post__subscribeBtn_unsubscribe",e,u),"group"===a?function(e,t,n,i){var a=n?Groups.leave:Groups.enter,r=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;i&&o(r),a.call(Groups,e,t,"feed")}(t,c,s,r):function(e,t,n,i,a){var r=n?Friends.decline:Friends.accept,s=n?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_UNSUBSCRIBE:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_SUBSCRIBE;a&&o(s),r.call(Friends,e,t,"feed",i)}(t,c,s,d,r);return!1}},FeedAssistanceStats.registerTrackingCls("post_exploreBait"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_EXPLORE_BAIT){if(e._exploreBaitClickHandlerAdded)return;a=!0,addEvent(e,"click",(function(e){!function(e){for(var t,i=e.target,a=n(r);!(t=a()).done;){if(!0===t.value.call(null,i))return}}(e)})),e._exploreBaitClickHandlerAdded=!0}})),nav.onBeforeGo((function(e){if(!a)return;if(!function(e){return e.tagName&&"explore-bait"===domData(e,"post-type")}(e))return;!function(e){for(var t=0,n=["pi_text_more","wi_date","pi_text","i_replies","v_replies","item_replies"];t<n.length;t++){if(hasClass(n[t],e))return o(FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPENED),!0}}(e)}));var a=!1;function o(e){FeedAssistanceStats.dispatchEvent({type:FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT,data:FeedAssistanceStats.serializeEventData(FeedAssistanceStats.EVENTS.EVENT_EXPLORE_BAIT_SUB,e)})}var r=[function(e){if(domData(e,"post-owner-type"))return o("user"===domData(e,"post-owner-type")?FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_USER:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_OPEN_GROUP),!0},function(e){var t={report:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_REPORT,hide:FeedAssistanceStats.EVENTS.SUB_EVENT_EXPLORE_BAIT_HIDE}[domData(e,"post-action")];if(t)return o(t),!0}]},cZev:function(e,t,n){"use strict";var i=n("Xrg9"),a=n("J8bf"),o=n("kr3z"),r=n("+sJP"),s=n("+cqQ"),c=n("UxAg"),l=n("zvhO"),u=n("OcsD"),d=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},_=function(){function e(){}return e.saveStickerPanel=function(e,t){i.a.set("sticker_panel",e),t&&Object(a.b)("remixstickers_hash",t),window.cur.sticker_panel=e},e.getStickerPanel=function(e){void 0===e&&(e=""),e||(e=Object(r.y)("target")||"");var t=i.a.get("sticker_panel")||window.cur.sticker_panel;return t?e?t.replace(/mail0/g,e):t:""},e.saveStickers=function(t){e.stickers=t,i.a.set("stickers",t)},e.setStickerTab=function(e,t){return void 0===t&&(t=[]),this.getStickers(),this.stickers[e]?this.stickers[e].stickers=t:this.stickers[e]={stickers:t},this.saveStickers(this.stickers),this.stickers[e]},e.getStickers=function(){if(this.stickers)return this.stickers;var t=i.a.get("stickers");return t&&Object.values(t).find((function(e){return!e.hasOwnProperty("stickers")}))&&(clog("[StickerCache] Stickers cache format is outdated"),t=null),!t&&cur.stickers&&(t=cur.stickers,this.saveStickers(t)),e.stickers||(e.stickers=t),e.stickers},e.setNewStickersCount=function(t,n){var i=n||e.getStickerPanel();if(!Object(l.a)(t))return n;var a=ce("div");a.innerHTML=i;var o=Object(c.a)(".sp_badge",a),r=window.devicePixelRatio>=1.5?"_2x":"";return Object(u.jc)(o,{"background-image":t>0?"url(/images/mobile/badge"+t+r+".png)":""}),a.innerHTML},e.checkStickers=function(t){var n=this;if(void 0===t&&(t={}),!window.vk)return setTimeout((function(){var t;return(t=n.checkStickers).call.apply(t,d([e],arguments))}),1e3);if(window.vk.id){if(this.getStickers()&&this.getStickerPanel()&&Object(a.a)("remixstickers_hash")){if(!t.force&&Date.now()-i.a.get("stickers_last_load")<3e5)return clog("[StickerCache] Stickers check was fired in less than 5 minutes. Prevent loading"),!1}else clog("[StickerCache] Stickers cache isn't loaded or broken"),Object(a.b)("remixstickers_hash","");t.ignore_hash&&Object(a.b)("remixstickers_hash",""),i.a.set("stickers_last_load",Date.now()),o.a.post("/?act=load_stickers",{},{onDone:function(t){if(i.a.set("stickers_last_load",Date.now()),t){if(t.part_load){clog("[StickerCache] Force loaded some categories");var n=t.stickers_data,a=t.new_items;if(Object(l.a)(a)){var o=e.setNewStickersCount(a);e.saveStickerPanel(o)}var r=extend(e.getStickers()||{},n);e.saveStickers(r)}else{clog("[StickerCache] New version of stickers async loaded");o=t.sticker_panel,n=t.stickers_data;e.saveStickerPanel(o,t.hash),e.saveStickers(JSON.parse(n))}e.onStickerPanelUpdate()}else clog("[StickerCache] Stickers already exists.")}})}else clog("[StickerCache] User unauthorized.")},e.stickers=null,e.onStickerPanelUpdate=Object(s.a)(),e}();t.a=_},ciqL:function(e,t){var n={show:function(e,t){window.grecaptcha?grecaptcha.reset():(window.recaptchaCallback=function(){n.onCallback(e)},document.body.appendChild(ce("script",{type:"text/javascript",src:"https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit&hl="+t})))},onResponse:function(e){ge("field_recaptcha").value=e,ge("recaptcha_form").submit()},onCallback:function(e){if(grecaptcha&&e){var t=geByClass1("recaptcha_box"),i=geByClass1("recaptcha",t);i&&(val(i,""),grecaptcha.render(i,{sitekey:e,callback:n.onResponse}))}}};window.ReCaptcha=n},dmnf:function(e,t,n){"use strict";function i(e,t,n){return void 0===t&&(t=""),e&&n?new Promise((function(i,a){window.ajax.post("/?act=track_event",{type:e,value:t,hash:n},{onDone:function(){i()},onFail:function(e){return a(e),!0}})})):Promise.reject()}n.d(t,"a",(function(){return i}))},drfJ:function(e,t,n){"use strict";n.r(t),n.d(t,"uMailHat_getPeerActions",(function(){return C}));var i=n("STl5"),a=n("DkIl"),o=n("+sJP"),r=n("UknS"),s=n("vmnM"),c=n("/Nch"),l=n("SCqW"),u=n("2cdU"),d=n("gmmu"),_=n("+7CI"),p=n("K95L"),h=n("OwA7"),f=n("iNof"),m=n("NTGm"),v=n("jyox"),g=n("PssS"),b=n("0jkK"),A=n("IxZu"),w=n("LpTT"),y=n("i87f"),O=n("HUf4"),k=n("VkCW");function j(e){return"/club"+-store.mail.peers[e].ownerId}function S(){var e=store.mail.cur;return e.schoolData&&e.schoolData.school&&Object(o.D)()?E("openSchoolGrade",null,'onmousedown="uMessenger.openSchoolGrade()"',!1,e.schoolData):""}function C(e){var t=store.mail,n=t.peers[e].actionUrls,i=t.peers[e].isChannel,a=!!Math.abs(t.cur.groupId),r=t.rolls.peer[e],s=!r||!r.length,c=[];if(!n)return c;var l=E("markAsUnread",null,'onmousedown="uMessenger.onMarkDialogAsUnreadClick()"'),u=s||!n.canPinDialog||a?"":E("pinConvo",null,'onmousedown="uMessenger.onPinDialogClick()"'),d=s||!n.canPinDialog||a?"":E("unpinConvo",null,'onmousedown="uMessenger.onUnpinDialogClick()"');return c=e>-2e9&&e<0?[!s&&E("showMedias",n.showMedia),l,u,d,!s&&E("deleteHistory",n.flushHistory),E("blockCommunity",n.blockCommunity),E("unblockCommunity",n.unblockCommunity),E("blockNotify",n.blockNotify)]:Object(o.B)(e)?[E("chatInfo",n.chatInfo,"",i),E("chatAdd",n.addToChat,"",i),i&&Object(o.D)()?E("goToSchoolPage",j(e)):"",!i&&S(),Object(o.H)()?"":E("inviteLink",n.inviteLink,"",i),!s&&E("showMedias",n.showMedia),n.unpinMsg?E("chatUnpinMsg",n.unpinMsg):"",n.unpinMsg?E("chatShowPinnedMsg",null,'onmousedown="uMessenger.onShowPinnedMsgClick()"'):"",n.unpinMsg?E("chatHidePinnedMsg",null,'onmousedown="uMessenger.onHidePinnedMsgClick()"'):"",l,u,d,!s&&E("chatDeleteHistory",n.flushHistory),E("chatReturn",n.returnToChat,"",i),E("chatLeave",n.leaveChat,"",i)]:a?[!s&&E("showMedias",n.showMedia),Object(o.H)()?"":E("markAsAnswered",n.communityMarkAsAnswered),l,n.isDialogImportant?E("removeImportantMark",n.communityToggleImportant):E("markAsImportant",n.communityToggleImportant),Object(o.H)()?"":n.isBlacklisted?E("unbanUser",n.userBan):E("banUser",n.userBan),!s&&E("deleteHistory",n.flushHistory)]:[!s&&E("showMedias",n.showMedia),l,u,d,!s&&E("deleteHistory",n.flushHistory)]}function E(e,t,n,i,a){void 0===n&&(n=""),void 0===i&&(i=!1),void 0===a&&(a={});var j=window.lang;if(!t&&!n)return null;var S=Object(o.D)(),C=S?j.mobile_mail_edu_chat_info:j.mobile_mail_chat_info,E=i?j.mobile_mail_channel_info:C,T=S?j.mobile_mail_edu_chat_return:j.mobile_mail_chat_return,I=S?j.mobile_mail_edu_leave_chat:j.mobile_mail_chat_leave,M=S?j.mobile_mail_edu_clean_chat:j.mobile_mail_delete_chat_history,P=a.grade?j.mobile_mail_edu_show_grade.replace("{grade}",""+a.grade.number+a.grade.liter):j.mobile_mail_edu_show_school,x=a.grade?Object(y.a)():Object(w.a)(),L={showMedias:[j.mobile_mail_show_medias,Object(r.a)()],deleteHistory:[j.mobile_mail_delete_history,Object(s.a)()],blockCommunity:[j.mobile_mail_block_community,Object(c.a)()],blockNotify:[j.mobile_mail_block_community_notify,Object(c.a)()],unblockCommunity:[j.mobile_mail_unblock_community,Object(l.a)()],chatAdd:[i?j.mobile_mail_add_to_channel:j.mobile_mail_add_to_chat,Object(l.a)()],chatUnpinMsg:[j.mobile_mail_unpin_msg,Object(u.a)(),"unpin"],chatShowPinnedMsg:[j.mobile_mail_pin_show,Object(d.a)(),"showPinned"],chatHidePinnedMsg:[j.mobile_mail_pin_hide,Object(_.a)(),"hidePinned"],chatInfo:[E,Object(p.a)()],openSchoolGrade:[P,x],chatDeleteHistory:[M,S?Object(k.a)():Object(s.a)()],chatReturn:[i?j.mobile_mail_return_to_channel:T,Object(h.a)(),"returnToChat"],chatLeave:[i?j.mobile_mail_channel_leave:I,S?Object(O.a)():Object(f.a)(),"leaveChat"],removeChat:[j.mobile_mail_edu_remove_chat,Object(s.a)()],markAsAnswered:[j.mobile_mail_mark_as_answered,Object(m.a)()],removeImportantMark:[j.mobile_mail_remove_important_mark,Object(v.a)()],markAsImportant:[j.mobile_mail_mark_as_important,Object(g.a)()],markAsUnread:[j.mobile_mail_mark_as_unread,Object(b.a)()],unbanUser:[j.mobile_settings_blacklist_unban_user,Object(l.a)()],banUser:[j.mobile_settings_blacklist_ban_user,Object(c.a)()],inviteLink:[i?j.mobile_mail_channel_invite_link:j.mobile_mail_invite_link,Object(A.a)()],pinConvo:[j.mobile_mail_pin_conversation,Object(d.a)(),"pinConvo"],unpinConvo:[j.mobile_mail_unpin_conversation,Object(u.a)(),"unpinConvo"],goToSchoolPage:[j.mobile_mail_edu_go_to_school_page,Object(w.a)()]},R={text:L[e][0],icon:SVGIcon(L[e][1]),attrs:n,url:t};return L[e][2]&&(R.name=L[e][2]),R}t.default=function(){var e=store.mail.cur.peerId,t=store.mail.cur.page;if(e)return function(e){var t=store.mail,n=t.peers[e],i=Object(o.B)(e),r=Object(o.C)(e),s={id:e,title:n.title,photos:n.avatarImages,actions:C(e),editing:t.cur.editing,peerProfile:{isEnabled:t.flags.isPeerProfileEnabled,tagsData:n.peerProfileTagsData||{},tags:t.peerProfileTags||[]},canCall:!!n.canCall};if(i){var c=i?e-2e9:null;if(s.url="/mail?act=info&chat="+c,s.membersCount=n.countMembers,s.hasPinnedMsg=n.hasPinnedMsg,s.isChannel=n.isChannel,s.isCasper=n.isCasper,s.isDonutChat=n.isDonutChat,s.isChannel||n.isCommunityChat)s.url=j(e);else if(n.viewerId<0){var l=-n.viewerId;s.url="/mail?act=info&chat="+c+"&community="+l}}else s.url=n.profileUrl,s.isOnline=n.isOnline,s.onlinePlatform=n.onlinePlatform,s.offlineText=n.offlineText,s.isContact=r;return Object(a.MailHat_convo)(s)}(e);if(t)return function(e){return Object(a.MailHat_page)(e)}(t);return function(){var e=store.mail.cur,t=Math.abs(e.groupId),n=!!t,r=n?"&community="+t:"",s=n?"?community="+t:"",c=!Object(o.H)()&&n;return Object(a.MailHat_main)({folder:e.folder,urls:{all:"/mail"+s,unrespond:"/mail?act=unrespond"+r,unread:"/mail?act=unread"+r,important:"/mail?act=important"+r,adTag:"/mail?act=ad_tag"+r,createChatUrl:"/mail?act=new_chat"},importantCount:e.countImportant,withUnrespond:n,withAdTag:c,forwarding:!!e.forwardFromId,notifier:Object(i.a)()})}()}},eJy5:function(e,t,n){"use strict";var i=n("OcsD"),a=Object(i.Hb)("Voting");function o(e){s(e.$voting,e.url)}function r(e,t){s(t.$voting,e,!0)}function s(e,t,n){var o=setTimeout((function(){a.setLoading(e)}),140);window.ajax.post(t,{_ajax:1},{onDone:function(t,r){Object(i.v)(e,"is-web-view")&&a._onPollChanged&&a._onPollChanged(e,n),clearTimeout(o),a.setHtml(t,r)}})}window.uVoting={},window.uVoting._onSubmit=o,window.uVoting._onRevoteClick=r},eWFs:function(e,t,n){"use strict";n.r(t),n.d(t,"uConvo_getLastMsgId",(function(){return p}));n("bZ/P");var i=n("TYsd"),a=(n("Mc5h"),n("s0aB")),o=n("iWgD"),r=n("/Id8"),s=n("+sJP"),c=function(e,t,n){void 0===t&&(t=null);void 0===n&&(n={isWithoutMessage:!1});var i="last"===t,o=store.mail,r=o.peers[e],c=Object(s.C)(e),_=r.url,p=null;if(t){var m;i||(_=_+"&msg="+t),(m=i?h(e):o.msgs[t])&&(p={text:l(m),date:m.dateShort,unreadCount:d(e),muted:r.isMuted,typing:f(e),pending:m.pending,failed:m.failed})}return Object(a.default)({id:e,url:_,photos:r.avatarImages,title:r.title,online:u(r),important:r.isImportant,profileUrl:r.profileUrl,isLast:i,peerProfile:{tagsData:r.peerProfileTagsData||{},tags:o.peerProfileTags||[]},isMarkedUnread:r.isMarkedUnread,more:p,isCasper:r.isCasper,isDonutChat:r.isDonutChat,isContact:c,name:r.title,majorSortId:r.majorSortId,isWithoutMessage:n.isWithoutMessage})};function l(e){var t=window.lang,n=store.mail,a=!!e.attaches.call;if(e.isExpired){var o=Object(s.t)("mobile_mail_you")+": "+Object(s.t)("mobile_casper_chat_message_disappeared");return i.a.html({inner:[o],tag:"span"})}if(e.isService&&!a)return i.a.html({tag:"span",inner:[i.a.wrap(e.serviceText)]});var c=e.body?i.a.wrap(Object(r.Msg__textPreview)(e.body)):function(e){return{tag:"span",class:"convo__msgAttach",inner:Object(r.Msg__attachPreview)(e)}}(e),l="";return e.authorId===n.cur.userId&&e.peerId!==n.cur.userId?l=t.mobile_mail_you:Object(s.B)(e.peerId)&&e.authorId&&(l=(l=n.members[e.authorId].shortName).replace(/\.$/,"")),l&&(l+=": "),i.a.html({tag:"span",inner:[i.a.wrap(l),c]})}function u(e){return!!e.isOnline&&("desktop"===e.onlinePlatform?"desktop":"mobile")}function d(e){var t=_(e).countUnread;if(0===t){var n=store.mail,i=h(e);i&&i.isUnread&&i.authorId===n.cur.viewerId&&(t=-1)}return t}function _(e){return store.mail.peers[e]}function p(e){var t=store.mail,n=t.rolls.peer[e],i=t.presend&&t.presend.pending[e],a=t.presend&&t.presend.failed[e];if(i&&i.length)for(var o=i.length-1;o>=0;o--){var r=i[o];if(-1===r.indexOf("edit"))return r}if(a&&a.length)for(var s=a.length-1;s>=0;s--){var c=a[s];if(-1===c.indexOf("edit"))return c}return n&&n.length?last(n):null}function h(e){var t=store.mail.msgs,n=store.mail.presend,i=n&&n.msgs,a=p(e);return i&&i[a]?i[a]:a?t[a]:null}function f(e){var t,n,i=Object(o.b)(e),a=i&&1===i.count&&i.users[0]===e;return i?("mixed"===i.type?(t="simple-dots",n="mixed"):"audio"===i.type?(t="audio",n="audio"):"text"===i.type&&(t="simple-dots",n=""),{typing:!!a||Object(o.a)(i),typingCount:i.count,animation:t,text:n,dimmed:!1,compact:!0}):""}n("+cqQ");var m=n("rudk");Object.assign(c,{onTap:a.default.onTap,redrawOnline:function(e){var t=store.mail.peers[e];if(t){var n=u(t);a.default.setOnline(e,n)}},redrawUnread:function(e){if(!store.mail.peers[e])return;var t=d(e),n=_(e).isMarkedUnread;a.default.setUnreadCount(e,t,n)},redrawLastMsg:function(e){var t=h(e);t&&a.default.setLastMsg(e,l(t),{dateShort:t.dateShort,pending:t.pending,failed:t.failed})},redrawTyping:function(e){if(!store.mail.cur)return;var t=Object(o.b)(e),n=(t&&1===t.count&&t.users[0],f(e));a.default.setTyping(e,n)},redrawImportant:function(e,t){a.default.setImportant(e,t)},updateAdTag:function(e){var t=store.mail.peers[e];a.default.updateAdTag(e,t.peerProfileTagsData)},redrawPinned:function(e){var t=store.mail.peers[e];if(t){var n=Object(m.d)(t.majorSortId);a.default.updatePinned(e,n)}}});t.default=c;window.uConvo=c},eoxF:function(e,t){var n=function(){var e=null,t=!1,i=!1,a={},o=[],r=0,s=null,c="",l="";function u(e,t){return!t&&g(e)}function d(e){i=!1;var n=ge("medias_map"),a=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),append(n,a));var o=+e[1]||0,r=e[3]||"",s=e[4]||"",c=e[5]||"",l=(+e[6].lat||0)+"_"+(+e[6].lng||0),u=geByClass1("medias_map",n),d='<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+r+(c?", "+c:s?", "+s:"")+"</div>",_='<input type="hidden" name="place_id" value="'+o+'"><input type="hidden" name="place" value="'+l+'">';if(u)val(u,d+_);else{d='<div class="medias_map">'+d+_+"</div>";val(n,d)}addClass("cp_geo_btn_sel","geo_btn"),t=!0,show(n)}function _(t){return g(e)}function p(){val("place_add_box",""),hide("place_add_box"),show("places_box")}function h(t,n){f();var i=a[n];i&&(e={latitude:+i[6].lat||0,longitude:+i[6].lng||0},n?d(i):m(e,i))}function f(e){if(!s)return!0;val("m",s),s=null,scrollToEl(geByClass1("create_post_extra","mcont"));var t=nav.path+(nav.params?"?"+nav.params:"");return nav.go(t,null,{push_only:!0,no_push:e}),!1}function m(e,n){i=!0;var a=ge("medias_map"),o=ge("attached_wrap");a||(a=ce("div",{id:"medias_map",className:"pi_medias"}),o.appendChild(a));var r=e.latitude,s=e.longitude,c=(window.devicePixelRatio,n&&n[4]||!1),l=geByClass1("medias_map",a),u=c?'<div class="medias_map_close" onclick="checkin.remove();"><i class="i_close">&nbsp;</i></div><div class="medias_map_label" onclick="checkin.changePlace();">'+c+"</div>":"",d='<input type="hidden" name="map" value="'+(r+"_"+s+"_0")+'">';l?val(l,u+""+d):val(a,'<div class="medias_map">'+u+d+"</div>");t=!0,addClass("cp_geo_btn_sel","geo_btn"),show(a)}function v(){e=null,a={},o=[],r=0,ajax.post(l,{_ajax:1}),remove("medias_map")}function g(e){var t=window.al;remove("feed_extra_field");var n=Math.round(1e8*e.latitude)/1e8,i=Math.round(1e8*e.longitude)/1e8,a=gpeByTag("form","geo_btn"),o=ce("input",{id:"feed_extra_field",type:"hidden",name:"add_place",value:n+","+i});if(!a)return nav.go(nav.path+"?act=places&lat="+n+"&lng="+i);var r=!1;return each(a,(function(e,t){if("submit"===t.type)return r=t,!1})),r?(append(o,a),window.al&&t.ver?nav.go(r,null,{removeAfterNextResponse:!1}):a.submit()):void 0}function b(t){t&&t.coords&&u(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0})}function A(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},addNewPlace:function(){var t=val("place_name_fld"),n=val("place_address_fld");return t?(lockButton("place_add_btn"),ajax.post("/places.php",{_ajax:1,act:"add_place",latitude:e.latitude,longitude:e.longitude,title:t,address:n,hash:c},{onDone:function(e,t){if(unlockButton("place_add_btn"),e){var n={};n[e]=t,extend(a,n),o.splice(o[0]?0:1,0,e),p(),h(null,e)}},onFail:function(){unlockButton("place_add_btn");var e=Array.prototype.slice.call(arguments),t=e.shift(),n=ge("place_add_form");switch(t){case 2:n&&n.submit()}}}),!1):(elfocus("place_name_fld"),!1)},addPlaceShow:function(t,n){var i=window.lang,a="/places.php"+obj2qs({act:"add_place",latitude:e.latitude,longitude:e.longitude,hash:c});val("place_add_box",'<h3 class="sub_header">'+i.mobile_geo_new_place_header+'</h3><div class="form_item fi_fat"><form id="place_add_form" action="'+a+'" method="post"><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_name_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_name_fld" name="title" /></dd></dl><dl class="fi_row"><dt class="fi_label">'+i.mobile_geo_place_address_label+'</dt><dd class="iwrap"><input type="text" class="textfield" id="place_address_fld" name="address" /></dd></dl><dl class="fi_row"><dd><input class="button" type="submit" id="place_add_btn" value="'+i.mobile_geo_place_add_btn+'" onclick="return checkin.addNewPlace(this);" /><a class="near_btn" onclick="checkin.addPlaceCancel(); return false;">'+i.mobile_cancel+"</a></dd></dl></form></div>"),val("place_name_fld",unescapeAttr(t)||""),val("place_address_fld",unescapeAttr(n)||""),hide("places_box"),show("place_add_box"),t?elfocus("place_address_fld"):elfocus("place_name_fld")},addPlaceCancel:p,selectPlace:h,changePlace:_,back:f,refreshCurrentPosition:function(){geo.getCurrentPosition(b,A)},getCurrentAddress:function(){return a[0]&&a[0][5]||""},savePlaces:function(e){extend(a,e)},add:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(b,A),show("geo_waiting"))},add_place:function(n){if(!n&&t)return _();n&&(n.latitude||n.longitude)&&n.place?(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.place[1]?d(n.place):m(e,n.place),u(e,!0)):(geo.getCurrentPosition(b,A),show("geo_waiting"))},remove:function(){t=!1,removeClass("cp_geo_btn_sel","geo_btn"),v()},stash:function(n){if(!n)return[e,t,i,a,o,r,s];e=n[0],t=n[1],i=n[2],a=n[3],o=n[4],r=n[5],s=n[6]},init:function(u,d,_){return hide("geo_waiting"),e=null,t=!1,i=!1,a={},o=[],r=0,s=null,c=d||"",l=_||"",u&&n.add(u),geo.init()}}}();window.checkin=n},fWqt:function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"onConfirmDelete",(function(){return u})),n.d(i,"open",(function(){return d})),n.d(i,"close",(function(){return _})),n.d(i,"isDeleteMessagesForAll",(function(){return p}));var a=n("MUpH"),o=n("bZ/P"),r=n("+cqQ"),s=n("iS9e");function c(){var e=Object(a.a)(["\n    ","\n    ","\n  "]);return c=function(){return e},e}var l=null,u=Object(r.a)();function d(e){s.default.open({body:h(e),confirmText:lang.mobile_mail_delete_popup_delete,cancelText:lang.mobile_mail_delete_popup_cancel,onConfirm:o.a.onClick("MsgDeleteDialog.onConfirmDelete"),onClose:o.a.onClick("MsgDeleteDialog.close")})}function _(){var e=$(".MsgDeleteDialog__checkboxInput");e&&(l=e.checked,lsSet("delete_message_for_all_checked",l)),s.default.close()}function p(){var e=$(".MsgDeleteDialog__checkboxInput");return!!e&&e.checked}function h(e){var t,n,i=e.isEditing,a=e.canDeleteForAll;if(i)t=lang.mobile_mail_dialog_msg_delete_for_all;else{var r=Object.keys(store.mail.cur.msgSelected).length;t=langNumeric(r,lang.mobile_mail_dialog_msg_delete_N)}if(!i&&a){var s=lang.mobile_mail_delete_for_all;n='\n      <div class="MsgDeleteDialog__checkbox">\n        <label class="MsgDeleteDialog__checkboxIn">\n          <input type="checkbox" class="MsgDeleteDialog__checkboxInput" '+(function(){if("boolean"!=typeof l){var e=!!lsGet("delete_message_for_all_checked");l=e}return l}()?"checked":"")+'>\n          <span class="MsgDeleteDialog__checkboxLabel">'+s+"</span>\n        </label>\n      </div>\n    "}return o.a.html(c(),t,n)}t.default=i;window.MsgDeleteDialog=i},fYoA:function(e,t){window.SettingsNotifyGroup={},SettingsNotifyGroup._onChange=a;var n=".settingsNotifyGroup",i=".settingsNotifyGroup__description";function a(e,t){t.$control.closest(n).$(i).innerHTML=e}},g3t9:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("+sJP");function a(e){return void 0===e&&(e={}),{class:Object(i.f)("Separator",{"Separator--hideOnDesktop":e.hideOnDesktop,"Separator--noOffset":e.noOffset,"Separator--gray":e.gray},e.className||e.class),tag:"div"}}t.b=a},gF8j:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("uQjJ"),a=n("PU8N"),o=n("DLiR"),r=browser.iphone||browser.ipad||browser.ipod;function s(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function c(e,t,n){Object(a.g)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function l(e,t,n){Object(a.g)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function u(){return document.visibilityState||document.webkitVisibilityState}function d(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(s.prototype,i.a.prototype),extend(s.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.g)()&&this._isTopLevel()&&d()&&l(document,d(),this.onVisiblityChange),Object(a.g)()&&r||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.g)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.g)()&&this._isTopLevel()&&d()&&c(document,d(),this.onVisiblityChange),Object(a.g)()&&r||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(o.a.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime:function(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange:function(){"visible"===u()?this.cbActiveB():this.cbInactiveB()},_isTopLevel:function(){var e=this.opts.focusElement;return e===window||e===document},_isFocused:function(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=u();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gNTM:function(e,t){var n=function(){var e=null,t=!1;function i(e,t){var n=ge("medias_map"),i=ge("attached_wrap");n||(n=ce("div",{id:"medias_map",className:"pi_medias"}),i.appendChild(n));var a=e.latitude,o=e.longitude,r=(window.devicePixelRatio,geByClass1("medias_map",n)),s=t?'<div class="medias_map_close"><i class="i_close">&nbsp;</i></div><div class="medias_map_label">'+t+"</div>":"",c='<input type="hidden" name="map" value="'+(a+"_"+o+"_0")+'">';r?val(r,s+""+c):val(n,'<div class="meias_row medias_map" onclick="geoloc.remove();">'+s+c+"</div>");show(n)}function a(){e=null,remove("medias_map")}function o(t){var n;t&&t.coords&&(e={latitude:+t.coords.latitude||0,longitude:+t.coords.longitude||0},n=e,ajax.post("/places.php",{_ajax:1,act:"map_label",lat:n.latitude,lng:n.longitude},{onDone:function(e){hide("geo_waiting"),i(n,e)},onFail:r}))}function r(e){n.remove(),hide("geo_waiting")}return{toggle:function(){t?n.remove():n.add()},add:function(n){!n&&t||(t=!0,addClass("cp_geo_btn_sel","geo_btn"),n&&(n.latitude||n.longitude)?i(e={latitude:+n.latitude||0,longitude:+n.longitude||0},n.label):(geo.getCurrentPosition(o,r),show("geo_waiting")))},remove:function(){t&&(t=!1,removeClass("cp_geo_btn_sel","geo_btn"),a())},init:function(e){return e&&n.add(e),geo.init()}}}();window.geoloc=n},gy8s:function(e,t,n){"use strict";var i=n("bZ/P"),a=n("Mc5h"),o=n("9y81"),r=n("AXyT"),s=n("EDm3"),c=n("uBUF"),l=n("+sJP"),u=function(e){var t="unfold-"+Date.now()+"-"+Math.round(9999*Math.random());e.uniqueId=t;var n=i.a.class(e.mix,"Unfold",{position:e.position,asIcon:!!e.icon||!!e.icon_html,open:e.opened,withTitle:!!e.title}),a=i.a.list(e.items,_);return Wd.html({inner:[Object(c.a)({inner:[d(e)],tag:e.triggerWrapperTag,class:"Unfold__trigger"}),{inner:[Wd.wrap(a)],id:t,class:["Unfold__popup","ScrollView",e.popup_class].filter((function(e){return e})).join(" "),role:"menu",tag:"div"}],class:n,"data-name":e.name,onclick:e.onclick,tag:"div"})};function d(e){var t,n=e.title;if(e.icon)t=Object(o.b)({icon:e.icon});else if(e.icon_html)t=e.icon_html;else{for(var r=e.items,c=r.length,u="",d="",_=0;_<c;_++){var p=r[_];if(p&&p.active){u=p.text,d=p.activeCount;break}}t=[Object(a.a)({mix:"Unfold__triggerText",tag:"div",inner:Wd.html({inner:[n?[{inner:[n],class:"Unfold__triggerContentTitle",tag:"div"},{inner:[u],class:"Unfold__triggerContentSubTitle",tag:"div"}]:[u]],class:"Unfold__triggerContent",tag:"div"})}),!n&&d?Object(a.a)({mix:"Unfold__triggerTextCount",inner:d}):"",Wd.html({inner:[Object(s.i)()],class:"Unfold__triggerIcon",tag:"div"})],t=i.a.list(t)}var h=e.opened?e.close_url:e.open_url,f=Object(l.R)({},e.trigger_attrs);return e.isDisabled&&(f.disabled=!0),{inner:[Wd.wrap(t)],type:"button","aria-haspopup":"true","aria-expanded":"false","aria-controls":e.uniqueId,href:h,class:"Unfold__trigger",onclick:["Unfold._onTriggerClick","this"],attrs:f,tag:"button"}}function _(e){if(!e)return"";var t="";return e.svgIcon?t=Wd.html({inner:[e.svgIcon],class:"Unfold__itemIcon",tag:"div"}):e.icon&&(t="string"==typeof e.icon?Object(o.b)({mix:"Unfold__itemIcon",icon:e.icon}):Object(a.a)({mix:i.a.class("Unfold__itemIcon"),inner:Wd.html(e.icon)})),e.attrs+=' data-name="'+e.name+'" role="menuitem" tabindex="-1"',e.active&&(e.attrs+=' aria-current="true"'),e.preventNavigation&&(e.attrs+=' data-prevent-navigation="1"'),Object(a.a)({inner:[t,Object(a.a)({inner:[e.text,e.count?Object(a.a)({mix:"Unfold__itemCountHidden",inner:e.count}):""],mix:"Unfold__itemText"}),e.count?Object(r.a)({mix:"Unfold__itemCount",gray:!0,value:e.count}):""],mix:i.a.class(e.mix,"_touched","replaceState","Unfold__item",{active:e.active,name:e.name,disabled:e.disabled,replaceState:e.replaceState}),url:e.url,tag:e.tag,attrs:e.attrs})}var p=n("OcsD"),h=n("UxAg"),f=n("jk6M"),m=n("CQvH");Object.assign(u,{onOpen:befall.kind("unfoldName"),getByName:function(e){return Object(h.a)(j.unfoldByName(e))},setActive:S,setCount:function(e,t,n){var i=e.$(j.itemCountByName(t));r.a.setValue(i,n)},setTitle:function(e,t,n){e.$(j.itemByName(t)).$(j.itemText).innerText=n},toggleItemEnabled:function(e,t,n){void 0===n&&(n=!0);if(!e)return;var i=e.$(j.itemByName(t));i&&i.classList.toggle(g,!n)},changePosition:function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!1);var i;e.classList.remove(A,w,y,O),i=t?n?A:y:n?w:O;e.classList.add(i)}}),u._onTriggerClick=C;var v="Unfold__item_active",g="Unfold__item_disabled",b="Unfold_open",A="Unfold_position_topLeft",w="Unfold_position_topRight",y="Unfold_position_bottomLeft",O="Unfold_position_bottomRight",k="Unfold__item_replaceState",j={unfold:".Unfold",unfoldByName:function(e){return'.Unfold[data-name="'+e+'"]'},itemActive:"."+v,itemByName:function(e){return".Unfold__item_name_"+e},itemCountByName:function(e){return j.itemByName(e)+" .Unfold__itemCount"},item:".Unfold__item",itemDisabled:"."+g,triggerText:".Unfold__triggerText",itemText:".Unfold__itemText",popup:".Unfold__popup"};function S(e,t){var n,i;if(1===arguments.length?e=(i=e).closest(j.unfold):i=e.$(j.itemByName(t)),(n=e.$(j.itemActive))&&i){n.classList.remove(v),i.classList.add(v);var a=e.$(j.triggerText),o=i.$(j.itemText);a.innerText=o.textContent.trim()}}function C(e){var t=e.closest(j.unfold),n=f.b?"touchend":"mousedown",i=f.b?"touchend":"mouseup",a=!f.b&&window.innerWidth<882,o=t.getAttribute("data-name"),r=!1;o&&u.onOpen(o)(),t.classList.add(b),document.addEventListener("touchmove",_),f.a.msie_mobile?document.addEventListener(i,v,!0):document.addEventListener(n,g,!0);var s=function(){},c=function(){},l=Object(h.a)(j.popup,t);function d(){t.classList.remove(b),document.removeEventListener("touchmove",_),document.removeEventListener(n,g,!0),document.removeEventListener(i,v,!0),Object(m.c)(l).then((function(){c&&c(),s&&s()}))}function _(e){e.target.closest(j.popup)||d(),r=!0}function v(){document.addEventListener(n,g,!0)}function g(e){if(r)r=!1;else{var t=e.target.closest(j.itemDisabled);if(!t){var n=e.target.closest(j.item+"[href]");if(n){if(f.a.safari&&f.a.safari_mobile&&f.a.version<9)setTimeout(d,500);else{Object(p.j)(e);var i=Object(p.v)(n,"prevent-navigation");if(i||nav.onBeforeGo((function(){d()})),n.classList.contains(k))S(n.closest(j.unfold),Object(p.v)(n,"name"));i?d():nav.go(n)}return}if(n=e.target.closest(j.item+"[onclick]")||e.target.closest(j.item+"[onmousedown]"))return void setTimeout(d);if(n=e.target.closest("label"+j.item))return void(f.a.safari&&f.a.safari_mobile&&f.a.version<9?setTimeout(d,500):setTimeout(d));if(n=e.target.closest("input[onchange]"))return void(f.a.safari&&f.a.safari_mobile&&f.a.version<9?setTimeout(d,500):setTimeout(d))}(f.b||a||t)&&(e.preventDefault(),e.stopImmediatePropagation()),(a||!f.b&&t)&&document.addEventListener("click",A,!0),t||d()}}function A(e){e.preventDefault(),e.stopImmediatePropagation(),document.removeEventListener("click",A,!0)}l&&Object(m.c)(l).then((function(){(c=Object(m.a)(e)).exitIntent=function(){return!1},(s=Object(m.e)(l))&&(s.exitIntent=function(){return d(),!1})}))}t.a=u;window.Unfold=u},h8oe:function(e,t,n){"use strict";n.d(t,"b",(function(){return E})),n.d(t,"a",(function(){return T}));var i=n("Fkq0"),a=n("z9Td"),o=n("tGJf"),r=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e};function s(e,t,n,a){var s=window.MarketAnalyticsManager&&window.MarketAnalyticsManager.getHash();if(s){var l=n.slice(0,10),u=0,d=o.a.getItem("market_event_count");d&&(u=parseInt(d)),u>=20&&(c(e),u=0);var _=Date.now(),p="market_event_item_"+Math.floor(1e5*Math.random())+"_"+_+"_"+t;l.unshift(_),l.unshift(t),l.push(s),o.a.setItem(p,JSON.stringify(l)),o.a.setItem("market_event_count",String(++u)),a&&c(e),i.d.apply(void 0,r(["debug","event",t],n))}else Object(i.d)("warn","events","Hash error")}function c(e){for(var t=[],n=0;n<o.a.length();++n){var r=o.a.key(n);r&&0===r.lastIndexOf("market_event_item_")&&t.push(r)}if(!(t.length<=0)){o.a.setItem("market_event_count",String(0));var s=[],c="";t.forEach((function(e){var t=o.a.getItem(e);if(o.a.removeItem(e),t)try{var n=JSON.parse(t);c?n.pop():c=n.pop(),s.push(Object.values(n))}catch(e){Object(i.d)("error","event error","Unable to assemble events pack",e)}})),!c||s.length<1||(!window.MarketAnalyticsManager||window.MarketAnalyticsManager.isEnabled()?window.ajax.post(e===a.a?"market.php":"al_market.php",{act:"log_events",hash:c,events:s},{onDone:function(){Object(i.d)("warn","events sent",s.length+" events sent")}}):Object(i.d)("error","event error","analytics disabled"))}}var l=function(){function e(){}return e.prototype.connectMutator=function(t){if(this.mutationObserver)throw new Error("{Observer #"+t.getObserverId()+"} MutationObserver already connected to observer");var n=document.querySelector(t.getContainerQuery());n instanceof HTMLElement&&(this.mutationObserver=new MutationObserver((function(n){n.forEach((function(n){if(n.addedNodes)for(var i=0;i<n.addedNodes.length;i++){var a=n.addedNodes[i];if(a instanceof HTMLElement){var o=e.resolveNodes(a,t).filter((function(e){return!!e}));o&&(o.forEach((function(e){t.add(e)})),t.scan())}}}))})),this.mutationObserver.observe(n,{childList:!0,subtree:!0,attributes:!1,characterData:!1}))},e.prototype.disconnectMutator=function(e){e.isRunning()&&this.mutationObserver&&this.mutationObserver.disconnect()},e.resolveNodes=function(e,t){var n=[];if(t.getSelectorQuery(!1).split(",").forEach((function(t){if(e.matches(t))return n.push(e),!1})),n.length<1){var i=e.querySelectorAll(t.getSelectorQuery(!1));n=Array.from(i)}return n},e}(),u=n("BJj/"),d={};function _(){for(var e in d){if(d[e])d[e].stop()}}var p=n("+ggo"),h=function(){return(h=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},f=function(){function e(e,t,n,i,a,o){var r;if(void 0===n&&(n=""),void 0===i&&(i=!1),void 0===a&&(a=""),this.observerId=e,this.itemSelector=t,this.container=n,this.isUnifyNodes=i,this.platform=a,this.getExtraItemParams=o,this.trackingItems={},this._debounceTimeout=20,this.uniqueNodeCounter=0,this.nodes=[],this.isWatching=!1,this.mutatorList=[],(r=this).getObserverId()in d&&(d[r.getObserverId()].stop(),delete d[r.getObserverId()]),d[r.getObserverId()]=r,!this.itemSelector.types&&!this.itemSelector.selectors)throw new Error("Empty itemSelector definition");this.container||(this.container=this.observerId)}return Object.defineProperty(e.prototype,"debounceTimeout",{set:function(e){this._debounceTimeout=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"itemReachedCallback",{set:function(e){this._itemReachedCallback=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"preCheckReachedCallback",{set:function(e){this._preCheckReachedCallback=e},enumerable:!1,configurable:!0}),e.prototype.getObserverId=function(){return this.observerId},e.prototype.getItemSelector=function(){return this.itemSelector},e.prototype.getPlatform=function(){return this.platform},e.prototype.add=function(e){this.nodes.push(e)},e.prototype.getTrackingItems=function(){return this.trackingItems},e.prototype.addMutators=function(e){this.mutatorList=this.mutatorList.concat(e)},e.prototype.isRunning=function(){return this.isWatching},e.prototype.watch=function(){this.isWatching||(this.update(),this.startObserving(),this.connectMutators(),this.isWatching=!0)},e.prototype.stop=function(){this.isWatching&&(this.trackUntracked(),this.stopObserving(),this.disconnectMutators(),this.isWatching=!1)},e.prototype.scan=function(){this.viewportScanner()},e.prototype.trackUntracked=function(){var e=this.getTrackingItems();for(var t in e)if(e[t]){var n=e[t];!n.isTracked&&n.isReached&&(this.track(n),this.persist(n))}},e.prototype.connectMutators=function(){var e=this;this.mutatorList.forEach((function(t){t.connectMutator(e)}))},e.prototype.disconnectMutators=function(){var e=this;this.mutatorList.forEach((function(t){t.disconnectMutator(e)}))},e.prototype.getContainerQuery=function(){var e=this.container.substr(0,1);return"#"===e||"."===e?this.container:'[data-stat-container="'+(this.container?this.container:this.observerId)+'"]'},e.prototype.getSelectorQuery=function(e){void 0===e&&(e=!0);var t=this.getContainerQuery(),n=[];return this.itemSelector.selectors?n=this.itemSelector.selectors.split(",").map((function(n){return e?t+" "+n:n})):this.itemSelector.types&&(n=this.itemSelector.types.split(",").map((function(n){return e?t+' [data-stat-item^="'+n+'|"]':'[data-stat-item^="'+n+'|"]'}))),n.join(",")},e.prototype.update=function(){var e=document.querySelectorAll(this.getSelectorQuery());this.nodes=Array.from(e)},e.parseStatAttribute=function(e){var t=e.getAttribute("data-stat-item"),n=null==t?void 0:t.split("|");return n?{type:n[0],ownerId:parseInt(n[1]),itemId:n[2]}:{type:"",ownerId:0,itemId:0}},e.prototype.getNodeKey=function(e,t){var n=String(t.itemId);this.isUnifyNodes&&(this.unifyNode(e),n=n+"_"+e.getAttribute("data-stat-id"));return this.observerId+"_"+n},e.prototype.isItemReached=function(e){return!(void 0!==this._preCheckReachedCallback&&!this._preCheckReachedCallback(e))&&this.isReached(e)},e.prototype.filterItem=function(e){return!e.isTracked&&!e.isReached&&(this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.persist(e),!0))},e.prototype.track=function(e){e.isTracked||(e.viewEnd=Date.now(),e.duration=e.viewEnd-e.viewStart,this._itemReachedCallback(e),e.isReached=!1,e.isTracked=!0)},e.prototype.persist=function(e){this.trackingItems[e.key]=e},e.prototype.getTrackingItem=function(t){var n=e.parseStatAttribute(t);if(!n.type||!n.itemId)return null;var i=this.getNodeKey(t,n);return i?i in this.trackingItems?this.trackingItems[i]:this.createTrackingItem(t,n):null},e.prototype.createTrackingItem=function(e,t){var n=this.getNodeKey(e,t),i=this.getExtraItemParams&&this.getExtraItemParams()||{};return this.trackingItems[n]=h(h({},i),{key:n,type:t.type,observerId:this.observerId,ownerId:t.ownerId,itemId:t.itemId,isTracked:!1,isReached:!1,viewStart:0,viewEnd:0,duration:0,node:e,viewTimer:0,data:{},platform:this.getPlatform(),city:Object(p.a)(),screen:Object(p.c)()}),this.trackingItems[n]},e.prototype.getNextUnifyId=function(){return++this.uniqueNodeCounter},e.prototype.unifyNode=function(e){e.getAttribute("data-stat-id")||e.setAttribute("data-stat-id",String(this.getNextUnifyId()))},e.prototype.startObserving=function(){var e=this;this.update(),this.viewportScanner=Object(u.a)((function(){e.nodes=e.nodes.filter((function(t){var n=e.getTrackingItem(t);return!!n&&e.filterItem(n)}))}),this._debounceTimeout),this.scrollEventListener=function(){return e.scan()},document.addEventListener("scroll",this.scrollEventListener,{passive:!0}),this.scan()},e.prototype.stopObserving=function(){document.removeEventListener("scroll",this.scrollEventListener),this.nodes=[],this.viewportScanner=function(){},this.scrollEventListener=function(){}},e}();var m,v=(m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return v(t,e),t.prototype.filterItem=function(e){return!e.isTracked&&(e.isReached&&!this.isItemReached(e.node)?(this.track(e),this.persist(e),!1):(this.isItemReached(e.node)&&this.view(e),this.persist(e),!0))},t.prototype.view=function(e){var t=this;e.isTracked||(e.isReached=!0,e.viewStart||(e.viewStart=Date.now()),e.viewTimer&&(clearTimeout(e.viewTimer),e.viewTimer=0),e.viewTimer=window.setTimeout((function(){var n=e.node;!t.isItemReached(n)||function(e){var t=e.viewStart;return Date.now()-t>3e4}(e)?t.track(e):t.view(e)}),3e3))},t.prototype.track=function(t){t.viewTimer&&(clearTimeout(t.viewTimer),t.viewTimer=0),e.prototype.track.call(this,t)},t}(f),b=n("ZD4m"),A=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),w=function(e){function t(n,i,a,o,r,s,c){void 0===a&&(a=""),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===s&&(s="");var u=e.call(this,n,i,a,o,s,c)||this;return u.observerId=n,u.itemSelector=i,u.container=a,u.isUnifyNodes=o,u.isDynamicNodes=r,u.gap=null,r&&u.addMutators([new l]),u.gap=t.getViewportGap(u.getPlatform()),u}return A(t,e),t.prototype.isReached=function(e){if(!Object(i.c)(e))return!1;var t,n=this.gap,a=e.closest("[data-stat-viewport]");if(a){var o=a.getBoundingClientRect();n={top:o.top,left:o.left},t={width:o.left+o.width,height:o.top+o.height}}return Object(i.b)(e,45,n,t)},t.create=function(e){return new t(e.observerId,e.itemSelector,null==e?void 0:e.container,null==e?void 0:e.isUnifyNodes,null==e?void 0:e.isDynamicContent,null==e?void 0:e.platform,null==e?void 0:e.getExtraItemParams)},t.getViewportGap=function(e){void 0===e&&(e="");var t={left:0,top:0},n="";return n=e===a.a?"#vk_head":"#page_header_wrap,#market_search_input",document.querySelectorAll(n).forEach((function(e){var n=Object(b.b)(e);t.top=t.top+n.height})),t},t}(g),y=n("RJa5"),O=[],k=!1;function j(e,t){void 0===t&&(t=0);var n=S(t);return!!n&&e.includes(n.event)}function S(e){return void 0===e&&(e=0),O.length>e?O[O.length-(1+e)]:null}function C(e){k||(window.addEventListener("beforeunload",(function(){_(),c(e)})),k=!0)}function E(e){if(function(e){var t=S();if(t){if(e===y.c.CLOSE_ITEM&&t.event===y.c.CLOSE_ITEM)return!1;if(e===y.c.TRANSITION_TO_ITEM){if(j([y.c.TRANSITION_TO_ITEM_LEFT,y.c.TRANSITION_TO_ITEM_RIGHT]))return!1;if(j([y.c.SWITCH_ITEM_VARIANT_1,y.c.SWITCH_ITEM_VARIANT_2]))return!1}}return!0}(e.event))if(e.event||e.table){e.table||(Object.values(y.c).includes(e.event)?e.table=y.b.GOODS:Object.values(y.d).includes(e.event)?e.table=y.b.ORDERS:Object(i.d)("error","table not specified")),e.screen=e.screen?e.screen:window.MarketAnalyticsManager&&window.MarketAnalyticsManager.getScreen(),e.platform=e.platform?e.platform:"web",e.itemType=e.itemType?e.itemType:"",C(e.platform);var t=String(e.event),n=e.table+":"+t;e.instant?function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];s(e,t,n,!0)}(e.platform,n,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration,e.itemType):function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];s(e,t,n,!1)}(e.platform,n,e.ownerId,e.itemId,e.screen,e.albumId,e.time,e.duration,e.itemType),O.push(e),O.length>3&&O.shift()}else Object(i.d)("error","event and table not specified",e)}function T(e,t){var n;switch(void 0===t&&(t=""),C(t),c(t),_(),Object(i.d)("warn","analytics: start tracking area",e),e){case y.a.MARKET:n=function(e){var t=0;void 0!==window.cur.aid&&(t=window.cur.aid),E({event:"market_item"===e.type?y.c.VIEW_ITEM:y.c.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,albumId:"market_item"===e.type?t:e.itemId,duration:e.duration,time:e.viewStart,platform:e.platform})};var o=w.create({observerId:"market_products",itemSelector:{types:"market_item"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});o.itemReachedCallback=n;var r=w.create({observerId:"market_albums",itemSelector:{types:"market_album"},isUnifyNodes:!0,isDynamicContent:!1,platform:t});r.itemReachedCallback=n,t!==a.a&&(r.preCheckReachedCallback=function(e){var t,n=e.offsetTop,i=null===(t=e.parentNode)||void 0===t?void 0:t.parentNode;return i&&n<i.offsetHeight}),o.watch(),r.watch();break;case y.a.GROUP:n=function(e){E({event:"market_item"===e.type?y.c.VIEW_ITEM:y.c.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,albumId:"market_item"===e.type?0:e.itemId,duration:e.duration,time:e.viewStart,platform:e.platform})};var s=w.create({observerId:"market_module",itemSelector:{types:"market_item"},isUnifyNodes:!0,platform:t});s.itemReachedCallback=n;var l=w.create({observerId:"group_wall",itemSelector:{types:"market_item,market_album"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});l.itemReachedCallback=n,s.watch(),l.watch();break;case y.a.USER_PROFILE:var u=w.create({observerId:"user_wall",itemSelector:{types:"market_item,market_album"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});u.itemReachedCallback=function(e){E({event:"market_item"===e.type?y.c.VIEW_ITEM:y.c.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,duration:e.duration,time:e.viewStart,albumId:"market_item"===e.type?0:e.itemId,platform:e.platform})},u.watch();break;case y.a.BOOKMARKS:var d=w.create({observerId:"bookmarks",itemSelector:{types:"market_item"},isUnifyNodes:!0,isDynamicContent:!0,platform:t});d.itemReachedCallback=function(e){E({table:y.b.GOODS,event:y.c.VIEW_ITEM,ownerId:e.ownerId,itemId:e.itemId,duration:e.duration,time:e.viewStart,albumId:0,platform:e.platform})},d.watch();break;case y.a.FEED:var p=w.create({observerId:"feed",itemSelector:{types:"market_item"},isUnifyNodes:!0,isDynamicContent:!0,container:".feed_wrap",platform:t});p.itemReachedCallback=function(e){E({event:"market_item"===e.type?y.c.VIEW_ITEM:y.c.VIEW_ALBUM,ownerId:e.ownerId,itemId:"market_item"===e.type?e.itemId:0,duration:e.duration,time:e.viewStart,albumId:"market_item"===e.type?0:e.itemId,platform:e.platform})},p.watch()}}},hG3N:function(e,t,n){"use strict";var i=n("pRml");t.a=i.a},he4e:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return f})),n.d(t,"b",(function(){return d}));var i=n("OcsD"),a=n("+cqQ"),o=n("UxAg"),r=n("r/ag"),s=n("29dZ"),c=n("zouF"),l=Object(a.a)(),u={};function d(e){var t=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(e)[2];return!!u[t]||!!u[e]}nav.onBeforeGo((function(){Object(o.b)(".Confirm[id^=restr]").forEach((function(e){f(e.id)}))}));var _={};function p(e,t,n,a,o,r){if(t&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),r){e&&s.a.setLoading(e,!0,"white");var l="restr_"+Object(i.mc)();if(e){var u=e.closest(".PostPhotoRestriction");Object(i.v)(u,"clear-id",l)}return function(e,t,n,i,a){window.photoview._toggleTouches(!1),window.clog("[PostPhotoRestriction] Show confirm to unblur "+i),Object(c.a)(t,"PostPhotoRestriction.onClearConfirm('"+e+"', '"+i+"', '"+a+"')","PostPhotoRestriction.onClearDecline('"+e+"')",{id:e,ok_text:n})}(l,n,a,o,r),new Promise((function(e,t){_[l]={resolve:e,reject:t}}))}window.clog("[PostPhotoRestriction] No hash was provided")}function h(e,t,n){r.a.close(Object(i.M)(e)),window.photoview._toggleTouches(!0),window.ajax.post(t+"?act=unblur&hash="+n,{},{onDone:function(n){_[e]&&(_[e].resolve({result:!0,isFullyAvailable:n}),delete _[e]);var a=Object(o.a)('[data-clear-id="'+e+'"]');if(a){var r=Object(o.a)(".SplashScreen__more .Btn",a);s.a.setLoading(r,!1),a.classList.add("PostPhotoRestriction--clear")}else window.clog("[PostPhotoRestriction] Can't find restriction el with clear id "+e);var c=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(t),d=c[2],p=c[3],h=[];n?(h.push.apply(h,Object(o.b)('.thumb_map_img--blur[data-id^="'+d+'"]')),h.push.apply(h,Object(o.b)('.thumb_map_img--blur[href^="/photo'+d+'"]'))):(h.push(Object(o.a)('.thumb_map_img--blur[data-id="'+d+"_"+p+'"]')),h.push(Object(o.a)('.thumb_map_img--blur[href^="/photo'+d+"_"+p+'"]'))),h.forEach((function(e){if(e){e.classList.remove("thumb_map_img--blur");var t=Object(o.a)(".PostPhotoRestriction--blur,.PostPhotoRestriction--blurWithText",e);Object(i.Vb)(t)}})),n&&(u[""+d]=!0),u[t]=!0,l(t);var f=[];n?f.push.apply(f,Object(o.b)('.PhotosPhotoItem__photo[data-id^="'+d+'"]')):f.push(Object(o.a)('.PhotosPhotoItem__photo[data-id="'+t.replace("photo","")+'"]')),f.forEach((function(e){if(e){e.classList.remove("PhotosPhotoItem__photo--blur");var t=Object(o.a)(".PhotosPhotoItem__restriction",e);Object(i.Vb)(t)}}));var m=[];n?m.push.apply(m,Object(o.b)('.AlbumItem__thumb--blur[data-thumb-id^="'+d+'"]')):m.push(Object(o.a)('.AlbumItem__thumb--blur[data-thumb-id="'+t.replace("photo","")+'"]')),m.forEach((function(e){if(e){e.classList.remove("AlbumItem__thumb--blur");var t=Object(o.a)(".AlbumItem__restriction",e);Object(i.Vb)(t)}})),setTimeout((function(){Object(i.Xb)(a)}),500)}})}function f(e){var t=Object(o.a)('[data-clear-id="'+e+'"]'),n=t&&Object(o.a)(".SplashScreen__more .Btn",t);_[e]&&(_[e].resolve({result:!1}),delete _[e]),window.photoview._toggleTouches(!0),r.a.close(Object(i.M)(e)),n&&s.a.setLoading(n,!1)}},hw56:function(e,t,n){"use strict";n.d(t,"f",(function(){return c})),n.d(t,"g",(function(){return l})),n.d(t,"v",(function(){return u})),n.d(t,"c",(function(){return _})),n.d(t,"y",(function(){return p})),n.d(t,"n",(function(){return h})),n.d(t,"j",(function(){return f})),n.d(t,"h",(function(){return m})),n.d(t,"w",(function(){return v})),n.d(t,"l",(function(){return g})),n.d(t,"k",(function(){return b})),n.d(t,"x",(function(){return A})),n.d(t,"q",(function(){return w})),n.d(t,"e",(function(){return y})),n.d(t,"s",(function(){return k})),n.d(t,"p",(function(){return j})),n.d(t,"a",(function(){return S})),n.d(t,"b",(function(){return C})),n.d(t,"i",(function(){return E})),n.d(t,"r",(function(){return T})),n.d(t,"o",(function(){return I})),n.d(t,"d",(function(){return M})),n.d(t,"m",(function(){return P})),n.d(t,"u",(function(){return x})),n.d(t,"t",(function(){return L}));var i=n("wx14"),a=(n("2IoG"),n("qHA9")),o=n("29dZ"),r=n("jE6c"),s=n("OcsD");function c(e){var t=store.mail.cur.keyboards,n=t[e];return n||(n=t[e]={}),n}function l(){return store.mail.cur&&store.mail.cur.keyboardType||""}function u(e){store.mail.cur&&(store.mail.cur.keyboardType=e)}var d={};function _(e,t){void 0===t&&(t=!1),store.mail.cur.pressedButtons&&(t?delete store.mail.cur.pressedButtons.msgs[t]:delete store.mail.cur.pressedButtons.peers[e])}function p(e){var t=d[e];if(t){var n,i=t.peerId,a=t.msgId,r=t.position,s=t.button,c=t.inline;if(c?store.mail.cur.pressedButtons.msgs[a]&&delete store.mail.cur.pressedButtons.msgs[a][r.join(",")]:store.mail.cur.pressedButtons.peers[i]&&delete store.mail.cur.pressedButtons.peers[i][r.join(",")],delete d[e],!bodyNode.contains(s))(n=c?$(".msg_id_"+a+" .BotsKeyboard__main"):$(".uMailWrite__keyboard .BotsKeyboard__main"))&&(s=$('.BotsKeyboard__button[data-position="'+r.join(",")+'"]',n));s&&o.a.setLoading(s,!1)}}function h(e,t,n,i,a){var c=(Object(s.v)(t,"position")||"").split(",");if(!c)return o.a.setLoading(t,!1),clog("Can't find button position for callback event"),!1;if(d[n]={time:Object(r.y)(),peerId:e,msgId:i,button:t,position:c,inline:!!i},store.mail.cur.pressedButtons||(store.mail.cur.pressedButtons={peers:{},msgs:{}}),c[0]&&c[1])if(i){var l="";a&&(l=a+"|"),store.mail.cur.pressedButtons.msgs[i]||(store.mail.cur.pressedButtons.msgs[i]={}),store.mail.cur.pressedButtons.msgs[i][l+c.join(",")]=n}else store.mail.cur.pressedButtons.peers[e]||(store.mail.cur.pressedButtons.peers[e]={}),store.mail.cur.pressedButtons.peers[e][c.join(",")]=n;setTimeout((function(){p(n)}),6e4)}function f(e){var t=store.mail.cur.drafts;return t||(t=lsGet("mail_drafts_"+e),t=store.mail.cur.drafts=t||{}),t}function m(e,t){var n=f(e);return n[t]||(n[t]={})}function v(e,t,n,a){var o=store.mail.cur.drafts;if(o||(o=store.mail.cur.drafts=o||{}),a){var r=o[t],s=r&&r.editing&&r.editing.id===a?r.editing:void 0;o[t]=Object(i.a)({},r,{editing:Object(i.a)({},s,{},n,{id:a})})}else o[t]=Object(i.a)({},o[t],{},n,{editing:void 0});lsSet("mail_drafts_"+e,o)}function g(e,t){var n=store.mail.peers[e];n.attachmentsStack.push(n.attachmentsHTML),n.attachmentsHTML=t}function b(e){var t=store.mail.peers[e],n=t.attachmentsStack.pop();n||(n=Brick({mix:"cp_attached_wrap",attrs:'id="attached_wrap"'})),t.attachmentsHTML=n}function A(e,t){var n=store.mail.cur.typings[e];if(n||(n=store.mail.cur.typings[e]={}),"text"!==t.type&&"audio"!==t.type||(t.count?n[t.type]=t:n[t.type]=null),n.text&&n.audio){var i=O(n.text,n.audio);n.mixed=i.count>1?i:null}else n.mixed=null}function w(e,t){var n=store.mail.cur.typings[e];if(n){var i=n.audio,a=n.text;if(i&&((i=y(i,t)).count?n.audio=i:n.audio=null),a&&((a=y(a,t)).count?n.text=a:n.text=null),n.text&&n.audio){var o=O(n.text,n.audio);n.mixed=o.count>1?o:null}else n.mixed=null}}function y(e,t){var n=e.users.filter((function(e){return e!==t}));return n.length!==e.users.length&&(e.count=e.count-(e.users.length-n.length),e.users=n),e}function O(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return e.count+=t.count,t.users.reduce((function(e,t){return-1===e.users.indexOf(t)?e.users.push(t):e.count--,e}),e)}),{users:[],count:0,type:"mixed"})}function k(e,t){var n=store.mail,i=n.scraps.folder,a=i.indexOf(e);-1!==a&&(t?i.splice(a,1,t):i.splice(a,1)),Object.keys(n.rolls.folder).forEach((function(i){var a=n.rolls.folder[i],o=a.indexOf(e);-1!==o&&(t?a.splice(o,1,t):a.splice(o,1))})),t&&(n.rolls.peer[t]=n.rolls.peer[e],n.reached.peer.before[t]=n.reached.peer.before[e],n.reached.peer.after[t]=n.reached.peer.after[e]),e!==t&&(n.rolls.peer[e]&&n.rolls.peer[e].forEach((function(i){var a=n.msgs[i];a&&(t?(a.peerId=t,a.authorId===e&&(a.authorId=t)):delete n.msgs[i])})),delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e],delete n.members[e],delete n.peers[e])}function j(e,t){void 0===t&&(t={});var n=store.mail;if(!1!==t.lists){var i=n.scraps.folder,a=i.indexOf(e);-1!==a&&i.splice(a,1),Object.keys(n.rolls.folder).forEach((function(t){var i=n.rolls.folder[t],a=i.indexOf(e);-1!==a&&i.splice(a,1)}))}!1!==t.msgs&&n.rolls.peer[e]&&n.rolls.peer[e].forEach((function(e){n.msgs[e]&&delete n.msgs[e]})),!1!==t.lists&&(delete n.rolls.peer[e],delete n.reached.peer.before[e],delete n.reached.peer.after[e]),!1!==t.data&&(delete n.members[e],delete n.peers[e])}function S(e,t){void 0===t&&(t={});var n=store.mail;if(t.msgs){var i=t.msgs;n.rolls.peer[e]=i,n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1}else n.rolls.peer[e]||(n.rolls.peer[e]=[],n.reached.peer.before[e]=!1,n.reached.peer.after[e]=!1);var a=n.msgs[n.rolls.peer[e][0]];n.rolls.folder.all.unshift(e),n.cur.folder&&n.scraps.folder.unshift(e),a&&(a.isUnread&&n.rolls.folder.unread.unshift(e),a.isImportant&&n.rolls.folder.important.unshift(e))}function C(e){var t=store.mail.presend;t.pending[e.peerId]||(t.pending[e.peerId]=[]),t.msgs[e.sendId]=e,t.pending[e.peerId].push(e.sendId)}function E(e,t){var n=store.mail.presend;return n.pending[t]?n.msgs[e]:null}function T(e){var t=store.mail.presend;if(t.pending[e.peerId]){var n=e.sendId;delete t.msgs[n],t.pending[e.peerId]=t.pending[e.peerId].filter((function(e){return e!==n}))}}function I(e){var t=store.mail.presend;if(t.failed[e.peerId]){var n=e.sendId;delete t.msgs[n],t.failed[e.peerId]=t.failed[e.peerId].filter((function(e){return e!==n}))}}function M(){var e=store.mail.presend,t={};Object.keys(e.msgs).forEach((function(n){var i=e.msgs[n];i.pending=!1,i.failed=!0,t[i.peerId]||(t[i.peerId]=[]),t[i.peerId].push(n)}),{}),e.pending={},e.failed=t}function P(e){var t={};Object.keys(e.items).forEach((function(n){var i=e.items[n];t[n]=Object(a.o)(i.data.data,-1!==e.failed.indexOf(n))}));var n={};e.pending.forEach((function(e){var i=t[e];n[i.peerId]||(n[i.peerId]=[]),n[i.peerId].push(e)}),{});var i={};e.failed.forEach((function(e){var n=t[e];i[n.peerId]||(i[n.peerId]=[]),i[n.peerId].push(e)}),{}),store.mail.presend={msgs:t,pending:n,failed:i}}function x(e,t){var n=store.mail.cur;n&&(n.folderScroll||(n.folderScroll={}),n.folderScroll[e]=t)}function L(e){var t=store.mail.cur;if(t){t.folderScroll||(t.folderScroll={});var n=t.folderScroll[e]||0;return t.folderScroll[e]=0,n}}},i2ua:function(e,t,n){"use strict";function i(e,t){var n=t.peers&&t.peers[e];return!!n&&n.isNew}function a(e,t,n){var i=n.peers&&n.peers[e];i&&(i.isNew=t)}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}))},iS9e:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.a)(['\n    <div class="','" role="dialog" id="mail-dialog">\n      <div class="mailDialog__overlay" ','></div>\n      <div class="mailDialog__wrap">\n        <div class="mailDialog__content">\n          <div class="mailDialog__close" ',"></div>\n          ",'\n          <div class="mailDialog__body">','</div>\n          <div class="mailDialog__footer">\n            ',"\n          </div>\n        </div>\n      </div>\n    </div>\n  "]);return o=function(){return e},e}var r=function(e){var t=e.onClose||a.a.onClick("MailDialog._onDialogClose"),n=a.a.class(e.class,"mailDialog",{}),i="";e.title&&(i='<div class="mailDialog__title">'+e.title+"</div>");var r="";r=e.buttons?e.buttons:'<div class="BtnStack">\n      <div class="Btn Btn_theme_regular mailDialog__button mailDialog__confirmButton" '+e.onConfirm+">"+e.confirmText+'</div>\n      <div class="Btn Btn_theme_secondary mailDialog__button mailDialog__closeButton" '+t+">"+e.cancelText+"</div>\n    </div>";return a.a.html(o(),n,t,t,i,e.body,r)};var s,c=n("UxAg"),l=n("OcsD");function u(){var e=Object(c.a)(".messenger__dialog");s=null,e.innerHTML=""}Object.assign(r,{open:function(e){s={},"function"==typeof e.onConfirm&&(s.onConfirm=e.onConfirm,e.onConfirm="");"function"==typeof e.onClose&&(s.onClose=e.onClose,e.onClose="");var t=Object(c.a)(".messenger__dialog"),n=r(e),i=Object(l.l)(n);s.onConfirm&&(Object(c.a)(".mailDialog__confirmButton",i).onclick=function(e){return s.onConfirm(e,t)});s.onClose&&Object(c.b)(".mailDialog__overlay,.mailDialog__close,.mailDialog__closeButton",i).forEach((function(e){e.onclick=function(e){return s.onClose(e,t)}}));t.innerHTML="",t.appendChild(i)},close:u,_onDialogClose:u});t.default=r;window.MailDialog=r},iWgD:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));n("rKUZ");function i(e){var t=store.mail.cur.typings[e];return t?t.mixed||t.audio||t.text:null}function a(e){if(!e)return[];for(var t=store.mail.members,n=e.users,i=n.length,a=[],o=0;o<i;o++){var r=t[n[o]];if(r){var s=1===i?r.name:r.shortName;a.push(s)}}return a}},iwo4:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={NONE:0,ALL:1,ONE:2}},j1wj:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=0;function a(){return performance?performance.now():i?Date.now()-i:0}window.onDOMReady((function(){i=Date.now()}))},jdQ7:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s}));var i=n("jk6M"),a=n("Xrg9"),o=void 0,r=function(){return void 0!==o?o:o=!!a.a.get("reactions.debug_enabled")},s=function(){return!i.b}},"k+Df":function(e,t,n){"use strict";var i=n("z9sQ"),a=n("TYsd"),o=n("9y81"),r=n("29dZ"),s=n("tlMv");t.a=function(e){void 0===e&&(e={});var t=null;e.icon_raw?t=e.icon_raw:e.icon&&(t=Object(o.a)({class:"SplashScreen__icon",icon:e.icon,svg:e.is_svg_icon}));var n=a.a.wrap(e.more_text);"primary"!==e.more_type&&"regular"!==e.more_type&&"outlineMono"!==e.more_type||(n=Object(r.a)({inner:[e.more_text],theme:e.more_type,url:e.more_url,onClick:e.more_onclick,attrs:{ontouchend:e.more_ontouchend},use_native_onclick:e.more_native_onclick}),e.more_url=null);var c=[e.class,i.a.class("SplashScreen",e.mix||{},"_")];e.small&&c.push("SplashScreen--small");return[e.separator?Object(s.a)({hideOnDesktop:!e.separator_desktop}):null,{inner:[e.inner||[e.before,t,e.title?{inner:[a.a.wrap(e.title)],class:"SplashScreen__title",tag:"div"}:null,e.text?{inner:[a.a.wrap(e.text)],class:[e.text_class,"SplashScreen__text"],tag:"div"}:null,e.more_text?{inner:[n],class:"SplashScreen__more",href:e.more_url,tag:"a"}:null,e.action_text?{inner:[{inner:[a.a.wrap(e.action_text)],class:"SplashScreen__actionButton",href:e.action_url,tag:"a"}],class:"SplashScreen__action",tag:"div"}:null]],class:c,tag:"div"}].filter((function(e){return e}))}},k9Tg:function(e,t,n){"use strict";n.d(t,"a",(function(){return C})),n.d(t,"b",(function(){return E})),n.d(t,"d",(function(){return I})),n.d(t,"g",(function(){return k})),n.d(t,"e",(function(){return j})),n.d(t,"h",(function(){return S})),n.d(t,"f",(function(){return M})),n.d(t,"c",(function(){return P}));var i=n("MUpH"),a=n("TYsd"),o=n("bZ/P"),r=n("9y81"),s=n("gy8s"),c=n("KMpi"),l=n("Y6JH"),u=n("+sJP"),d=n("EDm3"),_=n("9b/I"),p=n("yOyn"),h=n("gZry"),f=n("zs4F"),m=n("svF/");function v(){var e=Object(i.a)(['\n    <div class="mailHat__convoDetails">\n      <div class="mailHat__convoDetailsText">',"</div>\n      ","\n    </div>\n  "]);return v=function(){return e},e}function g(){var e=Object(i.a)(["\n    ","\n      ",'\n      <div class="mailHat__convoBody">\n        <div class="mailHat__convoTitleWrapper">\n          <div class="','">',"</div>\n          ","\n          ","\n        </div>\n        ","\n      </div>\n    ","\n  "]);return g=function(){return e},e}function b(){var e=Object(i.a)(['\n    <div class="mailHat__title">\n      ',"\n    </div>\n  "]);return b=function(){return e},e}function A(){var e=Object(i.a)(['\n    <div class="mailHat__editingTitle">\n      ',"\n    </div>\n  "]);return A=function(){return e},e}function w(){var e=Object(i.a)(['\n    <div class="mailHat__desktopTitle">\n      ',"\n    </div>\n  "]);return w=function(){return e},e}function y(){var e=Object(i.a)(['\n    <div class="mailHat__forwardTitle">\n      ',"\n    </div>\n  "]);return y=function(){return e},e}function O(){var e=Object(i.a)(['\n    <div class="mailHat '," "," "," "," ",'">\n      <div class="mailHat__left">','</div>\n      <div class="mailHat__center">','</div>\n      <div class="mailHat__right">',"</div>\n    </div>\n  "]);return O=function(){return e},e}function k(e){var t=function(e,t,n,i,a){var o=window.lang;return Object(s.a)({mix:"mailHat__folder",triggerWrapperTag:"h1",items:[{name:"all",text:o.mobile_mail_tab_all,active:"all"===e,url:t.all},n?{name:"unrespond",text:o.mobile_mail_tab_unrespond,active:"unrespond"===e,url:t.unrespond}:"",{name:"unread",text:o.mobile_mail_tab_unread,active:"unread"===e,url:t.unread},{name:"important",text:o.mobile_mail_tab_important,active:"important"===e,count:i,url:t.important},a?{name:"ad_tag",text:o.mobile_mail_tab_ad_tag,active:"ad_tag"===e,url:t.adTag}:""]})}(e.folder,e.urls,e.withUnrespond,e.importantCount,e.withAdTag);return C({type:"main",left:""+a.a.html({class:"mailHat__cancelForward",inner:Object(l.a)(Object(_.a)()),onmousedown:["MailHat_main.onCancelForwardTap"]}),center:""+t+function(){var e=window.lang;return o.a.html(y(),e.mobile_mail_choose_recipient)}()+function(){var e=window.lang;return o.a.html(w(),e.mobile_mail_tab_messages)}(),right:""+a.a.html({href:e.urls.createChatUrl,class:"mailFilter__create",inner:Object(d.Db)()}),forwarding:e.forwarding})}function j(e){var t=T(),n=a.a.html({class:"mailHat__cancelEditing",inner:Object(d.cb)(),onmousedown:["MailHat_convo.onCancelEditingTap"]}),i=function(e){var t=e.isContact,n=(e.peerProfile.tagsData,o.a.class("mailHat__convo",{mobile:e.mobile})),i=o.a.class("mailHat__convoTitle",{casper:e.isCasper}),r=a.a.html(Object(c.a)({mix:"mailHat__convoAvatar",src:e.photos,size:36,mode:Object(u.q)({id:e.id,name:e.title}),backgroundTheme:e.id,text:e.title,textLength:Object(u.r)(e.id)})),s=function(e){var t=window.lang,n=e.membersCount,i="",r="";if(n>0)r=e.isChannel?langNumeric(n,t.mobile_mail_channel_N_members):langNumeric(n,t.mobile_mail_N_members);else{var s=e.onlinePlatform;r=M(e.isOnline,e.offlineText),"mobile"===s&&(i=a.a.html({class:o.a.class("mailHat__onlineIcon",{platform:"mobile",isOnline:e.isOnline}),inner:e.isOnline?Object(l.a)(Object(h.a)()):Object(l.a)(Object(f.a)())}))}return o.a.html(v(),r,i)}(e),d=e.isCasper?'<span title="'+Object(u.t)("mobile_casper_chat_title")+'" class="mailHat__convoCasperIcon">'+a.a.html(Object(l.a)(Object(p.a)()))+"</span>":"",_=e.isDonutChat?'<span title="'+Object(u.t)("mobile_donut_chat_title")+'" class="mailHat__convoCasperIcon">'+a.a.html(Object(l.a)(Object(m.a)()))+"</span>":"",b=t?'<div class="'+n+'">':'<a class="'+n+'" href="'+e.url+'">',A=t?"</div>":"</a>";return o.a.html(g(),b,r,i,e.title,d,_,s,A)}(e),r=function(){var e=window.lang;return o.a.html(A(),e.mobile_mail_message_editing)}(),s=P(e.actions),_=s;Object(u.H)()&&e.canCall&&(_=""+a.a.html({class:"mailHat__icon",inner:Object(d.Bb)(),onclick:["uMessenger.onCall"]})+s);return C({type:"convo",left:""+t+n,center:""+i+r,right:_,hasPinnedMsg:e.hasPinnedMsg,editing:e.editing})}function S(e){return C({type:"page",left:""+T(),center:"",right:"",hasPinnedMsg:!1,editing:!1})}function C(e){var t=e.forwarding?"mailHat_forwarding":"",n=e.hasPinnedMsg?"mailHat_hasPinnedMsg":"",i="mailHat_type_"+e.type,a=Object(u.D)()?"mailHat_edu":"",r=e.editing?"mailHat_editing":"";return o.a.html(O(),i,t,n,r,a,e.left,e.center,e.right)}function E(e){return o.a.html(b(),e.title)}function T(){return a.a.html({tag:"button",type:"button","aria-label":Object(u.t)("mobile_back"),class:"mailHat__back",inner:Object(l.a)(Object(_.a)()),onclick:["MailHat_convo.onBackTap"]})}function I(e){return Object(r.b)({mix:o.a.class("mailHat__icon",e.mix),icon:e.icon,attrs:e.attrs,url:e.url})}function M(e,t){var n=window.lang;return e?n.mobile_mail_online:t}function P(e){return Object(s.a)({mix:"mailHat__actions",trigger_attrs:{"aria-label":Object(u.t)("mobile_mail_actions_label")},icon_html:a.a.html(Object(d.qb)()),position:"topRight",items:e,isDisabled:0===e.length})}},kYGI:function(e,t){var n={tt:!1,handlers:[],show:function(){n.shown||(n.tt=Array.prototype.slice.call(arguments))},hide:function(){n.tt&&(n.tt=!1)},addHandler:function(e){e&&n.handlers.push(e)},removeHandler:function(e){e?each(n.handlers,(function(t){if(e===this)return n.handlers.splice(t,1),!1})):n.handlers=[]},onClose:function(){each(n.handlers,(function(){this()}))},clear:function(){n.tt&&(n.hide(),n.onClose(),n.removeHandler())},closeByTap:function(e){if(!n.tt||!e.target)return!1;var t=e.target;do{for(var i=0;i<n.tt.length;i++)if(t===n.tt[i])return!1}while(t=t.parentNode);return n.hide(),n.onClose(),!0}};window.tooltip=n},kr3z:function(e,t,n){"use strict";var i=n("wx14"),a=n("UxAg"),o=n("+cqQ"),r=n("jk6M"),s=n("jE6c"),c=n("ZMWW"),l=n("OcsD"),u=n("0ZFE"),d=n("j80l"),_=n("eGQV"),p=n("tgcV"),h=n("cGUQ"),f=n("izth"),m=n("Cbap"),v=function(e){void 0===e&&(e={});var t=["AudioPlaylistRoot",e.class].filter((function(e){return e})).join(" ");return{attrs:{"data-playlist-id":e.playlist_id},inner:e.inner,class:t}};var g=n("g3t9"),b=n("+sJP"),A=n("0hva"),w=n("z1UI"),y=n("GtpT"),O=n("vOib"),k=n("v+Uj");var j=function(e){void 0===e&&(e={});var t=window.lang,n=e.items||[],i=e.count||null,a=e.emptyIcon||null,o=e.href,r=e.header||t.mobile_photos_block_albums_title,s=n.map((function(e){return{inner:[Object(y.a)({album:e,emptyIcon:a})],class:"AlbumsBlock__album",tag:"div"}})),c={text:Object(b.t)("mobile_subheader_show_all"),class:"al_albums",url:o},l=Object(k.a)({inner:[{inner:[s],class:"AlbumsBlock__albums",tag:"div"}]});return{inner:[{name:"albums",tag:"a"},Object(O.a)({title:r,count:i,corner:c,content:l,no_border:!0,noShadow:!0})],class:"AlbumsBlock",tag:"div"}},S=n("1VZq");var C=function(e){var t=window.lang,n=e.items||[],i=e.count||null,a=e.buttons||{},o=e.href,r=e.hide_header||!1,s=e.label||t.mobile_photos_block_photos_title,c="PhotosBlock",l="PhotosBlock__photos";!!e.autoload&&(c+=" PhotosBlock--autoload",l+=" photos_page");var u={inner:[n.map((function(e){return Object(S.a)({photo:e})}))],class:l,tag:"div"},d=null;return o&&(d={text:Object(b.t)("mobile_subheader_show_all"),class:"al_empty",url:o}),{inner:[{name:"photos",tag:"a"},Object(O.a)({inner:[{inner:[a.prev,u,a.more],tag:"div"}],title:r?null:s,corner:d,count:i,noShadow:!0,no_border:!0})],class:c,tag:"div"}},E=n("tlMv");var T,I=function(e){var t=window.lang,n=e.pretag,i=e.buttons||{},a=e.is_owner,o=[],r=e.section,s=e.albums,c=e.albums_count,l=e.albums_href,u=e.photos,d=e.photos_count,_=e.new_tags_photos,p=e.new_tags_count,h=e.new_tags_href,f=e.emptyIcon||null;if("all"===r){var m=s.map((function(e){return Object(y.a)({album:e,is_owner:a,emptyIcon:f})}));m&&o.push({inner:[i.prev?i.prev:null,{inner:[m],class:"AlbumsPage__items album_items photos_page bl_cont",tag:"div"},i.more?i.more:null],tag:"div"})}else s&&s.length&&o.push(j({items:s,count:c,href:l})),_&&_.length&&o.push(C({label:t.mobile_photos_block_tags_title,items:_,count:p,href:h})),u&&u.length&&o.push(C({autoload:!0,items:u,count:d,buttons:i}));if(!o.length){var v=a?t.mobile_albums_can_store_photos:t.mobile_albums_no_albums;return Object(w.a)({separator:!0,text:v,more_type:"primary",more_text:e.add_url?t.mobile_photos_placeholder_album_action:null,more_url:e.add_url})}return{inner:["all"!==r?Object(E.a)({hideOnDesktop:!0}):null,{inner:[o],class:"upanel bl_cont",tag:"div"},n],class:"AlbumsPage PageBlock PageBlock_bottomPadding",tag:"div"}},M=n("GVTI"),P=n("W9Tc"),x=n("gF8j"),L=n("xAJ7"),R=n("uEFA"),B=n("j1wj"),N=(n("HLtZ"),n("EDm3"));if(!window.ajax){var D={onBeforeRedirect:Object(o.a)("url"),onBeforePageParse:Object(o.a)(),onPostsLoad:Object(o.a)(),onRedirect:Object(l.hc)(),onNavDone:Object(o.a)(),_tStart:!1,_tAlStart:!1,RESPONSE_ARGUMENTS:0,RESPONSE_REDIRECT:1,RESPONSE_CAPTCHA:2,RESPONSE_PAGE:3,RESPONSE_FAILED_AUTH:4,RESPONSE_CONFIRM:5,RESPONSE_IGNORE:100,_getreq:function(){return new XMLHttpRequest},_al_reqs:[],_last_req:null,save_req:function(e){D._al_reqs.push(e||D._last_req)},abort_reqs:function(){Object(l.D)(D._al_reqs,(function(e,t){t.abort()})),D._al_reqs=[]},_failed_relogin:!1,_failed_reqs:[],save_failed_req:function(e,t,n,i){D._failed_reqs.push([e,t,n,i])},repeat_reqs:function(){Object(l.D)(D._failed_reqs,(function(){var e=this.shift();D._post.apply(null,this),e&&Object(l.Xb)(e)})),D._failed_reqs=[]},_error_displayed:null,plainpost:function(e,t,n,a,o,r,s,c){var u="string"!=typeof t?Object(h.a)(t,!0):t,d={"Content-Type":"application/x-www-form-urlencoded"};r&&void 0===r.ignoreAbort&&(r.ignoreAbort=!0),o||c||(d["X-Requested-With"]="XMLHttpRequest"),c||(Object(_.a)()&&(d["X-View-Mode"]="pwa"),r&&r.headers&&Object.assign(d,r.headers));var p=new AbortController,f=p.signal,m=new Request(e,{credentials:"same-origin",method:"POST",headers:d,body:u,signal:f}),v=(new Error).stack,g={skip:!1,response:null,text:null,json:null},b=fetch(m).catch((function(e){var t=e&&"AbortError"===e.name,n=!1;if((t&&!r.ignoreAbort||a&&a(e&&e.message,null))&&(n=!0),t&&r.ignoreAbort)return null;if("true"===m.headers.get("X-Ajax-Nav")&&history.back(),!n&&(!D._error_displayed||D._error_displayed<=Date.now()-1e4)){var i=Object(l.W)("mobile_general_snackbar_error");navigator.onLine||(i=Object(l.W)("mobile_pwa_offline_network_lost")),Object(l.oc)("mvk_ajax_error_snackbar",Number(navigator.onLine)),Snackbar.init({text:i}),D._error_displayed=Date.now()}throw e.stack=v,e})).then((function(e){return null===e?Object(i.a)({},g,{skip:!0}):e.text().then((function(t){var o=null;try{o=Object(l.Pb)(t)}catch(e){}if(!(e.status>=200&&e.status<300))throw a&&a(t,e),new Error("FailedRequest");return n&&n(t,e),Object(i.a)({},g,{response:e,text:t,json:o})}))}));b.catch((function(){}));var A={request:m,abort:p.abort.bind(p),promise:b};return D._last_req=A,A},post:function(e,t,n){return"/"!=e.substr(0,1)&&(e="/"+e),e=e.split("#")[0],D._post(e,t,n||{})},onPrepared:Object(l.hc)(),prepare_click:function(e){var t=window.al;if(r.a.ios&&!(r.a.ios>=7)&&window.al&&t.ver){var n=[],i=!1;e&&"a"==(e.tagName||"").toLowerCase()?n.push(e):Object(l.ob)(e)?n=e:(n=Object(l.Q)("a",e),i=!0);for(var a=0,o=n.length;a<o;a++){var s=n[a],c=s&&s.target||"";if(s&&s.getAttribute&&(!i||!s.getAttribute("data-href")&&Object(l.m)(s,{skip_onclick:!0})&&"_blank"!=c)){var u=s.getAttribute("href");if(null==u||!Object(l.rb)(u))continue;Object(l.g)(s,"data-href",Object(l.V)(s)),Object(l.g)(s,"href",!1)}}}},click:function(e,t,n){var i=window.nav;t=t||{};var a,o=!1,r={_ajax:1},s=Object(l.K)(t,{link:e});if(n=n||{},(n=Object(l.K)({closeContextMenu:!0},n)).closeContextMenu&&ContextMenu.close(),t.onStart){var c=D.tAlGetParam();D.tAlStart=(new Date).getTime(),c&&(r._talstat=c)}if(n.use_cache){var u=Object(l.M)(!0===n.use_cache?"preload_data":n.use_cache),d=u.innerHTML.replace(/(^<!--|-->$)/g,""),_=d.split("--\x3e\x3c!--");if(d)u.innerHTML="",t.onStart&&t.onStart.apply(s),n.nav&&i.go(o,null,{push_only:!0}),t.onDone&&t.onDone.apply(s,_),(e=Object(l.O)("show_more",Object(l.O)("pcont","mcont")))&&D.click(e,{onDone:function(){var e="";Object(l.D)(arguments,(function(t,n){e+="\x3c!--"+(n||"")+"--\x3e"})),u.innerHTML=e,Object(l.M)("show_more_loading")&&D.click(!1,t,n),D.onPostsLoad()}},{closeContextMenu:!1});else t.onStart&&t.onStart.apply(s),n.nav&&i.go(o,null,{push_only:!0});return!1}if(!e)return!0;if(e.form){if(e.disabled)return!0;var p=e.form,h={};o=(p.action||"").replace(/^https?:\/\/[^\/]+/i,""),Object(l.D)(p,(function(t,n){return!(n.name&&!n.disabled)||("radio"===n.type&&!n.checked||("checkbox"===n.type&&!n.checked||("button"===n.type||("submit"===n.type&&n!==e||("image"===n.type&&n!==e||void(h[n.name]=n.value))))))})),"image"==e.type&&(h[e.name]=e.value,h[e.name+".x"]=1,h[e.name+".y"]=1),p.method&&"get"!=p.method?Object(l.K)(r,h):o=o.split("?",1).shift()+Object(l.Ib)(h)}else e.getAttribute&&(o=e.getAttribute("data-href")||e.getAttribute("href"));if(o||(o=e.pathname?e.pathname+e.search+e.hash:e),!o)return!0;Object(l.K)(r,n.url_params||{});var f=window.pStats,m=f.getSeenData();if(m){var v=window.cur;r._pstat=m.data,v&&v.module&&(r._pstatref=v.module)}return(a=D.post(o,r,{onDone:function(){m&&f.onSend(m.seen),n.lock&&Object(l.xc)(e),t.onDone&&t.onDone.apply(s,arguments),(n.nav||n.scroll)&&Object(l.fc)()},onFail:function(){n.lock&&Object(l.xc)(e),t.onFail&&t.onFail.apply(s,arguments),(n.nav||n.scroll)&&Object(l.fc)()}}))&&(t.onStart&&t.onStart.apply(s),n.nav&&i.go(o,null,{push_only:!0}),n.lock&&Object(l.Cb)(e)),!a},nav:function(e,t){var n,o=window.nav,c=window.page,_=window.menu,h=window.cur,f=window.Tabbar;(t=t||{}).nav=t.nav||{};var m,w=Object(l.V)(e),O=c.getHash(t.nav);if(!(w=o.checkUrl(w)))return!1;"/"!=w.substr(0,1)&&(w="/"+w),_.close(null,!0),D.navStart=Object(B.a)();var k=D.tGetParam();if(D.tStart=(new Date).getTime(),t.need_restore&&_&&_.closeSearch(),window.isNewMail&&(t.need_restore&&t.nav.push&&!t.need_check_updates&&D.abort_reqs(),o.onBeforeGo2(t.nav.path,Object.assign({},Object(l.Ub)(t.nav.params),t.params),t.nav.push,t)))return D.abort_reqs(),!0;if(t.need_restore&&t.nav.push&&(m=c.restore(O))&&(D.abort_reqs(),D._failed_relogin=!1,m.lm&&Object(l.K)(m.lm,{tn:!1,bn:!1}),c.set(O,m,{restored:!0},t),t.zProcess&&(t.zProcess(m.st),delete t.zProcess),o.set(t),D.tModule=window.cur.module,D.tRestoreRender=(new Date).getTime(),!t.need_check_updates))return!0;var j=!1,S=!1;if(t.need_check_updates&&o.isTabHaveCache(t.tab,O));else if(t.fast)j=!0,c.set(O,!1,{before:!0,beforeAppend:t.beforeAppend,afterAppend:t.afterAppend}),S=t.onAfterFast||!1;else if((t.alMode||(null==(n=t.target)?void 0:n.className))&&!h.ignoreFastNav){var C,E=/(?:^|\s)(al_([a-z_]+)(-?[0-9]+)?)(?:\s|$)/i.exec((null==(C=t.target)?void 0:C.className)||""),T=t.alMode||E&&E[2]||!1;switch(T){case"menu":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){var n=Object(a.a)(".vk__page");if(n.className=n.className.replace("vk__page_notifications",""),window.isNewMail){var i=Object(l.O)("mcont",e)||Object(l.O)("layout__basis");Object(l.zc)(i,'<div class="pcont bl_cont"><div id="al_loading"></div></div>')}else Object(l.zc)(Object(l.O)("mcont",e),'<div class="pcont bl_cont"><div id="al_loading"></div></div>');c.setMhead(e,Object(l.g)(t.target,"data-header"),"/")},afterAppend:function(){window.isNewMail&&"/mail"===O?Object(u.a)(Object(l.O)("layout").offsetHeight):Object(u.a)(),Object(l.gc)(0)}});break;case"tab":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){Object(l.zc)(Object(l.O)("upanel",e),'<div id="al_loading"></div>'),Object(l.zc)(Object(l.O)("basisDefault",e),'<div id="al_loading"></div>');var t=Object(l.O)("tabs_block",e)||Object(l.O)("tabs",e),n=Object(l.O)("active",t);n&&(Object(l.gb)("tab_item_top",n)?(Object(l.Yb)("tab_item_cur",Object(l.O)("tab_item_cur",t)),Object(l.a)("tab_item_cur",Object(l.O)("tab_item",t))):(Object(l.Yb)("tab_item_cur",Object(l.O)("tab_item_cur",t)),Object(l.a)("tab_item_cur",n)))},afterAppend:function(){Object(u.a)()}},t);break;case"post":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){var n=window.lang,i=Object(l.q)(Object(l.eb)("post_item",t.target)),a=Object(l.O)("pi_fronly",i),o=Object(l.O)("pi_bfronly",i),r=a&&a.getAttribute("onclick")||"",s=o&&o.getAttribute("onclick")||"",u=i.id,d=Object(l.Nb)(Object(l.fb)("a",Object(l.O)("pi_img",i))).replace("pi_img","op_img"),_=Object(l.fb)("div",Object(l.O)("pi_author",i)),p=Object(l.Xb)(Object(l.O)("pi_date",i)),h=Object(l.Nb)(Object(l.Xb)(Object(l.O)("explain",_))),f=Object(l.Xb)(a),m=Object(l.Xb)(o),v=Object(l.Nb)(_),g=Object(l.O)("pi_body",i),b=Object(l.O)("pi_text_more",g),A=(p=Object(l.O)("pi_date",i),Object(l.O)("pi_info",g)),w=Object(l.O)("pi_links",g),y=Object(l.O)("replies_link",w),O=Object(l.zc)(Object(l.Xb)(Object(l.O)("pi_actions_wrap",i))),k=Object(l.zc)(Object(l.Xb)(null==A.querySelector?void 0:A.querySelector(".item_replies, ._item_replies")))?Object(l.zc)(y):n.mobile_wall_post_replies_title,j=y?'<a name="comments"></a><h3 class="slim_header">'+(k||"")+'</h3><div id="al_loading"></div>':"";if(b){var S=b.nextSibling?b:b.parentNode;S.nextSibling.style.display="inline",S.style.display="none"}Object(l.zc)(w,Object(l.Nb)(Object(l.O)("like_wrap",g))),p&&Object(l.g)(p,"data-date")&&Object(l.zc)(p,Object(l.g)(p,"data-date")),c.setMhead(e,Object(l.g)(t.target,"data-header"),!0);var C=f?'<div class="pi_fronly" onclick="'+r+'">'+Object(N.c)()+"</div>":m?'<div class="pi_bfronly" onclick="'+s+'">'+Object(N.c)()+"</div>":"";Object(l.zc)(Object(l.O)("mcont",e),function(e,t,n,i,a,o,r,s){return'<div class="pcont bl_cont"><div class="owner_panel">'+(t||"")+'<div class="op_cont">'+(n||"")+'<div class="op_info"><span class="item_date">'+(i||"")+'</span></div></div></div><div id="'+(e||"")+'" class="post_item single_post_item"><div class="pi_cont"><div class="pi_head">'+(a||"")+'</div><div class="pi_body">'+(o||"")+"</div></div>"+(s||"")+"</div>"+(r||"")+"</div>"}(u,d,v,Object(l.zc)(p)+C,h,Object(l.zc)(g),j,O))},afterAppend:function(e){var n=Object(l.R)("h3",e);n&&Object(u.a)(t.nav.hash?Object(l.S)()-n.offsetHeight:0),t.nav.hash?Object(l.fc)(t.nav.hash):Object(l.gc)(0)}},t);break;case"wall":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){var n;var i=window.lang,a=Object(l.q)(Object(l.gb)("wall_item",t.target)?t.target:null==(n=t.target)||null==n.closest?void 0:n.closest(".wall_item"))||void 0,o=null==a||null==a.querySelector?void 0:a.querySelector(".wi_buttons, ._wi_buttons"),r=Object(l.Xb)(null==o||null==o.querySelector?void 0:o.querySelector(".item_replies, ._item_replies"))||void 0,s=Number(Object(l.qc)((null==r?void 0:r.getAttribute("data-replies-count"))||"").replace(/\D/g,"")),u=null==a?void 0:a.id,d=Object(l.O)("wi_body",a),_=Object(l.O)("item_like",o),p=Object(l.O)("v_like",_),h=Object(l.O)("item_share",o),f=Object(l.O)("v_share",h),m=Object(l.O)("pi_text_more",d),v=Object(l.O)("wi_date",a),b=s?Object(l.yb)(s,i.mobile_wall_post_comments):i.mobile_wall_post_replies_title,A=r&&s<50?'<a name="comments"></a><h3 class="slim_header">'+(b||"")+'</h3><div id="al_loading"></div>':"";if(clog("item_replies",r),Object(l.Xb)(Object(l.O)("wi_actions_btn",a)),Object(l.Xb)(Object(l.O)("post__subscribeBtn",a)),Object(l.Xb)(Object(l.O)("post__extraHeader",a)),p?Object(l.zc)(p):Object(l.f)(Object(l.k)("span",{className:"v_like"}),_),f?Object(l.zc)(f):Object(l.f)(Object(l.k)("span",{className:"v_share"}),h),m){var w=m.nextSibling?m:m.parentNode;w.nextSibling.style.display="inline",w.style.display="none"}v&&Object(l.g)(v,"data-date")&&Object(l.zc)(v,Object(l.g)(v,"data-date")),c.setMhead(e,Object(l.g)(t.target,"data-header"),!0);var y=Wd.html(Object(g.a)({hideOnDesktop:!0}));Object(l.zc)(Object(l.O)("mcont",e),function(e,t,n,i){return'<div class="pcont"><div class="PageBlock">'+e+'<div class="wall_item single_wall_item" id="'+(t||"")+'">'+(n||"")+"</div>"+(i||"")+"</div></div>"}(y,u,Object(l.zc)(a),A)),Object(l.a)("vk__page_singlePost",document.body)},afterAppend:function(e){var n=Object(l.R)("h3",e);n&&Object(u.a)(t.nav.hash?Object(l.S)()-n.offsetHeight:0),t.nav.hash?Object(l.fc)(t.nav.hash):Object(l.gc)(0)}},t);break;case"pinfo":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){var t=window.lang,n=Object(l.O)("owner_panel",e),i=Object(l.O)("pp_img",n),a=Object(l.O)("op_header",n),o=Object(l.O)("lvi",a),r=Object(l.O)("pp_last_activity",n),s=Object(l.k)("div");Object(l.a)("mhi_back",Object(l.O)("mh_header",e)),Object(l.zc)(n,'<img src="'+Object(l.G)(Object(l.g)(i,"src")||"")+'" class="op_img"><div class="op_cont"><h2 class="op_header">'+Object(l.qc)(Object(l.zc)(a))+'</h2><div class="pp_online">'+(o?t.mobile_online:Object(l.zc)(r))+"</div></div>"),Object(l.zc)(Object(l.O)("ipanel",e),"<div>"+Object(l.zc)(s)+'</div><div id="al_loading"></div>'),c.setMhead(e,!1,!0)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0,10)}},t);break;case"player":j=!0;var x=Object(l.Ub)(t.nav.params).playlist_id;c.set(O,!1,{before:!0,beforeAppend:function(e){var t=window,n=t.lang,i=t.audio,a=(i.playlist(),i.playlist_q());c.setMhead(e,n.mobile_menu_player_head_title,!0),Object(l.zc)(Object(l.O)("mcont",e),'\n                <div class="pcont audioPage">\n                  <div class="PageBlock">\n                    <div class="audioPage__header">\n                      '+AudioPlaylist.tplPlayerSearch(x)+'\n                    </div>\n                    <div id="au_search_items" class="upanel bl_cont">\n                      <div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(a)+'"></div>\n                    </div>\n                  </div>\n                </div>'),Object(l.zc)("m",e.innerHTML)}},t),S=function(){var e=window,n=e.qsearch,i=e.audio,a=i.playlist(),o="/audio"+Object(l.Ib)({act:"player",list:x}),s=[],d={},_=i.getCurrentId();Object(l.D)(a,(function(e,t){t.chartInfo=null,s.push(t.fullId),d[t.fullId]=[t.performer+" "+t.title,t]}));var p=s.indexOf(_),h=p>-1?Math.min(p+10,s.length):50,f=[];n.init({action:o,al_action:o,container:"au_search_items",field:Object(l.M)("au_search_field"),btn:Object(l.M)("au_search_btn"),top_items:s,_cache:d,forceRerender:!0,tpl:function(e,t,n,a){var o="";if(t){if(a)return a;o=""==a?'<div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(t)+'">'+e+"</div>":'<div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(t)+'"><div class="al_loading qs_loading">&nbsp;</div></div>'}else o='<div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(i.playlist_q())+'">'+e+"</div>";return Wd.html(v({playlist_id:x,inner:Wd.wrap(o)}))},item_tpl:function(e){var t=window.audioplayer;return f.push(e),t&&t.getDOMFromAudio(e,!0,this.q,!0)||""},null_tpl:function(e){var t=window.lang;return'<div class="service_msg_box">\n                  <div class="service_msg service_msg_null">\n                  '+(e?t.mobile_audio_search_not_found.replace("%s",Object(l.ib)(e)):t.mobile_audio_no_audio)+"\n                  </div>\n                </div>"},soft_filter:!0,need_invalid_keys:r.a.desktop,top_len:h,global_search:!0,onRendered:function(){var e=window,t=e.audioplayer,n=e.audio;t&&t.initAudio(),n.addToPlaylist(f),Object(u.a)()},al_need:!0,init_offset:0});var m=window.audioplayer.getCurrentElem();if(m){var g=Object(l.db)(m)+m.offsetHeight/2-Object(l.S)()/2;Object(l.gc)(g,100),c.save(O,{html:null,st:Object(l.gc)(),page:Object(l.M)("m"),state:c.stash(),cur:window.cur,options:t||{}},!1)}};break;case"photo":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var t=Wd.html(Object(M.b)({is_loading:!0}));Object(l.zc)(Object(l.O)("mcont",e),t),Object(u.a)(),c.setMhead(e,lang.mobile_photos_photo_title)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}},t);break;case"album":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){var n;f.drawLoader(e);var o,r=t.target.href,s=/((?:album|tag)(-?\d+)(?:(?:_(\d+))?))/.exec(r);s&&(o=s[1]);var _=o&&Object(b.y)(o)||{},p=Object(a.a)(".AlbumItemInfo__title",t.target),h=!1;t.target.classList.contains("AlbumItem--empty")&&(h=!0);var m=Object(d.b)("/"+o,{act:"select_album"}),v=Object(i.a)({},_,{title:_.title||Object(l.zc)(p)||lang.mobile_page_title_album,description:Wd.wrap(_.description),is_empty:h,is_owner:s&&(null==(n=window.vk)?void 0:n.id)===+s[2],add_url:m,count:parseInt(t.target.getAttribute("data-count")||0,10)}),g=function(e){return void 0===e&&(e={}),Wd.html(Object(A.a)(Object(i.a)({},e,{title:Wd.wrap(e.title),is_loading:!e.is_empty||e.count>0})))}(v);Object(l.zc)(Object(l.O)("mcont",e),g),Object(u.a)(),c.setMhead(e,v.title,!0,!1,{movable:!0})},afterAppend:function(){Object(A.b)(),Object(u.a)(),Object(l.gc)(0)}});break;case"albums":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e);var n=t.target.closest(".AlbumsBlock"),o=[];n&&(o=Array.from(Object(a.b)(".AlbumItem",n)).map((function(e){return Object(y.b)(e).album})));var r=function(e){return void 0===e&&(e={}),Wd.html(I(Object(i.a)({},e,{section:"all"})))}({albums:o});Object(l.zc)(Object(l.O)("mcont",e),r),Object(u.a)()},afterAppend:function(){Object(A.b)(),Object(u.a)(),Object(l.gc)(0)}});break;case"u":case"g":case"p":case"e":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}},t);break;case"playlists":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}});break;case"empty":case"artist":case"playlist":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){f.drawLoader(e)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}},t);break;case"news_subsection":j=!0,c.set(O,!1,{before:!0,beforeAppend:function(e){var t=Object(l.O)("news_subsections",e);t&&!Object(l.gb)("summary_loading",t.firstChild)&&Object(l.i)(Object(l.k)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),t.firstChild)}});break;case"tabbar":j=!0,t.is_fast=!0;var L=!1,R={options:{is_fast:!0,tab:t.tab,prev_tab:t.prev_tab}};t.need_check_updates&&m&&(R=Object(l.K)(R,m),L=!0),c.set(O,R,{before:!L,beforeAppend:function(e){c.setMhead(e,Object(l.g)(t.target,"data-header"),!1),f.drawSkeletonLoader(e,t.tab),document.body.classList.contains("vk_tabbar_bottom")&&c.hideHeader(e)},afterAppend:function(){Object(u.a)()}});break;default:h=window.cur;var H=!!Object(l.O)("mhi_logo","mhead");if(j=!0,h.al_fast&&h.al_fast[T])c.set(O,!1,h.al_fast[T](t),t);else if(!H){var U={options:{is_fast:!0,tab:t.tab,removeAfterNextResponse:t.removeAfterNextResponse}};c.set(O,U,{before:!0,afterAppend:function(){Object(u.a)()}})}}}if(t.need_check_updates||D.abort_reqs(),t.local){var V=!0;c.set(O,{},{after:!0,no_scroll:!0,force:!0},!1),S&&S()}else{var F=Object(P.b)("mvk_fix_nav_params")?{}:Object(l.Ub)(t.nav.params);Object(l.K)(F,t.params||{}),window.al&&!window.al.inited?F[_.NEED_MENU_PARAM]=_.FORCE_NEED_MENU:window.al&&window.al.menu||(F[_.NEED_MENU_PARAM]=_.NEED_MENU),k&&(F._tstat=k);var W=window.pStats,q=W.getSeenData();q&&(F._pstat=q.data,h&&h.module&&(F._pstatref=h.module)),t.target&&Object(s.j)(t.target)&&(F._ref=domData(t.target,"ref")),F._ref||(F._ref=(o.path||"").substr(1));var z=w.split("#");!F._hash&&z.length>1&&(F._hash="#"+z[1]),Object(p.c)(w);var Y=Object.assign({},t.headers,{"X-Ajax-Nav":"true"});V=D.post(w,F,{onPageDone:function(e,n,i,o,r){D.fastNav=!1;var s=window.cur;if(q&&W.onSend(q.seen),D.tProcess=(new Date).getTime(),c.set(O,{title:e,html:n,js:i,lm:o,bc:r,st:t.st||0},{after:j,no_scroll:j,al_transition:!0},!j&&t),t.back){var l=Object(a.a)(".layout");c.setMhead(l,!1,t.back)}D.tModule=s.module,D.tRender=(new Date).getTime(),D.onNavDone()},redirectToLoginPage:t.redirectToLoginPage,headers:Y});D.save_req()}return j&&(t.zProcess&&(t.zProcess(),delete t.zProcess),o.set(t),D.tModule=h.module,D.tFastRender=(new Date).getTime(),D.fastNav=!0),V},confirm:function(e){function t(t,n,i,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n,i){return!!confirm(t)&&D.click(e,i,{url_params:{hash:n}})})),_post:function(e,t,n){var i=function(e,t){n.onFail&&n.onFail.call(window,0,e,t)},a=window.debuglogSent?window.debuglogSent(e):-1;return D.plainpost(e,t,(function(o,r){if(204===r.status&&r.headers.get("X-AppShell-Fallback")){var s=location.href;return history.replaceState(null,null,Object(d.b)(location.href,{__appshell_fallback:r.headers.get("X-AppShell-Fallback")})),void location.replace(s)}var c=!1;try{c=Object(l.Pb)(o)}catch(t){if(r.headers.get("Content-Type").includes("text/html")||r.getResponseHeader("Content-Type").includes("text/html"))return nav.hard_go(e,null,n);c=!1}!1===c?i():(D.parseResponse(c,e,t,n),D._debugLog(a,c.debugLog))}),i,null,{headers:n.headers,ignoreAbort:n.ignoreAbort})},_debugLog:function(e,t){window.debuglogGot&&window.debuglogGot(e,t)},parseResponse:function(e,t,n,i){var o,r=window.al,s=window.nav,u=window.menu,d=window.page,_=e.version,h=e.counters,v=e.notifications,g=e.type,b=e.statsMeta,A=t.indexOf("community")>=0,w=!1;if(g!==D.RESPONSE_IGNORE)switch(A?(w=!(!window.al||_===r.ver))&&Object(l.oc)("mvk_version_reload",1,_,r.ver,"old_force_reload_community"):window.al&&_!==r.ver?Object(P.b)("mvk_lazy_static_reload")?g===D.RESPONSE_ARGUMENTS?T||(T=new x.a({id:"mvk_static_manager",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:6e5,onIdleCb:function(){Object(l.oc)("mvk_version_reload",1,_,r.ver,"new_idle_reload"),T.stop(),location.reload()}})).start():(Object(l.oc)("mvk_version_reload",1,_,r.ver,"new_force_reload"),w=!0):(Object(l.oc)("mvk_version_reload",1,_,r.ver,"old_force_reload"),w=!0):!window.menu||e.lm_data&&e.lm_data.lm||u.isMenuHasItems()&&((w=!u.refreshCounters(h))&&Object(l.oc)("mvk_version_reload",1,_,r.ver,"old_force_reload_change_menu"),u.refreshNotifications(v)),void 0===h||!1===h||A||Object(l.ic)(h[R.b]),e.lm_data&&e.lm_data.lm&&(h&&(e.lm_data.counters=h),v&&(e.lm_data.notifications=v)),b&&window.vk&&(window.vk.statsMeta=b),g){case D.RESPONSE_ARGUMENTS:if(w)return s.hard_go(s.cur,null,{replace:!0});var y=e.data;if(o=y&&Object(l.tb)(y[0])&&y[0]._snackbar){if(Snackbar.init(o),2===o.type)return photoview.opened()?void photoview.close():Stories.opened?void Stories.close():zlayer.opened()?void zlayer.close():void(D.fastNav&&history.back());delete y[0]._snackbar}var O=Object(p.a)(e.static_files||[]);i&&i.onDone&&O.finally((function(){i.onDone.apply(window,y)}));break;case D.RESPONSE_REDIRECT:var k=e.location;D.onRedirect(!0,k);var j=e.hard,S=e.frame,C=e.clear,E=e.restore,I=e.replace;if(!S&&window.isNewMail&&D.onBeforeRedirect(k))break;if(C&&s.clear(),(o=e._snackbar)&&(Snackbar.init(o),delete e.snackbar),w||j)s.hard_go(k,null,{replace:I});else if(S){Object(f.a)();var M=k+(-1==k.indexOf("?")?"?":"&")+"__extra=1",B=Object(l.s)({src:M})}else I&&k===s.prev_cur?history.back():s.go(k,null,{ignore_cur_process:!0,need_restore:E,replace:I});break;case D.RESPONSE_CAPTCHA:var N=e.location,H=e.img,U=e.post,V=e.key;i&&i.onFail?i.onFail(g,N,{location:N,img:H,post:U,key:V}):s.hard_go(N);break;case D.RESPONSE_PAGE:var F=e.lm_data;if(d.need_hard_go=w,F&&F.rdr&&window.al&&r.menu&&Object(l.ab)("vk_wrap")>=614){s.go(F.rdr,null,{replace:!0});break}m.a.getRouter().deactivateAllRoutes(),cur.share&&"destroy"in cur.share&&cur.share.destroy(),(i=i||{}).onPageDone||(i.onPageDone=function(e,n,i,a,o){s.go(t,null,{push_only:!0}),d.set(d.getHash(s),{title:e,html:n,js:i,lm:a,bc:o})});var W=e.title,q=e.html,z=e.js,Y=e.body_class,G=e.top_bar,Q=Object(l.M)("vk_topbar");G&&!Q?(Q=Object(l.k)("div",{id:"vk_topbar",innerHTML:G}),Object(l.i)(Q,Object(a.a)(".layout"))):Object(l.zc)(Q,G),e.env&&e.env.pe&&(window.vk.pe=e.env.pe),Object(p.a)(e.static_files).then((function(){i.onPageDone(W,q,z,F,Y)}));break;case D.RESPONSE_FAILED_AUTH:if(c.a.isIntegrated)return D.save_failed_req(null,t,n,i),D._failed_relogin||D.SAKRelogin(),void(D._failed_relogin=!0);if(i.redirectToLoginPage)return window.location=e.location,!1;if(!D._failed_relogin){var K=e.location;Object(f.a)();B=Object(l.s)({src:K})}D._failed_relogin=!0,D.save_failed_req(B,t,n,i);break;case D.RESPONSE_CONFIRM:var X=e.data;X.useNavigation=!0;var $=Object(L.a)(X),J=Wd.elem($);Popup.open(J,!0);break;case D.RESPONSE_IGNORE:return}},onReLoginDone:function(){D.repeat_reqs(),D._failed_relogin=!1},SAKRelogin:function(){return c.a.reauth().then((function(e){var t=(void 0===e?{}:e).accessToken;if(t){var n={_sak_embed_at:t};return D.post("/login?act=sak_relogin",n,{onDone:function(){D.onReLoginDone()},onFail:function(){}}).promise}}))},tGetParam:function(){if(D.tStart&&D.tModule){var e=D.tFastRender-D.tStart,t=D.tRestoreRender-D.tStart,n=D.tProcess-D.tStart,i=D.tRender-D.tProcess,a=["/"==D.tModule.substr(0,1)?D.tModule.substr(1):D.tModule,e,t,n,i];for(var o in a)(!a[o]||a[o]<0)&&(a[o]=0);return D.tStart=!1,a.join(",")}},tAlGetParam:function(){if(D.tAlStart&&D.tAlModule){var e=D.tAlProcess-D.tAlStart,t=D.tAlRender-D.tAlProcess,n=["al_"+("/"==D.tAlModule.substr(0,1)?D.tAlModule.substr(1):D.tAlModule),e,t];for(var i in n)(!n[i]||n[i]<0)&&(n[i]=0);return D.tAlStart=!1,n.join(",")}},refreshLinks:function(e,t){if(e){var n=Object(l.O)("mmi_fv","lm_cont"),i=n&&Object(l.O)("lfm_item",n),a=Object(l.O)("mmi_fv","mfoot"),o=a&&Object(l.O)("lfm_item",a),r=Object(l.M)("fv_link"),s=Object(l.M)("menu_fv_link"),c=Object(l.P)('link[rel="canonical"]');Object(l.g)(i,"href",e),Object(l.g)(o,"href",e),Object(l.g)(r,"href",e),Object(l.g)(c,"href",Object(l.g)(Object(l.M)("mcont"),"data-canonical")),window.nav.prev_fv_link&&Object(l.g)(s,"href",window.nav.prev_fv_link),window.nav.fv_link=e}if(t){var u=Object(l.O)("mmi_app","lm_cont"),d=u&&Object(l.O)("lfm_item",u),_=Object(l.O)("mmi_app","mfoot"),p=_&&Object(l.O)("lfm_item",_),h=Object(l.M)("app_link"),f=!!t&&"return nav.app_go(this, event, '"+Object(l.I)(t)+"');";Object(l.g)(d,"onclick",f),Object(l.g)(p,"onclick",f),Object(l.g)(h,"onclick",f)}}};window.ajax=D}t.a=window.ajax},l51W:function(e,t){var n=function(){function e(e){var t=e.closest(".si_body");return{buttons:$(".si_links",t),message:$(".si_msg",t)}}return{sendRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href");ActionMenu.closeMenu();var a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){!function(e){hide(e.buttons),show(e.message)}(a),val(a.message,e)}})},cancelRequest:function(t,n){t&&t.preventDefault();var i=n.getAttribute("href"),a=e(n);ajax.post(i,{_ajax:1},{onDone:function(e){}}),function(e){hide(e.message),show(e.buttons)}(a)}}}();window.GroupsInvite=n},lPa4:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("OcsD"),a=n("Fkq0"),o=n("h8oe"),r=n("z9Td"),s=n("RJa5"),c={onDone:function(e,t,n,c){var l=Object(i.M)(e)||Object(i.O)("like_box","z")||Object(i.O)("like_box")||Object(i.O)("wall_item_for_like_"+e);if(l&&e){var u,d,_=Object(i.O)("item_repost",l);if(Object(i.gb)("wall_item",l)||l.parentNode.classList.contains("MarketItem")||l.parentNode.classList.contains("PhotoviewPage")||l.parentNode.classList.contains("VideoPage")?d=Object(i.O)("wi_like_wrap",l)||(null==l.querySelector?void 0:l.querySelector("._wi_likes_bar_wrap")):Object(i.gb)("ReplyItem",l)?u=Object(i.O)("ReplyItem__likeWrap",l):d=Object(i.O)("item_like",l),u||(u=null==l.querySelector?void 0:l.querySelector(".like_wrap, ._post_bottom_like_wrap")),d&&(d.innerHTML=t||"",Object(i.vc)("is_empty",d,!t),Object(i.uc)(d,t)),_&&(_.innerHTML=n||"",Object(i.uc)(_,n)),u){var p=Object(i.l)(c);p.classList.contains("like_wrap")||p.classList.contains("_post_bottom_like_wrap")?Object(i.ac)(p,u):Object(i.zc)(u,c||"");var h=Object(a.e)(e);if(h){var f=u.querySelector(".item_like");f&&Object(o.b)({event:f.classList.contains("item_sel")?s.c.LIKE_ITEM:s.c.UNLIKE_ITEM,ownerId:h.ownerId,itemId:h.itemId,instant:!0,platform:r.a})}}}},onFail:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();switch(t){case 2:nav.hard_go(e[0])}}}},ldCb:function(e,t){window.Informer={close:function(e){hide(e)}}},lkNA:function(e,t,n){"use strict";function i(e,t){var n,i=t.timeout,a=t.onLoad,o=t.onError,r=document.createElement("script");function s(e){r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(l(),a&&a())}function c(e){l(),o&&o()}function l(){clearTimeout(n),r.removeEventListener("load",s),r.removeEventListener("readystatechange",s),r.removeEventListener("error",c)}return r.addEventListener("load",s),r.addEventListener("readystatechange",s),r.addEventListener("error",c),r.src=e,document.head.appendChild(r),i&&(n=setTimeout(c,i)),{destroy:function(){l()}}}n.d(t,"a",(function(){return i}))},mPGc:function(e,t){FeedAssistanceStats.registerTrackingCls("feedAssistance_recommendedGroups"),FeedAssistanceStats.onStartViewElement((function(e){if(FeedAssistanceStats.getElementType(e)===FeedAssistanceStats.BLOCKS.BLOCK_TYPE_RECOMMENDED_GROUPS_SLIDER){var t,n,i=e.querySelector(".Slider__scroll").dataset.code;if(i)null==(t=window.RecommendedGroupsSlider)||t.viewBlock(i),null==(n=window.RecommendedGroupsSlider)||n.onScroll();if(e._groupsSliderHandlersAdded)return;e._groupsSliderHandlersAdded=!0}}))},nXjO:function(e,t){var n={OPEN_CLASS:"reply_owner_show",OPEN_BOTTOM_CLASS:"reply_owner_open_bottom",NO_LIMIT_CLASS:"reply_owner_picker_nolimit",CONTAINER_CLASS:"reply_owner_picker_container",PICKER_CLASS:"reply_owner_picker",PICKER_ITEM_CLASS:"reply_owner_option",LOADING_CLASS:"reply_owner_loading",IMAGE_CLASS:"_reply_owner_image",SELECTED_IMAGE_CLASS:"_reply_owner_selected_image",SELECTED_IMAGE_CONTAINER_CLASS:"reply_owner_selected_image",OPTION_CLASS:"reply_owner_option",PICKER_MAX_HEIGHT:null,LOADING_SHOW_TIME:300,container:null,picker:null,clickEvent:"ontouchend"in document.documentElement?"touchend":"click",clickHandler:null,requestHandler:null,request:null,loading:!1,setElements:function(e){this.container=gpeByClass(this.CONTAINER_CLASS,e),this.picker=geByClass1(this.PICKER_CLASS,this.container),this.clickHandler=this.clickHandler||bind(this.onDocumentClick,this),this.requestHandler=this.requestHandler||bind(this.onDocumentClickBeforeLoad,this)},unsetElements:function(){removeEvent(document.body,this.clickEvent,this.clickHandler),removeEvent(document.body,this.clickEvent,this.requestHandler),this.container=this.picker=null},show:function(e){this.setElements(e),addClass(this.OPEN_CLASS,this.container),this.calcPosition()},hide:function(){removeClass(this.OPEN_CLASS,this.container),removeClass(this.OPEN_BOTTOM_CLASS,this.container),this.unsetElements()},toggle:function(){toggleClass(this.OPEN_CLASS,this.container),this.calcPosition(),hasClass(this.OPEN_CLASS,this.container)?(this.scrollToSelected(),addEvent(document.body,this.clickEvent,this.clickHandler)):(this.hide(),this.unsetElements())},calcPosition:function(){var e=ge("mhead").offsetHeight,t=this.picker.getBoundingClientRect(),n=domClosestOverflowHidden(this.picker),i=!0;n&&n.getBoundingClientRect().bottom<this.container.getBoundingClientRect().bottom+this.PICKER_MAX_HEIGHT?i=!1:hasClass(this.LOADING_CLASS,this.container)?i=t.top-e-this.PICKER_MAX_HEIGHT+t.height<0:hasClass(this.OPEN_BOTTOM_CLASS,this.container)||(i=t.top-e<0),toggleClass(this.OPEN_BOTTOM_CLASS,this.container,i)},onDocumentClick:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.hide()},onDocumentClickBeforeLoad:function(e){var t=e.target;t===this.container||gpeByClass(this.CONTAINER_CLASS,t)||this.cancelRequest()},cancelRequest:function(){this.request&&(this.request.abort(),this.unsetElements())},getList:function(){var e=this;if(!this.loading){this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10);var t=geBySel1('input[name="from_oid"]',this.container).value,n=geBySel1('input[name="post_oid"]',this.container).value;this.loading=!0;var i=setTimeout((function(){addClass(e.LOADING_CLASS,e.container),e.calcPosition()}),this.LOADING_SHOW_TIME);addEvent(document.body,this.clickEvent,this.requestHandler),this.request=ajax.post("/wall.php",{act:"get_reply_clubs_list",oid:t,post_oid:n},{onDone:function(t){clearTimeout(i),e.picker.innerHTML=t,e.onLoadEnd(),e.toggle(e.picker)},onFail:function(){e.onLoadEnd()}})}},onLoadEnd:function(){this.loading=!1,removeClass(this.LOADING_CLASS,this.container),removeEvent(document.body,this.clickEvent,this.requestHandler)},onChange:function(e){var t=gpeByClass(this.OPTION_CLASS,e),n=geByClass1(this.IMAGE_CLASS,t).src;each(geByClass(this.SELECTED_IMAGE_CLASS),(function(){this.src=n})),attr(geByClass1("al"+this.SELECTED_IMAGE_CLASS),"href",attr(t,"data-href")),this.hide()},onClick:function(e){this.setElements(e),geByClass(this.PICKER_ITEM_CLASS,this.picker).length?this.toggle():this.getList()},scrollToSelected:function(){var e=gpeByClass(this.OPTION_CLASS,geBySel1(":checked",this.picker));this.PICKER_MAX_HEIGHT||(this.PICKER_MAX_HEIGHT=parseInt(getStyle(this.picker,"maxHeight"),10)),e&&(this.picker.scrollTop=e.offsetTop-this.PICKER_MAX_HEIGHT/2+e.offsetHeight/2)}};window.replyOwnerPicker=n},p5n7:function(e,t,n){"use strict";n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return f})),n.d(t,"b",(function(){return m}));var i=n("z9sQ"),a=n("+sJP"),o=n("TYsd"),r=function(e){void 0===e&&(e={});var t=e.style||[],n=e.class||e.mix,r=e.prefix,s=e.postfix,c=function(e){var t=[];Object(a.A)(e.on_key_down)?(e.on_key_down.push("event"),t=e.on_key_down):e.on_key_down&&(t=[e.on_key_down,"event"]);var n=e.on_key_press,i="function"==typeof e.on_change,r="function"==typeof e.onblur,s="function"==typeof e.onfocus,c=Object(a.h)("TextInput.onChange(event);",o.a.isAttrHandler("oninput",e.on_change)?o.a.prepareHandler(e.on_change):i?"":e.on_change),l=Object(a.h)("TextInput.onBlur(event, this);",o.a.isAttrHandler("onblur",e.onblur)?o.a.prepareHandler(e.onblur):r?"":e.onblur),u=Object(a.h)("TextInput.onFocus(event, this);",o.a.isAttrHandler("onfocus",e.onfocus)?o.a.prepareHandler(e.onfocus):s?"":e.onfocus);i&&(c=Object(a.S)([[c],[e.on_change]]));r&&(l=Object(a.S)([[c],[e.onblur]]));s&&(u=Object(a.S)([[c],[e.onfocus]]));return{class:"TextInput__native",id:e.id,type:e.type,name:e.name,value:e.value,spellcheck:e.spellcheck+"",placeholder:o.a.wrap(e.placeholder),autocapitalize:!1===e.autocapitalize?"off":null,autocomplete:!1===e.autocomplete?"off":e.autocomplete,tabindex:e.tabindex,readonly:e.readonly,disabled:e.disabled,oninput:c,onkeydown:t,onkeypress:n,onblur:l,onfocus:u,autofocus:e.autofocus,maxlength:e.maxlength,pattern:e.pattern,required:e.required,inputmode:e.inputmode,"aria-describedby":e["aria-describedby"],tag:"input"}}(e),l=e.error;l&&(t.error=!0);var u=!(r||s||"string"==typeof l);return{inner:[{inner:[u?c:[r?{inner:[r.text],class:i.a.class("TextInput__prefix",{rightPadding:r.with_right_padding,gray:r.gray},"_"),tag:"div"}:null,{inner:[c],class:"TextInput__nativeWrap",tag:"div"},s?{inner:[s.text],class:"TextInput__postfix",tag:"div"}:null]],class:"TextInput__content",tag:"div"},"string"==typeof l?{inner:[l],class:"TextInput__errorLabel",tag:"span"}:null],role:"presentational",class:[i.a.class("TextInput",{style_stretch:t.stretch,prefixed:!!r,hidden:"hidden"===e.type,error:t.error,native:u,disabled:!!e.disabled||!!e.readonly},"_"),n],onclick:e.on_click,tag:"label"}};var s=n("UxAg"),c=n("zvhO"),l=n("OcsD"),u=n("CQvH");Object.assign(r,{setPrefix:f,getValue:h,filter:function(e,t,n){switch(e){case"number":var i=Object(l.zc)(n)+String.fromCharCode(t.which);Object(c.a)(parseInt(i))||Object(l.j)(t),Object(l.zc)(n,Object(l.zc)(n).split("").filter((function(e){return Object(c.a)(+e)})).join(""))}},onFocus:function(e,t){var n=t.closest(d);setTimeout((function(){n.classList.add("TextInput--focused")}))},onBlur:function(e,t){var n,i=t.closest(d),a=null==(n=e.relatedTarget)?void 0:n.closest(d),o=Object(s.a)(_,i);if(i===a&&!Object(u.b)())return void o.focus();if(setTimeout((function(){var e;"BUTTON"===(null==(e=document.activeElement)?void 0:e.tagName)&&i.contains(document.activeElement)&&Object(l.b)(document.activeElement,"blur",v)})),a===i)return;setTimeout((function(){i.classList.remove("TextInput--focused")}))},onChange:function(e){var t=e.target.value;e.target.closest(d).classList.toggle("TextInput--notEmpty",!!t)}});var d=".TextInput",_=".TextInput__native",p=".TextInput__prefix";function h(e){return e.$(_).value}function f(e,t){e.$(p).innerText=t}function m(e){return Object(s.a)(_,e)}function v(e){var t=e.target.closest(d);Object(l.Zb)(e.target,"blur",v),t&&t.classList.remove("TextInput--focused")}t.a=r;window.TextInput=r},pRml:function(e,t,n){"use strict";var i=n("TYsd").a.createElement,a=n("+sJP"),o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};t.a=function(e){var t=e.title,n=e.text,r=e.class,s=e.children,c=Object(a.f)(r,{Alert:!0,Alert_theme_error:"error"===e.theme,Alert_theme_warning:"warning"===e.theme,Alert_theme_info:"info"===e.theme});return i("div",o({className:c},{children:[t?i("div",o({className:"Alert__title"},{children:t}),void 0):null,i("div",o({className:"Alert__description"},{children:n||s}),void 0)]}),void 0)}},qdnm:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("FbVm"),a=new i.e,o=new i.b(a)},"r/ag":function(e,t,n){"use strict";var i=n("Po+v"),a=n("TAKr");Object.assign(i.a,a.a),i.a.close=a.b,i.a.open=a.c,window.Popup=i.a,t.a=i.a},r0fY:function(e,t,n){"use strict";var i,a,o,r,s,c,l,u,d,_,p,h,f,m,v,g,b,A,w,y,O,k,j;n.d(t,"k",(function(){return a})),n.d(t,"j",(function(){return o})),n.d(t,"r",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c})),n.d(t,"n",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"q",(function(){return _})),n.d(t,"c",(function(){return h})),n.d(t,"m",(function(){return m})),n.d(t,"l",(function(){return v})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return b})),n.d(t,"h",(function(){return A})),n.d(t,"o",(function(){return w})),n.d(t,"d",(function(){return O})),n.d(t,"p",(function(){return k})),n.d(t,"i",(function(){return j})),function(e){e.NOWHERE="nowhere",e.OTHER="other",e.START="start",e.START_BOX="start_box",e.START_PROCEED_AS="start_proceed_as",e.REGISTRATION_COMPLETE="registration_complete",e.REGISTRATION_COUNTRY="registration_country",e.REGISTRATION_PHONE="registration_phone",e.REGISTRATION_PHONE_VERIFY="registration_phone_verify",e.REGISTRATION_PASSWORD="registration_password",e.REGISTRATION_EDUCATION="registration_education",e.REGISTRATION_EMAIL="registration_email",e.REGISTRATION_NAME="registration_name",e.REGISTRATION_INVITE_CONFIRM="registration_invite_confirm",e.REGISTRATION_LIST_FRIENDS_FACEBOOK="registration_list_friends_facebook",e.PHONE_2FA_VERIFY="phone_2fa_verify",e.OAUTH_FB="oauth_fb"}(i||(i={})),function(e){e.TYPE_NAVGO="type_navgo",e.TYPE_ACTION="type_action",e.TYPE_CLICK="type_click",e.TYPE_VIEW="type_view"}(a||(a={})),function(e){e.GO="go",e.BACK="back",e.TAB_OPEN="tab_open"}(o||(o={})),function(e){e.TYPE_DONUT_DESCRIPTION_NAV_ITEM="type_donut_description_nav_item",e.TYPE_MARKET_NAVGO="type_market_navgo",e.TYPE_YOULA_SNIPPET_NAVGO="type_youla_snippet_navgo"}(o||(o={})),function(e){e.TYPE_YOULA_SNIPPET_ITEM="type_youla_snippet_item"}(r||(r={})),function(e){e.TYPE_REGISTRATION_ITEM="type_registration_item",e.TYPE_MARKETING_TRANSITION_ITEM="type_marketing_transition_item",e.TYPE_DONUT_PAYMENT_ITEM="type_donut_payment_item",e.TYPE_CALL_ITEM="type_voip_call_item",e.TYPE_BRIDGE_EVENT_ITEM="type_bridge_event_item",e.TYPE_EASTER_EGGS_ITEM="type_easter_eggs_item",e.TYPE_CUSTOM_METRICS_ITEM="type_ab_custom_metrics_item",e.TYPE_MESSAGING_ACTION_ITEM="type_messaging_action_item"}(s||(s={})),function(e){e.TYPE_MARKET_CLICK="type_market_click",e.TYPE_WORKI_CLICK="type_worki_click",e.TYPE_CATALOG_BANNER_ITEM="type_catalog_banner_item",e.TYPE_MINI_APP_ITEM="type_mini_app_item",e.TYPE_VKM_CONVERSATION_SUGGESTION_ITEM="type_vkm_conversation_suggestion_item"}(c||(c={})),function(e){e.TYPE_CATALOG_BANNER_ITEM="type_catalog_banner_item",e.TYPE_MARKET_VIEW="type_market_view",e.TYPE_MINI_APPS_VIEW_ITEM="type_mini_app_view_item"}(l||(l={})),function(e){e.MARKETPLACE="marketplace",e.MARKETPLACE_BLOCK="marketplace_block",e.MARKETPLACE_SEARCH="marketplace_search"}(u||(u={})),function(e){e.TYPE_MARKET_ORDERS_ITEM="type_market_orders_item",e.TYPE_MARKET_CARTS_ITEM="type_market_carts_item",e.TYPE_MARKET_GOODS_ITEM="type_market_item",e.TYPE_MARKET_MARKETPLACE_ITEM="type_market_marketplace_item"}(d||(d={})),function(e){e.TYPE_WORKI_SNIPPET_ITEM="type_worki_snippet_item"}(_||(_={})),function(e){e.CATALOG_PROMO_BANNER_VIEWED="catalog_promo_banner_viewed"}(p||(p={})),function(e){e.ARTICLE="article",e.GROUP="group",e.PHOTO="photo",e.POST="post",e.STORY="story",e.USER="user",e.BROWSER="browser",e.NARRATIVE="narrative",e.MINI_APP="mini_app",e.GAME="game",e.VIDEO="video",e.MARKET_ITEM="market_item",e.MARKET_ITEM_ALBUM="market_item_album",e.MARKET_ORDER="market_order",e.CATALOG_BANNER="catalog_banner",e.AUDIO_FULLSCREEN_BANNER="audio_fullscreen_banner",e.WORKI_SNIPPET="worki_snippet",e.MINI_APPS_CATALOG_BANNER_VIEWED="catalog_promo_banner_viewed",e.MINI_APPS_CATALOG_BANNER="catalog_promo_banner",e.VKM_CONVERSATION_SUGGESTION_OPEN="vkm_conversation_suggestion_open"}(h||(h={})),function(e){e.SWITCH_ITEM_VARIANT_1="switch_item_variant_1",e.SWITCH_ITEM_VARIANT_2="switch_item_variant_2",e.OPEN_WIKI="open_wiki"}(f||(f={})),function(e){e.SCREEN_PROCEED="screen_proceed",e.SCREEN_SKIP="screen_skip",e.SCREEN_RETURN="screen_return",e.COMMON_SERVER_ERROR="common_server_error",e.RESEND_SMS_CODE="resend_sms_code",e.RESEND_SMS_CODE_FAILED="resend_sms_code_failed",e.INCORRECT_SMS_CODE="incorrect_sms_code",e.INCORRECT_PASSWORD="incorrect_password",e.INCORRECT_NAME="incorrect_name",e.INCORRECT_CAPTCHA="incorrect_captcha",e.INCORRECT_PHONE_NUMBER="incorrect_phone_number",e.INCORRECT_BDAY="incorrect_bday",e.INCORRECT_SEX="incorrect_sex",e.INCORRECT_EMAIL="incorrect_email",e.EXISTING_EMAIL="existing_email",e.INCORRECT_EDUCATION="incorrect_education",e.SUCCESS_2FA="success_2fa",e.LOGIN_TAP="login_tap",e.PASSWORD_TAP="passw_tap",e.START_REG_TAP="start_reg_tap",e.FIRST_COUNTRY="first_country",e.FIRST_EDUCATION="first_education",e.FIRST_EMAIL="first_email",e.FIRST_FRIEND_ASK="first_friend_ask"}(m||(m={})),function(e){e.PHONE_COUNTRY="phone_country",e.PHONE_NUMBER="phone_number",e.COUNTRY="country",e.CITY="city",e.EMAIL="email",e.UNIVERSITY="university",e.FACULTY="faculty",e.SCHOOL="school",e.CHAIR="chair",e.YEAR_FROM="year_from",e.YEAR_TO="year_to",e.CLASS="class",e.EDU_FORM="edu_form",e.EDU_STATUS="edu_status",e.GRADUATION="graduation",e.SPECIALIZATION="specialization",e.RULES_ACCEPT="rules_accept",e.SMS_CODE="sms_code",e.FIRST_NAME="first_name",e.LAST_NAME="last_name",e.SEX="sex",e.BDAY="bday",e.PASSWORD="password",e.FACEBOOK_REGISTRATION="facebook_registration",e.FRIEND_ASK="friend_ask",e.VERIFICATION_TYPE="verification_type"}(v||(v={})),function(e){e.UNAUTH_BOTTOM_BANNER="unauth_bottom_banner",e.UNAUTH_ACTION_BOX="unauth_action_box"}(g||(g={})),function(e){e.OPEN="open",e.CLOSE="close",e.CLICK_SIGN_UP="click_sign_up",e.CLICK_SIGN_IN="click_sign_in",e.CLICK_OPEN_IN_APP="click_open_in_app"}(b||(b={})),function(e){e.LIKE="like",e.SHARE="share",e.MORE="more"}(A||(A={})),function(e){e.ACTION_MENU_SHARE="action_menu_share",e.ACTION_MENU_ADD_TO_FAVOURITES="action_menu_add_to_favourites",e.ACTION_MENU_REMOVE_FROM_FAVOURITES="action_menu_remove_from_favourites",e.ACTION_MENU_ENABLE_NOTIFICATIONS="action_menu_enable_notifications",e.ACTION_MENU_DISABLE_NOTIFICATIONS="action_menu_disable_notifications",e.ACTION_MENU_ALL_APPS="action_menu_all_apps",e.ACTION_MENU_ALL_GAMES="action_menu_all_games",e.ACTION_MENU_COPY="action_menu_copy",e.ACTION_MENU_DELETE="action_menu_delete"}(w||(w={})),function(e){e.CLICK_GAME_CARD="cloud_games_game_click",e.CLICK_DOWNLOAD_GAME="cloud_games_client_download",e.OPEN_SECTION="cloud_games_section_open"}(y||(y={})),function(e){e.EGG_SHOW="egg_show",e.POPUP_SHOW="popup_show",e.POPUP_ACTION="popup_action"}(O||(O={})),function(e){e.OPEN="vkm_conversation_suggestion_open"}(k||(k={})),function(e){e.OPEN_MR="OPEN_MR"}(j||(j={}))},rEJs:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={CURRENT_CHANGED:"curr",PLAY:"start",PLAY_REQUESTED:"request_play",PAUSE:"pause",STOP:"stop",UPDATE:"update",LOADED:"loaded",ENDED:"ended",FAILED:"failed",BUFFERED:"buffered",PROGRESS:"progress",VOLUME:"volume",PLAYLIST_CHANGED:"plchange",ADDED:"added",REMOVED:"removed",FREQ_UPDATE:"freq",SEEK:"seek",PLAY_NEXT:"play_next",AD_READY:"ad_ready",AD_DEINITED:"ad_deinit",AD_STARTED:"ad_started",AD_COMPLETED:"ad_completed",START_LOADING:"start_load",CAN_PLAY:"actual_start",SELECT:"select",DESELECT:"deselect",EMPTY_PLAYLIST:"empty_playlist",NOT_FOUND_PLAYLIST:"not_found_playlist",INIT:"init",REQUEST_EXPANDED:"request_expanded",MUSIC_AUDIOS_ADD:"music_audios_add",MUSIC_PLAYLISTS_ADD:"music_playlists_add"}},rKUZ:function(e,t,n){"use strict";var i=n("MUpH"),a=n("bZ/P"),o=n("z9sQ"),r=n("BoyB"),s=n("+sJP");function c(){var e=Object(i.a)(['\n    <div class="typing__dotsWrap">\n      <div class="typing__dots">...</div>\n    </div>\n  ']);return c=function(){return e},e}function l(){var e=Object(i.a)(['\n    <div class="','">\n      ','\n      <div class="typing__names">',"</div>\n      ","\n    </div>\n  "]);return l=function(){return e},e}var u=function(e){var t,n,i=e.dimmed,s=e.animation,u=!!e.compact,p=e.typingCount,h=a.a.class("typing",{dimmed:i,id:e.id,empty:d(p),animation:s}),f=_(e);"audio"===s?(t=Object(r.a)({class:o.a.class("typing__loading",{audio:!0,compact:u},"_")}),n=""):"dots"===s?(t=Object(r.a)({class:o.a.class("typing__loading",{audio:!1,compact:u},"_")}),n=""):"simple-dots"===s&&(t="",n=a.a.html(c()));return a.a.html(l(),h,t,f,n)};function d(e){return!e}function _(e){return"audio"===e.text?function(e,t){var n=window.lang;if(!Object(s.A)(e))return e?n.mobile_mail_recaudio_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_recaudio_1).replace("{name}",r)}else if(2===a&&i.length>=2){var c=i[0],l=i[1];o=(o=(o=n.mobile_mail_recaudio_2).replace("{name1}",c)).replace("{name2}",l)}else if(a>1&&i.length>=1){var u=i[0];o=(o=(o=n.mobile_mail_recaudio_many).replace("{name}",u)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_recaudio_N_unknown));return o}(e.typing,e.typingCount):"mixed"===e.text?function(e,t){var n=window.lang;if(!Object(s.A)(e))return"";var i=e,a=t,o="";if(1===a&&i.length>=1)o="";else if(2===a&&i.length>=2){var r=i[0],c=i[1];o=(o=(o=n.mobile_mail_mixtyping_2).replace("{name1}",r)).replace("{name2}",c)}else if(a>1&&i.length>=1){var l=i[0];o=(o=(o=n.mobile_mail_mixtyping_many).replace("{name}",l)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_mixtyping_N_unknown));return o}(e.typing,e.typingCount):function(e,t){var n=window.lang;if(!Object(s.A)(e))return e?n.mobile_mail_typing_1_short:"";var i=e,a=t,o="";if(1===a&&i.length>=1){var r=i[0];o=(o=n.mobile_mail_typing_1).replace("{name}",r)}else if(2===a&&i.length>=2){var c=i[0],l=i[1];o=(o=(o=n.mobile_mail_typing_2).replace("{name1}",c)).replace("{name2}",l)}else if(a>1&&i.length>=1){var u=i[0];o=(o=(o=n.mobile_mail_typing_many).replace("{name}",u)).replace("{count}",a-1)}else a>=1&&!i.length&&(o=langNumeric(a,n.mobile_mail_typing_N_unknown));return o}(e.typing,e.typingCount)}var p=n("UxAg");Object.assign(u,{setTyping:function(e,t){var n="string"==typeof e?Object(p.a)(".typing_id_"+e):e,i=n.$(".typing__names");n.classList.toggle("typing_empty",d(t.typingCount)),i.innerHTML=_(t)},getElem:function(e){return Object(p.a)(".typing_id_"+e)}});t.a=u;window.Typing=u,Object.assign(window,{Typing_renderNames:_,Typing_isEmpty:d})},rKp0:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P"),o=n("Mc5h"),r=n("O5lf"),s=n("V2dH"),c=n("1KAK"),l=n("eWFs"),u=n("HGMY"),d=n("TYsd"),_=n("+sJP"),p=n("EDm3"),h=n("KMpi"),f=n("29dZ");var m=n("gY9e"),v=n("Uf6C");function g(){var e=Object(i.a)(['\n    <div class="mailScrap__systemMessage" ',">\n      ","\n    </div>\n  "]);return g=function(){return e},e}function b(){var e=Object(i.a)(['\n      <div class="mailScrap__empty mailScrap__empty_',' mailScrap_casper">\n        <div class="mailScrap__casperIcon" aria-hidden="true">\n          ','\n        </div>\n        <div class="mailScrap__casperText">\n          ',"\n        </div>\n      </div>\n  "]);return b=function(){return e},e}function A(){var e=Object(i.a)(['\n    <div class="mailEduScrap__empty">\n      <div class="mailScrap__icon">\n        ','\n      </div>\n      <div class="mailScrap__text mailEduScrap__text">\n        ','\n      </div>\n      <div class="mailEduScrap__action">\n        ',"\n      </div>\n    </div>\n  "]);return A=function(){return e},e}function w(){var e=Object(i.a)(["\n    ",'\n    <div class="mailScrap__empty mailScrap__empty_','">',"</div>\n  "]);return w=function(){return e},e}function y(){var e=Object(i.a)(['\n    <div class="','">\n      ',"\n    </div>\n  "]);return y=function(){return e},e}function O(){var e=Object(i.a)(['\n    <div class="','">\n      ',"\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n      ","\n    </div>\n  "]);return O=function(){return e},e}var k=function(e){var t=e.scrap,n=e.isCasper,i="peer"===t,r=x(t),c=i?T("before"):"",l=T("after"),h=T("center"),f=function(e){var t,n=a.a.class("mailScrap__items",((t={})[e]=!0,t)),i=j(e);return Object(o.a)({mix:n,inner:i})}(t),m=n?"":function(e){var t=P(e),n=t?d.a.html({inner:["$",t],class:"mailScrap__findFriendsStub",tag:"div"}):"",i=I(e);return a.a.html(w(),n,e,i)}(t),v=n?function(e){var t=d.a.html(Object(p.Lb)()),n=Object(_.t)("mobile_casper_chat_no_messages");return a.a.html(b(),e,t,n)}(t):"",A=i?Object(s.default)():"",y=i?d.a.html(Object(u.b)()):"",k=i?(S=store.mail.cur.notification||"",C=a.a.onClick("MailScrap.clearSystemMessage2"),a.a.html(g(),C,S)):"";var S,C;return a.a.html(O(),r,c,f,m,v,l,y,A,k,h)};function j(e){for(var t=store.mail,n=t.cur,i=t.msgs,o=t.scraps[e],r=o.length,s=[],c=!1,l=0;l<r;l++){if(l>0&&"peer"===e&&!c){var u=i[o[l-1]],d=i[o[l]];if(d.isUnread&&!u.isUnread&&d.authorId!==n.viewerId){c=!0,s.push(S(e,o[l],!0));continue}}s.push(S(e,o[l]))}return a.a.list(s)}function S(e,t,n){void 0===n&&(n=!1);var i=store.mail,a=i.cur,o="";if("folder"===e)o="important"===a.folder?C(t):E(t);else if("search"===e)if("peers"===a.tab){var r=t;i.peers[r].isIncomingMR||(o=function(e){return Object(l.default)(e)}(r))}else{o=C(t)}else if("peer"===e){o=function(e,t){void 0===t&&(t=!1);return Object(c.default)({msgId:e,withDivider:t})}(t,n)}else if("mrs"===e){o=E(t)}return o}function C(e){var t=store.mail.msgs[e].peerId;return Object(l.default)(t,e)}function E(e){return Object(l.default)(e,"last")}function T(e){var t,n=a.a.class("mailScrap__loading",((t={})[e]=!0,t)),i=Object(r.a)({mix:""});return a.a.html(y(),n,i)}function I(e){if(Object(_.D)())return function(e){var t=store.mail.cur,n="folder"===e,i="unread"===t.folder,o="important"===t.folder,r=window.lang,s={unread:r.mobile_mail_edu_messages_list_unread,important:r.mobile_mail_edu_messages_list_important}[t.folder]||r.mobile_mail_edu_chat_list_empty,c=i||o?d.a.html(SVGIcon(Object(m.a)())):d.a.html(SVGIcon(Object(v.a)())),l=!n||i||o?"":'<button class="mailEduScrap__link" onmousedown="uMessenger.createNewChat()">\n        '+r.mobile_mail_edu_create_chat+"\n      </button>";return a.a.html(A(),c,s,l)}(e);var t=window.lang,n=store.mail.cur,i="";switch(e){case"peer":i=t.mobile_mail_history_is_empty;break;case"mrs":i=t.mobile_mail_mrs_empty_info;break;case"folder":if(M("folder")){i="";break}i={all:t.mobile_mail_no_messages,important:t.mobile_mail_no_important,unread:t.mobile_mail_no_unreaded,unrespond:t.mobile_mail_sublist_empty,ad_tag:t.mobile_mail_sublist_empty}[n.folder];break;case"search":"msgs"===n.tab&&(i=t.mobile_mail_not_found),"peers"===n.tab&&(i=t.mobile_mail_no_peers)}return i}function M(e){var t=store.mail,n=t.cur,i=t.scraps,a=(t.reached,!(t.cur.folder&&"all"!==t.cur.folder||"folder"!==e||n.communityParam)),o=i.folder.length<=1;return n.findFriendsUsers&&n.findFriendsUsers.length>=0&&!n.hasContacts&&a&&o}function P(e){if(!M(e))return"";var t=store.mail.cur;return d.a.html(function(e){void 0===e&&(e={});var t,n,i=Object(_.O)("friends",{act:"import",from_section:"all"}),a=e.class||"";return{inner:[(t=e.recommendedFriends,n=t.length?t.map((function(e){var t=Object(_.q)({id:e.id,name:e.name});return{inner:[Object(h.a)({src:e.photo,size:56,mode:t,backgroundTheme:e.id,text:e.name,textLength:Object(_.r)(e.id)})],class:"ConvoListFindFriendsStub__avatarWrapper",tag:"div"}})):Object(p.Wb)(),{inner:[n],class:"ConvoListFindFriendsStub__avatarsStack",tag:"div"}),{inner:[Object(_.t)("mobile_mail_find_friends_stub_header")],class:"ConvoListFindFriendsStub__header",tag:"span"},{inner:[Object(_.t)("mobile_mail_find_friends_stub_text")],class:"ConvoListFindFriendsStub__text",tag:"span"},Object(f.a)({inner:[Object(_.t)("mobile_mail_find_friends_stub_button")],tag:"a",url:i})],class:a+" ConvoListFindFriendsStub",tag:"div"}}({recommendedFriends:t.findFriendsUsers}))}function x(e){var t,n=store.mail,i=n.cur,o=n.reached,r=Object(_.D)(),s=function(e){var t=store.mail,n=t.cur,i=t.scraps,a=t.reached,o=!1;switch(e){case"peer":var r=n.peerId,s=t.rolls.peer[r];0===(s?s.length:0)&&a.peer.after[r]&&a.peer.before[r]&&(o=!0);break;case"mrs":0===i.mrs.length&&a.mrs&&(o=!0);break;case"folder":0===i.folder.length&&a.folder[n.folder]&&(o=!0);break;case"search":0===i.search.length&&a.search[n.tab][n.query]&&(o=!0)}return o}(e),c=r&&s,l=!0,u=!1,d=!1,p=!1;if("peer"===e){var h=i.peerId,f=n.scraps.peer,m=f.length,v=n.rolls.peer[h]||[];l=o.peer.before[h]&&f[0]===v[0],u=last(f)===last(v)&&o.peer.after[h],0===m&&(u=!0);var g=h?n.peers[h]:null;g&&(d=!!g.systemMessageCode,g.isChannel&&(p=g.ownerId!==i.viewerId))}else if("mrs"===e)u=o.mrs;else if("folder"===e)u=o.folder[i.folder];else if("search"===e){var b=i.tab;i.query;if("peers"===b){var A=n.scraps.search.length;u=o.search[i.tab][i.query]||A>0}else u=o.search[i.tab][i.query]}return a.a.class("mailScrap",((t={})[e]=!0,t.empty=s,t.systemMessage=d,t.reachedBefore=l,t.reachedAfter=u,t.tab="search"===e&&i.tab,t.isChannel=p,t.edu=c,t))}n("+cqQ");var L=n("3pHe"),R=n("BZzM"),B=(n("s0aB"),n("GR/G")),N=n.n(B);Object.assign(k,{updateClass:q,clearSystemMessage2:function(){remove(geByClass1("service_msg_box"))},onSystemMessageClick:function(){!function(){var e=store.mail,t=e.cur;e.peers[t.peerId].systemMessageCode=null,q("peer"),z()}()},resetPrevScraps:function(){D={folder:[],search:[],peer:[]}},redrawPeer:function(){W("peer",store.mail.scraps.peer),$$(".mailScrap_peer").forEach((function(e){return e.className=x("peer")}))},redrawFolder:function(e){var t=store.mail,n=t.cur,i=t.scraps;n.folder;W("folder",i.folder,e),$$(".mailScrap_folder").forEach((function(e){return e.className=x("folder")})),Y("folder")},redrawEmpty:Y,redrawSearch:function(){$$(".mailScrap__items_search").forEach((function(e){return e.innerHTML=j("search")})),$$(".mailScrap_search").forEach((function(e){return e.className=x("search")})),$$(".mailScrap__empty_search").forEach((function(e){return e.innerHTML=I("search")}))},redrawMRs:function(e){W("mrs",store.mail.scraps.mrs,e),$$(".mailScrap_mrs").forEach((function(e){return e.className=x("mrs")})),$$(".mailScrap__empty_mrs").forEach((function(e){return e.innerHTML=I("mrs")}))},redrawSystemMessage:z,folderSetItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.innerHTML=F(e,!0)})),$$(".mailScrap_folder").forEach((function(e){return e.className=x("folder")})),$$(".mailScrap__empty_folder").forEach((function(e){return e.innerHTML=I("folder")}))},folderAddItems:function(e){$$(".mailScrap__items_folder").forEach((function(t){return t.insertAdjacentHTML("beforeend",F(e))}))},folderCutItems:function(e){$$(".mailScrap_folder .mailScrap__items").forEach((function(t){[].slice.call(t.children).slice(e).forEach((function(e){return t.removeChild(e)}))}))},peerAddElemAfter:function(e,t){var n=$(".mailScrap__items_peer");if(!n)return;var i=ceFromString(U([e],!0));V(t,i),n.appendChild(t),N()(t,i),q("peer")},peerAddItemsBefore:function(e,t){void 0===t&&(t=!1);q("peer"),e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)}));var n=L.Messenger.getConvoBody();n.scrollHeight,n.scrollTop,n.offsetHeight;window._preventedCheckTop=!0,setTimeout((function(){return window._preventedCheckTop=!1}));var i='\n    <div class="load_before load_before_closed">\n      '+U(e,t)+"\n    </div>\n  ";return $$(".mailScrap__items_peer").forEach((function(e){return e.insertAdjacentHTML("afterbegin",i)})),void uMessenger.expandPeerBefore()},peerAddItemsAfter:function(e,t,n){void 0===t&&(t=!1);e=e.filter(unique).filter((function(e){return!$(".msg_id_"+e)})),$$(".mailScrap__items_peer").forEach((function(n){n.insertAdjacentHTML("beforeend",U(e,t))})),q("peer"),Object(R.a)()},peerReplaceItems:function(e){e.forEach((function(e){var t=$(".msg_id_"+e),n=ceFromString(U([e],!0));V(t,n),N()(t,n),CasperTimer.init(e)})),Object(R.a)()},peerSetItems:function(e){e=e.filter(unique),$$(".mailScrap__items_peer").forEach((function(t){return t.innerHTML=U(e)}))},peerGoToBottom:function(){var e=L.Messenger.getConvoBody();e.scrollTop=e.scrollHeight},removeDivider:H,checkDivider:function(){var e=last($(".mailScrap__items_peer").children);e&&e.classList.contains("msg__newMsgsDivider")&&H()}}),uVK.onReady((function(){if(store.mail&&store.mail.scraps){var e=store.mail.scraps;D.folder=e.folder.slice(),D.search=e.search.slice(),D.peer=e.peer.slice()}}));var D={folder:[],search:[],peer:[]};function H(){remove($(".msg__newMsgsDivider"))}function U(e,t){void 0===t&&(t=!1),e=e.filter(unique);var n,i=store.mail,a=i.cur,o=i.msgs,r=!!$(".msg__newMsgsDivider");return e.map((function(e,i){var s=o[e];return i>0&&!r&&!t&&!n.isUnread&&s.isUnread&&s.authorId!==a.viewerId?(n=s,r=!0,S("peer",e,!0)):(n=s,S("peer",e))})).join("")}function V(e,t){if(e&&t){var n=$(".pi_medias",e),i=$(".pi_medias",t);n&&i&&(i.isSameNode=n.isSameNode)}}function F(e,t){return void 0===t&&(t=!1),(e=e.filter(unique)).map((function(e){return $(".mailScrap__items_folder .convo_id_"+e)&&!t?"":S("folder",e)})).join("")}function W(e,t,n){!function(e,t,n,i){void 0===i&&(i=null);var a=[];if(!e)return;i||(e.innerHTML="",i=[]);if(0===n.length)return void(e.innerHTML="");n.forEach((function(n,a){var o=i.indexOf(n);-1===o?(i.splice(a,0,n),domInsert(e,t(n),a)):o!==a&&(i.splice(o,1),i.splice(a,0,n),before(e.children[o],e.children[a]))})),i.forEach((function(t,i){-1===n.indexOf(t)&&a.push(e.children[i])})),a.forEach(remove)}($(".mailScrap__items_"+e),(function(t){return S(e,t)}),t,n)}function q(e){$$(".mailScrap_"+e).forEach((function(t){return t.className=x(e)}))}function z(){$$(".mailScrap__systemMessage").forEach((function(e){e.innerHTML=store.mail.cur.notification||""}))}function Y(e){$$(".mailScrap__empty_folder").forEach((function(t){return t.innerHTML=I(e)})),function(e){var t=$(".mailScrap__findFriendsStub");t&&(t.innerHTML=P(e))}(e)}t.default=k;window.MailScrap=k},rc7J:function(e,t,n){"use strict";var i=n("z9sQ"),a=n("+sJP"),o=n("KMpi");var r=function(e){void 0===e&&(e={});var t=i.a.class("AlbumInfoRow",{withoutBottomBorder:e.withoutBottomBorder});return{inner:[{inner:[Object(o.a)({mode:Object(a.q)({id:e.id,name:e.name}),backgroundTheme:e.id,text:e.name,size:40,src:e.avatar})],class:"AlbumInfoRow__avatar",href:e.author_url,onclick:"cancelEvent(event); nav.go(this);",tag:"a"},{inner:[{inner:[e.title],class:"AlbumInfoRow__title",href:e.url,tag:"a"},{inner:[e.subtitle],class:"AlbumInfoRow__subtitle",tag:"div"}],class:"AlbumInfoRow__content",tag:"div"}],class:t,onclick:"nav.go('"+e.url+"')",tag:"div"}};t.a=r},rycc:function(e,t,n){"use strict";function i(e){return e.href&&!e.tag&&(e.tag="a"),e}n.d(t,"a",(function(){return i}))},s0aB:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("TYsd"),o=n("bZ/P"),r=n("Mc5h"),s=n("AXyT"),c=n("9y81"),l=n("KMpi"),u=n("Y6JH"),d=n("rKUZ"),_=n("+sJP"),p=n("gZry"),h=n("LBnd"),f=n("EDm3"),m=n("svF/"),v=n("yOyn"),g=(n("ZvT/"),n("k0dR"));function b(){var e=Object(i.a)(['\n    <div class="','" ',">\n      ","\n      ",'\n      <a class="convo__body" href="','">\n        <div class="convo__row convo__row_title ','">\n          <div class="convo__title">',"</div>\n          ","\n          ","\n          ",'\n          <div class="convo__row_right">\n            ','\n            <div class="convo__date">',"</div>\n          </div>\n        </div>\n        ","\n      </a>\n    </div>\n  "]);return b=function(){return e},e}function A(){var e=Object(i.a)(['\n    <div class="convo__row convo__row_text">\n      <div class="convo__typing">','</div>\n      <div class="convo__text">','</div>\n      <div class="convo__row_right convo__unreadBox" ',">\n        ",'\n        <div class="convo__unreadOut"></div>\n        ','\n      </div>\n      <div class="convo__status">','</div>\n      <div class="convo__pin">',"</div>\n    </div>\n  "]);return A=function(){return e},e}var w=function(e){var t,n,i=e.more,r="",p="",h=0,g=!1,w="",S=Object(_.G)(e.majorSortId);i&&(r=i.text,p=i.date,h=i.unreadCount,g=i.muted,w=i.typing?Object(d.a)(i.typing):"",t=i.pending,n=i.failed,(t||n)&&(p=""));var C=o.a.class("clickable","convo",{id:e.id,short:!i,last:e.isLast,typing:!!w,important:e.important,unread:e.isLast&&(h>0||e.isMarkedUnread),unreadOut:e.isLast&&h<0,pinned:i&&S}),E=a.a.html(Object(l.a)({size:50,src:e.photos,mix:"convo__avatar",url:e.profileUrl,mode:Object(_.q)({id:e.id,name:e.title}),backgroundTheme:e.id,text:e.title,textLength:Object(_.r)(e.id)})),T=O({pending:t,failed:n}),I=y(e.online),M=Object(c.b)({mix:"convo__star",icon:"star",blue:!0}),P=k(e.peerProfile),x=a.a.html(Object(f.o)()),L=e.isLast?Object(s.a)({mix:"convo__unread",value:j(h,e.isMarkedUnread),gray:g}):"",R=e.url,B=o.a.onClick("Convo._onClick","event",R),N=e.isCasper?'<span class="convo__casper" title="'+Object(_.t)("mobile_casper_chat_title")+'">'+a.a.html(Object(u.a)(Object(v.a)()))+"</span>":"",D=e.isDonutChat?'<span class="convo__casper">'+a.a.html(Object(u.a)(Object(m.a)()))+"</span>":"",H=o.a.html(A(),w,r,T?"hidden":"","",L,T,x),U="";e.isWithoutMessage&&(H="",U="convo__row_centered");return o.a.html(b(),C,B,I,E,e.url,U,e.title,P,N,D,M,p,H)};function y(e){return"mobile"===e?a.a.html({inner:[{inner:[Object(u.a)({icon:Object(p.a)()})],class:"mlvi_default",tag:"div"},{inner:[Object(u.a)({icon:Object(h.a)()})],class:"mlvi_muted",tag:"div"}],class:"lvi mlvi convo__online convo__online_mobile",tag:"div"}):"desktop"===e?Object(r.a)({mix:o.a.class("convo__online",{desktop:!0})}):Object(r.a)({mix:"convo__online"})}function O(e){var t=window.lang;return e.pending?a.a.html({inner:[Object(f.q)()],class:"convo__pending",tag:"div"}):e.failed?'<div class="convo__failed">'+t.mobile_mail_send_error+"</div>":""}function k(e){var t=e.tags,n=e.tagsData,i=[];t&&n.peerTags&&(i=t.filter((function(e){return n.peerTags.indexOf(e.id)>-1})));var o,r=i.length;if(!r&&!n.fromAd)return"";if(n.fromAd&&!r)o={class:"convo__adTag",inner:[Object(_.t)("mobile_mail_ad_tag_no_access_text"),Object(u.a)(Object(g.a)())]};else if(n.fromAd||1!==r){var s=window.lang,c=r+(n.fromAd?1:0);o={class:"convo__extraTag",inner:langNumeric(c,s.mobile_mail_peer_profile_extra_tags)}}else{var l=i[0];o={class:"convo__peerTag",inner:l.name,style:"background-color: "+l.color}}return a.a.html({class:"convo__peerTags",inner:o})}function j(e,t){var n=e;return t&&e<=0&&(n="empty"),n}var S=n("UxAg"),C=n("+cqQ"),E=n("OcsD");n("jk6M");function T(e,t){e.stopPropagation(),e.preventDefault(),w.onTap(t)}Object.assign(w,{onTap:Object(C.a)("url"),setOnline:function(e,t){Object(S.b)(".convo_id_"+e+" .convo__online").forEach((function(e){e.outerHTML=y(t)}))},setLastMsg:function(e,t,n){var i=n.dateShort,a=n.pending,o=n.failed;Object(S.b)(".convo_last.convo_id_"+e).forEach((function(e){e.$(".convo__text").innerHTML=t,e.$(".convo__status").innerHTML=O({pending:a,failed:o}),a||o?(e.$(".convo__date").innerText="",e.$(".convo__unreadBox").hidden=!0):(e.$(".convo__date").innerText=i,e.$(".convo__unreadBox").hidden=!1)}))},setTyping:function(e,t){Object(S.b)(".convo_last.convo_id_"+e).forEach((function(e){var n=e.$(".convo__typing"),i=t.typing;if(t.typingCount&&(!0===i||Object(_.A)(i))){var a=n.$(".typing"),o=a&&q.parseClass("typing",a.className);a&&o.animation===t.animation?d.a.setTyping(a,t):(e.classList.add("convo_typing"),n.innerHTML=Object(d.a)(t))}else n.innerHTML="",e.classList.remove("convo_typing")}))},setUnreadCount:function(e,t,n){Object(S.b)(".convo_last.convo_id_"+e).forEach((function(e){var i=e.$(".Oval");e.classList.toggle("convo_unread",t>0||n),e.classList.toggle("convo_unreadOut",t<0),s.a.setValue(i,j(t,n))}))},setImportant:function(e,t){Object(S.b)(".convo_id_"+e).forEach((function(e){e.classList.toggle("convo_important",t)}))},updateAdTag:function(e,t){Object(S.b)(".convo_id_"+e).forEach((function(e){var n=Object(S.a)("convo__peerTags",e);t.fromAd&&!n&&(n=Object(E.l)(k({tagsData:t})),after(n,Object(S.a)(".convo__title",e)))}))},updatePinned:function(e,t){Object(S.b)(".convo_id_"+e).forEach((function(e){e.classList.toggle("convo_pinned",t)}))}}),w._onClick=T;t.default=w;window.Convo=w,window.Convo__online=y},scr1:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return k}));var i=n("2mXy"),a=n("UxAg"),o=n("TYsd"),r=n("V4qE"),s=n("+sJP"),c=n("OcsD"),l=n("vOib"),u=n("7cYY"),d=n("z9sQ"),_=n("29dZ"),p=n("O5lf"),h=n("EDm3");function f(e){void 0===e&&(e={});var t=e.stories&&0===e.stories.length,n=e.selectedStories&&e.selectedStories.length,i=0===n,a=d.a.class("StoriesArchive",{editable:e.isEdit}),r=["StoriesArchive__stories",e.isLoading?"_si_container_loading":null];return t?Object(l.a)({inner:[{inner:[Object(h.Gb)()],class:"StoriesArchiveEmpty__icon",tag:"div"},{inner:[Object(s.t)("mobile_stories_archive_empty_label")],class:"StoriesArchiveEmpty__label",tag:"div"}],mix:"StoriesArchive StoriesArchiveEmpty"}):Object(l.a)({inner:[{inner:[e.stories.map((function(t){var n=Object(s.d)(e.selectedStories,"id",t.id);return Object(u.a)({isSelectable:e.isEdit,isSelected:n,story:t,onStoryThumbCheck:e.onStoryThumbCheck})}))],class:r,ref:e.storiesArchiveStoriesWrapperRef,tag:"div"},e.isLoading?o.a.wrap(Object(p.a)({mix:"StoriesArchive__spinner"})):null,e.isEdit?{inner:[{inner:[i?Object(s.t)("mobile_stories_archive_select_at_least_one"):Object(s.u)(n,Object(s.t)("mobile_stories_archive_selected_stories_title","raw")),i?null:{inner:[Object(h.a)()],class:"StoriesArchiveActions__resetSelectedIcon",onClick:e.onResetSelectedStoriesClick,tag:"div"}],class:"StoriesArchiveActions__selected",tag:"div"},{inner:[Object(_.a)({inner:[Object(s.t)("mobile_stories_archive_remove")],class:"StoriesArchiveActions__btn StoriesArchiveActions__btn--delete",theme:"secondary",onClick:e.onDeleteStoriesActionClick,disabled:!e.selectedStories.length||e.isCreateNarrativeActionLoading,isLoading:e.isDeleteActionLoading,icon:Object(h.H)()}),Object(_.a)({inner:[Object(s.t)("mobile_stories_archive_to_narrative")],class:"StoriesArchiveActions__btn StoriesArchiveActions__btn--narrative",theme:"secondary",onClick:e.onCreateNarrativeActionClick,disabled:!e.selectedStories.length||e.isDeleteActionLoading,isLoading:e.isCreateNarrativeActionLoading,icon:Object(h.N)()})],class:"StoriesArchiveActions__buttons",tag:"div"}],class:"StoriesArchiveActions",ref:e.storiesArchiveActionsRef,tag:"div"}:null],mix:a,ref:e.storiesArchiveRef})}var m,v=n("zouF"),g=n("r/ag"),b=n("1UEa"),A=(m=function(e,t){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),w=function(){return(w=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},y=function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},O=100,k=function(e){function t(t){var n,a,o=e.call(this,t)||this;return o.storiesArchiveRef=Object(i.c)(),o.storiesArchiveStoriesWrapperRef=Object(i.c)(),o.storiesArchiveActionsRef=Object(i.c)(),o.state=w(w({},t),{storiesLoadedCount:null===(n=t.stories)||void 0===n?void 0:n.length,isLoading:!1,isAllLoaded:(null===(a=t.stories)||void 0===a?void 0:a.length)>=t.storiesTotalCount,selectedStories:[]}),o.deleteSelectedStories=o.deleteSelectedStories.bind(o),o.createNarrativeFromSelectedStories=o.createNarrativeFromSelectedStories.bind(o),o.resetSelectedStories=o.resetSelectedStories.bind(o),o.onStoryThumbCheck=o.onStoryThumbCheck.bind(o),window.nav.onBeforeGo((function(e,t,n){"/narratives"===window.nav.path&&(null==n?void 0:n.need_restore)&&(null==o||o.setState({isLoading:!1,isCreateNarrativeActionLoading:!1}))})),o}return A(t,e),t.prototype.componentDidMount=function(){var e=this;Object(u.b)(this.storiesArchiveStoriesWrapperRef.current),Object(c.lb)((function(){return e.storiesArchiveRef.current}),(function(){return e.storiesArchiveActionsRef.current}),{shouldCalculateAudioPlayer:!0}),Object(c.kb)((function(){var t=Object(a.b)(".StoryThumb",e.storiesArchiveStoriesWrapperRef.current);return t[t.length-1]}),this.loadStories.bind(this))},t.prototype.componentDidUpdate=function(){Object(u.b)(this.storiesArchiveStoriesWrapperRef.current)},t.prototype.loadStories=function(){var e=this;if(this.state.isLoading||this.state.isAllLoaded)return!1;this.setState({isLoading:!0}),window.ajax.post("stories",{act:"archive_list",offset:this.state.storiesLoadedCount,owner_id:this.state.ownerId,_ajax:!0},{onDone:function(t){var n=y(y([],e.state.stories),t.stories||[]),i=n.length>=t.storiesTotalCount;e.setState({stories:n,storiesLoadedCount:n.length,storiesTotalCount:t.storiesTotalCount,isAllLoaded:i,isLoading:!1})}})},t.prototype.deleteSelectedStories=function(){var e,t=this,n=this;if(!(null===(e=this.state.selectedStories)||void 0===e?void 0:e.length))return!1;var i=Object(s.u)(this.state.selectedStories.length,Object(s.t)("mobile_stories_archive_confirm_stories_delete_message","raw")),a=Object(v.a)(i,(function(){var e;t.setState({isDeleteActionLoading:!0}),g.a.close(a),window.ajax.post("stories.php",{_ajax:!0,act:"remove_stories",remove_stories_hash:t.state.removeStoriesHash,owner_id:t.state.ownerId,story_ids:null===(e=t.state.selectedStories)||void 0===e?void 0:e.map((function(e){return e.id})).join(",")},{onDone:function(e){var t,i,a,o=e.deletedStoryIds||[];n.setState({stories:null===(t=n.state.stories)||void 0===t?void 0:t.filter((function(e){return!o.includes(e.id)})),selectedStories:null===(i=n.state.selectedStories)||void 0===i?void 0:i.filter((function(e){return!o.includes(e.id)})),isDeleteActionLoading:!1,storiesTotalCount:n.state.storiesTotalCount-o.length,storiesLoadedCount:n.state.storiesLoadedCount-o.length}),r.g({type:r.e,text:Object(s.t)("mobile_stories_archive_stories_deleted_successful")}),null===(a=window.StoriesArchive)||void 0===a||a.sendStoryAnalytic("delete_from_archive")},onFail:function(){return n.setState({isDeleteActionLoading:!1}),!0}})}),null,{yes_label:Object(s.t)("mobile_stories_archive_remove")})},t.prototype.createNarrativeFromSelectedStories=function(){var e,t,n;if(!(null===(e=this.state.selectedStories)||void 0===e?void 0:e.length))return!1;if((null===(t=this.state.selectedStories)||void 0===t?void 0:t.length)>O)r.g({type:r.d,text:Object(s.u)(O,Object(s.t)("mobile_stories_archive_max_narrative_stories_count_alert","raw"))});else{var i=null===(n=this.state.selectedStories)||void 0===n?void 0:n.map((function(e){return e.id})),a=Object(s.O)("narratives",{act:"create",owner_id:this.props.ownerId,selected:(null==i?void 0:i.length)?i.join(","):null,from:Object(s.O)("stories_archive",{owner_id:this.props.ownerId})});Object(b.c)(b.a.clickToAddToNarrative,this.props.ownerId,0,b.b.storyArchive),this.setState({isCreateNarrativeActionLoading:!0}),window.nav.go(a)}},t.prototype.resetSelectedStories=function(){this.setState({selectedStories:[]})},t.prototype.onStoryThumbCheck=function(e,t){if(e.preventDefault(),e.stopPropagation(),t){var n=y([],this.state.selectedStories);n.some((function(e){return e.id===t.id}))?n=n.filter((function(e){return e.id!==t.id})):n.push(t),this.setState({selectedStories:n})}},t.prototype.render=function(){return o.a.preact(f,w(w({},this.state),{onStoryThumbCheck:this.onStoryThumbCheck,onResetSelectedStoriesClick:this.resetSelectedStories,onDeleteStoriesActionClick:this.deleteSelectedStories,onCreateNarrativeActionClick:this.createNarrativeFromSelectedStories,storiesArchiveRef:this.storiesArchiveRef,storiesArchiveStoriesWrapperRef:this.storiesArchiveStoriesWrapperRef,storiesArchiveActionsRef:this.storiesArchiveActionsRef}))},t}(i.a)},t7Ww:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return _})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return d}));var i=n("r/ag"),a=n("29dZ"),o=n("+sJP"),r=n("EDm3");function s(e){var t=e.class?" "+e.class:"";return t=e.isBtn?Object(o.h)(t," ModalMenu__customBtn"):Object(o.h)(t," ModalMenu__item"),Object(a.a)({icon:e.icon,url:e.url,class:"ModalMenu__btn "+t,theme:e.theme?e.theme:"none",size:e.size?e.size:"",inner:e.inner,on_click:e.onclick,use_native_onclick:!0,attrs:e.attrs,"aria-label":e["aria-label"]||""})}function c(e){return{inner:[{inner:[e.inner],class:"ModalMenu__icon",tag:"div"}],class:"ModalMenu__iconWrapper",tag:"div"}}function l(e){return{inner:[e.inner],class:"ModalMenu__customBody",tag:"div"}}function u(e){return{inner:[e.inner],class:"ModalMenu__title",tag:"div"}}function d(e){return void 0===e&&(e={}),{inner:[Object(r.I)()],class:"ModalMenu__headerCloseButton",onClick:e.onClose?e.onClose:["ModalMenu.close","this"],"aria-label":Object(o.t)("mobile_close"),tag:"button"}}function _(e){return e.class+=" ModalMenuContent",e}t.g=function(e){var t=e.attached?"ModalMenu--attached":"",n=[];if(e.title&&n.push({class:"ModalMenu__title",inner:e.title}),e.body&&n.push({class:"ModalMenu__body",inner:e.body}),Object(o.A)(e.items)){var r=e.items.map((function(e){return e}));n.push(r)}e.close&&n.push(Object(a.a)({class:"ModalMenu__btn ModalMenu__cancel",theme:"secondary",size:"large",inner:e.closeText?e.closeText:Object(o.t)("mobile_cancel"),on_click:e.onClose?e.onClose:["ModalMenu.close","this"],use_native_onclick:!0}));var s=function(e){if(e&&e[0]&&e[0].inner&&e[0].inner.inner&&e[0].inner.inner[0]&&"ModalMenuHeader"===e[0].inner.inner[0].class)return!0;return!1}(n)?" ModalMenu--hasHeader":"";return Object(i.a)({id:e.id||"",class:"ModalMenu "+e.class+" "+t+" "+s,on_overlay_click_native:e.on_overlay_click?e.on_overlay_click:["ModalMenu.close","this"],content:n})}},tgcV:function(e,t,n){"use strict";function i(e){return new Promise((function(t,n){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.onload=function(){return t(i)},i.onerror=function(){return n(new Error("Stylesheet load error for "+e))},document.head.appendChild(i)}))}function a(e){var t,n=(t=e,new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onload=function(){200===i.status?e(i.response):n(i.response)},i.onerror=function(){n(i.response)},i.send()})));return n.then((function(e){var t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)})),n}var o;n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return h})),n.d(t,"b",(function(){return f}));var r=[];function s(e,t){var n=e;return t&&(n+="?"+t),new Promise((function(e,t){var i,a,o,r=document.getElementsByTagName("script");Array.from(r).some((function(e){return e.src===n}))?e():(i=n,a=function(n){n?t(n):e()},(o=document.createElement("script")).src=i,o.onload=function(){return a(null,o)},o.onerror=function(){return a(new Error("Script load error for "+i))},document.head.appendChild(o))}))}function c(e,t){var n=function(){if(void 0!==o)return o;try{var e=document.createElement("b");e.style.display="flex",o="flex"===e.style.display}catch(e){o=!1}return o}()?i:a,r=e;t&&(r+="?"+t);var s=document.getElementsByTagName("link"),c=Array.from(s).find((function(e){return e.href===r}));return c?Promise.resolve(c):n(r)}function l(e){window.stManager.staticFiles[d(e)]=Promise.resolve()}function u(){window.vk&&window.vk.stFiles&&window.stManager?(Object.keys(window.vk.stFiles).forEach((function(e){return l(e)})),window.vk.stFiles=[]):setTimeout(u,0)}function d(e){return e.replace(/^https:\/\/st[-\d]*\.vk\.com\//i,"static://")}function _(e){r[e]&&r[e]()}function p(e){return void 0===e&&(e={}),Promise.all(Object.keys(e).map((function(t){return n=t,i=e[t],o=d(n),window.stManager.staticFiles[o]||(n.includes(".js")?a=s(n,i):n.includes(".css")&&(a=c(n,i)),a&&(window.stManager.staticFiles[o]=a,a.catch((function(){window.stManager.staticFiles[o]=null}))),a||Promise.resolve());var n,i,a,o})))}function h(e){var t=window.vk.stNavMap||{};for(var n in t){if(t.hasOwnProperty(n))if(new RegExp(n).test(e)){p(t[n]||{});break}}}function f(){u(),window.stManager={done:_,staticFiles:[],registerLoadedScript:l}}},tlMv:function(e,t,n){"use strict";var i=n("g3t9");t.a=i.b},tqja:function(e,t){var n,i=(n={1:"SEND_EMAIL",2:"CALL_PHONE",6:"OPEN_GROUP_APP"},{processButton:function(e,t,i,a,o,r){if(void 0===r&&(r=!1),e.classList.contains("_locked"))return!1;var s=!0;return n[t]&&(s=!1),e.classList.add("_locked"),ajax.post("/groups",{_ajax:1,act:"proxy_cta_button",action:t,resource:i,group_id:a,hash:o},{onDone:function(){if(e.classList.remove("_locked"),r)r();else if(s){var t=attr(e,"href");nav.go(t)}}}),!s}});window.GroupActionButton=i},u33z:function(e,t,n){"use strict";n.r(t);var i=n("MUpH"),a=n("bZ/P");function o(){var e=Object(i.a)(['\n    <button type="','" class="','" ',">\n      ","\n    </button>\n  "]);return o=function(){return e},e}function r(){var e=Object(i.a)(['\n      <a class="','" href=',' target="','" ',">\n        ","\n      </a>\n    "]);return r=function(){return e},e}var s=function(e){var t=e.class?" "+e.class:"";if(t="MailButton"+t,"link"===e.type&&e.link){var n=e.link.href,i=e.link.target||"_blank";return a.a.html(r(),t,n,i,e.onClick,e.text)}var s=e.type;"button"===s&&"submit"===s||(s="button");return a.a.html(o(),s,t,e.onClick,e.text)};t.default=s;window.MailButton=s},uBUF:function(e,t,n){"use strict";function i(e){return e.tag=e.tag||"div",e}n.d(t,"a",(function(){return i}))},uo4j:function(e,t){ownerPhotoUpload.onUploadedDone((function(e){var t=geByClass1("feedAssistance_profilePhoto");if(t){var i=geByClass1("feedAssistanceProfilePhotoContent__avatar",t),a=geByClass1("feedAssistanceProfilePhotoContent__desc",t),o=geByClass1("feedAssistanceProfilePhotoContent__title",t),r=geByClass1("feedAssistance__footerButton",t);(function(e,t){if(window.Image){var i=new Image;i.onload=function(){return n(e,t)},i.src=e}else n(e,t)})(e=function(e){return e.replace(/"/g,"").replace(/'/g,"").replace(/</g,"").replace(/>/g,"")}(e),i),o&&(o.textContent=getLang("mobile_assistance_profile_photo_uploaded_title")),a&&(a.textContent=getLang("mobile_assistance_profile_photo_uploaded_desc")),FeedAssistance.setFilled(t),remove(r)}})),FeedAssistanceStats.registerTrackingCls("feedAssistance_profilePhoto");function n(e,t){var n;t&&(addClass("feedAssistanceProfilePhotoContent__avatar_uploaded",t),setStyle(t,"background-image","url("+e+")")),n=e,geByClass("al_u"+vk.id).forEach((function(e){domData(e,"photo")&&domData(e,"photo",n);var t=geByClass1("_u"+vk.id,e);t&&"IMG"===t.tagName&&(t.src=n)}))}},"v+Uj":function(e,t,n){"use strict";n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return p}));var i=n("z9sQ");var a=function(e){var t=[i.a.class("Slider",{snapping:!!e.snapping}),e.class||e.mix],n=e.snapping?null:["Slider._onWheel","event","this"];return{inner:[{inner:[{inner:[e.inner],class:"Slider__line",role:"presentation",tag:"div"}],attrs:e.attrs,class:["Slider__scroll","_preventMenuOpen"],onwheel:n,onScroll:e.onScroll,tag:"div"}],class:t,id:e.id,tag:"div"}},o=n("OcsD"),r=n("UxAg"),s=n("jk6M");window.Slider={scrollToElem:_,nextElem:f,prevElem:m},Slider._onWheel=v,onDOMReady(b),onDOMReady((function(){onBodyResize(g)}));var c=".Slider",l=".Slider--snapping",u=".Slider__scroll",d=".Slider__line";function _(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n="center"),e){var i=e.closest(u),a=e.offsetLeft;"center"===n&&(a-=i.offsetWidth/2-e.offsetWidth/2);var r=0;if(window.getComputedStyle){var s=getComputedStyle(e);(s.scrollMarginLeft||s.scrollSnapMarginLeft)&&(r+=Object(o.tc)(s.scrollMarginLeft||s.scrollSnapMarginLeft))}t&&i.scrollTo?(Object(o.v)(i,"left",a-r),i.scrollTo({left:a-r,behavior:"smooth"})):i.scrollLeft=a-r}}function p(e){return e=Object(o.M)(e),Object(r.a)(d,e).childNodes}function h(e,t){var n=Object(r.a)(u,e);return t||(t=p(e)),n.scrollWidth-n.offsetWidth<=n.scrollLeft?t.length-1:Array.from(t).map((function(e,t){return{index:t,scrollLeft:Math.abs(e.offsetLeft-n.scrollLeft)}})).sort((function(e,t){return e.scrollLeft-t.scrollLeft}))[0].index}function f(e,t,n){void 0===t&&(t=!1);var i=p(e=Object(o.M)(e)),a=h(e,i),r=i[a+1];f&&(_(r,t,n),e.setAttribute("data-current",(a+1).toString()))}function m(e,t,n){void 0===t&&(t=!1);var i=p(e=Object(o.M)(e)),a=h(e,i),r=i[a-1];r&&(_(r,t,n),e.setAttribute("data-current",(a-1).toString()))}function v(e,t){e.preventDefault();var n=e.deltaX,i=e.deltaY;Math.abs(n)>Math.abs(i)&&(t.scrollLeft+=n)}function g(){var e=Object(r.b)(l);Array.from(e).forEach((function(e){var t=Object(r.a)(u,e);t.scrollLeft=t.scrollLeft}))}function b(){(s.a.ios||s.a.msie_edge)&&(onDOMReady(w),window.page&&window.page.onChange(w),window.MutationObserver&&onDOMReady((function(){document.body&&new MutationObserver(A).observe(document.body,{subtree:!0,childList:!0})})))}function A(e){e.forEach((function(e){e.addedNodes.forEach((function(e){e.nodeType===Node.ELEMENT_NODE&&e.$$(c).forEach(y)}))}))}function w(){Object(r.b)(c).forEach(y)}function y(e){var t=getComputedStyle(e),n=Number(t.paddingTop.replace("px","")),i=Number(t.paddingBottom.replace("px",""));e.style.overflow="hidden",e.style.height=e.offsetHeight-n-i+"px",e.$(u).style.paddingBottom="20px"}t.a=a;window.Slider=a,Object(o.K)(a,{scrollToElem:_,nextElem:f,prevElem:m,_onWheel:v})},vOeY:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return l}));var i=n("4pfz"),a=n("+sJP"),o=n("OcsD"),r=n("4vml"),s=function(){function e(e,t,n){this.errors={},this.wasFocused={},this.serverErrors={},this.name=e,this.layout=t,this.options=n,this.errors=Object(a.y)(this.name).errors||{},this.serverErrors=this.errors}return Object.defineProperty(e.prototype,"values",{get:function(){return Object(i.b)(this.layout)},enumerable:!1,configurable:!0}),e.prototype.getSubmitButton=function(){return this.layout.querySelector("[type=submit]")},e.prototype.onFocus=function(e){this.wasFocused[e]=!0},e.prototype.validate=function(e,t){var n=this;void 0===e&&(e=!1);var a=Object(i.b)(this.layout),o={},s=t?[t]:Object.keys(a);return s.forEach((function(t){n.options.rules.forEach((function(i){var a=i.validator(n,t,e);a&&(o[t]=a)}))})),this.errors=o,s.forEach((function(e){var t=o[e]||n.serverErrors[e]||"";"string"!=typeof t&&(t=t.__raw__);var i=n.layout.querySelector("[name="+e+"]");if(i){var a=Object(r.a)(i);a&&(t?Object(r.b)(a,t):Object(r.b)(a,""),Object(r.c)(a,t?"error":""))}})),!(0!==Object.keys(o).length)},e}(),c={validator:function(e,t,n){var i=e.values;return!("pass_repeat"!==t||!e.wasFocused[t]&&!n||i[t]===i.pass)&&Object(o.W)("join_pwds_mismatch")}},l={validator:function(e,t,n){var a,r,s,c=e.values[t],l=[e.layout.elements[t]].filter(i.a)[0],u=null===(a=e.options.errorMessagesDefault)||void 0===a?void 0:a[t];return!(!e.wasFocused[t]&&!n)&&(l.required&&!c?null!==(r=null==u?void 0:u.required_error_msg)&&void 0!==r?r:Object(o.W)("mobile_form_field_err_required"):!l.checkValidity()&&(null!==(s=null==u?void 0:u.validation_regex_error_msg)&&void 0!==s?s:Object(o.W)("mobile_form_validation_error")))}}},vOib:function(e,t,n){"use strict";var i=n("UWnA"),a=n("8ZMO"),o=n("hG3N"),r=n("z9sQ"),s=n("+sJP"),c=n("rycc"),l=n("uBUF");function u(e){return(Object(s.A)(e)?Object(s.V)(e):[e]).join("")}function d(e){var t=u(e);return!t||"<div></div>"===t}var _=function(e){if(void 0===e&&(e={}),e.content_only)return{outerHTML:u(e.content)};var t=e.title,n=e.corner||{},s=e.inner||e.content||e.children,_=e.anchor,p=e.alert,h=e.style||{},f=e.attrs||{},m=e.noShadow,v=null!==e.count,g=e.theme||"gray";v&&(g="black");var b=e.pageBlock?"PageBlock PageBlock--separate":"",A=[t];if(v){var w={inner:[e.count],class:"Pad__count",tag:"span"};A.push(w)}return Object(l.a)({inner:[_?Object(a.a)({mix:"Pad__anchor",id:_}):null,p?Object(i.b)({inner:[Object(o.a)({inner:[p],class:"Pad__alert",theme:e.alert_theme})],style:{tiny_padding_bottom:!0}}):null,t?Object(i.b)({inner:[e.isHeaderPage?{inner:[A],class:"Pad__title",tag:"h1"}:{inner:[A],class:"Pad__title",tag:"h3"},Object(c.a)({inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class]})],class:"Pad__header"}):null,t?{inner:[s],class:["Pad__content",e.content_mix],tag:"div"}:s],tag:e.tag,attrs:f,class:[e.class||e.mix,r.a.class("Pad",{empty:d(s),noBorder:e.no_border,noCapsTitle:e.no_caps_for_title,style_extraTopPadding:h.extra_top_padding,theme:g,noShadow:m},"_"),b],ref:e.ref,"data-id":e.name||e.id})};t.a=_},vOql:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("LiVZ"),a=n("6VgB"),o=n("PU8N"),r={title:"",titleColor:"#000",titleAlign:"center",titleFontSize:58,titleFont:"TT Commons",voteButtonText:window.getLang("stories_poll_sticker_vote_button_text"),voteButtonTextAlign:"center",voteButtonTextColor:"#fff",voteButtonFontSize:49,voteButtonFont:"TT Commons",voteButtonBackgroundColor:"#3F8AE0",width:a.c,height:a.a,radius:50,offset:a.b,backgroundColor:"#fff",backgroundCircleColor:"#fff",backgroundCircleSize:90,foregroundCircleColor:"#3F8AE0",foregroundCircleSize:72};function s(e){return Object(o.i)("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSI+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04IDJhMiAyIDAgMTE0IDB2MjBhMiAyIDAgMTEtNCAwVjJ6bTggMTJhMiAyIDAgMTE0IDB2OGEyIDIgMCAxMS00IDB2LTh6TTIgOGEyIDIgMCAwMC0yIDJ2MTJhMiAyIDAgMTA0IDBWMTBhMiAyIDAgMDAtMi0yeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==").then((function(t){var n=Object.assign({},s.defaultOptions,e||{}),a=n.title,o=n.titleColor,r=n.titleAlign,c=n.titleFontSize,l=n.titleFont,u=n.voteButtonText,d=n.voteButtonTextAlign,_=n.voteButtonTextColor,p=n.voteButtonFontSize,h=n.voteButtonFont,f=n.voteButtonBackgroundColor,m=n.width,v=n.height,g=n.radius,b=n.offset,A=n.backgroundColor,w=n.backgroundCircleColor,y=n.backgroundCircleSize,O=n.foregroundCircleColor,k=n.foregroundCircleSize,j=document.createElement("canvas"),S=j.getContext("2d");if(!S)return Promise.reject("canvas context not found");j.width=Number(m),j.height=Number(v)+Number(b),S.fillStyle=String(A||""),Object(i.c)(S,0,Number(b),Number(m),Number(v),Number(g)),S.fill(),S.fillStyle=String(w||""),S.beginPath(),S.arc(Number(m)/2,Number(y),Number(y),0,2*Math.PI,!1),S.fill(),S.fillStyle=String(O||""),S.beginPath(),S.arc(Number(m)/2,Number(y),Number(k),0,2*Math.PI,!1),S.fill();S.drawImage(t,Number(m)/2-27,Number(y)-36,54,72),S.save(),S.font="500 "+c+"px "+l,S.fillStyle=String(o||""),S.textAlign=String(r||""),S.fillText(a,Number(m)/2,230),S.restore(),S.save();var C=Number(m)-75,E=(Number(m)-C)/2,T=Number(v)+Number(b)-103-35;S.fillStyle=String(f||""),Object(i.c)(S,E,T,C,103,29),S.fill(),S.restore(),S.save();var I=Number(m)/2,M=Number(v)+Number(b)-103+30;return S.font="500 "+p+"px "+h,S.fillStyle=String(_||""),S.textAlign=String(d||""),S.fillText(String(u||""),I,M),S.restore(),j}))}s.defaultOptions=r},vWwi:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d}));var i,a=n("OcsD"),o=n("jk6M"),r=n("zvhO"),s=!1,c=null,l=null;function u(e,t){if(void 0===t&&(t={}),window.MutationObserver&&!s){window.storybook||window.nav.saveScrollPosition();var n,u=document.body,_=Object(a.gc)(),p=u;if(c=p.style.overflow,s=!0,o.a.ios||o.a.ipad||(p.style.overflow="hidden"),t.forceScrollDisable&&(p.style.height="100%",document.documentElement.style.overflow="hidden"),l=new MutationObserver((function(){p.contains(e)||d()})),i=_,u){var h=!u.classList.contains("fixed");u.classList.add("fixed"),h&&Object(a.jc)(u,{top:"-"+_+"px"}),n=Object(r.a)(_)?_:void 0,o.a.safari&&Object(a.T)()<882&&document.scrollingElement&&(document.scrollingElement.scrollTop=_||0,setTimeout((function(){document.scrollingElement&&(document.scrollingElement.scrollTop=_||0)}),100),setTimeout((function(){document.scrollingElement&&(document.scrollingElement.scrollTop=_||0)}),300))}return l.observe(u,{attributes:!0,childList:!0,subtree:!0}),{bodyScrollTopBeforeOpen:n}}}function d(e,t){var n;if(void 0===t&&(t={}),window.MutationObserver){var o=null!==(n=null==t?void 0:t.bodyScrollTopBeforeOpen)&&void 0!==n?n:i,r=void 0===(null==t?void 0:t.bodyScrollTopBeforeOpen),u=document.body;if(s){if(u.style.overflow=c,(null==t?void 0:t.forceScrollDisable)&&(document.documentElement.style.overflow="initial"),null==l||l.disconnect(),u){var d=u.classList.contains("fixed");u.classList.remove("fixed"),d&&void 0!==o&&(Object(a.jc)(u,{top:""}),Object(a.gc)(o))}s=!1,r&&(i=void 0)}}}},vhZE:function(e,t,n){"use strict";var i=n("z9sQ"),a=n("z1UI"),o=n("EDm3");var r=function(e){void 0===e&&(e={});var t={},n=e.raw||"",r=e.hash||"",s=e.text||"";"album"===(e.attachment_type||"")&&(e.height-=60),e.type&&"blur"!==e.type||(e.width>=250&&e.height>=250?e.type="blurWithText":e.type="blur"),("blur"===e.type||e.only_icon)&&(delete e.button,delete e.title),e.type&&(t[e.type]=!0);var c,l=i.a.class("PostPhotoRestriction",t);"blur"!==e.type&&"blurWithText"!==e.type||(c=e.width<100||e.height<100?Object(o.mb)():Object(o.Mb)()),"block"===e.type&&(!e.forceText&&(e.width<300||e.height<250)&&(delete e.title,delete e.text),c=e.width<100||e.height<100?Object(o.ab)():Object(o.Ib)()),c={inner:[c],class:"SplashScreen__icon",tag:"div"},"block"!==e.type||e.title||(e.title=e.text);var u="PostPhotoRestriction.clear(this, event, '"+s+"', '"+e.button+"', '"+n+"', '"+r+"')";return{inner:[{inner:[Object(a.a)({title:e.title,icon_raw:c,more_text:e.button,more_type:"outlineMono",more_onclick:u,more_ontouchend:u,more_native_onclick:!0})],class:"PostPhotoRestriction__splash",tag:"div"}],class:l,tag:"div"}},s=n("he4e"),c=n("OcsD"),l=Object(c.K)(r,{clear:s.a,onClearConfirm:s.d,onClearDecline:s.e,isCleared:s.b,onClear:s.c});window.PostPhotoRestriction=l;t.a=l},vk58:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("29dZ"),a=n("+sJP"),o=n("z9sQ");function r(e){var t=e.btns||e.inner||[],n=e.mode||"horizontal",r=e.align||"start";Object(a.A)(e.inner)&&1===e.inner.length&&e.inner[0].length>1&&(t=e.inner[0]),e.nowrap&&(t=t.map((function(e){return e.nowrap=!0,e})));var s,c=o.a.class("BtnStack",{verticalOnSmallScreen:e.verticalOnSmallScreen,stretchOnSmallScreens:e.stretch_on_small_screens,table:e.nowrap,stretch:e.stretch,mode:n,align:r},"_"),l=t.map((function(e){if(!e)return null;var t=["BtnStack__btn"];if(e.class&&t.push(e.class),e.mix&&t.push(e.mix),e.class=Object(a.e)(Object(a.a)(t)),!!e._&&e._.__is_wd_internal_data||Object(a.b)(t,"CellButton")||(e=Object(a.m)(Object(i.a)(e),{nowrap:e.nowrap,is_icon:e.is_icon})),e.nowrap){var n=o.a.class("BtnStack__cell",{icon:e.is_icon},"_");return delete e.nowrap,{inner:[e],class:n,tag:"div"}}return e}));return e.after&&(s={inner:[e.after],class:o.a.class("BtnStack__cell",e.after_mix,"_"),tag:"div"}),{inner:[l[0]?l:null,s],class:c,tag:"div"}}},vy0q:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"c",(function(){return _}));var i=n("B+U2"),a=n("v+Uj"),o=n("+sJP"),r=n("EDm3");var s=function(e){void 0===e&&(e={});for(var t=e.elements,n=e.msgId,s={inline:!0,author_id:e.authorId||100},c=[],l=function(e){var a=t[e],r=a.pressed,l=a.buttons?a.buttons.map((function(t){return Object(i.a)([t],s,n,r,"carousel"+e,e)})):null,u=a.title||a.description||l,d=Object(o.f)("MsgTemplateCard",{"MsgTemplateCard--full":!!u,"MsgTemplateCard--photo":!u}),_=a.action;_&&"open_photo"===_.type&&(_.photo_id=a.photo_id+"/mail"+n),c.push({inner:[a.photo_src?{inner:[{src:a.photo_src,alt:"",tag:"img"},{class:"MsgTemplateCard__imageShadow",tag:"div"}],class:"MsgTemplateCard__image",tag:"div"}:null,u?{inner:[a.title||a.description?{inner:[a.title?{inner:[Wd.wrap(a.title)],class:"MsgTemplateCard__title",tag:"span"}:null,a.description?{inner:[Wd.wrap(a.description)],class:"MsgTemplateCard__subtitle",tag:"span"}:null],class:"MsgTemplateCardContent__text",tag:"div"}:null,l?{inner:[l],class:"MsgTemplateCardContent__buttons",tag:"div"}:null],class:"MsgTemplateCardContent",tag:"div"}:null],class:d,onclick:_?"MsgTemplates.Carousel.handleElementAction(event, "+JSON.stringify(_)+")":"",tag:"div"})},u=0;u<t.length;u++)l(u);var d=Object(o.c)(t)>1;return{inner:[Object(a.a)({inner:[c],class:"Slider--right",onScroll:["MsgTemplates.Carousel.onScroll","event"],snapping:!0}),d?{inner:[{inner:[Object(r.F)()],class:"MsgTemplate__button MsgTemplate__button--prev",onClick:["MsgTemplates.Carousel.moveSlider","this","prev"],tag:"button"},{inner:[Object(r.F)()],class:"MsgTemplate__button MsgTemplate__button--next",onClick:["MsgTemplates.Carousel.moveSlider","this","next"],tag:"button"}],class:"MsgTemplate__buttons",tag:"div"}:null],class:"MsgTemplate MsgTemplate--carousel",tag:"div"}},c=n("N4ZS"),l=n("UxAg");function u(e,t){if("open_link"===t.type){if("BUTTON"===e.target.tagName||e.target.closest(".MsgTemplateCardContent__buttons"))return;var n=Object(c.a)(t.link,!0);window.open(n)}else if("open_photo"===t.type){var i=(t.photo_id||"").split("/"),a=i[0],o=i[1];return photo.zopen(null,null,a,o,{})}}function d(e){var t=e.target.closest(".Slider"),n=Object(a.c)(t),i=Object(a.b)(t,n);t.classList.toggle("Slider--left",0!==i),t.classList.toggle("Slider--right",i<n.length-1)}function _(e,t){var n=e.closest(".MsgTemplate--carousel"),i=Object(l.a)(".Slider",n);"next"===t?Slider.nextElem(i,!0,"left"):Slider.prevElem(i,!0,"left")}t.a=s},w1QQ:function(e,t){window.FeedAssistance={hide:function(e,t,n){var i=domCA(e,".feedAssistance"),a=hasClass(i,"feedAssistance_filled");remove(i),a||function(e,t,n){var i=FeedAssistanceStats.getFromRef(e);ajax.post("/feed",{_ajax:1,type:t,hash:n,act:"hide_assistance",from:i})}(e,t,n);return!1},setFilled:function(e){var t=hasClass(e,"feedAssistance")?e:domCA(e,".feedAssistance");addClass("feedAssistance_filled",t)}}},wCFN:function(e,t,n){"use strict";var i=n("OcsD"),a=n("TYsd"),o=n("Po+v"),r=n("29dZ");window.page&&page.onChange((function(){$$(".AlertBox").forEach((function(e){return o.a.close(e)}))})),window.AlertBox=function(e,t,n,s){void 0===s&&(s={});var c=Object(i.l)(a.a.html(Object(o.a)({id:s.id,class:"AlertBox",scrollable:!0,header:{title:t||getLang("mobile_warning_header")},content:[e,{class:"Popup__buttons",inner:[Object(r.a)({onClick:n||"Popup.close(this)",use_native_onclick:!0,class:"Popup__button",theme:"regular",inner:a.a.wrap(getLang("mobile_close"))})]}]})));domInsert(document.body,c),o.a.open(c,!0)}},wTbK:function(e,t,n){"use strict";n.d(t,"g",(function(){return j})),n.d(t,"e",(function(){return E})),n.d(t,"b",(function(){return s.b})),n.d(t,"d",(function(){return s.f})),n.d(t,"a",(function(){return s.a})),n.d(t,"c",(function(){return s.d}));var i,a,o,r=n("OcsD"),s=n("t7Ww"),c=n("r/ag"),l=n("UxAg"),u=function(){function e(e){this.lastTime=0,this.lastRegisteredTime=0,this.lastCoordinates=[0,0],this.velocity={x:0,y:0},this.lastTime=e.time,this.lastCoordinates=[e.x,e.y],this.velocity={x:0,y:0}}return e.getVelocity=function(e,t,n){return{x:t/e||0,y:n/e||0}},e.prototype.registerEvent=function(t){if("touchmove"===t.type){var n=+t.touches[0].clientX,i=+t.touches[0].clientY,a=t.timeStamp-this.lastTime;if(t.timeStamp-this.lastRegisteredTime<=16.67)this.lastCoordinates=[n,i],this.lastTime=t.timeStamp;else{var o=n-this.lastCoordinates[0],r=i-this.lastCoordinates[1];this.velocity=e.getVelocity(a,o,r),this.lastTime=t.timeStamp,this.lastRegisteredTime=this.lastTime,this.lastCoordinates=[n,i]}}else window.clog&&window.clog("[Gestures.js] unhandled event "+t.type)},e}(),d=n("CQvH"),_=n("xt6h"),p="horizontal",h="vertical",f=!1,m=null,v=null,g=0,b=0,A=0,w={},y=null,O=Object(l.a)(".Popup__wrap",i),k=!1;function j(e,t,n,s){void 0===t&&(t=!0),void 0===n&&(n=""),void 0===s&&(s={});var u=s,_=u.settling,p=void 0===_?75:_,h=u.expandable,f=void 0!==h&&h;if(s.settling=p,s.expandable=f,i=c.a.open(e,t,{hash:n,withoutCloning:s.withoutPopupCloning}),w=s,O=Object(l.a)(".Popup__wrap",i),o=Object(l.a)(".Popup__content",O),void 0===s.swipeDown&&(s.swipeDown=!0),f&&C(i)){i.classList.add("ModalMenu--expandable");var m=(100-w.settling)/100*window.innerHeight;M=m,r.jc.animate(O,"transform",{duration:200,func:"ease"}),r.jc.transform(O,1,[0,m])}return R(),Object(r.Jb)(R),s.swipeDown&&window.innerWidth<882&&(scrollTop(0),Object(r.b)(o,"touchstart",T,{passive:!0}),Object(r.b)(o,"touchmove",P,{capture:!0}),Object(r.b)(o,"touchcancel touchend",x,{passive:!0}),Object(r.b)(O,"click",S,{passive:!0}),Object(r.b)(O,"click",S,{passive:!0})),(a=Object(d.d)(i))&&(a.exitIntent=function(){return!1}),i}function S(e){if(O&&e.target===O)return(a=Object(d.d)(i))&&(a.exitIntent=function(){return!1}),i}function C(e){var t=Object(l.a)(".ModalMenu__body",e)||Object(l.a)(".ModalMenuContent",e)||Object(l.a)(".Popup__content",e);return!(Object(r.T)()>=882)&&(t.scrollHeight||Object(r.U)(t))>=window.innerHeight}function E(e,t){if(void 0===t&&(t={}),e||(e=document.activeElement),e){var n=e.closest(".ModalMenu.Popup_open")||e;n&&n.classList.contains("ModalMenu")&&(e.classList.contains("Popup__overlay")&&Object(_.d)(w.onOverlayClick)&&w.onOverlayClick(),window.innerWidth<882?c.a.close(n,{smooth:!0,velocity:!(!y||!y.velocity)&&y.velocity,lastY:A,onClose:t.onClose}):setTimeout((function(){c.a.close(n),t.onClose&&t.onClose()})),Object(r.Zb)(o,"touchstart",T,{passive:!0}),Object(r.Zb)(o,"touchmove",P,{capture:!0}),Object(r.Zb)(o,"touchcancel touchend",x,{passive:!0}),Object(r.Zb)(O,"click",S,{passive:!0}),Object(r.Zb)(O,"click",S,{passive:!0}),v=null,g=0,b=0,m=null,I=!1,A=0,M=0,i=null,O=null,o=null,y=null,w={},Object(r.Jb)("__clear",R),a&&(a(),a=null))}}function T(e){if(e.touches&&e.touches.length>1)f=!1;else{var t=e.target.closest(".ScrollView")||Object(l.a)(".ScrollView",e.target);if(!Object(l.a)(".ModalMenu").classList.contains("ModalMenu--blocked")){var n=w.expandable&&C(i);k=n,v=e.touches[0],b=e.touches[0].clientX,g=e.touches[0].clientY,t&&t.scrollTop>1?f=!1:(y=new u({time:e.timeStamp,x:e.touches[0].clientX,y:e.touches[0].clientY}),f=!0)}}}var I=!1,M=0;function P(e){if(e.touches&&e.touches.length>1)f=!1;else if(v&&f){var t=e.touches[0];if(m||(m=Math.abs(b-t.clientX)>Math.abs(g-t.clientY)?p:h),m!==p){y.registerEvent(e);var n=-Math.min(0,g-t.clientY-M);0!==n&&(Object(r.j)(e),A=n,I||(i.classList.add("ModalMenu--dragging"),browser.ios&&r.jc.animate(O,"transform",{duration:50,func:"linear"}),I=!0),L(n),r.jc.transform(O,1,[0,n]))}}}function x(e){if(f)if(f=!1,i.classList.remove("ModalMenu--dragging"),I=!1,m!==p){m=null,L(A);var t=w.expandable&&C(i);k=t;var n=i.classList.contains("ModalMenu--expanded"),a=!n,o=function(e){void 0===e&&(e=[]);return e.find((function(e){return 0!==e.scrollTop||e.scrollHeight>e.offsetHeight}))}(e.path),s=!1;o&&(s=0!==o.scrollTop);var c=!1,l=!1;y&&(c=!s&&y.velocity.y>=.6,l=!s&&y.velocity.y<=-.15);var u=A/window.innerHeight*100,d="";n?d="expand":a&&(d="collapse");var _=d;c&&u<8?u=8:l&&(u=0),!t&&u>=8||u>=100-w.settling+8?_="close":n?u>=8&&!s&&(_="collapse"):a&&C(i)&&u<=100-w.settling&&(_="expand"),function(e){if(!e)return;i.classList.toggle("ModalMenu--expanded","expand"===e),"close"!==e&&O.style.removeProperty("transition");switch(e){case"collapse":i.classList.add("ModalMenu--restore");var t=0;C(i)&&(t=(100-w.settling)/100*window.innerHeight),M=t,r.jc.transform(O,1,[0,t]),L(M=t,!0),setTimeout((function(){i&&i.classList.remove("ModalMenu--restore"),0===t&&Object(r.jc)(O,{transform:""})}),200);break;case"expand":i.classList.add("ModalMenu--restore"),i.classList.add("ModalMenu--expanded"),r.jc.transform(O,1,[0,0]),L(M=0,!0),setTimeout((function(){i&&(R(),i.classList.remove("ModalMenu--restore"))}),200);break;case"close":M=0,E(i,w)}}(_),y=null}else m=null}function L(e,t){if(void 0===e&&(e=null),void 0===t&&(t=!1),k){var n=Object(l.a)(".ModalMenuHeader__title",O),i=Object(l.a)(".ModalMenuHeader__close",O);if(n&&i){var a=(100-w.settling)/100*window.innerHeight,o=1-Math.max(0,Math.min(1,(null===e?M:e)/a));t&&(r.jc.animate(n,"transform",{duration:250}),r.jc.animate(i,"transform, opacity",{duration:250})),r.jc.transform(n,1,[44*o,0]),r.jc.transform(i,o),Object(r.jc)(i,{opacity:o})}}}function R(){var e=Object(l.a)(".ModalMenuContent",i),t=Object(l.a)(".ModalMenuHeader",i);if(e&&t){var n=Object(r.U)(t),a=Object(r.U)(e),o=Math.min(Object(r.S)(),a+n+"px");Object(r.T)()>=882&&(o=null),Object(r.jc)(e,"height",o)}}Object(r.b)(window,"keydown",(function(e){var t=e.target&&e.target.closest(".ModalMenu")||document.activeElement&&document.activeElement.closest(".ModalMenu")||Object(l.a)(".ModalMenu.Popup_open");if(t)switch(e.keyCode){case 27:E(t,w)}})),Object(r.b)(window,"click",(function(e){if(e.isTrusted){var t=e.target&&e.target.closest(".ModalMenu")||document.activeElement&&document.activeElement.closest(".ModalMenu")||Object(l.a)(".ModalMenu.Popup_open"),n=!!e.target.closest(".ModalMenu");if(t&&n&&!e.target.closest(".Popup__content")){var i=Object(l.a)(".Popup__overlay",t);window.clog("Simulate modal overlay click"),i.click()}}}),{passive:!0});t.f=s.g;Object(r.K)(s.g,{open:j,close:E}),window.ModalMenu=s.g},wcVR:function(e,t,n){"use strict";var i={_def_opts:{enableHighAccuracy:!0,maximumAge:3e5,timeout:6e4},_provider:null,initW3C:function(){i._provider=navigator.geolocation,i.getCurrentPosition=function(e,t,n){i._provider.getCurrentPosition((function(t){void 0!==t.latitude?e(extend(t,{coords:extend(t.coords||{},{latitude:t.latitude,longitude:t.longitude})})):e(t)}),t,n)}},initGears:function(){var e=window.google;i._provider=e.gears.factory.create("beta.geolocation")},initSymbian:function(){var e=window.device;i._provider=e.getServiceObject("Service.Location","ILocation"),i.getCurrentPosition=function(e,t){i._provider.ILocation.GetLocation({LocationInformationClass:"BasicLocationInformation"},(function(n,i,a){4==i?t({code:2,message:"Position unavailable"}):e({timestamp:null,coords:{latitude:a.ReturnValue.Latitude,longitude:a.ReturnValue.Longitude,altitude:a.ReturnValue.Altitude,heading:a.ReturnValue.Heading}})}))}},initPalm:function(){i.getCurrentPosition=function(e,t,n){var i={};n&&(n.enableHighAccuracy&&1==n.enableHighAccuracy&&(i.accuracy=1),n.maximumAge&&(i.maximumAge=n.maximumAge),n.responseTime&&(n.responseTime<5?i.responseTime=1:n.responseTime<20?i.responseTime=2:i.timeout=3)),new window.Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:i,onSuccess:function(t){e({timestamp:t.timestamp,coords:{latitude:t.latitude,longitude:t.longitude,heading:t.heading}})},onFailure:function(e){1==e.errorCode?t({code:3,message:"Timeout"}):2==e.errorCode?t({code:2,message:"Position unavailable"}):t({code:0,message:"Unknown Error: webOS-code"+e.errorCode})}})}},getCurrentPosition:function(e,t,n){i._provider.getCurrentPosition(e,t,extend(i._def_opts,n||{}))},init:function(){var e=window,t=e.google,n=e.device,a=e.Mojo;try{var o="undefined";if(typeof navigator.geolocation!==o)i.initW3C();else if(typeof window.google!==o&&typeof t.gears!==o)i.initGears();else if(typeof n!==o&&typeof n.getServiceObject!==o)i.initSymbian();else{if(typeof a===o||"Mojo.Service.Request"==typeof a.Service.Request)return!1;i.initPalm()}}catch(e){return!1}return!0}};window.geo=i,t.a=i},wyHI:function(e,t){var n=window,i=n.gpeByClass,a=n.hasClass,o=n.addClass,r=n.removeClass,s=n.geByClass1,c=n.setStyle,l=n.tooltip,u=n.ajax;window.Fave={showActionsTT:function(e,t){cancelEvent(t);var n=i("FaveArticles__row",e);if(a(n,"wi_actions_opened"))Fave.hideActionsTT();else{var r=s("wi_actions_wrap",n),u=s("FaveArticles__row_actions",n);c(r,"top",e.offsetTop+e.offsetHeight+"px"),o(n,"wi_actions_opened"),l.addHandler(Fave.hideActionsTT),l.show(r,u)}},hideActionsTT:function(){r("wi_actions_opened",s("wi_actions_opened")),l.hide()},removeArticle:function(e,t,n){Fave.hideActionsTT();var a=i("FaveArticles__row",e);o(a,"removed"),u.post("fave.php",{act:"defave_article",link:t,hash:n},{onFail:function(){return r(a,"removed")}})},restoreArticle:function(e,t,n){var a=i("FaveArticles__row",e);r(a,"removed"),u.post("fave.php",{act:"enfave_article",link:t,hash:n},{onFail:function(){return o(a,"removed")}})}}},xAJ7:function(e,t,n){"use strict";var i=n("r/ag"),a=n("29dZ"),o=n("vk58");t.a=function(e){var t=function(e){var t=e.buttons,n=Object.keys(t).map((function(n){var i=t[n],o=i.theme;o="yes"!==n||o?"secondary":"regular";var r={"data-key":n,"data-force":e.force?1:0};return Object(a.a)({inner:[i.text],theme:o,url:i.href,attrs:r,on_click:i.onClick||"ConfirmPopup.onButtonClick(this, event);",use_native_onclick:!0})}));return Object(o.a)({inner:[n]})}(e),n={title:e.title};return Object(i.a)({inner:[Wd.wrap(e.text),{inner:[t],class:"Popup__buttons",tag:"div"}],class:"ConfirmPopup",header:n,scrollable:!0,attrs:' data-use-navigation="'+!!e.useNavigation+'"',on_overlay_click_native:e.onOverlayClick||"ConfirmPopup.onOverlayClick(this, event);"})}},xU72:function(e,t,n){"use strict";var i=n("29dZ"),a=n("Y6JH"),o=n("9b/I"),r=n("WWJR"),s=n("EDm3");t.a=function(e){return void 0===e&&(e={}),{inner:[{inner:[{inner:[Object(i.a)({inner:[Object(a.a)({icon:e.isLeftActionBack?Object(o.a)():Object(r.a)()})],theme:"header",class:"ModalPage__headerButton ModalPage__headerButton--close",onClick:e.onLeftActionClick,use_native_onclick:!0,is_icon:!0}),{inner:[e.title],class:"ModalPage__headerTitle",tag:"div"},e.isConfirmActionAvailable?Object(i.a)({inner:[Object(s.gb)()],theme:"header",class:"ModalPage__headerButton ModalPage__headerButton--confirm",onClick:e.onConfirmClick,use_native_onclick:!0,is_icon:!0}):null],class:"ModalPage__header",tag:"div"},{inner:[e.content],class:"ModalPage__content",id:e.contentId,tag:"div"}],class:"ModalPage__wrapper",tag:"div"}],class:"Popup ModalPage",tag:"div"}}},"y/eL":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("W9Tc");var a=n("jE6c"),o=n("DM2o");var r=n("JlTo");function s(e,t){if(!(window.__dev||window.vk&&(window.vk.zero||window.vk.__dev))){t=t||document.referrer||"";[[/(hash|dl)=\w+/g,"$1="],[/(\/(?:write|mail|im|al_im.php))(?:\?[a-z0-9&=_-]*)?$/,"$1"],[/(\/write)\d*(?:\?[a-zA-Z0-9&=_-]*)?$/,"$1"]].forEach((function(n){var i=n[0],a=n[1];e=e.replace(i,a),t=t.replace(i,a)})),Object(r.g)(e,t);var n=[/\/login\?.*$/];n.some((function(t){return t.test(e)}))||n.some((function(e){return e.test(t)}))||(!function(e,t){var n=location.protocol,r=window._tns&&(window._tns.tnsPixelSocdem||"83"),s=t.replace(/\*/g,"%2a").split("#")[0],c=window._tns&&window._tns.tnsPixelType;if(Object(a.x)().src=n+"//www.tns-counter.ru/V13a**clid:"+r+"*"+s+"*vk_com/ru/UTF-8/tmsec=vksite_total/"+Math.round(1e9*Math.random()),Object(i.b)("tns_track_sections")){var l=[[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bw=story-?\d+_\d+/,"content","story"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=video-?\d+_\d+/,"video","videoview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=(photo(_tag)?-?\d+_\d+|albums?-?\d+)/,"photo","photoview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=audio_playlist-?\d+_\d+/,"music","playlistview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=podcast-?\d+_\d+/,"music","podcastview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bz=clip-?\d+_\d+/,"clips","clipsview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bw=app\d+/,"games","gamesappview"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\b.*?\bw=product-?\d+_\d+/,"ecomm","product"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/feed\?section=likes(\/|\&|$)/,"content","likes"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/feed(\/|\?|$)/,"content","feed"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/friends(\/|\?|$)/,"content","friends"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/groups(\/|\?|$)/,"content","groups"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(id|public|club)\d+(\/|\?|$)/,"content","idpublicclub"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/@[\w-\.]+(\/|\?|$)/,"content","longread"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/bookmarks(\/|\?|$)/,"content","bookmarks"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/stickers(\/|\?|$)/,"content","stickers"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/im(\/|\?|$)/,"messenger","messenger"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(photos|tag\d+|(albums|photos)-?\d+|(album|photo)-?\d+_\d+)(\/|\?|$)/,"photo","photo"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(audio(s-?\d+)?|music)(\/|\?|$)/,"music","music"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/podcasts(-?\d+)(\/|\?|$)/,"podcasts","podcasts"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(videos-?\d+|video(-?\d+_\d+)?)(\/|\?|$)/,"video","video"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/(clips(-?\d+)?|clip-?\d+_\d+)(\/|\?|$)/,"clips","clips"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/services(\/|\?|$)/,"services","services"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/taxi(\/|\?|$)/,"taxi","taxi"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/eda(\/|\?|$)/,"eda","eda"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/worki(\/|\?|$)/,"worki","worki"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/market(-?\d+)?(\/|\?|$)/,"ecomm","ecomm"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/apps(\/|\?|$)/,"games","gamesapp"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/app\d+(_-?\d+)(\/|\?|$)/,"games","gamesapppage"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/docs(\/|\?|$)/,"docs","docs"],[/^https?:\/\/(?:(?:www|m)\.)?(?:\w+\.)*vk.com\/doc-?\d+_\d+(\/|\?|$)/,"docs","docdoc"]],u=window.cur&&window.cur.module||"other",d="other",_="other";l.some((function(t){if(t[0].test(e))return d=t[1],_=t[2],!0})),Object(o.a)("counters_check_tns",d,_,u)}"unauth"===c?Object(a.x)().src=n+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184674/"+Math.round(1e9*Math.random()):"has_rough"===c?Object(a.x)().src=n+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184675/"+Math.round(1e9*Math.random()):"not_has_rough"===c&&(Object(a.x)().src=n+"//www.tns-counter.ru/V13a****vk_ad/ru/UTF-8/tmsec=vkad_cid1015708-posid1184677/"+Math.round(1e9*Math.random()))}(e,t),function(){if(Object(i.b)("geminus_counter")){var e="pzBAVLtpzyiyDVIwmwjmX5a2zSVdA6eUI7mpf0ufDFf.57";if(window.pp_gemius_identifier)window.pp_gemius_hit(e);else{window.pp_gemius_identifier=e;var t=function(e){window[e]=window[e]||function(){var t=window[e+"_pdata"]=window[e+"_pdata"]||[];t[t.length]=arguments}};t("gemius_hit"),t("gemius_event"),t("pp_gemius_hit"),t("pp_gemius_event"),function(e,t){try{var n=e.createElement(t),i=e.getElementsByTagName(t)[0],a="http"+("https:"==location.protocol?"s":""),o="vkgalv";if(window.vk&&window.vk.countryISO)switch(window.vk.countryISO){case"BY":o="vkgaby";break;case"MD":o="vkgamd";break;case"EE":o="vkgaee"}n.setAttribute("async","async"),n.setAttribute("defer","defer"),n.src=a+"://"+o+".hit.gemius.pl/xgemius.js",i.parentNode.insertBefore(n,i)}catch(e){}}(document,"script")}}}(),Object(o.a)("counters_check",1))}}},yVza:function(e,t){window.FaceRecognitionSwitch={onChange:function(e,t){window.ajax.post(e,{checked:t.checked,_ajax:1})}}},yuVR:function(e,t){var n="friendsStat.events",i=null;function a(){clearTimeout(i);var e=lsGet(n)||[];if(e.length){lsSet(n);var t,a={act:"stats"};a=extend(a,(t={},each(e,(function(){t[this.type]?t[this.type].push(this.data):t[this.type]=[this.data]})),t)),ajax.post("/friends",a)}}window.FriendsStats={log:function(e,t){var o=function(e,t){var n=[],i=(new Date).getTime();switch(e){case FriendsStats.EVENTS.EVENT_VIEW_USER:n=[t.uid,i,t.pos,t.ref,t.blockType,t.trackCode];break;case FriendsStats.EVENTS.EVENT_HIDE_BLOCK:n=[i,t.ref,t.trackCode];break;case FriendsStats.EVENTS.EVENT_OPEN_USER:n=[t.uid,i,t.ref,t.trackCode]}return n.join("|")}(e,t);if(!o)return;var r=lsGet(n)||[];r.push({type:e,data:o}),lsSet(n,r),clearTimeout(i),i=setTimeout(a,1e4)},EVENTS:{EVENT_VIEW_USER:"show_user_rec",EVENT_HIDE_BLOCK:"hide_block",EVENT_OPEN_USER:"open_user"}},i=setTimeout(a,1e4)},z1UI:function(e,t,n){"use strict";var i=n("k+Df");t.a=i.a},z9Td:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i="mvk"},z9sQ:function(e,t,n){"use strict";n("OcsD");var i={class:function(e,t,n){void 0===t&&(t={});void 0===n&&(n="--");var i=[e];return Object.keys(t).forEach((function(o){if(a(o)){var r=t[o];!0===r?i.push(""+e+n+o):a(r)&&i.push(""+e+n+o+n+r)}})),i.join(" ")},setMod:function(e,t,n){var i,o=new RegExp("\\s*"+t+"(_[-a-zA-Z]+)?");i=!0===n?" "+t:a(n)?" "+t+"_"+n:"";o.test(e.className)?e.className=e.className.replace(o,i):e.className+=i}};function a(e){return"number"==typeof e||"string"==typeof e&&e}t.a=i;window.Bem=i},zHNa:function(e,t){var n=need("Control"),i=need("Popup"),a={init:function(){var e=geByClass1("_adultConfirm"),t=geByClass1("_adultConfirm__submit",e),i=geByClass1("adultConfirm__checkbox",e);toggleClass("adultConfirm__submit_disabled",t,!n.isChecked(i))},toggle:function(e){var t=gpeByClass("_adultConfirm",e.$control),n=geByClass1("_adultConfirm__submit",t);toggleClass("adultConfirm__submit_disabled",n,!e.checked)},submit:function(e,t){if(cancelEvent(e),!hasClass("adultConfirm__submit_disabled",t)){var n=gpeByClass("_adultConfirm",t),a=geByClass1("_adultConfirm__form",n),o={_ajax:1};each(geByTag("input",a),(function(e,t){var n=t.type.toLowerCase(),i=t.name.toLowerCase();"hidden"!==n&&"checkbox"!==n&&"radio"!==n||(o[i]=t.value)}));var r=attr(a,"action");ajax.post(r,o),i.close()}},back:function(e){cancelEvent(e),window.history?window.history.back():window.location="/"}};window.AdultConfirm=a},zRDV:function(e,t){var n="";window.DonutDuration={init:function(e){n=e.select_url||""},selectDuration:function(e){var t=document.querySelector("#value_link");if(t){var i=n.replace("{value}",e);t.setAttribute("href",i)}}}},zhKY:function(e,t,n){"use strict";var i=n("z9sQ"),a=n("UWnA"),o=n("+sJP");function r(e){void 0===e&&(e={});var t,n=e.name,r=e.description,s=e.label||e.inner,c=e.type,l=e.checked,u=e.disabled,d=e.on_change||e.onChange,_=e.ariaHiddenLabel?e.ariaHiddenLabel:"true",p="value"in e?e.value:"1",h=[e.class||e.mix,i.a.class("Control",{type:c},"_")],f=e.attrs||[];f=Object(o.m)({onclick:!0},f),"switcher"===c&&(t="switch");var m=e.name+"_"+p+"_label",v={inner:[{id:e.input_id,class:"Control__native",name:n,value:p,checked:!!l&&"checked",disabled:!!u&&"disabled",type:"switcher"===c?"checkbox":c,onChange:d?["Control._onChange","this",d]:null,"aria-labelledby":s?m:null,role:t,tag:"input"},{class:"Control__icon",tag:"div"},{inner:[{inner:[s],id:m,"aria-hidden":_,tag:"span"},r?{inner:[r],class:"Control__description",tag:"div"}:""],class:"Control__label",tag:"div"}],tag:"div"}.inner;return e.withoutWrap?{inner:[v],class:h,attrs:f,tag:"label"}:(f.role="menuitem",Object(a.b)({inner:[v],tag:"label",class:h,attrs:f}))}t.a=r},zouF:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("TYsd"),a=n("Po+v"),o=n("+sJP"),r=n("29dZ"),s=n("UxAg");function c(e,t,n,s){void 0===s&&(s={});var c=i.a.preactElemFromTemplate(Object(a.a)({id:s.id,class:"Confirm",scrollable:!0,header:{title:s.title||Object(o.t)("mobile_warning_header")},on_overlay_click_native:n,content:[e,{class:"Popup__buttons",inner:[Object(r.a)({onClick:t,use_native_onclick:!0,class:"Popup__button",theme:s.theme_accept_btn||"regular",url:s.yes_href,inner:s.yes_label||Object(o.t)("mobile_continue")}),Object(r.a)({onClick:n||"Popup.close(this, event)",use_native_onclick:!0,class:"Popup__button",theme:s.theme_close_btn||"secondary",url:s.no_href,inner:s.no_label||Object(o.t)("mobile_cancel")})]}]}));return a.a.open(c,!0,{withoutCloning:!0})}window.page&&window.page.onChange((function(){Object(s.b)(".Confirm").forEach((function(e){return a.a.close(e)}))})),window.Confirm=c},zvhO:function(e,t,n){"use strict";function i(e){return"number"==typeof e&&!isNaN(e)}n.d(t,"a",(function(){return i}))}},[[9,"runtime","vendor","icons","vendor~vkui","vendor~qr","b-93a435b854bd32d1172676df2ef0660b","b-cd1bd7666b0b0a417cbe4ad7de6f651d","b-cc249007038b89cf1982a1f77a49d64d"]]]);