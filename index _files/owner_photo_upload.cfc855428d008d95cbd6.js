(window.webpackJsonp=window.webpackJsonp||[]).push([["owner_photo_upload"],{"0ZFE":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("Y6JH"),a=n("OcsD"),o=n("Fbxv");function i(t,e){e=e||"al_loading";var n=Object(a.O)(e)||Object(a.M)(e);if(n){var i;if(!n&&!Object(a.gb)("BottomMenu__preloader",n))if("al_loading"!==e||!(null==(i=window)?void 0:i.getComputedStyle(n).getPropertyValue("--content_area_height"))){var c=document.getElementById("m").offsetHeight||0,s=document.getElementById("mfoot")&&document.getElementById("mfoot").offsetHeight||0;t=Object(a.S)()-c+s-16}n.style.height=t+"px",n.innerHTML=Wd.html(Object(r.a)(Object(o.a)())),Object(a.a)(e,n)}}window.alLoadingFix=i},"0hva":function(t,e,n){"use strict";n.d(e,"b",(function(){return p}));var r=n("vOib"),a=n("1VZq"),o=n("z1UI"),i=n("O5lf"),c=n("z9sQ");var s,l,u,d,b=function(t){void 0===t&&(t={});var e=window.lang,n=t.title||"",s=t.description||"",l=t.pretag,u=t.buttons||{},d=(t.photos||[]).map((function(t){return Object(a.a)({photo:t})})),b=null;if(t.is_loading)b=Wd.wrap(Object(i.a)({mix:"al_loading",type:"pageLoader"}));else{if(!d.length)return Object(o.a)({separator:!0,more_text:t.add_url&&t.is_owner?e.mobile_photos_placeholder_album_action:null,more_type:"primary",more_url:t.add_url,text:e.mobile_photos_placeholder_album_text});b={inner:[d],class:"AlbumPage__photos photos_page",tag:"div"}}var _=c.a.class("AlbumPage",{withoutDescription:!s});return{inner:[Object(r.a)({inner:[{inner:[{inner:[n],class:"AlbumPage__title",tag:"h2"},s&&{inner:[s],class:"AlbumPage__description",tag:"span"}],class:"AlbumPage__info",tag:"div"},u.prev,b,u.more,l]})],class:_,tag:"div"}},_=n("OcsD"),h=n("UxAg");function p(){Object(h.a)(".AlbumPage")&&(s=!1,l=!1,u=!1,d=!1,Object(_.Kb)(f),Object(_.Kb)(!0))}function f(){if(s||(s=Object(h.a)(".AlbumPage__title"),l=Object(_.U)(s)),u||(u=Object(h.a)(".header__title",Object(h.a)("#mhead"))),!u)return Object(_.Kb)("__clear",f);d||(d=Object(h.a)(".header__text",u));var t=Math.min(40,Math.max(0,Object(_.db)(s)-l-Object(_.gc)()));_.jc.transform(d,1,[0,t]),u.classList.toggle("header__title--initial-position",0===t)}var v=n("Cbap");v.a.getRouter().addRoute(/\/(?:album|tag)(-?\d+(?:_\d+)?)/,p),v.a.getRouter().addRoute(/\/(?:attachments\?act=choose_photo).*(?:album|tag)=(-?\d+(?:_\d+)?)/,p);e.a=b},"1VZq":function(t,e,n){"use strict";var r=n("z9sQ"),a=n("EDm3");var o=function(t){var e,n=t.photo,o=n.restriction;if(o&&"block"===o.type)e={inner:[{inner:[Object(a.Ib)()],class:"PhotosPhotoItem__restriction PhotosPhotoItem__restriction--doNotDisturb",tag:"div"}],class:"_image PhotosPhotoItem__photo",tag:"div"};else{var i=["_image",r.a.class("PhotosPhotoItem__photo",{blur:o&&"blur"===o.type})];e={inner:[o&&o.type?{inner:[Object(a.Mb)()],class:"PhotosPhotoItem__restriction PhotosPhotoItem__restriction--hide",tag:"div"}:null],style:"background-image: url("+n.src+")",attrs:n.attrs,class:i,tag:"div"}}return{inner:[e],href:n.href,class:"PhotosPhotoItem "+n.class,onclick:n.onclick,tag:"a"}};e.a=o},22:function(t,e,n){t.exports=n("24YH")},"24YH":function(t,e,n){"use strict";n.r(e);var r=n("yJWU");n("Db7M");function a(t,e,n,r,a){void 0===a&&(a=!1);var o=t+","+e+","+n;return a||(o=o+","+r),o}var o,i,c,s=n("OcsD"),l=n("TdLS"),u=n("PU8N");function d(t){return e=URL.createObjectURL(t),new Promise((function(t,n){var r=new Image;r.onload=function(){var e=Number(r.height),n=Number(r.width);t([n,e])},r.onerror=function(){n()},r.onabort=function(){n()},r.src=e}));var e}!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UPLOAD=1]="UPLOAD",t[t.NOT_ALLOWED_EXTENSION=2]="NOT_ALLOWED_EXTENSION",t[t.IMAGE_TOO_SMALL=3]="IMAGE_TOO_SMALL",t[t.IMAGE_TOO_BIG=4]="IMAGE_TOO_BIG",t[t.BAD_ASPECT_RATIO=5]="BAD_ASPECT_RATIO"}(o||(o={})),function(t){t.UPLOADED="uploaded",t.EXISTED="existed"}(i||(i={})),function(t){t[t.UPLOAD=1]="UPLOAD",t[t.SELECT=2]="SELECT",t[t.EDIT=3]="EDIT"}(c||(c={}));var b=function(){return(b=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},_=function(){function t(t,e){this.config=b({allowedTypes:["*"]},t),this.progressCallback=e}return t.prototype.validate=function(t){var e=this.config,n=e.constraints,r=e.allowedTypes,a=e.lang,i=!1;return r&&(i=r.some((function(e){return"*"===e||e===t.type}))),i?n?d(t).then((function(t){var e=n.maxWidth,r=n.minWidth,i=n.maxHeight,c=n.minHeight,s=n.maxAspectRatio,l=n.minAspectRatio,u=t[0],d=t[1],b=u/d;if(u>e||d>i){var _=(a["error_"+o.IMAGE_TOO_BIG]||"").replace("{width}",String(e)).replace("{height}",String(i));return Promise.reject({code:o.IMAGE_TOO_BIG,text:_})}if(u<r||d<c){_=(a["error_"+o.IMAGE_TOO_SMALL]||"").replace("{width}",String(r)).replace("{height}",String(c));return Promise.reject({code:o.IMAGE_TOO_SMALL,text:_})}return l&&l>b||s&&b>s?Promise.reject({code:o.BAD_ASPECT_RATIO,text:a["error_"+o.BAD_ASPECT_RATIO]}):Promise.resolve(null)})).catch((function(t){return t&&t.text&&t.code?Promise.reject(t):Promise.reject({code:o.UNKNOWN,text:a["error_"+o.UNKNOWN]})})):Promise.resolve(null):Promise.reject({code:o.NOT_ALLOWED_EXTENSION,text:a["error_"+o.NOT_ALLOWED_EXTENSION]})},t.prototype.upload=function(t){var e=this;return this.validate(t).then((function(){return new Promise((function(n,r){var a=new XMLHttpRequest,i=new FormData;i.append("file1",t),a.open("POST",e.config.url,!0),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE&&200===a.status){var t=void 0;try{a.responseText&&(t=JSON.parse(a.responseText))}catch(t){r({code:o.UNKNOWN,text:e.config.lang["error_"+o.UNKNOWN]})}n(t)}},a.onerror=function(){r({code:o.UPLOAD,text:e.config.lang["error_"+o.UPLOAD]})},a.upload.onprogress=function(t){e.progressCallback&&e.progressCallback(t.loaded,t.total)},a.send(i)}))}))},t}(),h=n("+sJP");function p(t){void 0===t&&(t={});var e=Object(h.W)(t.ownerName);return{inner:[{inner:[Object(h.t)("mobile_owner_avatar_edit_preview_header")],class:"OwnerAvatarEditPreview__header",tag:"div"},{inner:[{class:"OwnerAvatarEditPreviewThumbnail__preview",tag:"div"},{inner:[{inner:[e],class:"OwnerAvatarEditPreviewThumbnail__ownerName",tag:"div"},{inner:[Object(h.t)("mobile_owner_avatar_edit_preview_thumbnail_description")],class:"OwnerAvatarEditPreviewThumbnail__description",tag:"div"}],class:"OwnerAvatarEditPreviewThumbnail__content",tag:"div"}],class:"OwnerAvatarEditPreviewThumbnail",tag:"div"}],class:"OwnerAvatarEditPreview",tag:"div"}}var f=n("xU72"),v=n("TYsd"),m=n("r/ag"),g=n("29dZ"),O=n("zhKY"),w=n("KMpi");function j(t){void 0===t&&(t={});var e=t.avatarSrc,n=t.config||{},r=n.new_avatar_story_data&&n.new_avatar_story_data.shouldCreateNewAvatarStory;return{inner:[{inner:[Object(w.a)({mix:"OwnerAvatarEditPublisherStep__avatar",size:192,src:e}),{inner:[n.description],class:"OwnerAvatarEditPublisherStep__description",tag:"div"}],class:"OwnerAvatarEditPublisherStep__previewWrapper",tag:"div"},{inner:[Object(O.a)({type:"switcher",name:"OwnerAvatarEditPublisherStepPublishPost",label:n.publish_post_checkbox_label,checked:!0,onChange:t.onPostPublishChange}),r?Object(O.a)({type:"switcher",name:"OwnerAvatarEditPublisherStepPublishStory",label:n.publish_story_checkbox_label,checked:!0,onChange:t.onStoryPublishChange}):null],class:"OwnerAvatarEditPublisherStep__checkboxes",tag:"div"},Object(g.a)({inner:[n.save_button_done],class:"OwnerAvatarEditPublisherStep__submitButton",size:"large",use_native_onclick:!0,onClick:t.onSaveClick})],class:"OwnerAvatarEditPublisherStep",tag:"div"}}var y,S=n("W9Tc"),k=n("V4qE"),A=n("PovR"),P=n("DM2o");function T(t){var e={event_type:t};Object(P.a)("upload_photo_analytics",e)}!function(t){t.EVENT_SHARE_TO_STORY_TURN_OFF="share_to_story_turn_off",t.EVENT_SHARE_TO_STORY_TURN_ON="share_to_story_turn_on",t.EVENT_SHARE_TO_FEED_TURN_OFF="share_to_feed_turn_off",t.EVENT_SHARE_TO_FEED_TURN_ON="share_to_feed_turn_on"}(y||(y={}));var E=new(function(){function t(){var t=this;this.thumbnailCreatorHandler=function(e){var n;if(t.context.cropperResult=e,t.context.mode===c.UPLOAD||t.context.mode===c.SELECT)return(null===(n=t.context.publisherStep)||void 0===n?void 0:n.is_enabled)?t.openPublisherStep(e):t.saveOwnerAvatar().catch(console.error).then((function(e){var n,r,a=e[1];t.showDoneBoxAfterAvatarChange(!0,null===(r=null===(n=t.context.publisherStep)||void 0===n?void 0:n.new_avatar_story_data)||void 0===r?void 0:r.shouldCreateNewAvatarStory,null==a?void 0:a.ownerId,null==a?void 0:a.id)})).finally((function(){var e;null===(e=t.thumbnailCreator)||void 0===e||e.close(),t.closePublisherStep()})),!0;var r=e.crop,o=a(r.x,r.y,r.width,r.height,!1);return t.sendCropUpdate(t.context.ownerId,o,t.context.hash||"").then((function(t){t[0]&&window.nav.go(t[0])}))},this.onPostPublishChange=function(e){var n=(void 0===e?{}:e).checked;t.context.mode===c.UPLOAD&&T(n?y.EVENT_SHARE_TO_FEED_TURN_ON:y.EVENT_SHARE_TO_FEED_TURN_OFF)},this.onStoryPublishChange=function(e){var n=(void 0===e?{}:e).checked;t.context.mode===c.UPLOAD&&T(n?y.EVENT_SHARE_TO_STORY_TURN_ON:y.EVENT_SHARE_TO_STORY_TURN_OFF)},this.showDoneBoxAfterAvatarChange=function(t,e,n,r){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===n&&(n=0),void 0===r&&(r=0);var a=[],o={tag:"a",className:"link",href:"/story"+n+"_"+r,onclick:"NewAvatarStory.openNewAvatarStory(event, "+n+", "+r+")",inner:Object(s.W)("mobile_stories_new_avatar_story_success_box_open_story")};t&&e?a.push({inner:Object(s.W)("profile_avatar_changed_with_post_and_story_title"),attrs:{style:"margin-bottom: 8px;"}},o):t?n>0?a.push({inner:Object(s.W)("profile_avatar_changed_with_post_title")}):a.push({inner:Object(s.W)("groups_avatar_changed_with_post_title")}):e?a.push({inner:Object(s.W)("profile_avatar_changed_with_story_title"),attrs:{style:"margin-bottom: 8px;"}},o):n>0?a.push({inner:Object(s.W)("profile_avatar_changed_title")}):a.push({inner:Object(s.W)("groups_avatar_changed_title")}),k.g({type:k.e,text:{inner:a},duration:5*A.d})},this.selectPhoto=function(e,n,r){void 0===r&&(r="");var a=e?c.SELECT:c.EDIT;return t.context={ownerId:n,ownerName:r,mode:a,selectedPhotoId:e},t.initUI(r).then((function(r){t.fetchUploadConfig({owner_id:n,photo_id:e,mode:a}).then((function(e){t.context.publisherStep=e.publisherStep,t.context.hash=e.hash;var n=e.photo,o=e.rect;r.setSuccessHandler(t.thumbnailCreatorHandler),a===c.EDIT?Object(u.c)(n.src,o[0],o[1],o[2],o[3]).then((function(t){r.getFromPhoto(t.src)})).catch((function(t){throw t})):r.getFromPhoto(n.src)})).catch((function(t){throw t}))})).catch((function(t){console.error(t),k.g({text:Object(s.W)("mobile_unknown_error"),type:k.d})})),!1}}return t.prototype.initUI=function(t){var e=this;return void 0===t&&(t=""),Object(r.a)().then((function(n){return e.thumbnailCreator=new n({minSourceWidth:400,minSourceHeight:400,minCroppedHeight:400,minCroppedWidth:400,maxSourceWidth:8192,maxSourceHeight:8192,maxCroppedHeight:8192,maxCroppedWidth:8192,previewBlock:Object(S.b)("mvk_owner_new_avatar_preview_block")&&p({ownerName:t}),cropperOptions:{preview:".OwnerAvatarEditPreviewThumbnail__preview"}}),e.thumbnailCreator.initPopup(),e.thumbnailCreator}))},t.prototype.onUploadInputChange=function(t){var e=this;this.context={ownerId:Number(t.dataset.ownerId),ownerName:String(t.dataset.ownerName),mode:c.UPLOAD},this.prepareUpload().then((function(){var n;if(!(null===(n=null==t?void 0:t.files)||void 0===n?void 0:n[0]))throw new Error;return e.preparePhoto(t.files[0]).then((function(){e.startCrop()}))})).catch((function(t){console.error(t),k.g({text:"UploadError"===t.name?t.message:Object(s.W)("mobile_unknown_error"),type:k.d})}))},t.prototype.prepareUpload=function(){var t=this;return this.initUI(this.context.ownerName).then((function(){return t.fetchUploadConfig({owner_id:t.context.ownerId,mode:c.UPLOAD}).then((function(e){t.context.uploader=new _(e.uploadConfig),t.context.publisherStep=e.publisherStep})).catch((function(e){var n;throw null===(n=t.thumbnailCreator)||void 0===n||n.close(),e}))}))},t.prototype.preparePhoto=function(t){var e=this;return this.context.uploader?this.context.uploader.validate(t).then((function(){var n;return null===(n=e.context.uploader)||void 0===n?void 0:n.upload(t).then((function(t){return e.getPhotoSrcFromRawObject(e.context.ownerId,JSON.stringify(t)).then((function(n){e.context.photo=t,e.context.src=n}))}))})).catch((function(t){var n;if(null===(n=e.thumbnailCreator)||void 0===n||n.close(),t.text){var r=new Error(t.text);throw r.name="UploadError",r}})):Promise.reject()},t.prototype.startCrop=function(){if(!this.thumbnailCreator||!this.context.src)throw new Error;this.thumbnailCreator.setSuccessHandler(this.thumbnailCreatorHandler),this.thumbnailCreator.getFromPhoto(this.context.src)},t.prototype.saveOwnerAvatar=function(t,e){var n;void 0===t&&(t=!0),void 0===e&&(e=!0);var r=this.context.cropperResult,o=r.crop,i=r.cropped,s=null===(n=this.context.publisherStep)||void 0===n?void 0:n.new_avatar_story_data,u=a(o.x,o.y,o.width,o.height,!1),d=Promise.resolve(void 0);e&&(null==s?void 0:s.shouldCreateNewAvatarStory)&&(d=l.a.initNewAvatarStory(s,this.context.ownerId,i.base64));var b=this.context.mode===c.UPLOAD?this.sendPhotoAvatarSave(this.context.ownerId,JSON.stringify(this.context.photo),u,t?0:1):this.sendPhotoAvatarSelect(this.context.ownerId,this.context.selectedPhotoId||"",u,this.context.hash||"",t?0:1);return Promise.all([b,d.then((function(t){return!((null==t?void 0:t.response)&&t.response.upload_result&&s)||l.a.saveNewAvatarStory(s,t.response.upload_result)}))]).then((function(t){return t[0]&&window.nav.go(t[0][0]),t}))},t.prototype.openPublisherStep=function(t){var e;if(!this.publisherStepPopup){var n=Object(f.a)({title:null===(e=this.context.publisherStep)||void 0===e?void 0:e.title,isLeftActionBack:!0,onLeftActionClick:"OwnerPhotoUpload2.closePublisherStep();",content:j({avatarSrc:t.cropped.base64,config:this.context.publisherStep,onSaveClick:"OwnerPhotoUpload2.onPublisherStepDone()",onPostPublishChange:"OwnerPhotoUpload2.onPostPublishChange",onStoryPublishChange:"OwnerPhotoUpload2.onStoryPublishChange"})}),r=v.a.elem(n);this.publisherStepPopup=m.a.open(r,!0)}},t.prototype.onPublisherStepDone=function(){var t,e=this,n=this.publisherStepPopup.querySelector('input[name="OwnerAvatarEditPublisherStepPublishPost"]').checked,r=null===(t=this.publisherStepPopup.querySelector('input[name="OwnerAvatarEditPublisherStepPublishStory"]'))||void 0===t?void 0:t.checked;g.a.setDisabled(this.publisherStepPopup.querySelector(".ModalPage__headerButton--close"),!0),g.a.setLoading(this.publisherStepPopup.querySelector(".OwnerAvatarEditPublisherStep__submitButton"),!0),this.saveOwnerAvatar(n,r).catch(console.error).then((function(t){var a=t[1];e.showDoneBoxAfterAvatarChange(n,r,e.context.ownerId,null==a?void 0:a.id)})).finally((function(){var t;null===(t=e.thumbnailCreator)||void 0===t||t.close(),e.closePublisherStep()}))},t.prototype.closePublisherStep=function(){var t;null===(t=this.thumbnailCreator)||void 0===t||t.unlockControlButtons(),m.a.close(this.publisherStepPopup),delete this.publisherStepPopup},t.prototype.fetchUploadConfig=function(t){return window.ajax.post("/profile.php",{act:"upload_owner_photo",oid:t.owner_id,mode:t.mode,photo_id:t.photo_id}).promise.then((function(t){if(!t.json)throw new Error;return t.json.data[0]}))},t.prototype.getPhotoSrcFromRawObject=function(t,e){return window.ajax.post("/profile.php",{act:"get_image_src",photo:e,oid:t}).promise.then((function(t){if(!t.json||!t.json.data)throw new Error;if(null===t.json.data[0]){var e=new Error(t.json.data[1]);throw e.name="UploadError",e}return t.json.data[0]}))},t.prototype.sendCropUpdate=function(t,e,n){return window.ajax.post("/profile.php",{act:"update_avatar_crop",square_crop:e,oid:t,hash:n}).promise.then((function(t){if(!t.json)throw new Error;return t.json.data}))},t.prototype.sendPhotoAvatarSelect=function(t,e,n,r,a){return void 0===a&&(a=0),window.ajax.post("/profile.php",{act:"select_avatar",rect_crop:n,photo_raw:e,oid:t,hash:r,skip_post:a}).promise.then((function(t){if(!t.json)throw new Error;return t.json.data}))},t.prototype.sendPhotoAvatarSave=function(t,e,n,r){return void 0===r&&(r=0),window.ajax.post("/profile.php",{act:"save_avatar",rect_crop:n,photo:e,oid:t,skip_post:r}).promise.then((function(t){if(!t.json)throw new Error;return t.json.data}))},t}());window.OwnerPhotoUpload2=E},"2IoG":function(t,e,n){"use strict";var r=n("MUpH"),a=n("bZ/P");function o(){var t=Object(r.a)(["\n    <",' class="','" '," ",">\n      ","\n    </",">\n  "]);return o=function(){return t},t}e.a=function(t){void 0===t&&(t={});var e,n,r=a.a.list(t.inner);t.url?(e="a",n=a.a.attr("href",t.url)):(e=t.tag||"div",n="");return a.a.html(o(),e,t.mix,n,t.attrs,r,e)}},"6VgB":function(t,e,n){"use strict";n.d(e,"d",(function(){return a})),n.d(e,"e",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return s})),n.d(e,"f",(function(){return l})),n.d(e,"g",(function(){return u}));var r=n("PU8N"),a=157,o=1075,i=760,c=391,s=45;function l(t){return new Promise((function(e,n){window.ajax.post(Object(r.g)()?"stories.php":"al_stories.php",{act:"create_new_avatar_poll",hash:t},{onDone:e,onError:n,onFail:n})}))}function u(t,e,n){var r=Object.assign({},{pollStickerX:a,pollStickerY:o,pollStickerWidth:i,pollStickerHeight:c,pollStickerOffset:s},n||{}),l=r.pollStickerX,u=r.pollStickerY,d=r.pollStickerWidth,b=r.pollStickerHeight+r.pollStickerOffset;return{type:"poll",poll_id:e,poll_owner_id:t,clickable_area:[{x:l,y:u},{x:l+d,y:u},{x:l+d,y:u+b},{x:l,y:u+b}]}}},"8ZMO":function(t,e,n){"use strict";var r=function(t){return{class:["Anchor",t.mix],id:t.id,tag:"div"}};e.a=r},"9y81":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("bZ/P"),a=n("Mc5h"),o=function(t){var e,n=t.icon,o=t.class||t.mix;return Object(a.a)({mix:r.a.class(o,"Icon",(e={},e[n]=!0,e.active=t.active,e.blue=t.blue,e.bluer=t.bluer,e.dark=t.dark,e.selected=t.selected,e.small=t.small,e.white=t.white,e)),url:t.url,attrs:t.attrs})};function i(t){var e,n=t.icon,r={class:[t.class,Bem.class("Icon",(e={},e[n]=!0,e.active=t.active,e.blue=t.blue,e.bluer=t.bluer,e.dark=t.dark,e.selected=t.selected,e.small=t.small,e.white=t.white,e),"_")],href:t.url,attrs:t.attrs,tag:"a"};return r.tag=t.url?"a":"div",r}Object.assign(o,{toggleActive:function(t){t.classList.toggle(c)}});var c="Icon_active";e.b=o;window.Icon=o},Cbap:function(t,e,n){"use strict";var r=function(){function t(){this.routes=[]}t.getRouter=function(){return window.router||(window.router=new t),window.router};var e=t.prototype;return e.addRoute=function(t,e,n){this.routes.push({isActive:!1,test:t,activateCallback:e,deactivateCallback:n})},e.test=function(t){var e=t.test;if(nav.cur)return"function"==typeof e?e(window.nav.cur):e instanceof RegExp?e.test(window.nav.cur):!(!window.nav.cur||"string"!=typeof e)&&window.nav.cur.startsWith(e)},e.deactivateAllRoutes=function(){this.routes=this.routes.map((function(t){return t.isActive=!1,t.deactivateCallback&&t.deactivateCallback(),t}))},e.checkRoutes=function(){var t=this;this.routes=this.routes.map((function(e){var n=t.test(e);return n&&e.activateCallback&&e.activateCallback(),!n&&e.isActive&&e.deactivateCallback&&e.deactivateCallback(),e.isActive=n,e}))},t}();e.a=r,window.Router=r},DLiR:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=new(function(){function t(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}return t.prototype._onVisibilityChange=function(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((function(){})).catch(console.error)},t.prototype.requestWakeLock=function(){var t=this;return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((function(e){t.wakeLockSentinel=e})):Promise.reject()},t.prototype.isLocked=function(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released},t.prototype.lock=function(){var t=this;return this.requestWakeLock().then((function(){t.wakeLockSentinel&&document.addEventListener("visibilitychange",t.onVisibilityChange)})).catch((function(){}))},t.prototype.unlock=function(){var t=this;return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((function(){t.wakeLockSentinel=null}))):Promise.resolve()},t}())},GVTI:function(t,e,n){"use strict";n.d(e,"a",(function(){return _}));var r=n("vOib"),a=n("rc7J"),o=n("+sJP"),i=n("29dZ"),c=n("vk58"),s=n("Q8gl"),l=n("O5lf"),u=n("vhZE");function d(t){var e="wi_like_wrap";t.liked_people||(e+=" is_empty");var n="PhotoviewPage__description";return t.photo.description||(n+=" PhotoviewPage__description--empty"),{inner:[t.photo.caption?{inner:[Wd.wrap(t.photo.caption)],class:"PhotoviewPage__caption",tag:"div"}:null,{inner:[Wd.wrap(t.photo.description)],class:n,tag:"div"},{inner:[t.liked_people?t.liked_people:null],class:e,tag:"div"},t.buttons?{inner:[{inner:[t.buttons],class:"wi_buttons",tag:"div"}],class:"wi_buttons_wrap",tag:"div"}:null,t.author,t.replies],class:"PhotoviewPage__footer",tag:"div"}}function b(t){var e=window.lang;return{inner:[{inner:[t.edit_data.rotate.can_rotate?Object(c.a)({inner:[Object(i.a)({inner:[e.mobile_photos_edit_rotate_left],url:t.edit_data.rotate.left,stretch:!0}),Object(i.a)({inner:[e.mobile_photos_edit_rotate_right],url:t.edit_data.rotate.right,stretch:!0})],nowrap:!0}):null,{inner:[{inner:[e.mobile_photos_edit_desc_label],class:"fi_label",tag:"dt"},{inner:[{inner:[t.photo.description],name:"text",class:"textfield",rows:"4",tag:"textarea"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[{inner:[e.mobile_photos_edit_album_label],class:"fi_label",tag:"dt"},{inner:[{inner:[t.edit_data.albums.map((function(t){return{inner:[t.name],selected:t.selected?"selected":null,value:t.id,tag:"option"}}))],name:"aid",tag:"select"},{inner:[Object(s.a)({withoutWrap:!0,name:"cover",label:e.mobile_photos_edit_cover_label,type:"checkbox"})],class:"fi_subrow",tag:"div"}],class:"iwrap",tag:"dd"}],class:"fi_row",tag:"dl"},{inner:[Object(c.a)({inner:[Object(i.a)({inner:[e.mobile_photos_edit_save_btn],type:"submit"}),Object(i.a)({inner:[e.mobile_cancel],theme:"link",url:t.edit_data.back_url})]})],class:"fi_row",tag:"div"}],action:t.edit_data.action,method:"post",tag:"form"}],class:"form_item",tag:"div"}}function _(t){return void 0===t&&(t=[]),{inner:[Object.keys(t).map((function(e){return{inner:[{class:"fill",tag:"div"}],class:"pv_tag",id:"pv_tag"+e,style:function(t){if(!Object(o.A)(t))return"";var e=t[0];return Object(o.A)(e)?"left: "+e[0]+"%; top: "+e[1]+"%; width: "+e[2]+"%; height: "+e[3]+"%":""}(t[e]),tag:"div"}}))],class:"PhotoviewPage__tags",tag:"div"}}var h=function(t){void 0===t&&(t={});var e=t.info||{},n=t.photo||{},i=t.is_loading||!1,c=t.navigation_buttons||{},s=Object(o.h)("PhotoviewPage ",t.class);t.info&&(t.author=Object(a.a)({url:e.url,author_url:e.author_url,avatar:e.avatar,name:e.name,id:e.id,title:e.title,subtitle:e.subtitle,withoutBottomBorder:!t.has_replies})),t.photo||(t.photo={}),t.photo.description||(t.photo.description="");var h,p="",f=null;i&&(s=Object(o.h)(s," PhotoviewPage--skeleton"),n.width?p+=" width"+t.width+"px;":f=Wd.wrap(Object(l.a)({mix:"al_loading",type:"pageLoader"})));var v=["PhotoviewPage__photo"];t.photo.restriction&&("block"===t.photo.restriction.type?v.push("PhotoviewPage__photo--block"):"blur"===t.photo.restriction.type&&v.push("PhotoviewPage__photo--blur")),h=[{src:n.src,style:p,tag:"img"},_(t.tags)];var m,g=!!t.photo.restriction;return g&&((m=t.photo.restriction).width=t.width,m.height=t.height||t.width),Object(r.a)({inner:[{inner:[{inner:[f||{inner:[h],class:v,href:n.href,tag:"a"},{inner:[Object(u.a)(m)],class:"PhotoviewPage__restrictedInfo",style:g?"":"display: none;",tag:"div"},c],class:"PhotoviewPage__thumb",tag:"div"},t.edit_mode?b(t):d(t)],id:t.photo.id,tag:"div"}],class:s})};e.b=h},GtpT:function(t,e,n){"use strict";n.d(e,"b",(function(){return u}));var r=n("Y6JH"),a=n("z9sQ"),o=n("EDm3"),i=n("CW4u");var c=function(t){var e,n,c=t.album,s=c.url,l=c.title,u=c.photos_count_label,d=c.restriction,b="";if(d){var _={};_[d.type]=!0,b=a.a.class("AlbumItem__restriction",_)}if(e=t.emptyIcon?t.emptyIcon:Object(r.a)({icon:Object(i.a)()}),d&&"geo"===d.type)n={inner:[{inner:[Object(o.Ib)()],class:b,tag:"div"}],class:"AlbumItem__thumb",tag:"div"};else{var h=[a.a.class("AlbumItem__thumb",{blur:d&&"blur"===d.type})];n={inner:[!c||c.thumb||d?null:{inner:[e],class:"AlbumItem__emptyThumbIcon",tag:"div"},d&&d.type?{inner:[Object(o.Mb)()],class:b,tag:"div"}:null],class:h,"data-thumb-id":c.thumb_id,style:"background-image: url("+c.thumb+")",tag:"div"}}return{inner:[{inner:[n],class:"AlbumItem__thumbWrap",tag:"div"},{inner:[{inner:[l],class:"AlbumItemInfo__title",tag:"div"},{inner:[u],class:"AlbumItemInfo__subtitle",tag:"div"}],class:"AlbumItemInfo",tag:"div"}],href:s,class:"AlbumItem al_album",onclick:t.onClick,"data-count":c.count,tag:"a"}},s=n("OcsD"),l=n("UxAg");function u(t){if(!t.classList.contains("AlbumItem"))return{};var e=Object(s.zc)(Object(l.a)(".AlbumItemInfo__title",t))||"",n=Object(s.zc)(Object(l.a)(".AlbumItemInfo__subtitle",t))||"",r=t.getAttribute("href"),a=Object(l.a)(".AlbumItem__thumb",t),o=/url\("(.*)"\)/.exec(a.style.backgroundImage),i=!!o&&o[1],c=Object(l.a)(".AlbumItem__restriction",t),u=!1;return c&&(c.classList.contains("AlbumItem__restriction--blur")?u={type:"blur"}:c.classList.contains("AlbumItem__restriction--geo")&&(u={type:"geo"})),{album:{title:Wd.wrap(e),photos_count_label:n,url:r,thumb:i,restriction:u},onClick:t.getAttribute("onclick")}}e.a=c},I7Du:function(t,e,n){"use strict";var r=n("z9sQ");var a=function(t){void 0===t&&(t={});var e=t.on_change;return{inner:[{inner:[t.options.map((function(t){return t?{inner:[t.label],attrs:t.attrs,class:"Select__option",value:t.value,selected:t.selected?"selected":null,tag:"option"}:null}))],class:"Select__native",name:t.name,disabled:t.disabled,onchange:t.nativeOnChange?t.onChange:e?["Select._onChange","this",e]:null,required:t.required,tag:"select"}],class:[t.mix||t.class,r.a.class("Select",{disabled:t.disabled},"_")],tag:"div"}};e.a=a},IjIm:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n("PU8N"),a=n("LiVZ"),o=n("vOql"),i=n("6VgB"),c={newAvatarUrl:"",oldAvatarUrl:"",newAvatarStrokeWidth:17,newAvatarStrokeColor:"#fff",oldAvatarStrokeWidth:17,oldAvatarStrokeColor:"#fff",baseWidth:1080,baseHeight:1920,displayWidth:375,backgroundColor:"rgba(0, 0, 0, .16)",newAvatarInBackgroundBlur:160,avatarWidth:500,title:window.getLang("stories_new_avatar_story_title_header"),titleColor:"#fff",titleTextAlign:"center",titleFont:"TT Commons",titleFontSize:69,titleLineHeight:87,titleShadowOffsetX:0,titleShadowOffsetY:4,titleShadowBlur:12,titleShadowColor:"rgba(0, 0, 0, 0.24)",pollStickerX:i.d,pollStickerY:i.e,blobImageType:"image/jpeg",blobQuality:1};function s(t,e){var n=Object.assign({},s.defaultOptions,t||{}),i=n.newAvatarUrl,c=n.oldAvatarUrl,l=n.newAvatarStrokeWidth,u=n.newAvatarStrokeColor,d=n.oldAvatarStrokeWidth,b=n.oldAvatarStrokeColor,_=n.baseWidth,h=n.baseHeight,p=n.displayWidth,f=n.backgroundColor,v=n.newAvatarInBackgroundBlur,m=n.avatarWidth,g=n.title,O=n.titleColor,w=n.titleTextAlign,j=n.titleFont,y=n.titleFontSize,S=n.titleLineHeight,k=n.titleShadowOffsetX,A=n.titleShadowOffsetY,P=n.titleShadowBlur,T=n.titleShadowColor,E=n.pollStickerX,I=n.pollStickerY,x=n.pollStickerOptions,C=n.blobImageType,N=n.blobQuality;_=_||Number(s.defaultOptions.baseWidth),h=h||Number(s.defaultOptions.baseHeight),p=p||Number(s.defaultOptions.displayWidth),x=Object.assign({},{title:window.getLang("stories_new_avatar_story_poll_sticker_title")},x||{});var R=p*(h/_),M=e||document.createElement("canvas"),L=M.getContext("2d");return L?(M.width=_,M.height=h,M.style.width=p+"px",M.style.height=R+"px",new Promise((function(t,e){Object(r.j)([i,c]).then((function(n){var i=n[0],c=n[1];L.clearRect(0,0,M.width,M.height),L.fillStyle=String(f||""),L.fillRect(0,0,M.width,M.height),L.save(),L.filter="blur("+v+"px)";var s=Object(a.b)(i.naturalWidth,i.naturalHeight,M.width,M.height,.5,.5);if(L.drawImage(i,s.offsetLeft,s.offsetTop,s.width,s.height),L.restore(),"none"!==L.filter){var _=Object(r.a)(L);L.fillStyle="rgb("+_.r+", "+_.g+", "+_.b+")",L.fillRect(0,0,M.width,M.height)}L.save(),L.shadowOffsetX=Number(k),L.shadowOffsetY=Number(A),L.shadowBlur=Number(P),L.shadowColor=String(T||""),L.font="600 "+y+"px/"+S+"px "+j,L.fillStyle=String(O||""),L.textAlign=String(w);var h=null==g?void 0:g.split("{br}");null==h||h.forEach((function(t,e){var n=Number(S)*e,r=M.width/2,a=M.height/2-Number(S)*h.length/2+n-395;L.fillText(t,r,a)})),L.restore();var p=(M.width-Number(m))/2,R=Math.min(c.width,c.height),D=Math.min(i.width,i.height);L.save(),Object(a.a)(L,c,Number(m)/2,0,0,R,R,p-165,665,Number(m),Number(m)),L.lineWidth=Number(d),L.strokeStyle=String(b),L.stroke(),Object(a.a)(L,i,Number(m)/2,0,0,D,D,p+165,665,Number(m),Number(m)),L.lineWidth=Number(l),L.strokeStyle=String(u),L.stroke(),L.restore(),Object(o.a)(x).then((function(e){L.drawImage(e,Number(E),Number(I)),null==M||M.toBlob(t,C,N)})).catch(e)})).catch(e)}))):Promise.reject(new Error("canvas context not found"))}s.defaultOptions=c},KMpi:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n("TYsd"),a=n("EDm3"),o=n("+sJP"),i=n("uBUF");function c(t){var e,n,c=t.mode||"image",l=t.size||"inherit",u=t.src?Object(o.A)(t.src)?t.src:[t.src]:[],d=t.borderRadius||"full",b=t.backgroundTheme?Math.abs(t.backgroundTheme)>6?Math.abs(t.backgroundTheme)%6+1:t.backgroundTheme:1,_=t.mix?Object(o.A)(t.mix)?t.mix.join(" "):t.mix:"",h=function(t,e,n,r,a,o){return["Avatar","Avatar--mode-"+t,"Avatar--size-"+e,"Avatar--images-"+n,"Avatar--borderRadius-"+r,"image"!==t&&"Avatar--theme-"+a,o]}(c,l,u.length,d,b,_),p=t.inner?Object(o.F)(t.inner)?t.inner:r.a.wrap(t.inner):null,f=null,v=null,m=null;return"text"===c?(e=t.text,n=t.textLength||2,f={inner:[s(e,n)],class:"Avatar__text",tag:"div"}):(v=function(t){for(var e=[],n=t.length<=4?t.length:4,r=0;r<n;r++){var a=r+1;e.push({class:"Avatar__image Avatar__image-"+a,style:"background-image: url('"+t[r]+"')",tag:"div"})}return e}(u),u.length||p||(m=Object(a.X)())),Object(i.a)({inner:[v,m,f,p],tag:t.href?"a":"div",href:t.href,class:h,attrs:t.attrs,role:"img"})}function s(t,e){void 0===e&&(e=2);for(var n="",r=Object(o.g)(Object(o.k)(Object(o.i)(t))).split(" "),a=r.length,i=0;i<a;i++)n+=Object(o.P)(r[i],0,1,"utf-8");return n=Object(o.P)(n,0,e,"utf-8"),n=Object(o.j)(n)}},LiVZ:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return o}));var r=function(t,e,n,r,a,o,i,c,s,l,u){var d=c||r,b=s||a,_=l||o||e.naturalWidth,h=u||i||e.naturalHeight;t.beginPath(),t.arc(d+n,b+n,n,Math.PI,Math.PI+Math.PI/2),t.lineTo(d+_-n,b),t.arc(d+_-n,b+n,n,Math.PI+Math.PI/2,2*Math.PI),t.lineTo(d+_,b+h-n),t.arc(d+_-n,b+h-n,n,2*Math.PI,Math.PI/2),t.lineTo(d+n,b+h),t.arc(d+n,b+h-n,n,Math.PI/2,Math.PI),t.closePath(),t.save(),t.clip(),t.drawImage(e,r,a,o,i,c,s,l,u),t.restore()},a=function(t,e,n,r,a,o){var i={};if("number"==typeof o)i={tl:o,tr:o,br:o,bl:o};else{var c={tl:0,tr:0,br:0,bl:0};for(var s in c)i[s]=i[s]||c[s]}t.save(),t.beginPath(),t.moveTo(e+i.tl,n),t.lineTo(e+r-i.tr,n),t.quadraticCurveTo(e+r,n,e+r,n+i.tr),t.lineTo(e+r,n+a-i.br),t.quadraticCurveTo(e+r,n+a,e+r-i.br,n+a),t.lineTo(e+i.bl,n+a),t.quadraticCurveTo(e,n+a,e,n+a-i.bl),t.lineTo(e,n+i.tl),t.quadraticCurveTo(e,n,e+i.tl,n),t.closePath(),t.restore()},o=function(t,e,n,r,a,o){var i,c,s=t/e;return s>n/r?(i=r,c=r*s):(c=n,i=n/s),{width:c,height:i,offsetLeft:(n-c)*(a=void 0===a?.5:a),offsetTop:(r-i)*(o=void 0===o?.5:o)}}},Mc5h:function(t,e,n){"use strict";var r=n("2IoG");e.a=r.a,window.Brick=r.a},O5lf:function(t,e,n){"use strict";var r=n("9y81"),a=n("Y6JH"),o=n("z9sQ"),i=n("Fbxv"),c=function(t){void 0===t&&(t={});var e=t.mix||"",n="pageLoader"===(t.type||"gray"),c=o.a.class("Spinner",{pageLoader:n,hidden:t.isHidden,fixed:t.isFixed}),s=e+" "+c;if(n)return Wd.html({inner:[Object(a.a)(Object(i.a)())],class:s,tag:"div"});return Object(r.b)({mix:s,icon:"spinner"})};var s=n("jE6c");var l={show:function(t){Object(s.j)(t)&&t.classList.remove("Spinner--hidden")},hide:function(t){Object(s.j)(t)&&(t.classList.contains("Spinner--hidden")||t.classList.add("Spinner--hidden"))}};Object.assign(c,l),window.Spinner=c;e.a=c},PU8N:function(t,e,n){"use strict";n.d(e,"g",(function(){return a})),n.d(e,"f",(function(){return o})),n.d(e,"d",(function(){return i})),n.d(e,"b",(function(){return c})),n.d(e,"l",(function(){return s})),n.d(e,"a",(function(){return l})),n.d(e,"k",(function(){return u})),n.d(e,"e",(function(){return d})),n.d(e,"i",(function(){return b})),n.d(e,"j",(function(){return _})),n.d(e,"h",(function(){return p})),n.d(e,"c",(function(){return f}));var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};function a(){return!!window.isMVK}function o(t){return void 0===t&&(t=""),new Promise((function(e,n){var r=document.createElement("video");r.addEventListener("loadedmetadata",(function(){return e(r.duration)}),{once:!0}),r.addEventListener("error",n,{once:!0}),r.crossOrigin="anonymous",r.preload="metadata",r.src=t}))}function i(t){return new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(){if(404===r.response.status)return n();e(r.response)},r.onerror=n,r.send()}))}function c(t){try{return t.type.split("/").splice(-1)[0]}catch(t){return null}}var s=function(){};function l(t,e,n,r,a){void 0===e&&(e=0),void 0===n&&(n=0);var o,i={r:0,g:0,b:0};r=r||t.canvas.width,a=a||t.canvas.height;try{o=t.getImageData(e,n,r,a)}catch(t){return i}for(var c=-4,s=0;(c+=20)<o.data.length;)++s,i.r+=o.data[c],i.g+=o.data[c+1],i.b+=o.data[c+2];return i.r=~~(i.r/s),i.g=~~(i.g/s),i.b=~~(i.b/s),i}function u(t){return new Promise((function(e,n){var r=document.createElement("video");r.muted=!0,r.autoplay=!0,r.addEventListener("canplay",(function(){r.pause(),e(r)}),{once:!0}),r.addEventListener("error",n,{once:!0}),r.crossOrigin="anonymous",r.src=t}))}function d(t,e){void 0===e&&(e=[0]);var n=[];return new Promise((function(r,a){var o=document.createElement("canvas"),i=o.getContext("2d"),c=t.videoWidth,s=t.videoHeight;o.width=c,o.height=s,function l(u){var d=t.currentTime;t.addEventListener("seeked",(function(){null==i||i.drawImage(t,0,0,c,s,0,0,c,s),t.currentTime=d,b(o.toDataURL("image/jpeg",1)).then((function(a){n.push(a),u>=e.length-1?(t.src="",r(n)):l(u+1)})).catch(a)}),{once:!0}),t.currentTime=-1===e[u]?t.duration:e[u]}(0)}))}function b(t){return new Promise((function(e,n){var r=new Image;r.crossOrigin=t.startsWith("data:")?null:"Anonymous",r.onerror=function(){return n(new Error("Failed to load image's URL: "+t))},r.onload=function(){return e(r)},r.src=t}))}var _=function(t){return new Promise((function(e){var n=t.map((function(t){return b(t)}));Promise.all(n).then((function(t){return e(t)})).catch((function(){}))}))};function h(t,e){var n,r,a,o,i,c,s,l,u={normal:"400",500:"500",600:"600",bold:"700"},d={tolerance:2,delay:100,glyphs:"",success:function(){},error:function(){},timeout:5e3,weight:"400",style:"normal"},b={display:"block","font-size":"48px","line-height":"normal","font-variant":"normal","white-space":"nowrap",position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:"auto",height:"auto",margin:"0",padding:"0"};function _(t){var e=[];return each(t,(function(t,n){e.push(t+":"+n)})),e.join(";")}function h(t,e,n){return Math.abs(t.width-e.offsetWidth)>n||Math.abs(t.height-e.offsetHeight)>n}function p(){o||(utilsNode.appendChild(i),o=!0,a={sansSerif:{width:s.offsetWidth,height:s.offsetHeight},serif:{width:c.offsetWidth,height:c.offsetHeight}},browser.opera&&!browser.chrome?(s.style.fontFamily='"'+t+'", sans-serif',c.style.fontFamily='"'+t+'", serif'):(setStyle(s,"font-family",'"'+t+'", sans-serif'),setStyle(c,"font-family",'"'+t+'", serif'))),o&&a&&(h(a.sansSerif,s,e.tolerance)||h(a.serif,c,e.tolerance))?(re(i),e.success()):(new Date).getTime()-r.getTime()>e.timeout?(re(i),e.error()):!o&&"requestAnimationFrame"in window?window.requestAnimationFrame(p):window.setTimeout(p,e.delay)}for(var f in d)e.hasOwnProperty(f)||(e[f]=d[f]);b["font-weight"]=e.weight,b["font-style"]=e.style,!e.glyphs&&"fonts"in document?(e.timeout&&(n=setTimeout((function(){e.error()}),e.timeout)),function(n){each(null===document||void 0===document?void 0:document.fonts,(function(r){r.family.toLowerCase()===t.toLowerCase()&&(u[r.weight]||r.weight)===""+e.weight&&r.style===e.style&&r.load().then((function(){e.success(),clearTimeout(n)}))}))}(n)):(l="AxmTYklsjo190QW"+e.glyphs,r=new Date,i=ce("div"),s=ce("div",{innerHTML:l}),c=ce("div",{innerHTML:l}),s.setAttribute("style",_(extend({"font-family":"sans-serif"},b))),c.setAttribute("style",_(extend({"font-family":"serif"},b))),i.appendChild(s),i.appendChild(c),p())}function p(t,e){return new Promise((function(n,a){h(t,r(r({},e),{glyphs:"",success:function(){var t=function(){n(),(null==e?void 0:e.success)&&e.success()};browser.safari?setTimeout(t,150):t()},error:function(){a(),(null==e?void 0:e.error)&&e.error()}}))}))}function f(t,e,n,r,a,o){return void 0===o&&(o=0),new Promise((function(i,c){("string"==typeof t?b(t):Promise.resolve(t)).then((function(t){var s=document.createElement("canvas");s.width=90===o||270===o?t.naturalHeight:t.naturalWidth,s.height=90===o||270===o?t.naturalWidth:t.naturalHeight;var l=s.getContext("2d");if(l){l.fillStyle="#fff",l.fillRect(0,0,l.canvas.width,l.canvas.height),o?(l.translate(s.width/2,s.height/2),l.rotate(o*Math.PI/180),l.drawImage(t,-t.naturalWidth/2,-t.naturalHeight/2)):l.drawImage(t,0,0);var u=l.getImageData(e,n,r,a),d=document.createElement("canvas");d.width=r,d.height=a;var _=d.getContext("2d");if(_)return _.putImageData(u,0,0),b(d.toDataURL("image/jpeg",1)).then(i).catch(c);i(t)}else i(t)})).catch(c)}))}},Q8gl:function(t,e,n){"use strict";var r=n("OcsD"),a=n("zhKY"),o=n("TYsd"),i={setChecked:function(t,e){void 0===e&&(e=!0);d(t).checked=e},isChecked:function(t){return d(t).checked}},c=i;i._onChange=u;var s=".Control",l=".Control__native";function u(t,e){o.a.handle(e,{$control:t.closest(s),name:t.name,checked:t.checked,value:t.value})}function d(t){return t.$(l)}var b=Object(r.K)(a.a,c);e.a=b;window.Control=b},TdLS:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n("tgcV"),a=n("PU8N"),o=n("IjIm"),i=n("OcsD"),c=n("6VgB"),s=n("bKAG"),l=n("V4qE");var u={openNewAvatarStory:function(t,e,n){t.metaKey||t.ctrlKey||(t.preventDefault(),window.Stories.init(e+"/"+e+"_"+n,{source:s.c.PROFILE_SNACKBAR}))},saveNewAvatarStory:function(t,e){return Object(s.f)(e,t.newAvatarStorySaveHash).then((function(t){return t.story})).catch((function(t){l.g({type:l.d,text:t&&t.message||Object(i.W)("global_error")})}))},initNewAvatarStory:function(t,e,n){var l;return Object(r.a)((l={},l[t.newAvatarStoryFontsCssPath]=null,l)).then((function(){return Promise.all([Object(a.h)("TT Commons",{weight:500}),Object(a.h)("TT Commons",{weight:600})])})).then((function(){return Promise.all([Object(o.a)({newAvatarUrl:n,oldAvatarUrl:t.currentPhoto,title:Object(i.W)("mobile_stories_new_avatar_story_title_header"),pollStickerOptions:{title:Object(i.W)("mobile_stories_new_avatar_story_poll_sticker_title"),voteButtonText:Object(i.W)("mobile_stories_poll_sticker_vote_button_text")}}),Object(c.f)(t.newAvatarStoryCreatePollHash).then((function(t){return t||Promise.reject()})).then((function(n){return Object(s.e)({clickable_stickers:JSON.stringify({original_width:1080,original_height:1920,clickable_stickers:[Object(c.g)(e,n)]}),hash:t.newAvatarStoryUploadUrlHash,entry_point:s.b.CHANGE_AVATAR,ref:window.cur.module})}))]).then((function(t){var e=t[0],n=t[1];return window.StoryPublisher.uploadStoryBlobToServer(e,n)}))}))}};window.NewAvatarStory=u},UWnA:function(t,e,n){"use strict";var r=n("WWoJ");n.d(e,"a",(function(){return r.a})),e.b=r.b},V4qE:function(t,e,n){"use strict";n.d(e,"g",(function(){return k})),n.d(e,"f",(function(){return T})),n.d(e,"a",(function(){return v})),n.d(e,"e",(function(){return O})),n.d(e,"d",(function(){return w})),n.d(e,"b",(function(){return j})),n.d(e,"c",(function(){return y}));var r=n("z9sQ"),a=n("29dZ"),o=n("Y6JH"),i=n("+sJP"),c=n("xlrz"),s=n("XJmI"),l=n("EXPB"),u=n("0qaj"),d=function(t){void 0===t&&(t={});var e=t.position||"bottom",n=!(!t.type||t.image),d={class:r.a.class("SnackbarItem__cell",{left:!0,image:!!t.image,top:t.avatar&&"left"===t.avatar_position,icon:n},"_")},b={class:r.a.class("SnackbarItem__cell",{right:!0,avatar:!!t.avatar},"_")},_=!1,h=!1;if(t.type){_=!0;var p=null;switch(t.type){case 1:p=Object(o.a)(Object(c.a)());break;case 2:p=Object(o.a)(Object(s.a)());break;case 3:p=Object(o.a)(Object(l.a)());break;case 4:p=Object(o.a)(Object(u.a)())}d.inner={class:"SnackbarItem__icon",inner:p}}t.image&&(_=!0,d.inner={class:"SnackbarItem__image",inner:{tag:"img",src:t.image}});t.action&&(h=!0,b.inner=Object(a.a)({theme:"none",class:"SnackbarItem__action",url:t.action.url,target:t.action.target,on_click:t.action.onclick,use_native_onclick:!0,inner:Wd.wrap(t.action.text),attrs:t.action.attrs}));if(t.avatar){var f={tag:"img",class:"SnackbarItem__avatar",src:t.avatar};t.avatar_position&&"right"!==t.avatar_position?"left"===t.avatar_position&&(_=!0,d.inner=f):(h=!0,b.inner=f)}return{style:t.style?t.style:"",class:["SnackbarItem_"+t.id,"SnackbarItem--"+e+" ",r.a.class("SnackbarItem",{static:!!t.static,vertical:!!t.vertical,hasIcon:n}),t.className||t.class],attrs:{"data-snackbar-id":t.id},inner:[{class:"SnackbarItem__table",inner:[_?d:null,t.text?{class:r.a.class("SnackbarItem__cell",{text:!0},"_"),inner:{class:"SnackbarItem__text",inner:Object(i.F)(t.text)?t.text:Wd.wrap(t.text)}}:null,h?b:null]}]}};var b=n("OcsD"),_=n("UxAg"),h=n("kr3z"),p=n("uEFA"),f=n("ZMWW");window.Snackbar={init:k,close:T,_onActionClick:function(t,e){var n=g[e];if(!n)return void Object(b.hb)(e);var r=n.callback,a=n.url;r?"function"==typeof r?r.call(null,t,{id:e,url:a}):Wd.handle2(r,t,{id:e,url:a}):Object(b.hb)(e)},_onRestoreClick:function(t,e,n){var r=e.closest(".SnackbarItem"),a=Object(b.v)(r,"snackbar-id"),o=g[a];t.stopPropagation(),t.preventDefault();var i=o.callback;i&&("function"==typeof i?i.call(null,t,{id:a,url:n}):Wd.handle2(i,t,{id:a,url:n}));T(a),h.a.click(n,null,{url_params:{_ajax:1,_snackbar:1}})}};var v="mail",m=0,g={},O=1,w=2,j=3,y=4,S=[];function k(t){if(!f.a.isIntegrated){var e=isFinite(t.duration)?t.duration:5e3,n=m++,r=t.action&&t.action.callback,a=t.action&&t.action.url;t.position=t.position||"common";var o=t.position;t.id=n,r&&!t.action.onclick&&(t.action.onclick=["Snackbar._onActionClick","event",n]),t.bottom&&(t.style="bottom: "+t.bottom+"px");var i,c=Wd.elem(SnackbarItem(t));return function(t,e){if("common"===e.position)Object(b.f)(t,document.body);else if(e.position===v){var n="msg"===window.store.mail.cur.page?Object(_.a)(".messenger__layer_page .messenger__header"):Object(_.a)(".messenger__layer_convo .messenger__header");Object(b.f)(t,n)}setTimeout((function(){t.classList.add("SnackbarItem_added")}),100)}(c,t),e&&(i=P(n,e)),Object(b.b)(c,"touchstart",L,{passive:!0}),Object(b.b)(c,"touchmove",D,{capture:!1}),Object(b.b)(c,"touchcancel touchend",B,{passive:!0}),g[n]={id:n,timer:i,callback:r,url:a,duration:e,position:o},S.push(n),A(),n}f.a.sendMessage("show_snackbar",{type:t.type,text:t.text})}function A(){var t=(S=S.filter((function(t){var e=g[t],n=E(t);return!(!e||!n)}))).reduce((function(t,e){var n=g[e];return t[n.position]||(t[n.position]=[]),t[n.position].push(e),t}),{});Object.keys(t).forEach((function(e){var n=t[e],r=0,a=e===v?8:12;n.forEach((function(t,n){var o=E(t),i=Object(b.U)(o);g[t].vertical=e===v?r:-r,b.jc.transform(o,1,[0,g[t].vertical]),r+=i+a}))}))}function P(t,e){return setTimeout((function(){T(t,!1)}),e)}function T(t,e){var n=g[t],r=E(t);n&&(n.timer&&clearTimeout(n.timer),delete g[t]),r&&function(t,e){if(Object(b.Zb)(t,"touchstart",L,{passive:!0}),Object(b.Zb)(t,"touchmove",D,{capture:!1}),Object(b.Zb)(t,"touchcancel touchend",B,{passive:!0}),e)return Object(b.Xb)(t),void A();t.classList.add("SnackbarItem--closing");if(!t)return;t.classList.add("SnackbarItem_removed"),setTimeout((function(){Object(b.Xb)(t),A()}),600)}(r,e)}function E(t){return Object(_.a)(".SnackbarItem_"+t)}onDOMReady((function(){onBodyResize(A)}));var I=!1,x=null,C=!1,N=0,R=!1,M=Object(b.T)();function L(t){if(M=Object(b.T)(),t.touches&&t.touches.length>1)I=!1;else{var e=t.target.closest(".SnackbarItem");e.classList.add("SnackbarItem--dragging");var n=Object(b.v)(e,"snackbar-id");if(M>=p.d&&(R=!0),g[n].position===v){R=!1;var r=Object(_.a)(".messenger");M=Object(b.ab)(r),g[n].parentXY=Object(b.cb)(r)}else g[n].parentXY=Object(b.cb)(bodyNode);g[n].timer&&clearTimeout(g[n].timer),x=t.touches[0],N=t.touches[0].clientX,I=!0,C=n,document.body.style.overflow="hidden"}}function D(t){var e=C;if(t.preventDefault(),t.touches&&t.touches.length>1)I=!1;else if(x&&I){var n=t.touches[0],r=t.target.closest(".SnackbarItem"),a=-(N-n.clientX);R&&(a=Math.min(a,0));var o=Object(b.bb)(r),i=(Object(b.ab)(r)+a)/2+o-g[e].parentXY[0],c=i>=.95*M||i<=M/.95-M;g[e].canClose=c,b.jc.transform(r,1,[a,g[e].vertical])}}function B(t){var e=t.target.closest(".SnackbarItem");e.classList.remove("SnackbarItem--dragging");var n=Object(b.v)(e,"snackbar-id"),r=g[n];if(g[n].dragging=!1,C=!1,document.body.style.overflow="visible",r.canClose){var a=Object(b.bb)(e)>0?Object(b.T)():-Object(b.T)();return Object(b.T)()>=p.d&&(a=Object(b.bb)(e)>Object(b.T)()/2?Object(b.T)():-Object(b.T)()),b.jc.transform(e,1,[a,g[n].vertical||0]),void T(n)}g[n].timer=P(n,r.duration),e&&b.jc.transform(e,1,[0,g[n].vertical||0])}window.SnackbarItem=d},WWoJ:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var r=n("8ZMO"),a=(n("p5n7"),n("I7Du")),o=n("9y81"),i=(n("29dZ"),n("z9sQ")),c=n("uBUF");function s(t){void 0===t&&(t={});var e=t.anchor,n=t.attrs||{},a=t.style||{},s=t.url,l=t.count,u=s&&!a.no_go_icon&&!l,d=t.tag;d||(d=s?"a":"div");var b=null;return u?b=Wd.wrap(Object(o.b)({mix:"Row__right",icon:"chevron_right"})):l&&(b={inner:[l],class:"Row__right Row__count",tag:"div"}),Object(c.a)({inner:[e?Object(r.a)({id:e}):null,b,t.icon?{inner:[t.icon],class:"Row__icon "+t.icon_class,tag:"div"}:null,t.content||t.inner],tag:d,class:[t.mix||t.class,i.a.class("Row",{go:u,style_withBorder:a.with_border,style_withBorderForce:a.with_border_force,style_withHover:a.with_hover,style_smallPaddings:a.small_paddings,style_noPaddingTop:a.no_padding_top,style_noPaddingBottom:a.no_padding_bottom,style_tinyPaddingTop:a.tiny_padding_top,style_tinyPaddingBottom:a.tiny_padding_bottom,paddingTop_short:a.padding_top_short},"_")],attrs:n,href:s,role:t.role})}function l(t){return u({anchor:t.anchor,style:t.style,label:t.label,content:Object(a.a)(t)})}function u(t){return s({anchor:t.anchor,url:t.url,style:t.style,content:[d({is_mini:t.is_mini,label:t.label}),b({content:t.content})]})}function d(t){return{inner:[t.label],class:[i.a.class("Row__label",{mini:t.is_mini},"_"),t.class||""].join(" "),tag:"div"}}function b(t){return{inner:[t.content],class:["Row__labeledContent",t.class||""].join(" "),tag:"div"}}e.b=s},bKAG:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"e",(function(){return l})),n.d(e,"f",(function(){return u}));n("jE6c");var r,a,o,i=n("PU8N"),c=function(){return(c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},s=16;function l(t){return new Promise((function(e,n){window.ajax.post(Object(i.g)()?"stories.php":"al_stories.php",c({act:"get_upload_url"},t),{onDone:e,onError:n,onFail:n})}))}function u(t,e){return new Promise((function(n,r){window.ajax.post(Object(i.g)()?"stories.php":"al_stories.php",{act:"save",upload_result:t,hash:e},{onDone:n,onError:r,onFail:r})}))}!function(t){t.PHOTO="photo",t.VIDEO="video"}(r||(r={})),function(t){t.SWIPE="swipe",t.NAVIGATION_BUTTON="navigation_button",t.SIT_POSTING="sit_posting",t.LINK="link",t.STORY_REPLY="story_reply",t.STORY_REPOST="story_repost",t.CATALOG_ADD="catalog_add",t.DIALOG="dialog",t.STORY_LIVE_FINISHED="story_live_finished",t.DIALOG_VKME="dialog_vkme",t.STORY_VIEWER_FINISHED="story_viewer_finished",t.PUSH_TRY_MASK="push_try_mask",t.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",t.LINK_MASK="link_mask",t.POSTING="posting",t.NEW_STORY_AVATAR="new_story_avatar",t.STORY_REPLIES_LIST="story_replies_list",t.STORIES_FEED="stories_feed",t.STORIES_SEARCH_NEWS="stories_search_news",t.QUESTION_STICKER="question_sticker",t.LIST_MIDDLE="list_middle",t.ARCHIVE_EMPTY_BUTTON="archive_empty_button",t.ARCHIVE_MENU_BUTTON="archive_menu_button",t.IM="im",t.PROFILE_BUTTON="profile_button",t.SHARE="share",t.MINI_APP="mini_app",t.SYSTEM_SHARING="system_sharing",t.SHORTCUT="shortcut",t.ARCHIVE_SHARING="archive_sharing",t.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",t.STORY_VIEWER_MUSIC="story_viewer_music",t.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",t.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",t.CHANGE_AVATAR="change_avatar"}(a||(a={})),function(t){t.FEED="feed",t.FEED_MIDDLE="feed_middle",t.LINK="link",t.PROFILE="profile",t.IM_DIALOGS="im_dialogs",t.IM_DIALOG_HEADER="im_dialog_header",t.SNIPPET="snippet",t.REPLY="reply",t.REPLIES_LIST="replies_list",t.REPLY_STORY="reply_story",t.DISCOVER="discover",t.STORIES_MANAGE="stories_manage",t.USER_PERSONAL_CARD="user_personal_card",t.GROUP_PERSONAL_CARD="group_personal_card",t.NARRATIVE_SNIPPET="narrative_snippet",t.NARRATIVE_STORY="narrative_story",t.NARRATIVE_LINK="narrative_link",t.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",t.NARRATIVE_SECTION="narrative_section",t.FAVE="fave",t.SPAMFEED="sf",t.ADS_PREVIEW="ads_preview",t.LIST_MIDDLE="list_middle",t.PLACE_STORY_LIST="place_story_list",t.SEARCH_STORY_LIST="search_story_list",t.STORY_ARCHIVE="story_archive",t.IM_MSG_LIST="im_msg_list",t.NOSPAM="nospam",t.PROFILE_SNACKBAR="profile_snackbar"}(o||(o={}))},"bZ/P":function(t,e,n){"use strict";var r={};function a(t,e){return t+'="'+e+'"'}function o(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return a(t,i(n))}}function i(t){return t[0]+"("+t.slice(1).map(c).join(", ")+")"}function c(t){return"number"==typeof t||"event"===t||"this"===t?t:JSON.stringify(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(t,e){var n,r=[];"string"==typeof e&&((n={})[e]=!0,e=n);return Object.keys(e).forEach((function(n){var a=e[n];!0===a?r.push(t+"_"+n):a&&r.push(t+"_"+n+"_"+a)})),r}Object.assign(r,{html:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var a="";return t.forEach((function(t,e){var r=n[e];a+=t+(r||0===r?r:"")})),a}}),Object.assign(r,{attr:a,onBlur:o("onblur"),onClick:o("onclick"),onFocus:o("onfocus"),onInput:o("oninput"),onKeyDown:o("onkeydown"),onKeyPress:o("onkeypress"),onKeyUp:o("onkeyup"),onMouseDown:o("onmousedown"),onMouseUp:o("onmouseup"),onScroll:o("onscroll"),onSubmit:o("onsubmit"),onTouchEnd:o("ontouchend"),onTouchMove:o("ontouchmove"),onTouchStart:o("ontouchstart"),onWheel:o("onwheel"),onChange:o("onchange")}),Object.assign(r,{list:function(t,e){void 0===e&&(e=null);Array.isArray(t)||(t=[t]);return e?t.map(e).join(""):t.join("")}}),Object.assign(r,{class:function(){for(var t=[],e=null,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return r.forEach((function(n){"string"==typeof n?(t.push(n),e=n):n&&(t=t.concat(s(e,n)))})),t.join(" ")},parseClass:function(t,e){var n={};return e.trim().split(/\s+/).forEach((function(e){if(e!==t){var r=e.replace(t+"_","").split("_");n[r[0]]=!(r.length>1)||r[1]}})),n}});e.a=r;window.q=r},cGUQ:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("jE6c"),a={},o=function(t){if(a[t])return t;try{return encodeURIComponent(t)}catch(t){return""}};function i(t,e){var n=[];for(var a in t)if(t.hasOwnProperty(a)&&null!=t[a]&&!Object(r.m)(t[a]))if(Object(r.i)(t[a]))for(var i=0,c=0,s=t[a].length;i<s;++i)null==t[a][i]||Object(r.m)(t[a][i])||(n.push(o(a)+"["+c+"]="+o(t[a][i])),++c);else n.push(o(a)+"="+o(t[a]));return e||n.sort(),n.join("&")}},g3t9:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n("+sJP");function a(t){return void 0===t&&(t={}),{class:Object(r.f)("Separator",{"Separator--hideOnDesktop":t.hideOnDesktop,"Separator--noOffset":t.noOffset,"Separator--gray":t.gray},t.className||t.class),tag:"div"}}e.b=a},gF8j:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n("uQjJ"),a=n("PU8N"),o=n("DLiR"),i=browser.iphone||browser.ipad||browser.ipod;function c(t){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:t.element,element:null,idleTimeout:3e4},t)}function s(t,e,n){Object(a.g)()?window.addEvent(t,e,n,{passive:!0}):window.addEvent(t,e,n)}function l(t,e,n){Object(a.g)()?window.removeEvent(t,e,n,{passive:!0}):window.removeEvent(t,e,n)}function u(){return document.visibilityState||document.webkitVisibilityState}function d(){var t="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?t+="webkit":t=""),t}extend(c.prototype,r.a.prototype),extend(c.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.g)()&&this._isTopLevel()&&d()&&l(document,d(),this.onVisiblityChange),Object(a.g)()&&i||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(t){this.is_idle=!0,t||this.opts.onIdleCb(),this.emit("idle")},unidle:function(t){this.is_idle=!1,t||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.g)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.g)()&&this._isTopLevel()&&d()&&s(document,d(),this.onVisiblityChange),Object(a.g)()&&i||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(o.a.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},getActiveTime:function(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange:function(){"visible"===u()?this.cbActiveB():this.cbInactiveB()},_isTopLevel:function(){var t=this.opts.focusElement;return t===window||t===document},_isFocused:function(){var t=this.opts.focusElement;if(this._isTopLevel()){var e=u();return"string"==typeof e&&"visible"===e}return document.activeElement===t}})},hG3N:function(t,e,n){"use strict";var r=n("pRml");e.a=r.a},he4e:function(t,e,n){"use strict";n.d(e,"a",(function(){return _})),n.d(e,"c",(function(){return l})),n.d(e,"d",(function(){return h})),n.d(e,"e",(function(){return p})),n.d(e,"b",(function(){return d}));var r=n("OcsD"),a=n("+cqQ"),o=n("UxAg"),i=n("r/ag"),c=n("29dZ"),s=n("zouF"),l=Object(a.a)(),u={};function d(t){var e=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(t)[2];return!!u[e]||!!u[t]}nav.onBeforeGo((function(){Object(o.b)(".Confirm[id^=restr]").forEach((function(t){p(t.id)}))}));var b={};function _(t,e,n,a,o,i){if(e&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()),i){t&&c.a.setLoading(t,!0,"white");var l="restr_"+Object(r.mc)();if(t){var u=t.closest(".PostPhotoRestriction");Object(r.v)(u,"clear-id",l)}return function(t,e,n,r,a){window.photoview._toggleTouches(!1),window.clog("[PostPhotoRestriction] Show confirm to unblur "+r),Object(s.a)(e,"PostPhotoRestriction.onClearConfirm('"+t+"', '"+r+"', '"+a+"')","PostPhotoRestriction.onClearDecline('"+t+"')",{id:t,ok_text:n})}(l,n,a,o,i),new Promise((function(t,e){b[l]={resolve:t,reject:e}}))}window.clog("[PostPhotoRestriction] No hash was provided")}function h(t,e,n){i.a.close(Object(r.M)(t)),window.photoview._toggleTouches(!0),window.ajax.post(e+"?act=unblur&hash="+n,{},{onDone:function(n){b[t]&&(b[t].resolve({result:!0,isFullyAvailable:n}),delete b[t]);var a=Object(o.a)('[data-clear-id="'+t+'"]');if(a){var i=Object(o.a)(".SplashScreen__more .Btn",a);c.a.setLoading(i,!1),a.classList.add("PostPhotoRestriction--clear")}else window.clog("[PostPhotoRestriction] Can't find restriction el with clear id "+t);var s=/([a-z]*)(-?\d+)?(?:_(-?\d+))?/.exec(e),d=s[2],_=s[3],h=[];n?(h.push.apply(h,Object(o.b)('.thumb_map_img--blur[data-id^="'+d+'"]')),h.push.apply(h,Object(o.b)('.thumb_map_img--blur[href^="/photo'+d+'"]'))):(h.push(Object(o.a)('.thumb_map_img--blur[data-id="'+d+"_"+_+'"]')),h.push(Object(o.a)('.thumb_map_img--blur[href^="/photo'+d+"_"+_+'"]'))),h.forEach((function(t){if(t){t.classList.remove("thumb_map_img--blur");var e=Object(o.a)(".PostPhotoRestriction--blur,.PostPhotoRestriction--blurWithText",t);Object(r.Vb)(e)}})),n&&(u[""+d]=!0),u[e]=!0,l(e);var p=[];n?p.push.apply(p,Object(o.b)('.PhotosPhotoItem__photo[data-id^="'+d+'"]')):p.push(Object(o.a)('.PhotosPhotoItem__photo[data-id="'+e.replace("photo","")+'"]')),p.forEach((function(t){if(t){t.classList.remove("PhotosPhotoItem__photo--blur");var e=Object(o.a)(".PhotosPhotoItem__restriction",t);Object(r.Vb)(e)}}));var f=[];n?f.push.apply(f,Object(o.b)('.AlbumItem__thumb--blur[data-thumb-id^="'+d+'"]')):f.push(Object(o.a)('.AlbumItem__thumb--blur[data-thumb-id="'+e.replace("photo","")+'"]')),f.forEach((function(t){if(t){t.classList.remove("AlbumItem__thumb--blur");var e=Object(o.a)(".AlbumItem__restriction",t);Object(r.Vb)(e)}})),setTimeout((function(){Object(r.Xb)(a)}),500)}})}function p(t){var e=Object(o.a)('[data-clear-id="'+t+'"]'),n=e&&Object(o.a)(".SplashScreen__more .Btn",e);b[t]&&(b[t].resolve({result:!1}),delete b[t]),window.photoview._toggleTouches(!0),i.a.close(Object(r.M)(t)),n&&c.a.setLoading(n,!1)}},j1wj:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=0;function a(){return performance?performance.now():r?Date.now()-r:0}window.onDOMReady((function(){r=Date.now()}))},"k+Df":function(t,e,n){"use strict";var r=n("z9sQ"),a=n("TYsd"),o=n("9y81"),i=n("29dZ"),c=n("tlMv");e.a=function(t){void 0===t&&(t={});var e=null;t.icon_raw?e=t.icon_raw:t.icon&&(e=Object(o.a)({class:"SplashScreen__icon",icon:t.icon,svg:t.is_svg_icon}));var n=a.a.wrap(t.more_text);"primary"!==t.more_type&&"regular"!==t.more_type&&"outlineMono"!==t.more_type||(n=Object(i.a)({inner:[t.more_text],theme:t.more_type,url:t.more_url,onClick:t.more_onclick,attrs:{ontouchend:t.more_ontouchend},use_native_onclick:t.more_native_onclick}),t.more_url=null);var s=[t.class,r.a.class("SplashScreen",t.mix||{},"_")];t.small&&s.push("SplashScreen--small");return[t.separator?Object(c.a)({hideOnDesktop:!t.separator_desktop}):null,{inner:[t.inner||[t.before,e,t.title?{inner:[a.a.wrap(t.title)],class:"SplashScreen__title",tag:"div"}:null,t.text?{inner:[a.a.wrap(t.text)],class:[t.text_class,"SplashScreen__text"],tag:"div"}:null,t.more_text?{inner:[n],class:"SplashScreen__more",href:t.more_url,tag:"a"}:null,t.action_text?{inner:[{inner:[a.a.wrap(t.action_text)],class:"SplashScreen__actionButton",href:t.action_url,tag:"a"}],class:"SplashScreen__action",tag:"div"}:null]],class:s,tag:"div"}].filter((function(t){return t}))}},kr3z:function(t,e,n){"use strict";var r=n("wx14"),a=n("UxAg"),o=n("+cqQ"),i=n("jk6M"),c=n("jE6c"),s=n("ZMWW"),l=n("OcsD"),u=n("0ZFE"),d=n("j80l"),b=n("eGQV"),_=n("tgcV"),h=n("cGUQ"),p=n("izth"),f=n("Cbap"),v=function(t){void 0===t&&(t={});var e=["AudioPlaylistRoot",t.class].filter((function(t){return t})).join(" ");return{attrs:{"data-playlist-id":t.playlist_id},inner:t.inner,class:e}};var m=n("g3t9"),g=n("+sJP"),O=n("0hva"),w=n("z1UI"),j=n("GtpT"),y=n("vOib"),S=n("v+Uj");var k=function(t){void 0===t&&(t={});var e=window.lang,n=t.items||[],r=t.count||null,a=t.emptyIcon||null,o=t.href,i=t.header||e.mobile_photos_block_albums_title,c=n.map((function(t){return{inner:[Object(j.a)({album:t,emptyIcon:a})],class:"AlbumsBlock__album",tag:"div"}})),s={text:Object(g.t)("mobile_subheader_show_all"),class:"al_albums",url:o},l=Object(S.a)({inner:[{inner:[c],class:"AlbumsBlock__albums",tag:"div"}]});return{inner:[{name:"albums",tag:"a"},Object(y.a)({title:i,count:r,corner:s,content:l,no_border:!0,noShadow:!0})],class:"AlbumsBlock",tag:"div"}},A=n("1VZq");var P=function(t){var e=window.lang,n=t.items||[],r=t.count||null,a=t.buttons||{},o=t.href,i=t.hide_header||!1,c=t.label||e.mobile_photos_block_photos_title,s="PhotosBlock",l="PhotosBlock__photos";!!t.autoload&&(s+=" PhotosBlock--autoload",l+=" photos_page");var u={inner:[n.map((function(t){return Object(A.a)({photo:t})}))],class:l,tag:"div"},d=null;return o&&(d={text:Object(g.t)("mobile_subheader_show_all"),class:"al_empty",url:o}),{inner:[{name:"photos",tag:"a"},Object(y.a)({inner:[{inner:[a.prev,u,a.more],tag:"div"}],title:i?null:c,corner:d,count:r,noShadow:!0,no_border:!0})],class:s,tag:"div"}},T=n("tlMv");var E,I=function(t){var e=window.lang,n=t.pretag,r=t.buttons||{},a=t.is_owner,o=[],i=t.section,c=t.albums,s=t.albums_count,l=t.albums_href,u=t.photos,d=t.photos_count,b=t.new_tags_photos,_=t.new_tags_count,h=t.new_tags_href,p=t.emptyIcon||null;if("all"===i){var f=c.map((function(t){return Object(j.a)({album:t,is_owner:a,emptyIcon:p})}));f&&o.push({inner:[r.prev?r.prev:null,{inner:[f],class:"AlbumsPage__items album_items photos_page bl_cont",tag:"div"},r.more?r.more:null],tag:"div"})}else c&&c.length&&o.push(k({items:c,count:s,href:l})),b&&b.length&&o.push(P({label:e.mobile_photos_block_tags_title,items:b,count:_,href:h})),u&&u.length&&o.push(P({autoload:!0,items:u,count:d,buttons:r}));if(!o.length){var v=a?e.mobile_albums_can_store_photos:e.mobile_albums_no_albums;return Object(w.a)({separator:!0,text:v,more_type:"primary",more_text:t.add_url?e.mobile_photos_placeholder_album_action:null,more_url:t.add_url})}return{inner:["all"!==i?Object(T.a)({hideOnDesktop:!0}):null,{inner:[o],class:"upanel bl_cont",tag:"div"},n],class:"AlbumsPage PageBlock PageBlock_bottomPadding",tag:"div"}},x=n("GVTI"),C=n("W9Tc"),N=n("gF8j"),R=n("xAJ7"),M=n("uEFA"),L=n("j1wj"),D=(n("HLtZ"),n("EDm3"));if(!window.ajax){var B={onBeforeRedirect:Object(o.a)("url"),onBeforePageParse:Object(o.a)(),onPostsLoad:Object(o.a)(),onRedirect:Object(l.hc)(),onNavDone:Object(o.a)(),_tStart:!1,_tAlStart:!1,RESPONSE_ARGUMENTS:0,RESPONSE_REDIRECT:1,RESPONSE_CAPTCHA:2,RESPONSE_PAGE:3,RESPONSE_FAILED_AUTH:4,RESPONSE_CONFIRM:5,RESPONSE_IGNORE:100,_getreq:function(){return new XMLHttpRequest},_al_reqs:[],_last_req:null,save_req:function(t){B._al_reqs.push(t||B._last_req)},abort_reqs:function(){Object(l.D)(B._al_reqs,(function(t,e){e.abort()})),B._al_reqs=[]},_failed_relogin:!1,_failed_reqs:[],save_failed_req:function(t,e,n,r){B._failed_reqs.push([t,e,n,r])},repeat_reqs:function(){Object(l.D)(B._failed_reqs,(function(){var t=this.shift();B._post.apply(null,this),t&&Object(l.Xb)(t)})),B._failed_reqs=[]},_error_displayed:null,plainpost:function(t,e,n,a,o,i,c,s){var u="string"!=typeof e?Object(h.a)(e,!0):e,d={"Content-Type":"application/x-www-form-urlencoded"};i&&void 0===i.ignoreAbort&&(i.ignoreAbort=!0),o||s||(d["X-Requested-With"]="XMLHttpRequest"),s||(Object(b.a)()&&(d["X-View-Mode"]="pwa"),i&&i.headers&&Object.assign(d,i.headers));var _=new AbortController,p=_.signal,f=new Request(t,{credentials:"same-origin",method:"POST",headers:d,body:u,signal:p}),v=(new Error).stack,m={skip:!1,response:null,text:null,json:null},g=fetch(f).catch((function(t){var e=t&&"AbortError"===t.name,n=!1;if((e&&!i.ignoreAbort||a&&a(t&&t.message,null))&&(n=!0),e&&i.ignoreAbort)return null;if("true"===f.headers.get("X-Ajax-Nav")&&history.back(),!n&&(!B._error_displayed||B._error_displayed<=Date.now()-1e4)){var r=Object(l.W)("mobile_general_snackbar_error");navigator.onLine||(r=Object(l.W)("mobile_pwa_offline_network_lost")),Object(l.oc)("mvk_ajax_error_snackbar",Number(navigator.onLine)),Snackbar.init({text:r}),B._error_displayed=Date.now()}throw t.stack=v,t})).then((function(t){return null===t?Object(r.a)({},m,{skip:!0}):t.text().then((function(e){var o=null;try{o=Object(l.Pb)(e)}catch(t){}if(!(t.status>=200&&t.status<300))throw a&&a(e,t),new Error("FailedRequest");return n&&n(e,t),Object(r.a)({},m,{response:t,text:e,json:o})}))}));g.catch((function(){}));var O={request:f,abort:_.abort.bind(_),promise:g};return B._last_req=O,O},post:function(t,e,n){return"/"!=t.substr(0,1)&&(t="/"+t),t=t.split("#")[0],B._post(t,e,n||{})},onPrepared:Object(l.hc)(),prepare_click:function(t){var e=window.al;if(i.a.ios&&!(i.a.ios>=7)&&window.al&&e.ver){var n=[],r=!1;t&&"a"==(t.tagName||"").toLowerCase()?n.push(t):Object(l.ob)(t)?n=t:(n=Object(l.Q)("a",t),r=!0);for(var a=0,o=n.length;a<o;a++){var c=n[a],s=c&&c.target||"";if(c&&c.getAttribute&&(!r||!c.getAttribute("data-href")&&Object(l.m)(c,{skip_onclick:!0})&&"_blank"!=s)){var u=c.getAttribute("href");if(null==u||!Object(l.rb)(u))continue;Object(l.g)(c,"data-href",Object(l.V)(c)),Object(l.g)(c,"href",!1)}}}},click:function(t,e,n){var r=window.nav;e=e||{};var a,o=!1,i={_ajax:1},c=Object(l.K)(e,{link:t});if(n=n||{},(n=Object(l.K)({closeContextMenu:!0},n)).closeContextMenu&&ContextMenu.close(),e.onStart){var s=B.tAlGetParam();B.tAlStart=(new Date).getTime(),s&&(i._talstat=s)}if(n.use_cache){var u=Object(l.M)(!0===n.use_cache?"preload_data":n.use_cache),d=u.innerHTML.replace(/(^<!--|-->$)/g,""),b=d.split("--\x3e\x3c!--");if(d)u.innerHTML="",e.onStart&&e.onStart.apply(c),n.nav&&r.go(o,null,{push_only:!0}),e.onDone&&e.onDone.apply(c,b),(t=Object(l.O)("show_more",Object(l.O)("pcont","mcont")))&&B.click(t,{onDone:function(){var t="";Object(l.D)(arguments,(function(e,n){t+="\x3c!--"+(n||"")+"--\x3e"})),u.innerHTML=t,Object(l.M)("show_more_loading")&&B.click(!1,e,n),B.onPostsLoad()}},{closeContextMenu:!1});else e.onStart&&e.onStart.apply(c),n.nav&&r.go(o,null,{push_only:!0});return!1}if(!t)return!0;if(t.form){if(t.disabled)return!0;var _=t.form,h={};o=(_.action||"").replace(/^https?:\/\/[^\/]+/i,""),Object(l.D)(_,(function(e,n){return!(n.name&&!n.disabled)||("radio"===n.type&&!n.checked||("checkbox"===n.type&&!n.checked||("button"===n.type||("submit"===n.type&&n!==t||("image"===n.type&&n!==t||void(h[n.name]=n.value))))))})),"image"==t.type&&(h[t.name]=t.value,h[t.name+".x"]=1,h[t.name+".y"]=1),_.method&&"get"!=_.method?Object(l.K)(i,h):o=o.split("?",1).shift()+Object(l.Ib)(h)}else t.getAttribute&&(o=t.getAttribute("data-href")||t.getAttribute("href"));if(o||(o=t.pathname?t.pathname+t.search+t.hash:t),!o)return!0;Object(l.K)(i,n.url_params||{});var p=window.pStats,f=p.getSeenData();if(f){var v=window.cur;i._pstat=f.data,v&&v.module&&(i._pstatref=v.module)}return(a=B.post(o,i,{onDone:function(){f&&p.onSend(f.seen),n.lock&&Object(l.xc)(t),e.onDone&&e.onDone.apply(c,arguments),(n.nav||n.scroll)&&Object(l.fc)()},onFail:function(){n.lock&&Object(l.xc)(t),e.onFail&&e.onFail.apply(c,arguments),(n.nav||n.scroll)&&Object(l.fc)()}}))&&(e.onStart&&e.onStart.apply(c),n.nav&&r.go(o,null,{push_only:!0}),n.lock&&Object(l.Cb)(t)),!a},nav:function(t,e){var n,o=window.nav,s=window.page,b=window.menu,h=window.cur,p=window.Tabbar;(e=e||{}).nav=e.nav||{};var f,w=Object(l.V)(t),y=s.getHash(e.nav);if(!(w=o.checkUrl(w)))return!1;"/"!=w.substr(0,1)&&(w="/"+w),b.close(null,!0),B.navStart=Object(L.a)();var S=B.tGetParam();if(B.tStart=(new Date).getTime(),e.need_restore&&b&&b.closeSearch(),window.isNewMail&&(e.need_restore&&e.nav.push&&!e.need_check_updates&&B.abort_reqs(),o.onBeforeGo2(e.nav.path,Object.assign({},Object(l.Ub)(e.nav.params),e.params),e.nav.push,e)))return B.abort_reqs(),!0;if(e.need_restore&&e.nav.push&&(f=s.restore(y))&&(B.abort_reqs(),B._failed_relogin=!1,f.lm&&Object(l.K)(f.lm,{tn:!1,bn:!1}),s.set(y,f,{restored:!0},e),e.zProcess&&(e.zProcess(f.st),delete e.zProcess),o.set(e),B.tModule=window.cur.module,B.tRestoreRender=(new Date).getTime(),!e.need_check_updates))return!0;var k=!1,A=!1;if(e.need_check_updates&&o.isTabHaveCache(e.tab,y));else if(e.fast)k=!0,s.set(y,!1,{before:!0,beforeAppend:e.beforeAppend,afterAppend:e.afterAppend}),A=e.onAfterFast||!1;else if((e.alMode||(null==(n=e.target)?void 0:n.className))&&!h.ignoreFastNav){var P,T=/(?:^|\s)(al_([a-z_]+)(-?[0-9]+)?)(?:\s|$)/i.exec((null==(P=e.target)?void 0:P.className)||""),E=e.alMode||T&&T[2]||!1;switch(E){case"menu":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){var n=Object(a.a)(".vk__page");if(n.className=n.className.replace("vk__page_notifications",""),window.isNewMail){var r=Object(l.O)("mcont",t)||Object(l.O)("layout__basis");Object(l.zc)(r,'<div class="pcont bl_cont"><div id="al_loading"></div></div>')}else Object(l.zc)(Object(l.O)("mcont",t),'<div class="pcont bl_cont"><div id="al_loading"></div></div>');s.setMhead(t,Object(l.g)(e.target,"data-header"),"/")},afterAppend:function(){window.isNewMail&&"/mail"===y?Object(u.a)(Object(l.O)("layout").offsetHeight):Object(u.a)(),Object(l.gc)(0)}});break;case"tab":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){Object(l.zc)(Object(l.O)("upanel",t),'<div id="al_loading"></div>'),Object(l.zc)(Object(l.O)("basisDefault",t),'<div id="al_loading"></div>');var e=Object(l.O)("tabs_block",t)||Object(l.O)("tabs",t),n=Object(l.O)("active",e);n&&(Object(l.gb)("tab_item_top",n)?(Object(l.Yb)("tab_item_cur",Object(l.O)("tab_item_cur",e)),Object(l.a)("tab_item_cur",Object(l.O)("tab_item",e))):(Object(l.Yb)("tab_item_cur",Object(l.O)("tab_item_cur",e)),Object(l.a)("tab_item_cur",n)))},afterAppend:function(){Object(u.a)()}},e);break;case"post":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){var n=window.lang,r=Object(l.q)(Object(l.eb)("post_item",e.target)),a=Object(l.O)("pi_fronly",r),o=Object(l.O)("pi_bfronly",r),i=a&&a.getAttribute("onclick")||"",c=o&&o.getAttribute("onclick")||"",u=r.id,d=Object(l.Nb)(Object(l.fb)("a",Object(l.O)("pi_img",r))).replace("pi_img","op_img"),b=Object(l.fb)("div",Object(l.O)("pi_author",r)),_=Object(l.Xb)(Object(l.O)("pi_date",r)),h=Object(l.Nb)(Object(l.Xb)(Object(l.O)("explain",b))),p=Object(l.Xb)(a),f=Object(l.Xb)(o),v=Object(l.Nb)(b),m=Object(l.O)("pi_body",r),g=Object(l.O)("pi_text_more",m),O=(_=Object(l.O)("pi_date",r),Object(l.O)("pi_info",m)),w=Object(l.O)("pi_links",m),j=Object(l.O)("replies_link",w),y=Object(l.zc)(Object(l.Xb)(Object(l.O)("pi_actions_wrap",r))),S=Object(l.zc)(Object(l.Xb)(null==O.querySelector?void 0:O.querySelector(".item_replies, ._item_replies")))?Object(l.zc)(j):n.mobile_wall_post_replies_title,k=j?'<a name="comments"></a><h3 class="slim_header">'+(S||"")+'</h3><div id="al_loading"></div>':"";if(g){var A=g.nextSibling?g:g.parentNode;A.nextSibling.style.display="inline",A.style.display="none"}Object(l.zc)(w,Object(l.Nb)(Object(l.O)("like_wrap",m))),_&&Object(l.g)(_,"data-date")&&Object(l.zc)(_,Object(l.g)(_,"data-date")),s.setMhead(t,Object(l.g)(e.target,"data-header"),!0);var P=p?'<div class="pi_fronly" onclick="'+i+'">'+Object(D.c)()+"</div>":f?'<div class="pi_bfronly" onclick="'+c+'">'+Object(D.c)()+"</div>":"";Object(l.zc)(Object(l.O)("mcont",t),function(t,e,n,r,a,o,i,c){return'<div class="pcont bl_cont"><div class="owner_panel">'+(e||"")+'<div class="op_cont">'+(n||"")+'<div class="op_info"><span class="item_date">'+(r||"")+'</span></div></div></div><div id="'+(t||"")+'" class="post_item single_post_item"><div class="pi_cont"><div class="pi_head">'+(a||"")+'</div><div class="pi_body">'+(o||"")+"</div></div>"+(c||"")+"</div>"+(i||"")+"</div>"}(u,d,v,Object(l.zc)(_)+P,h,Object(l.zc)(m),k,y))},afterAppend:function(t){var n=Object(l.R)("h3",t);n&&Object(u.a)(e.nav.hash?Object(l.S)()-n.offsetHeight:0),e.nav.hash?Object(l.fc)(e.nav.hash):Object(l.gc)(0)}},e);break;case"wall":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){var n;var r=window.lang,a=Object(l.q)(Object(l.gb)("wall_item",e.target)?e.target:null==(n=e.target)||null==n.closest?void 0:n.closest(".wall_item"))||void 0,o=null==a||null==a.querySelector?void 0:a.querySelector(".wi_buttons, ._wi_buttons"),i=Object(l.Xb)(null==o||null==o.querySelector?void 0:o.querySelector(".item_replies, ._item_replies"))||void 0,c=Number(Object(l.qc)((null==i?void 0:i.getAttribute("data-replies-count"))||"").replace(/\D/g,"")),u=null==a?void 0:a.id,d=Object(l.O)("wi_body",a),b=Object(l.O)("item_like",o),_=Object(l.O)("v_like",b),h=Object(l.O)("item_share",o),p=Object(l.O)("v_share",h),f=Object(l.O)("pi_text_more",d),v=Object(l.O)("wi_date",a),g=c?Object(l.yb)(c,r.mobile_wall_post_comments):r.mobile_wall_post_replies_title,O=i&&c<50?'<a name="comments"></a><h3 class="slim_header">'+(g||"")+'</h3><div id="al_loading"></div>':"";if(clog("item_replies",i),Object(l.Xb)(Object(l.O)("wi_actions_btn",a)),Object(l.Xb)(Object(l.O)("post__subscribeBtn",a)),Object(l.Xb)(Object(l.O)("post__extraHeader",a)),_?Object(l.zc)(_):Object(l.f)(Object(l.k)("span",{className:"v_like"}),b),p?Object(l.zc)(p):Object(l.f)(Object(l.k)("span",{className:"v_share"}),h),f){var w=f.nextSibling?f:f.parentNode;w.nextSibling.style.display="inline",w.style.display="none"}v&&Object(l.g)(v,"data-date")&&Object(l.zc)(v,Object(l.g)(v,"data-date")),s.setMhead(t,Object(l.g)(e.target,"data-header"),!0);var j=Wd.html(Object(m.a)({hideOnDesktop:!0}));Object(l.zc)(Object(l.O)("mcont",t),function(t,e,n,r){return'<div class="pcont"><div class="PageBlock">'+t+'<div class="wall_item single_wall_item" id="'+(e||"")+'">'+(n||"")+"</div>"+(r||"")+"</div></div>"}(j,u,Object(l.zc)(a),O)),Object(l.a)("vk__page_singlePost",document.body)},afterAppend:function(t){var n=Object(l.R)("h3",t);n&&Object(u.a)(e.nav.hash?Object(l.S)()-n.offsetHeight:0),e.nav.hash?Object(l.fc)(e.nav.hash):Object(l.gc)(0)}},e);break;case"pinfo":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){var e=window.lang,n=Object(l.O)("owner_panel",t),r=Object(l.O)("pp_img",n),a=Object(l.O)("op_header",n),o=Object(l.O)("lvi",a),i=Object(l.O)("pp_last_activity",n),c=Object(l.k)("div");Object(l.a)("mhi_back",Object(l.O)("mh_header",t)),Object(l.zc)(n,'<img src="'+Object(l.G)(Object(l.g)(r,"src")||"")+'" class="op_img"><div class="op_cont"><h2 class="op_header">'+Object(l.qc)(Object(l.zc)(a))+'</h2><div class="pp_online">'+(o?e.mobile_online:Object(l.zc)(i))+"</div></div>"),Object(l.zc)(Object(l.O)("ipanel",t),"<div>"+Object(l.zc)(c)+'</div><div id="al_loading"></div>'),s.setMhead(t,!1,!0)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0,10)}},e);break;case"player":k=!0;var N=Object(l.Ub)(e.nav.params).playlist_id;s.set(y,!1,{before:!0,beforeAppend:function(t){var e=window,n=e.lang,r=e.audio,a=(r.playlist(),r.playlist_q());s.setMhead(t,n.mobile_menu_player_head_title,!0),Object(l.zc)(Object(l.O)("mcont",t),'\n                <div class="pcont audioPage">\n                  <div class="PageBlock">\n                    <div class="audioPage__header">\n                      '+AudioPlaylist.tplPlayerSearch(N)+'\n                    </div>\n                    <div id="au_search_items" class="upanel bl_cont">\n                      <div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(a)+'"></div>\n                    </div>\n                  </div>\n                </div>'),Object(l.zc)("m",t.innerHTML)}},e),A=function(){var t=window,n=t.qsearch,r=t.audio,a=r.playlist(),o="/audio"+Object(l.Ib)({act:"player",list:N}),c=[],d={},b=r.getCurrentId();Object(l.D)(a,(function(t,e){e.chartInfo=null,c.push(e.fullId),d[e.fullId]=[e.performer+" "+e.title,e]}));var _=c.indexOf(b),h=_>-1?Math.min(_+10,c.length):50,p=[];n.init({action:o,al_action:o,container:"au_search_items",field:Object(l.M)("au_search_field"),btn:Object(l.M)("au_search_btn"),top_items:c,_cache:d,forceRerender:!0,tpl:function(t,e,n,a){var o="";if(e){if(a)return a;o=""==a?'<div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(e)+'">'+t+"</div>":'<div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(e)+'"><div class="al_loading qs_loading">&nbsp;</div></div>'}else o='<div class="audios_block audios_list _si_container" data-query="'+Object(l.G)(r.playlist_q())+'">'+t+"</div>";return Wd.html(v({playlist_id:N,inner:Wd.wrap(o)}))},item_tpl:function(t){var e=window.audioplayer;return p.push(t),e&&e.getDOMFromAudio(t,!0,this.q,!0)||""},null_tpl:function(t){var e=window.lang;return'<div class="service_msg_box">\n                  <div class="service_msg service_msg_null">\n                  '+(t?e.mobile_audio_search_not_found.replace("%s",Object(l.ib)(t)):e.mobile_audio_no_audio)+"\n                  </div>\n                </div>"},soft_filter:!0,need_invalid_keys:i.a.desktop,top_len:h,global_search:!0,onRendered:function(){var t=window,e=t.audioplayer,n=t.audio;e&&e.initAudio(),n.addToPlaylist(p),Object(u.a)()},al_need:!0,init_offset:0});var f=window.audioplayer.getCurrentElem();if(f){var m=Object(l.db)(f)+f.offsetHeight/2-Object(l.S)()/2;Object(l.gc)(m,100),s.save(y,{html:null,st:Object(l.gc)(),page:Object(l.M)("m"),state:s.stash(),cur:window.cur,options:e||{}},!1)}};break;case"photo":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){p.drawLoader(t);var e=Wd.html(Object(x.b)({is_loading:!0}));Object(l.zc)(Object(l.O)("mcont",t),e),Object(u.a)(),s.setMhead(t,lang.mobile_photos_photo_title)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}},e);break;case"album":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){var n;p.drawLoader(t);var o,i=e.target.href,c=/((?:album|tag)(-?\d+)(?:(?:_(\d+))?))/.exec(i);c&&(o=c[1]);var b=o&&Object(g.y)(o)||{},_=Object(a.a)(".AlbumItemInfo__title",e.target),h=!1;e.target.classList.contains("AlbumItem--empty")&&(h=!0);var f=Object(d.b)("/"+o,{act:"select_album"}),v=Object(r.a)({},b,{title:b.title||Object(l.zc)(_)||lang.mobile_page_title_album,description:Wd.wrap(b.description),is_empty:h,is_owner:c&&(null==(n=window.vk)?void 0:n.id)===+c[2],add_url:f,count:parseInt(e.target.getAttribute("data-count")||0,10)}),m=function(t){return void 0===t&&(t={}),Wd.html(Object(O.a)(Object(r.a)({},t,{title:Wd.wrap(t.title),is_loading:!t.is_empty||t.count>0})))}(v);Object(l.zc)(Object(l.O)("mcont",t),m),Object(u.a)(),s.setMhead(t,v.title,!0,!1,{movable:!0})},afterAppend:function(){Object(O.b)(),Object(u.a)(),Object(l.gc)(0)}});break;case"albums":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){p.drawLoader(t);var n=e.target.closest(".AlbumsBlock"),o=[];n&&(o=Array.from(Object(a.b)(".AlbumItem",n)).map((function(t){return Object(j.b)(t).album})));var i=function(t){return void 0===t&&(t={}),Wd.html(I(Object(r.a)({},t,{section:"all"})))}({albums:o});Object(l.zc)(Object(l.O)("mcont",t),i),Object(u.a)()},afterAppend:function(){Object(O.b)(),Object(u.a)(),Object(l.gc)(0)}});break;case"u":case"g":case"p":case"e":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){p.drawLoader(t)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}},e);break;case"playlists":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){p.drawLoader(t)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}});break;case"empty":case"artist":case"playlist":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){p.drawLoader(t)},afterAppend:function(){Object(u.a)(),Object(l.gc)(0)}},e);break;case"news_subsection":k=!0,s.set(y,!1,{before:!0,beforeAppend:function(t){var e=Object(l.O)("news_subsections",t);e&&!Object(l.gb)("summary_loading",e.firstChild)&&Object(l.i)(Object(l.k)("div",{className:"summary_loading",innerHTML:'<i class="i_loading"></i>'}),e.firstChild)}});break;case"tabbar":k=!0,e.is_fast=!0;var R=!1,M={options:{is_fast:!0,tab:e.tab,prev_tab:e.prev_tab}};e.need_check_updates&&f&&(M=Object(l.K)(M,f),R=!0),s.set(y,M,{before:!R,beforeAppend:function(t){s.setMhead(t,Object(l.g)(e.target,"data-header"),!1),p.drawSkeletonLoader(t,e.tab),document.body.classList.contains("vk_tabbar_bottom")&&s.hideHeader(t)},afterAppend:function(){Object(u.a)()}});break;default:h=window.cur;var W=!!Object(l.O)("mhi_logo","mhead");if(k=!0,h.al_fast&&h.al_fast[E])s.set(y,!1,h.al_fast[E](e),e);else if(!W){var U={options:{is_fast:!0,tab:e.tab,removeAfterNextResponse:e.removeAfterNextResponse}};s.set(y,U,{before:!0,afterAppend:function(){Object(u.a)()}})}}}if(e.need_check_updates||B.abort_reqs(),e.local){var H=!0;s.set(y,{},{after:!0,no_scroll:!0,force:!0},!1),A&&A()}else{var F=Object(C.b)("mvk_fix_nav_params")?{}:Object(l.Ub)(e.nav.params);Object(l.K)(F,e.params||{}),window.al&&!window.al.inited?F[b.NEED_MENU_PARAM]=b.FORCE_NEED_MENU:window.al&&window.al.menu||(F[b.NEED_MENU_PARAM]=b.NEED_MENU),S&&(F._tstat=S);var z=window.pStats,q=z.getSeenData();q&&(F._pstat=q.data,h&&h.module&&(F._pstatref=h.module)),e.target&&Object(c.j)(e.target)&&(F._ref=domData(e.target,"ref")),F._ref||(F._ref=(o.path||"").substr(1));var V=w.split("#");!F._hash&&V.length>1&&(F._hash="#"+V[1]),Object(_.c)(w);var G=Object.assign({},e.headers,{"X-Ajax-Nav":"true"});H=B.post(w,F,{onPageDone:function(t,n,r,o,i){B.fastNav=!1;var c=window.cur;if(q&&z.onSend(q.seen),B.tProcess=(new Date).getTime(),s.set(y,{title:t,html:n,js:r,lm:o,bc:i,st:e.st||0},{after:k,no_scroll:k,al_transition:!0},!k&&e),e.back){var l=Object(a.a)(".layout");s.setMhead(l,!1,e.back)}B.tModule=c.module,B.tRender=(new Date).getTime(),B.onNavDone()},redirectToLoginPage:e.redirectToLoginPage,headers:G});B.save_req()}return k&&(e.zProcess&&(e.zProcess(),delete e.zProcess),o.set(e),B.tModule=h.module,B.tFastRender=(new Date).getTime(),B.fastNav=!0),H},confirm:function(t){function e(e,n,r,a){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t,e,n,r){return!!confirm(e)&&B.click(t,r,{url_params:{hash:n}})})),_post:function(t,e,n){var r=function(t,e){n.onFail&&n.onFail.call(window,0,t,e)},a=window.debuglogSent?window.debuglogSent(t):-1;return B.plainpost(t,e,(function(o,i){if(204===i.status&&i.headers.get("X-AppShell-Fallback")){var c=location.href;return history.replaceState(null,null,Object(d.b)(location.href,{__appshell_fallback:i.headers.get("X-AppShell-Fallback")})),void location.replace(c)}var s=!1;try{s=Object(l.Pb)(o)}catch(e){if(i.headers.get("Content-Type").includes("text/html")||i.getResponseHeader("Content-Type").includes("text/html"))return nav.hard_go(t,null,n);s=!1}!1===s?r():(B.parseResponse(s,t,e,n),B._debugLog(a,s.debugLog))}),r,null,{headers:n.headers,ignoreAbort:n.ignoreAbort})},_debugLog:function(t,e){window.debuglogGot&&window.debuglogGot(t,e)},parseResponse:function(t,e,n,r){var o,i=window.al,c=window.nav,u=window.menu,d=window.page,b=t.version,h=t.counters,v=t.notifications,m=t.type,g=t.statsMeta,O=e.indexOf("community")>=0,w=!1;if(m!==B.RESPONSE_IGNORE)switch(O?(w=!(!window.al||b===i.ver))&&Object(l.oc)("mvk_version_reload",1,b,i.ver,"old_force_reload_community"):window.al&&b!==i.ver?Object(C.b)("mvk_lazy_static_reload")?m===B.RESPONSE_ARGUMENTS?E||(E=new N.a({id:"mvk_static_manager",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress touchstart",idleTimeout:6e5,onIdleCb:function(){Object(l.oc)("mvk_version_reload",1,b,i.ver,"new_idle_reload"),E.stop(),location.reload()}})).start():(Object(l.oc)("mvk_version_reload",1,b,i.ver,"new_force_reload"),w=!0):(Object(l.oc)("mvk_version_reload",1,b,i.ver,"old_force_reload"),w=!0):!window.menu||t.lm_data&&t.lm_data.lm||u.isMenuHasItems()&&((w=!u.refreshCounters(h))&&Object(l.oc)("mvk_version_reload",1,b,i.ver,"old_force_reload_change_menu"),u.refreshNotifications(v)),void 0===h||!1===h||O||Object(l.ic)(h[M.b]),t.lm_data&&t.lm_data.lm&&(h&&(t.lm_data.counters=h),v&&(t.lm_data.notifications=v)),g&&window.vk&&(window.vk.statsMeta=g),m){case B.RESPONSE_ARGUMENTS:if(w)return c.hard_go(c.cur,null,{replace:!0});var j=t.data;if(o=j&&Object(l.tb)(j[0])&&j[0]._snackbar){if(Snackbar.init(o),2===o.type)return photoview.opened()?void photoview.close():Stories.opened?void Stories.close():zlayer.opened()?void zlayer.close():void(B.fastNav&&history.back());delete j[0]._snackbar}var y=Object(_.a)(t.static_files||[]);r&&r.onDone&&y.finally((function(){r.onDone.apply(window,j)}));break;case B.RESPONSE_REDIRECT:var S=t.location;B.onRedirect(!0,S);var k=t.hard,A=t.frame,P=t.clear,T=t.restore,I=t.replace;if(!A&&window.isNewMail&&B.onBeforeRedirect(S))break;if(P&&c.clear(),(o=t._snackbar)&&(Snackbar.init(o),delete t.snackbar),w||k)c.hard_go(S,null,{replace:I});else if(A){Object(p.a)();var x=S+(-1==S.indexOf("?")?"?":"&")+"__extra=1",L=Object(l.s)({src:x})}else I&&S===c.prev_cur?history.back():c.go(S,null,{ignore_cur_process:!0,need_restore:T,replace:I});break;case B.RESPONSE_CAPTCHA:var D=t.location,W=t.img,U=t.post,H=t.key;r&&r.onFail?r.onFail(m,D,{location:D,img:W,post:U,key:H}):c.hard_go(D);break;case B.RESPONSE_PAGE:var F=t.lm_data;if(d.need_hard_go=w,F&&F.rdr&&window.al&&i.menu&&Object(l.ab)("vk_wrap")>=614){c.go(F.rdr,null,{replace:!0});break}f.a.getRouter().deactivateAllRoutes(),cur.share&&"destroy"in cur.share&&cur.share.destroy(),(r=r||{}).onPageDone||(r.onPageDone=function(t,n,r,a,o){c.go(e,null,{push_only:!0}),d.set(d.getHash(c),{title:t,html:n,js:r,lm:a,bc:o})});var z=t.title,q=t.html,V=t.js,G=t.body_class,Y=t.top_bar,X=Object(l.M)("vk_topbar");Y&&!X?(X=Object(l.k)("div",{id:"vk_topbar",innerHTML:Y}),Object(l.i)(X,Object(a.a)(".layout"))):Object(l.zc)(X,Y),t.env&&t.env.pe&&(window.vk.pe=t.env.pe),Object(_.a)(t.static_files).then((function(){r.onPageDone(z,q,V,F,G)}));break;case B.RESPONSE_FAILED_AUTH:if(s.a.isIntegrated)return B.save_failed_req(null,e,n,r),B._failed_relogin||B.SAKRelogin(),void(B._failed_relogin=!0);if(r.redirectToLoginPage)return window.location=t.location,!1;if(!B._failed_relogin){var K=t.location;Object(p.a)();L=Object(l.s)({src:K})}B._failed_relogin=!0,B.save_failed_req(L,e,n,r);break;case B.RESPONSE_CONFIRM:var Z=t.data;Z.useNavigation=!0;var J=Object(R.a)(Z),Q=Wd.elem(J);Popup.open(Q,!0);break;case B.RESPONSE_IGNORE:return}},onReLoginDone:function(){B.repeat_reqs(),B._failed_relogin=!1},SAKRelogin:function(){return s.a.reauth().then((function(t){var e=(void 0===t?{}:t).accessToken;if(e){var n={_sak_embed_at:e};return B.post("/login?act=sak_relogin",n,{onDone:function(){B.onReLoginDone()},onFail:function(){}}).promise}}))},tGetParam:function(){if(B.tStart&&B.tModule){var t=B.tFastRender-B.tStart,e=B.tRestoreRender-B.tStart,n=B.tProcess-B.tStart,r=B.tRender-B.tProcess,a=["/"==B.tModule.substr(0,1)?B.tModule.substr(1):B.tModule,t,e,n,r];for(var o in a)(!a[o]||a[o]<0)&&(a[o]=0);return B.tStart=!1,a.join(",")}},tAlGetParam:function(){if(B.tAlStart&&B.tAlModule){var t=B.tAlProcess-B.tAlStart,e=B.tAlRender-B.tAlProcess,n=["al_"+("/"==B.tAlModule.substr(0,1)?B.tAlModule.substr(1):B.tAlModule),t,e];for(var r in n)(!n[r]||n[r]<0)&&(n[r]=0);return B.tAlStart=!1,n.join(",")}},refreshLinks:function(t,e){if(t){var n=Object(l.O)("mmi_fv","lm_cont"),r=n&&Object(l.O)("lfm_item",n),a=Object(l.O)("mmi_fv","mfoot"),o=a&&Object(l.O)("lfm_item",a),i=Object(l.M)("fv_link"),c=Object(l.M)("menu_fv_link"),s=Object(l.P)('link[rel="canonical"]');Object(l.g)(r,"href",t),Object(l.g)(o,"href",t),Object(l.g)(i,"href",t),Object(l.g)(s,"href",Object(l.g)(Object(l.M)("mcont"),"data-canonical")),window.nav.prev_fv_link&&Object(l.g)(c,"href",window.nav.prev_fv_link),window.nav.fv_link=t}if(e){var u=Object(l.O)("mmi_app","lm_cont"),d=u&&Object(l.O)("lfm_item",u),b=Object(l.O)("mmi_app","mfoot"),_=b&&Object(l.O)("lfm_item",b),h=Object(l.M)("app_link"),p=!!e&&"return nav.app_go(this, event, '"+Object(l.I)(e)+"');";Object(l.g)(d,"onclick",p),Object(l.g)(_,"onclick",p),Object(l.g)(h,"onclick",p)}}};window.ajax=B}e.a=window.ajax},p5n7:function(t,e,n){"use strict";n.d(e,"c",(function(){return h})),n.d(e,"d",(function(){return p})),n.d(e,"b",(function(){return f}));var r=n("z9sQ"),a=n("+sJP"),o=n("TYsd"),i=function(t){void 0===t&&(t={});var e=t.style||[],n=t.class||t.mix,i=t.prefix,c=t.postfix,s=function(t){var e=[];Object(a.A)(t.on_key_down)?(t.on_key_down.push("event"),e=t.on_key_down):t.on_key_down&&(e=[t.on_key_down,"event"]);var n=t.on_key_press,r="function"==typeof t.on_change,i="function"==typeof t.onblur,c="function"==typeof t.onfocus,s=Object(a.h)("TextInput.onChange(event);",o.a.isAttrHandler("oninput",t.on_change)?o.a.prepareHandler(t.on_change):r?"":t.on_change),l=Object(a.h)("TextInput.onBlur(event, this);",o.a.isAttrHandler("onblur",t.onblur)?o.a.prepareHandler(t.onblur):i?"":t.onblur),u=Object(a.h)("TextInput.onFocus(event, this);",o.a.isAttrHandler("onfocus",t.onfocus)?o.a.prepareHandler(t.onfocus):c?"":t.onfocus);r&&(s=Object(a.S)([[s],[t.on_change]]));i&&(l=Object(a.S)([[s],[t.onblur]]));c&&(u=Object(a.S)([[s],[t.onfocus]]));return{class:"TextInput__native",id:t.id,type:t.type,name:t.name,value:t.value,spellcheck:t.spellcheck+"",placeholder:o.a.wrap(t.placeholder),autocapitalize:!1===t.autocapitalize?"off":null,autocomplete:!1===t.autocomplete?"off":t.autocomplete,tabindex:t.tabindex,readonly:t.readonly,disabled:t.disabled,oninput:s,onkeydown:e,onkeypress:n,onblur:l,onfocus:u,autofocus:t.autofocus,maxlength:t.maxlength,pattern:t.pattern,required:t.required,inputmode:t.inputmode,"aria-describedby":t["aria-describedby"],tag:"input"}}(t),l=t.error;l&&(e.error=!0);var u=!(i||c||"string"==typeof l);return{inner:[{inner:[u?s:[i?{inner:[i.text],class:r.a.class("TextInput__prefix",{rightPadding:i.with_right_padding,gray:i.gray},"_"),tag:"div"}:null,{inner:[s],class:"TextInput__nativeWrap",tag:"div"},c?{inner:[c.text],class:"TextInput__postfix",tag:"div"}:null]],class:"TextInput__content",tag:"div"},"string"==typeof l?{inner:[l],class:"TextInput__errorLabel",tag:"span"}:null],role:"presentational",class:[r.a.class("TextInput",{style_stretch:e.stretch,prefixed:!!i,hidden:"hidden"===t.type,error:e.error,native:u,disabled:!!t.disabled||!!t.readonly},"_"),n],onclick:t.on_click,tag:"label"}};var c=n("UxAg"),s=n("zvhO"),l=n("OcsD"),u=n("CQvH");Object.assign(i,{setPrefix:p,getValue:h,filter:function(t,e,n){switch(t){case"number":var r=Object(l.zc)(n)+String.fromCharCode(e.which);Object(s.a)(parseInt(r))||Object(l.j)(e),Object(l.zc)(n,Object(l.zc)(n).split("").filter((function(t){return Object(s.a)(+t)})).join(""))}},onFocus:function(t,e){var n=e.closest(d);setTimeout((function(){n.classList.add("TextInput--focused")}))},onBlur:function(t,e){var n,r=e.closest(d),a=null==(n=t.relatedTarget)?void 0:n.closest(d),o=Object(c.a)(b,r);if(r===a&&!Object(u.b)())return void o.focus();if(setTimeout((function(){var t;"BUTTON"===(null==(t=document.activeElement)?void 0:t.tagName)&&r.contains(document.activeElement)&&Object(l.b)(document.activeElement,"blur",v)})),a===r)return;setTimeout((function(){r.classList.remove("TextInput--focused")}))},onChange:function(t){var e=t.target.value;t.target.closest(d).classList.toggle("TextInput--notEmpty",!!e)}});var d=".TextInput",b=".TextInput__native",_=".TextInput__prefix";function h(t){return t.$(b).value}function p(t,e){t.$(_).innerText=e}function f(t){return Object(c.a)(b,t)}function v(t){var e=t.target.closest(d);Object(l.Zb)(t.target,"blur",v),e&&e.classList.remove("TextInput--focused")}e.a=i;window.TextInput=i},pRml:function(t,e,n){"use strict";var r=n("TYsd").a.createElement,a=n("+sJP"),o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)};e.a=function(t){var e=t.title,n=t.text,i=t.class,c=t.children,s=Object(a.f)(i,{Alert:!0,Alert_theme_error:"error"===t.theme,Alert_theme_warning:"warning"===t.theme,Alert_theme_info:"info"===t.theme});return r("div",o({className:s},{children:[e?r("div",o({className:"Alert__title"},{children:e}),void 0):null,r("div",o({className:"Alert__description"},{children:n||c}),void 0)]}),void 0)}},rc7J:function(t,e,n){"use strict";var r=n("z9sQ"),a=n("+sJP"),o=n("KMpi");var i=function(t){void 0===t&&(t={});var e=r.a.class("AlbumInfoRow",{withoutBottomBorder:t.withoutBottomBorder});return{inner:[{inner:[Object(o.a)({mode:Object(a.q)({id:t.id,name:t.name}),backgroundTheme:t.id,text:t.name,size:40,src:t.avatar})],class:"AlbumInfoRow__avatar",href:t.author_url,onclick:"cancelEvent(event); nav.go(this);",tag:"a"},{inner:[{inner:[t.title],class:"AlbumInfoRow__title",href:t.url,tag:"a"},{inner:[t.subtitle],class:"AlbumInfoRow__subtitle",tag:"div"}],class:"AlbumInfoRow__content",tag:"div"}],class:e,onclick:"nav.go('"+t.url+"')",tag:"div"}};e.a=i},rycc:function(t,e,n){"use strict";function r(t){return t.href&&!t.tag&&(t.tag="a"),t}n.d(e,"a",(function(){return r}))},tgcV:function(t,e,n){"use strict";function r(t){return new Promise((function(e,n){var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=t,r.onload=function(){return e(r)},r.onerror=function(){return n(new Error("Stylesheet load error for "+t))},document.head.appendChild(r)}))}function a(t){var e,n=(e=t,new Promise((function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.onload=function(){200===r.status?t(r.response):n(r.response)},r.onerror=function(){n(r.response)},r.send()})));return n.then((function(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)})),n}var o;n.d(e,"a",(function(){return _})),n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return p}));var i=[];function c(t,e){var n=t;return e&&(n+="?"+e),new Promise((function(t,e){var r,a,o,i=document.getElementsByTagName("script");Array.from(i).some((function(t){return t.src===n}))?t():(r=n,a=function(n){n?e(n):t()},(o=document.createElement("script")).src=r,o.onload=function(){return a(null,o)},o.onerror=function(){return a(new Error("Script load error for "+r))},document.head.appendChild(o))}))}function s(t,e){var n=function(){if(void 0!==o)return o;try{var t=document.createElement("b");t.style.display="flex",o="flex"===t.style.display}catch(t){o=!1}return o}()?r:a,i=t;e&&(i+="?"+e);var c=document.getElementsByTagName("link"),s=Array.from(c).find((function(t){return t.href===i}));return s?Promise.resolve(s):n(i)}function l(t){window.stManager.staticFiles[d(t)]=Promise.resolve()}function u(){window.vk&&window.vk.stFiles&&window.stManager?(Object.keys(window.vk.stFiles).forEach((function(t){return l(t)})),window.vk.stFiles=[]):setTimeout(u,0)}function d(t){return t.replace(/^https:\/\/st[-\d]*\.vk\.com\//i,"static://")}function b(t){i[t]&&i[t]()}function _(t){return void 0===t&&(t={}),Promise.all(Object.keys(t).map((function(e){return n=e,r=t[e],o=d(n),window.stManager.staticFiles[o]||(n.includes(".js")?a=c(n,r):n.includes(".css")&&(a=s(n,r)),a&&(window.stManager.staticFiles[o]=a,a.catch((function(){window.stManager.staticFiles[o]=null}))),a||Promise.resolve());var n,r,a,o})))}function h(t){var e=window.vk.stNavMap||{};for(var n in e){if(e.hasOwnProperty(n))if(new RegExp(n).test(t)){_(e[n]||{});break}}}function p(){u(),window.stManager={done:b,staticFiles:[],registerLoadedScript:l}}},tlMv:function(t,e,n){"use strict";var r=n("g3t9");e.a=r.b},uBUF:function(t,e,n){"use strict";function r(t){return t.tag=t.tag||"div",t}n.d(e,"a",(function(){return r}))},"v+Uj":function(t,e,n){"use strict";n.d(e,"b",(function(){return h})),n.d(e,"c",(function(){return _}));var r=n("z9sQ");var a=function(t){var e=[r.a.class("Slider",{snapping:!!t.snapping}),t.class||t.mix],n=t.snapping?null:["Slider._onWheel","event","this"];return{inner:[{inner:[{inner:[t.inner],class:"Slider__line",role:"presentation",tag:"div"}],attrs:t.attrs,class:["Slider__scroll","_preventMenuOpen"],onwheel:n,onScroll:t.onScroll,tag:"div"}],class:e,id:t.id,tag:"div"}},o=n("OcsD"),i=n("UxAg"),c=n("jk6M");window.Slider={scrollToElem:b,nextElem:p,prevElem:f},Slider._onWheel=v,onDOMReady(g),onDOMReady((function(){onBodyResize(m)}));var s=".Slider",l=".Slider--snapping",u=".Slider__scroll",d=".Slider__line";function b(t,e,n){if(void 0===e&&(e=!1),void 0===n&&(n="center"),t){var r=t.closest(u),a=t.offsetLeft;"center"===n&&(a-=r.offsetWidth/2-t.offsetWidth/2);var i=0;if(window.getComputedStyle){var c=getComputedStyle(t);(c.scrollMarginLeft||c.scrollSnapMarginLeft)&&(i+=Object(o.tc)(c.scrollMarginLeft||c.scrollSnapMarginLeft))}e&&r.scrollTo?(Object(o.v)(r,"left",a-i),r.scrollTo({left:a-i,behavior:"smooth"})):r.scrollLeft=a-i}}function _(t){return t=Object(o.M)(t),Object(i.a)(d,t).childNodes}function h(t,e){var n=Object(i.a)(u,t);return e||(e=_(t)),n.scrollWidth-n.offsetWidth<=n.scrollLeft?e.length-1:Array.from(e).map((function(t,e){return{index:e,scrollLeft:Math.abs(t.offsetLeft-n.scrollLeft)}})).sort((function(t,e){return t.scrollLeft-e.scrollLeft}))[0].index}function p(t,e,n){void 0===e&&(e=!1);var r=_(t=Object(o.M)(t)),a=h(t,r),i=r[a+1];p&&(b(i,e,n),t.setAttribute("data-current",(a+1).toString()))}function f(t,e,n){void 0===e&&(e=!1);var r=_(t=Object(o.M)(t)),a=h(t,r),i=r[a-1];i&&(b(i,e,n),t.setAttribute("data-current",(a-1).toString()))}function v(t,e){t.preventDefault();var n=t.deltaX,r=t.deltaY;Math.abs(n)>Math.abs(r)&&(e.scrollLeft+=n)}function m(){var t=Object(i.b)(l);Array.from(t).forEach((function(t){var e=Object(i.a)(u,t);e.scrollLeft=e.scrollLeft}))}function g(){(c.a.ios||c.a.msie_edge)&&(onDOMReady(w),window.page&&window.page.onChange(w),window.MutationObserver&&onDOMReady((function(){document.body&&new MutationObserver(O).observe(document.body,{subtree:!0,childList:!0})})))}function O(t){t.forEach((function(t){t.addedNodes.forEach((function(t){t.nodeType===Node.ELEMENT_NODE&&t.$$(s).forEach(j)}))}))}function w(){Object(i.b)(s).forEach(j)}function j(t){var e=getComputedStyle(t),n=Number(e.paddingTop.replace("px","")),r=Number(e.paddingBottom.replace("px",""));t.style.overflow="hidden",t.style.height=t.offsetHeight-n-r+"px",t.$(u).style.paddingBottom="20px"}e.a=a;window.Slider=a,Object(o.K)(a,{scrollToElem:b,nextElem:p,prevElem:f,_onWheel:v})},vOib:function(t,e,n){"use strict";var r=n("UWnA"),a=n("8ZMO"),o=n("hG3N"),i=n("z9sQ"),c=n("+sJP"),s=n("rycc"),l=n("uBUF");function u(t){return(Object(c.A)(t)?Object(c.V)(t):[t]).join("")}function d(t){var e=u(t);return!e||"<div></div>"===e}var b=function(t){if(void 0===t&&(t={}),t.content_only)return{outerHTML:u(t.content)};var e=t.title,n=t.corner||{},c=t.inner||t.content||t.children,b=t.anchor,_=t.alert,h=t.style||{},p=t.attrs||{},f=t.noShadow,v=null!==t.count,m=t.theme||"gray";v&&(m="black");var g=t.pageBlock?"PageBlock PageBlock--separate":"",O=[e];if(v){var w={inner:[t.count],class:"Pad__count",tag:"span"};O.push(w)}return Object(l.a)({inner:[b?Object(a.a)({mix:"Pad__anchor",id:b}):null,_?Object(r.b)({inner:[Object(o.a)({inner:[_],class:"Pad__alert",theme:t.alert_theme})],style:{tiny_padding_bottom:!0}}):null,e?Object(r.b)({inner:[t.isHeaderPage?{inner:[O],class:"Pad__title",tag:"h1"}:{inner:[O],class:"Pad__title",tag:"h3"},Object(s.a)({inner:[n.text],href:n.url,onClick:n.onclick,attrs:n.attrs,class:["Pad__corner",n.class]})],class:"Pad__header"}):null,e?{inner:[c],class:["Pad__content",t.content_mix],tag:"div"}:c],tag:t.tag,attrs:p,class:[t.class||t.mix,i.a.class("Pad",{empty:d(c),noBorder:t.no_border,noCapsTitle:t.no_caps_for_title,style_extraTopPadding:h.extra_top_padding,theme:m,noShadow:f},"_"),g],ref:t.ref,"data-id":t.name||t.id})};e.a=b},vOql:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n("LiVZ"),a=n("6VgB"),o=n("PU8N"),i={title:"",titleColor:"#000",titleAlign:"center",titleFontSize:58,titleFont:"TT Commons",voteButtonText:window.getLang("stories_poll_sticker_vote_button_text"),voteButtonTextAlign:"center",voteButtonTextColor:"#fff",voteButtonFontSize:49,voteButtonFont:"TT Commons",voteButtonBackgroundColor:"#3F8AE0",width:a.c,height:a.a,radius:50,offset:a.b,backgroundColor:"#fff",backgroundCircleColor:"#fff",backgroundCircleSize:90,foregroundCircleColor:"#3F8AE0",foregroundCircleSize:72};function c(t){return Object(o.i)("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyNCIgZmlsbD0ibm9uZSI+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04IDJhMiAyIDAgMTE0IDB2MjBhMiAyIDAgMTEtNCAwVjJ6bTggMTJhMiAyIDAgMTE0IDB2OGEyIDIgMCAxMS00IDB2LTh6TTIgOGEyIDIgMCAwMC0yIDJ2MTJhMiAyIDAgMTA0IDBWMTBhMiAyIDAgMDAtMi0yeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==").then((function(e){var n=Object.assign({},c.defaultOptions,t||{}),a=n.title,o=n.titleColor,i=n.titleAlign,s=n.titleFontSize,l=n.titleFont,u=n.voteButtonText,d=n.voteButtonTextAlign,b=n.voteButtonTextColor,_=n.voteButtonFontSize,h=n.voteButtonFont,p=n.voteButtonBackgroundColor,f=n.width,v=n.height,m=n.radius,g=n.offset,O=n.backgroundColor,w=n.backgroundCircleColor,j=n.backgroundCircleSize,y=n.foregroundCircleColor,S=n.foregroundCircleSize,k=document.createElement("canvas"),A=k.getContext("2d");if(!A)return Promise.reject("canvas context not found");k.width=Number(f),k.height=Number(v)+Number(g),A.fillStyle=String(O||""),Object(r.c)(A,0,Number(g),Number(f),Number(v),Number(m)),A.fill(),A.fillStyle=String(w||""),A.beginPath(),A.arc(Number(f)/2,Number(j),Number(j),0,2*Math.PI,!1),A.fill(),A.fillStyle=String(y||""),A.beginPath(),A.arc(Number(f)/2,Number(j),Number(S),0,2*Math.PI,!1),A.fill();A.drawImage(e,Number(f)/2-27,Number(j)-36,54,72),A.save(),A.font="500 "+s+"px "+l,A.fillStyle=String(o||""),A.textAlign=String(i||""),A.fillText(a,Number(f)/2,230),A.restore(),A.save();var P=Number(f)-75,T=(Number(f)-P)/2,E=Number(v)+Number(g)-103-35;A.fillStyle=String(p||""),Object(r.c)(A,T,E,P,103,29),A.fill(),A.restore(),A.save();var I=Number(f)/2,x=Number(v)+Number(g)-103+30;return A.font="500 "+_+"px "+h,A.fillStyle=String(b||""),A.textAlign=String(d||""),A.fillText(String(u||""),I,x),A.restore(),k}))}c.defaultOptions=i},vhZE:function(t,e,n){"use strict";var r=n("z9sQ"),a=n("z1UI"),o=n("EDm3");var i=function(t){void 0===t&&(t={});var e={},n=t.raw||"",i=t.hash||"",c=t.text||"";"album"===(t.attachment_type||"")&&(t.height-=60),t.type&&"blur"!==t.type||(t.width>=250&&t.height>=250?t.type="blurWithText":t.type="blur"),("blur"===t.type||t.only_icon)&&(delete t.button,delete t.title),t.type&&(e[t.type]=!0);var s,l=r.a.class("PostPhotoRestriction",e);"blur"!==t.type&&"blurWithText"!==t.type||(s=t.width<100||t.height<100?Object(o.mb)():Object(o.Mb)()),"block"===t.type&&(!t.forceText&&(t.width<300||t.height<250)&&(delete t.title,delete t.text),s=t.width<100||t.height<100?Object(o.ab)():Object(o.Ib)()),s={inner:[s],class:"SplashScreen__icon",tag:"div"},"block"!==t.type||t.title||(t.title=t.text);var u="PostPhotoRestriction.clear(this, event, '"+c+"', '"+t.button+"', '"+n+"', '"+i+"')";return{inner:[{inner:[Object(a.a)({title:t.title,icon_raw:s,more_text:t.button,more_type:"outlineMono",more_onclick:u,more_ontouchend:u,more_native_onclick:!0})],class:"PostPhotoRestriction__splash",tag:"div"}],class:l,tag:"div"}},c=n("he4e"),s=n("OcsD"),l=Object(s.K)(i,{clear:c.a,onClearConfirm:c.d,onClearDecline:c.e,isCleared:c.b,onClear:c.c});window.PostPhotoRestriction=l;e.a=l},vk58:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("29dZ"),a=n("+sJP"),o=n("z9sQ");function i(t){var e=t.btns||t.inner||[],n=t.mode||"horizontal",i=t.align||"start";Object(a.A)(t.inner)&&1===t.inner.length&&t.inner[0].length>1&&(e=t.inner[0]),t.nowrap&&(e=e.map((function(t){return t.nowrap=!0,t})));var c,s=o.a.class("BtnStack",{verticalOnSmallScreen:t.verticalOnSmallScreen,stretchOnSmallScreens:t.stretch_on_small_screens,table:t.nowrap,stretch:t.stretch,mode:n,align:i},"_"),l=e.map((function(t){if(!t)return null;var e=["BtnStack__btn"];if(t.class&&e.push(t.class),t.mix&&e.push(t.mix),t.class=Object(a.e)(Object(a.a)(e)),!!t._&&t._.__is_wd_internal_data||Object(a.b)(e,"CellButton")||(t=Object(a.m)(Object(r.a)(t),{nowrap:t.nowrap,is_icon:t.is_icon})),t.nowrap){var n=o.a.class("BtnStack__cell",{icon:t.is_icon},"_");return delete t.nowrap,{inner:[t],class:n,tag:"div"}}return t}));return t.after&&(c={inner:[t.after],class:o.a.class("BtnStack__cell",t.after_mix,"_"),tag:"div"}),{inner:[l[0]?l:null,c],class:s,tag:"div"}}},xAJ7:function(t,e,n){"use strict";var r=n("r/ag"),a=n("29dZ"),o=n("vk58");e.a=function(t){var e=function(t){var e=t.buttons,n=Object.keys(e).map((function(n){var r=e[n],o=r.theme;o="yes"!==n||o?"secondary":"regular";var i={"data-key":n,"data-force":t.force?1:0};return Object(a.a)({inner:[r.text],theme:o,url:r.href,attrs:i,on_click:r.onClick||"ConfirmPopup.onButtonClick(this, event);",use_native_onclick:!0})}));return Object(o.a)({inner:[n]})}(t),n={title:t.title};return Object(r.a)({inner:[Wd.wrap(t.text),{inner:[e],class:"Popup__buttons",tag:"div"}],class:"ConfirmPopup",header:n,scrollable:!0,attrs:' data-use-navigation="'+!!t.useNavigation+'"',on_overlay_click_native:t.onOverlayClick||"ConfirmPopup.onOverlayClick(this, event);"})}},xU72:function(t,e,n){"use strict";var r=n("29dZ"),a=n("Y6JH"),o=n("9b/I"),i=n("WWJR"),c=n("EDm3");e.a=function(t){return void 0===t&&(t={}),{inner:[{inner:[{inner:[Object(r.a)({inner:[Object(a.a)({icon:t.isLeftActionBack?Object(o.a)():Object(i.a)()})],theme:"header",class:"ModalPage__headerButton ModalPage__headerButton--close",onClick:t.onLeftActionClick,use_native_onclick:!0,is_icon:!0}),{inner:[t.title],class:"ModalPage__headerTitle",tag:"div"},t.isConfirmActionAvailable?Object(r.a)({inner:[Object(c.gb)()],theme:"header",class:"ModalPage__headerButton ModalPage__headerButton--confirm",onClick:t.onConfirmClick,use_native_onclick:!0,is_icon:!0}):null],class:"ModalPage__header",tag:"div"},{inner:[t.content],class:"ModalPage__content",id:t.contentId,tag:"div"}],class:"ModalPage__wrapper",tag:"div"}],class:"Popup ModalPage",tag:"div"}}},yJWU:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r,a=n("DM2o");function o(){return r?Promise.resolve(r):Promise.all([n.e("vendor~cropperjs"),n.e("thumbnail_creator")]).then(n.bind(null,"iE2K")).then((function(t){return r=t.ThumbnailCreator})).catch((function(t){return Object(a.a)("mvk_thumbnail_creator_event",null,"chunk_error",t.name)}))}},z1UI:function(t,e,n){"use strict";var r=n("k+Df");e.a=r.a},zhKY:function(t,e,n){"use strict";var r=n("z9sQ"),a=n("UWnA"),o=n("+sJP");function i(t){void 0===t&&(t={});var e,n=t.name,i=t.description,c=t.label||t.inner,s=t.type,l=t.checked,u=t.disabled,d=t.on_change||t.onChange,b=t.ariaHiddenLabel?t.ariaHiddenLabel:"true",_="value"in t?t.value:"1",h=[t.class||t.mix,r.a.class("Control",{type:s},"_")],p=t.attrs||[];p=Object(o.m)({onclick:!0},p),"switcher"===s&&(e="switch");var f=t.name+"_"+_+"_label",v={inner:[{id:t.input_id,class:"Control__native",name:n,value:_,checked:!!l&&"checked",disabled:!!u&&"disabled",type:"switcher"===s?"checkbox":s,onChange:d?["Control._onChange","this",d]:null,"aria-labelledby":c?f:null,role:e,tag:"input"},{class:"Control__icon",tag:"div"},{inner:[{inner:[c],id:f,"aria-hidden":b,tag:"span"},i?{inner:[i],class:"Control__description",tag:"div"}:""],class:"Control__label",tag:"div"}],tag:"div"}.inner;return t.withoutWrap?{inner:[v],class:h,attrs:p,tag:"label"}:(p.role="menuitem",Object(a.b)({inner:[v],tag:"label",class:h,attrs:p}))}e.a=i},zouF:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n("TYsd"),a=n("Po+v"),o=n("+sJP"),i=n("29dZ"),c=n("UxAg");function s(t,e,n,c){void 0===c&&(c={});var s=r.a.preactElemFromTemplate(Object(a.a)({id:c.id,class:"Confirm",scrollable:!0,header:{title:c.title||Object(o.t)("mobile_warning_header")},on_overlay_click_native:n,content:[t,{class:"Popup__buttons",inner:[Object(i.a)({onClick:e,use_native_onclick:!0,class:"Popup__button",theme:c.theme_accept_btn||"regular",url:c.yes_href,inner:c.yes_label||Object(o.t)("mobile_continue")}),Object(i.a)({onClick:n||"Popup.close(this, event)",use_native_onclick:!0,class:"Popup__button",theme:c.theme_close_btn||"secondary",url:c.no_href,inner:c.no_label||Object(o.t)("mobile_cancel")})]}]}));return a.a.open(s,!0,{withoutCloning:!0})}window.page&&window.page.onChange((function(){Object(c.b)(".Confirm").forEach((function(t){return a.a.close(t)}))})),window.Confirm=s}},[[22,"runtime","vendor","icons","b-93a435b854bd32d1172676df2ef0660b","b-cd1bd7666b0b0a417cbe4ad7de6f651d","b-cc249007038b89cf1982a1f77a49d64d","b-81a1af81a054f6bff8edd4d0775bf1af","b-15c2f38da882b2c53340a6b7c7670966"]],["vendor~cropperjs","thumbnail_creator"]]);